import{r as a,j as e,b as xe}from"./react-C_cg2vJ2.js";import{a as xa}from"./react-dom-D3GiQpVl.js";import{j as Ue}from"./jwt-decode-VWaDGczM.js";import{Q as v,a1 as oa,H as P,aA as Qe,aB as fa,a8 as A,_ as q,a4 as Xe,aC as ga,aD as ba,aE as ja,aF as l,aG as me,aH as Se,ax as be,aI as Z,aa as se,ab as te,ac as $,as as ve,X as we,U as H,v as Oa,e as Wa,l as qe,aJ as $a,y as $e,aK as ya,C as Ba,ag as Ga,ah as Ka,ai as Va,aj as qa,aL as Ie,q as ze,ar as Oe,au as He,aM as Be,aN as ea,aO as Ha,aP as Ya,aQ as Ua,aR as _e,aS as We,d as aa,aT as Ja,aU as Za,aV as sa,aW as va,aX as Sa,aY as la,am as Je,aZ as Ze,a_ as Qa,a$ as _a,E as Ca,a0 as wa,b0 as Xa,b1 as es,b2 as as,$ as X,z as Ge,b3 as Ea,b4 as ss,b5 as ta,b6 as ts,b7 as ns,aw as ca,b8 as rs,b9 as Ke,ay as is,az as os,ba as ls,bb as cs,bc as ds,bd as us,af as ms,be as ps,bf as hs,bg as xs,bh as fs,bi as gs,bj as Ta,bk as bs,bl as js}from"./@mui-Bk476INp.js";import{u as Ee,L as da,a as na,b as ys,B as vs,R as Ss,c as pe}from"./react-router-BQSL4b-H.js";import{d as W}from"./dayjs-C-_GrJyW.js";import{u as Pe,M as Ne,a as De,b as Ia}from"./material-react-table-B7UwbLCs.js";import{Q as _s}from"./quill-NHzMMpWD.js";import{S as Ve}from"./date-fns-jgPrqPiU.js";import"./cookie-DhHe99HG.js";import"./scheduler-SPyfQU6S.js";import"./@emotion-Btd9ljfZ.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./@babel-BtohYyOd.js";import"./stylis-DDa9OTMq.js";import"./clsx-B-dksMZM.js";import"./react-transition-group-CZUuWARL.js";import"./dom-helpers-D0mFdbeO.js";import"./prop-types-DO4wCXId.js";import"./@popperjs-DC5wud4b.js";import"./react-is-BPJnJB5S.js";import"./@tanstack-BUN72RuI.js";import"./highlight-words-DCTHEhAM.js";import"./parchment-DI0xVRB_.js";import"./quill-delta-CmVyj_yU.js";import"./fast-diff-BGhgD5-Y.js";import"./lodash.clonedeep-CdAwFVkU.js";import"./lodash.isequal-CVqJ6bXo.js";import"./eventemitter3-DrmIJ5Tj.js";import"./lodash-es-GiBPWDzC.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const g of n.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();const O=async(b,c,s=null,i={},r=!0)=>{const n=localStorage.getItem("accessToken"),m=`https://mgmt.esnpolimi.it/backend${c}`;if(r&&!n)throw new Error("No access token available");const d={"Content-Type":"application/json",...r&&{Authorization:`Bearer ${n}`},...i.headers},x={method:b,headers:d,credentials:"include",...i};s&&(x.body=typeof s=="string"?s:JSON.stringify(s));const C=await fetch(m,x);if(C.status===401)throw new Error("Unauthorized: Access token may have expired");return C},J=async b=>{if(b instanceof Error)return b.message||"Unknown error occurred";if(b&&"ok"in b&&!b.ok)try{const c=await b.text();if(!c)return`Errore server (${b.status}) con risposta vuota`;try{const s=JSON.parse(c);if(typeof s=="string")return s;if(s.detail)return s.detail;if(s.message)return s.message;if(s.non_field_errors)return s.non_field_errors.join(", ");if(s.lists?.non_field_errors)return`Errore formato Liste: ${s.lists.non_field_errors.join(", ")}`;for(const[i,r]of Object.entries(s))if(r)return Array.isArray(r)?r.join(", "):r.toString();return JSON.stringify(s)}catch{return c}}catch{return`Errore server (${b.status})`}return"Errore server sconosciuto"},za=a.createContext(null),Cs="1",ws=({children:b})=>{const c=a.useRef(null),[s,i]=a.useState(localStorage.getItem("accessToken")),[r,n]=a.useState(()=>JSON.parse(localStorage.getItem("user")||"null")),[g,m]=a.useState(!0),d=j=>{try{const{user:o}=Ue(j);return o}catch(o){return console.error("Invalid JWT token",o),null}},x=async(j,o)=>{try{const z=await O("POST","/login/",{username:j,password:o},{},!1);if(z.ok){const h=await z.json(),u=d(h.access);return console.log("Login successful"),i(h.access),console.log("Decoded access token:",u),n(u),localStorage.setItem("accessToken",h.access),localStorage.setItem("user",JSON.stringify(u)),!0}else return console.error("Login error"),await J(z)}catch(z){return console.error("Login error:",z),z}},C=a.useCallback(async({skipApiCall:j=!1}={})=>{console.log("Logout function called"),c.current&&(console.log("Aborting refresh timer..."),clearTimeout(c.current),c.current=null),j||await O("POST","/logout/"),localStorage.removeItem("accessToken"),localStorage.removeItem("user"),i(null),n(null),console.log("Logged out successfully")},[]),_=a.useCallback(async()=>{if(s)try{const j=r?.profile?.email,o=await O("POST","/api/token/refresh/",{email:j},{},!1);if(o.ok){const z=await o.json(),h=d(z.access);return i(z.access),n(h),localStorage.setItem("accessToken",z.access),localStorage.setItem("user",JSON.stringify(h)),!0}else return console.warn("Token refresh failed. Logging out..."),await C(),!1}catch(j){return console.error("Refresh token error:",j),await C(),!1}else return console.log("Skipping token refresh, user is not logged in"),!1},[r,s,C]);return a.useEffect(()=>{const j=()=>{c.current&&(clearTimeout(c.current),c.current=null)};if(!s){console.log("No access token found, skipping refresh scheduling");return}const{exp:o}=Ue(s),z=Math.floor(Date.now()/1e3),h=(o-z-30)*1e3*Cs,u=new Date(o*1e3),t=new Date(z*1e3);if(console.log(`Token expires at: ${u.getHours()}:${u.getMinutes()}, current time: ${t.getHours()}:${t.getMinutes()}, refresh time in s: ${h/1e3}`),h<=0){console.log("Refresh time is not valid, no timer set"),i(null);return}return j(),c.current=setTimeout(()=>{console.log("Refreshing access token..."),_().then()},h),()=>{console.log("Clearing refresh timer"),j()}},[s,_]),a.useEffect(()=>{(async()=>{const o=localStorage.getItem("accessToken"),z=localStorage.getItem("user");if(o&&z)try{const h=Ue(o),u=Math.floor(Date.now()/1e3);h.exp>u?(i(o),n(JSON.parse(z))):await C()}catch(h){console.error("Token decode error",h),await C()}m(!1)})().then()},[C]),e.jsx(za.Provider,{value:{user:r,accessToken:s,refreshAccessToken:_,logout:C,login:x,loading:g},children:b})},Ae=()=>a.useContext(za),Pa=a.createContext(void 0);function Es({children:b}){const[c,s]=a.useState(!1),[i,r]=a.useState(null);a.useEffect(()=>{const m=localStorage.getItem("sidebarDrawerState");m&&s(JSON.parse(m))},[]),a.useEffect(()=>{localStorage.setItem("sidebarDrawerState",JSON.stringify(c))},[c]);const n=m=>d=>{d&&d.type==="keydown"&&(d.key==="Tab"||d.key==="Shift")||s(m)},g=m=>{r(d=>d===m?null:m)};return e.jsx(Pa.Provider,{value:{isDrawerOpen:c,toggleDrawer:n,expandedSection:i,handleExpand:g},children:b})}function Ts(){return a.useContext(Pa)}const ra=""+new URL("esnpolimi-logo-BJJf0P2z.png",import.meta.url).href,Fe=({message:b,state:c,successText:s,errorText:i})=>e.jsxs(v,{sx:{mt:2,mb:2,display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",p:2,borderRadius:5,boxShadow:3,bgcolor:"background.paper"},children:[c==="success"&&e.jsxs(e.Fragment,{children:[e.jsx(oa,{severity:"success",sx:{width:"100%",mb:1},children:b||"Success!"}),s&&e.jsx(P,{children:s})]}),c==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(oa,{severity:"error",sx:{width:"100%",mb:1},children:b||"An error occurred"}),i&&e.jsx(P,{children:i})]})]});function Is(){const[b,c]=a.useState(""),[s,i]=a.useState(""),[r,n]=a.useState(!1),{login:g}=Ae(),m=Ee(),[d,x]=a.useState(null),[C,_]=a.useState(!1),[j,o]=a.useState(!1),z=async()=>{o(!0);try{console.log("Sending forgot password request for:",b);const u=await O("POST","/api/forgot-password/",{email:b},{},!1);if(u.ok)_(!0),x({message:`Se il profilo è registrato, l'email è stata inviata con successo a "`+b+'". Controlla la tua casella di posta.',state:"success"});else{const t=await J(u);x({message:`Errore durante l'invio dell'email: ${t}`,state:"error"})}}catch(u){x({message:`Errore generale: ${u}`,state:"error"})}finally{o(!1)}},h=async()=>{o(!0),x(null);const u=await g(b,s);o(!1),u===!0?m("/"):x({message:`Errore durante il login: ${u}`,state:"error"})};return e.jsxs(Qe,{component:"main",maxWidth:"xs",children:[e.jsx(fa,{}),e.jsxs(v,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("img",{alt:"",src:ra,style:{height:"25vh"}}),e.jsxs(v,{children:[!C&&e.jsx(A,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email",name:"email",autoComplete:"email",autoFocus:!0,onChange:u=>c(u.target.value),onKeyDown:u=>u.key==="Enter"&&(r?z():h())}),!r&&e.jsx(A,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",onChange:u=>i(u.target.value),onKeyDown:u=>u.key==="Enter"&&h()}),!C&&e.jsx(q,{fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,backgroundColor:"black"},onClick:r?z:h,disabled:j,children:j?e.jsx(Xe,{size:24,color:"inherit"}):r?"Invia Email di Reset":"Log In"}),e.jsx(v,{sx:{display:"flex",justifyContent:"center",width:"100%"},children:e.jsx(ga,{component:"button",variant:"body2",onClick:()=>{n(!r),_(!1),x(null)},sx:{textAlign:"center"},children:r?"Torna al Login":"Password dimenticata?"})})]}),d&&e.jsx(Fe,{message:d.message,state:d.state})]})]})}const Ce=JSON.parse(`[{"name":"Afghanistan","dial":"+93","code":"AF"},{"name":"Aland Islands","dial":"+358","code":"AX"},{"name":"Albania","dial":"+355","code":"AL"},{"name":"Algeria","dial":"+213","code":"DZ"},{"name":"AmericanSamoa","dial":"+1684","code":"AS"},{"name":"Andorra","dial":"+376","code":"AD"},{"name":"Angola","dial":"+244","code":"AO"},{"name":"Anguilla","dial":"+1264","code":"AI"},{"name":"Antarctica","dial":"+672","code":"AQ"},{"name":"Antigua and Barbuda","dial":"+1268","code":"AG"},{"name":"Argentina","dial":"+54","code":"AR"},{"name":"Armenia","dial":"+374","code":"AM"},{"name":"Aruba","dial":"+297","code":"AW"},{"name":"Australia","dial":"+61","code":"AU"},{"name":"Austria","dial":"+43","code":"AT"},{"name":"Azerbaijan","dial":"+994","code":"AZ"},{"name":"Bahamas","dial":"+1242","code":"BS"},{"name":"Bahrain","dial":"+973","code":"BH"},{"name":"Bangladesh","dial":"+880","code":"BD"},{"name":"Barbados","dial":"+1246","code":"BB"},{"name":"Belarus","dial":"+375","code":"BY"},{"name":"Belgium","dial":"+32","code":"BE"},{"name":"Belize","dial":"+501","code":"BZ"},{"name":"Benin","dial":"+229","code":"BJ"},{"name":"Bermuda","dial":"+1441","code":"BM"},{"name":"Bhutan","dial":"+975","code":"BT"},{"name":"Bolivia, Plurinational State of","dial":"+591","code":"BO"},{"name":"Bosnia and Herzegovina","dial":"+387","code":"BA"},{"name":"Botswana","dial":"+267","code":"BW"},{"name":"Brazil","dial":"+55","code":"BR"},{"name":"British Indian Ocean Territory","dial":"+246","code":"IO"},{"name":"Brunei Darussalam","dial":"+673","code":"BN"},{"name":"Bulgaria","dial":"+359","code":"BG"},{"name":"Burkina Faso","dial":"+226","code":"BF"},{"name":"Burundi","dial":"+257","code":"BI"},{"name":"Cambodia","dial":"+855","code":"KH"},{"name":"Cameroon","dial":"+237","code":"CM"},{"name":"Canada","dial":"+1","code":"CA"},{"name":"Cape Verde","dial":"+238","code":"CV"},{"name":"Cayman Islands","dial":"+ 345","code":"KY"},{"name":"Central African Republic","dial":"+236","code":"CF"},{"name":"Chad","dial":"+235","code":"TD"},{"name":"Chile","dial":"+56","code":"CL"},{"name":"China","dial":"+86","code":"CN"},{"name":"Christmas Island","dial":"+61","code":"CX"},{"name":"Cocos (Keeling) Islands","dial":"+61","code":"CC"},{"name":"Colombia","dial":"+57","code":"CO"},{"name":"Comoros","dial":"+269","code":"KM"},{"name":"Congo","dial":"+242","code":"CG"},{"name":"Congo, The Democratic Republic of the Congo","dial":"+243","code":"CD"},{"name":"Cook Islands","dial":"+682","code":"CK"},{"name":"Costa Rica","dial":"+506","code":"CR"},{"name":"Cote d'Ivoire","dial":"+225","code":"CI"},{"name":"Croatia","dial":"+385","code":"HR"},{"name":"Cuba","dial":"+53","code":"CU"},{"name":"Cyprus","dial":"+357","code":"CY"},{"name":"Czech Republic","dial":"+420","code":"CZ"},{"name":"Denmark","dial":"+45","code":"DK"},{"name":"Djibouti","dial":"+253","code":"DJ"},{"name":"Dominica","dial":"+1767","code":"DM"},{"name":"Dominican Republic","dial":"+1849","code":"DO"},{"name":"Ecuador","dial":"+593","code":"EC"},{"name":"Egypt","dial":"+20","code":"EG"},{"name":"El Salvador","dial":"+503","code":"SV"},{"name":"Equatorial Guinea","dial":"+240","code":"GQ"},{"name":"Eritrea","dial":"+291","code":"ER"},{"name":"Estonia","dial":"+372","code":"EE"},{"name":"Ethiopia","dial":"+251","code":"ET"},{"name":"Falkland Islands (Malvinas)","dial":"+500","code":"FK"},{"name":"Faroe Islands","dial":"+298","code":"FO"},{"name":"Fiji","dial":"+679","code":"FJ"},{"name":"Finland","dial":"+358","code":"FI"},{"name":"France","dial":"+33","code":"FR"},{"name":"French Guiana","dial":"+594","code":"GF"},{"name":"French Polynesia","dial":"+689","code":"PF"},{"name":"Gabon","dial":"+241","code":"GA"},{"name":"Gambia","dial":"+220","code":"GM"},{"name":"Georgia","dial":"+995","code":"GE"},{"name":"Germany","dial":"+49","code":"DE"},{"name":"Ghana","dial":"+233","code":"GH"},{"name":"Gibraltar","dial":"+350","code":"GI"},{"name":"Greece","dial":"+30","code":"GR"},{"name":"Greenland","dial":"+299","code":"GL"},{"name":"Grenada","dial":"+1473","code":"GD"},{"name":"Guadeloupe","dial":"+590","code":"GP"},{"name":"Guam","dial":"+1671","code":"GU"},{"name":"Guatemala","dial":"+502","code":"GT"},{"name":"Guernsey","dial":"+44","code":"GG"},{"name":"Guinea","dial":"+224","code":"GN"},{"name":"Guinea-Bissau","dial":"+245","code":"GW"},{"name":"Guyana","dial":"+595","code":"GY"},{"name":"Haiti","dial":"+509","code":"HT"},{"name":"Holy See (Vatican City State)","dial":"+379","code":"VA"},{"name":"Honduras","dial":"+504","code":"HN"},{"name":"Hong Kong","dial":"+852","code":"HK"},{"name":"Hungary","dial":"+36","code":"HU"},{"name":"Iceland","dial":"+354","code":"IS"},{"name":"India","dial":"+91","code":"IN"},{"name":"Indonesia","dial":"+62","code":"ID"},{"name":"Iran, Islamic Republic of Persian Gulf","dial":"+98","code":"IR"},{"name":"Iraq","dial":"+964","code":"IQ"},{"name":"Ireland","dial":"+353","code":"IE"},{"name":"Isle of Man","dial":"+44","code":"IM"},{"name":"Israel","dial":"+972","code":"IL"},{"name":"Italy","dial":"+39","code":"IT"},{"name":"Jamaica","dial":"+1876","code":"JM"},{"name":"Japan","dial":"+81","code":"JP"},{"name":"Jersey","dial":"+44","code":"JE"},{"name":"Jordan","dial":"+962","code":"JO"},{"name":"Kazakhstan","dial":"+77","code":"KZ"},{"name":"Kenya","dial":"+254","code":"KE"},{"name":"Kiribati","dial":"+686","code":"KI"},{"name":"Korea, Democratic People's Republic of Korea","dial":"+850","code":"KP"},{"name":"Korea, Republic of South Korea","dial":"+82","code":"KR"},{"name":"Kuwait","dial":"+965","code":"KW"},{"name":"Kyrgyzstan","dial":"+996","code":"KG"},{"name":"Laos","dial":"+856","code":"LA"},{"name":"Latvia","dial":"+371","code":"LV"},{"name":"Lebanon","dial":"+961","code":"LB"},{"name":"Lesotho","dial":"+266","code":"LS"},{"name":"Liberia","dial":"+231","code":"LR"},{"name":"Libyan Arab Jamahiriya","dial":"+218","code":"LY"},{"name":"Liechtenstein","dial":"+423","code":"LI"},{"name":"Lithuania","dial":"+370","code":"LT"},{"name":"Luxembourg","dial":"+352","code":"LU"},{"name":"Macao","dial":"+853","code":"MO"},{"name":"Macedonia","dial":"+389","code":"MK"},{"name":"Madagascar","dial":"+261","code":"MG"},{"name":"Malawi","dial":"+265","code":"MW"},{"name":"Malaysia","dial":"+60","code":"MY"},{"name":"Maldives","dial":"+960","code":"MV"},{"name":"Mali","dial":"+223","code":"ML"},{"name":"Malta","dial":"+356","code":"MT"},{"name":"Marshall Islands","dial":"+692","code":"MH"},{"name":"Martinique","dial":"+596","code":"MQ"},{"name":"Mauritania","dial":"+222","code":"MR"},{"name":"Mauritius","dial":"+230","code":"MU"},{"name":"Mayotte","dial":"+262","code":"YT"},{"name":"Mexico","dial":"+52","code":"MX"},{"name":"Micronesia, Federated States of Micronesia","dial":"+691","code":"FM"},{"name":"Moldova","dial":"+373","code":"MD"},{"name":"Monaco","dial":"+377","code":"MC"},{"name":"Mongolia","dial":"+976","code":"MN"},{"name":"Montenegro","dial":"+382","code":"ME"},{"name":"Montserrat","dial":"+1664","code":"MS"},{"name":"Morocco","dial":"+212","code":"MA"},{"name":"Mozambique","dial":"+258","code":"MZ"},{"name":"Myanmar","dial":"+95","code":"MM"},{"name":"Namibia","dial":"+264","code":"NA"},{"name":"Nauru","dial":"+674","code":"NR"},{"name":"Nepal","dial":"+977","code":"NP"},{"name":"Netherlands","dial":"+31","code":"NL"},{"name":"Netherlands Antilles","dial":"+599","code":"AN"},{"name":"New Caledonia","dial":"+687","code":"NC"},{"name":"New Zealand","dial":"+64","code":"NZ"},{"name":"Nicaragua","dial":"+505","code":"NI"},{"name":"Niger","dial":"+227","code":"NE"},{"name":"Nigeria","dial":"+234","code":"NG"},{"name":"Niue","dial":"+683","code":"NU"},{"name":"Norfolk Island","dial":"+672","code":"NF"},{"name":"Northern Mariana Islands","dial":"+1670","code":"MP"},{"name":"Norway","dial":"+47","code":"NO"},{"name":"Oman","dial":"+968","code":"OM"},{"name":"Pakistan","dial":"+92","code":"PK"},{"name":"Palau","dial":"+680","code":"PW"},{"name":"Palestinian Territory, Occupied","dial":"+970","code":"PS"},{"name":"Panama","dial":"+507","code":"PA"},{"name":"Papua New Guinea","dial":"+675","code":"PG"},{"name":"Paraguay","dial":"+595","code":"PY"},{"name":"Peru","dial":"+51","code":"PE"},{"name":"Philippines","dial":"+63","code":"PH"},{"name":"Pitcairn","dial":"+872","code":"PN"},{"name":"Poland","dial":"+48","code":"PL"},{"name":"Portugal","dial":"+351","code":"PT"},{"name":"Puerto Rico","dial":"+1939","code":"PR"},{"name":"Qatar","dial":"+974","code":"QA"},{"name":"Romania","dial":"+40","code":"RO"},{"name":"Russia","dial":"+7","code":"RU"},{"name":"Rwanda","dial":"+250","code":"RW"},{"name":"Reunion","dial":"+262","code":"RE"},{"name":"Saint Barthelemy","dial":"+590","code":"BL"},{"name":"Saint Helena, Ascension and Tristan Da Cunha","dial":"+290","code":"SH"},{"name":"Saint Kitts and Nevis","dial":"+1869","code":"KN"},{"name":"Saint Lucia","dial":"+1758","code":"LC"},{"name":"Saint Martin","dial":"+590","code":"MF"},{"name":"Saint Pierre and Miquelon","dial":"+508","code":"PM"},{"name":"Saint Vincent and the Grenadines","dial":"+1784","code":"VC"},{"name":"Samoa","dial":"+685","code":"WS"},{"name":"San Marino","dial":"+378","code":"SM"},{"name":"Sao Tome and Principe","dial":"+239","code":"ST"},{"name":"Saudi Arabia","dial":"+966","code":"SA"},{"name":"Senegal","dial":"+221","code":"SN"},{"name":"Serbia","dial":"+381","code":"RS"},{"name":"Seychelles","dial":"+248","code":"SC"},{"name":"Sierra Leone","dial":"+232","code":"SL"},{"name":"Singapore","dial":"+65","code":"SG"},{"name":"Slovakia","dial":"+421","code":"SK"},{"name":"Slovenia","dial":"+386","code":"SI"},{"name":"Solomon Islands","dial":"+677","code":"SB"},{"name":"Somalia","dial":"+252","code":"SO"},{"name":"South Africa","dial":"+27","code":"ZA"},{"name":"South Sudan","dial":"+211","code":"SS"},{"name":"South Georgia and the South Sandwich Islands","dial":"+500","code":"GS"},{"name":"Spain","dial":"+34","code":"ES"},{"name":"Sri Lanka","dial":"+94","code":"LK"},{"name":"Sudan","dial":"+249","code":"SD"},{"name":"Suriname","dial":"+597","code":"SR"},{"name":"Svalbard and Jan Mayen","dial":"+47","code":"SJ"},{"name":"Swaziland","dial":"+268","code":"SZ"},{"name":"Sweden","dial":"+46","code":"SE"},{"name":"Switzerland","dial":"+41","code":"CH"},{"name":"Syrian Arab Republic","dial":"+963","code":"SY"},{"name":"Taiwan","dial":"+886","code":"TW"},{"name":"Tajikistan","dial":"+992","code":"TJ"},{"name":"Tanzania, United Republic of Tanzania","dial":"+255","code":"TZ"},{"name":"Thailand","dial":"+66","code":"TH"},{"name":"Timor-Leste","dial":"+670","code":"TL"},{"name":"Togo","dial":"+228","code":"TG"},{"name":"Tokelau","dial":"+690","code":"TK"},{"name":"Tonga","dial":"+676","code":"TO"},{"name":"Trinidad and Tobago","dial":"+1868","code":"TT"},{"name":"Tunisia","dial":"+216","code":"TN"},{"name":"Turkey","dial":"+90","code":"TR"},{"name":"Turkmenistan","dial":"+993","code":"TM"},{"name":"Turks and Caicos Islands","dial":"+1649","code":"TC"},{"name":"Tuvalu","dial":"+688","code":"TV"},{"name":"Uganda","dial":"+256","code":"UG"},{"name":"Ukraine","dial":"+380","code":"UA"},{"name":"United Arab Emirates","dial":"+971","code":"AE"},{"name":"United Kingdom","dial":"+44","code":"GB"},{"name":"United States","dial":"+1","code":"US"},{"name":"Uruguay","dial":"+598","code":"UY"},{"name":"Uzbekistan","dial":"+998","code":"UZ"},{"name":"Vanuatu","dial":"+678","code":"VU"},{"name":"Venezuela, Bolivarian Republic of Venezuela","dial":"+58","code":"VE"},{"name":"Vietnam","dial":"+84","code":"VN"},{"name":"Virgin Islands, British","dial":"+1284","code":"VG"},{"name":"Virgin Islands, U.S.","dial":"+1340","code":"VI"},{"name":"Wallis and Futuna","dial":"+681","code":"WF"},{"name":"Yemen","dial":"+967","code":"YE"},{"name":"Zambia","dial":"+260","code":"ZM"},{"name":"Zimbabwe","dial":"+263","code":"ZW"}]`);function zs(){const[b,c]=xe.useState(!1),[s,i]=xe.useState(!0),[r,n]=a.useState(null),[g,m]=xe.useState({name:"",surname:"",email:"",email_confirm:"",birthdate:W(),country:"",phone_prefix:"+39",phone_number:"",whatsapp_prefix:"+39",whatsapp_number:"",person_code:"",domicile:"",course:"","document-type":"","document-number":"","document-expiration":W(),matricola_number:"",matricola_expiration:W(),is_esner:!1}),[d,x]=xe.useState({email:[!1,""],email_confirm:[!1,""],name:[!1,""],surname:[!1,""],birthdate:[!1,""],country:[!1,""],phone_prefix:[!1,""],phone_number:[!1,""],whatsapp_prefix:[!1,""],whatsapp_number:[!1,""],person_code:[!1,""],domicile:[!1,""],course:[!1,""],"document-type":[!1,""],"document-number":[!1,""],"document-expiration":[!1,""],matricola_number:[!1,""],matricola_expiration:[!1,""],is_esner:[!1,""]}),C=()=>{let t=!0;const f={...d};return/^\d{6}$/.test(g.matricola_number)?f.matricola_number=[!1,""]:(f.matricola_number=[!0,"Matricola must be exactly 6 digits"],t=!1),/^\d{8}$/.test(g.person_code)?f.person_code=[!1,""]:(f.person_code=[!0,"Person Code must be exactly 8 digits"],t=!1),g.email!==g.email_confirm?(f.email_confirm=[!0,"Emails do not match"],t=!1):f.email_confirm=[!1,""],x(f),t},_=()=>{window.scrollTo({top:0,behavior:"smooth"})},j=t=>W(t).format("YYYY-MM-DD"),o=t=>{m({...g,[t.target.name]:t.target.value})},z=(t,f)=>{m({...g,[t]:f})},h=t=>{if(t.preventDefault(),!C()){_();return}let f={...g,whatsapp_prefix:s?g.phone_prefix:g.whatsapp_prefix,whatsapp_number:s?g.phone_number:g.whatsapp_number,birthdate:j(g.birthdate),"document-expiration":j(g["document-expiration"]),matricola_expiration:j(g.matricola_expiration)};(async()=>{try{const D=await O("POST","/profile/initiate-creation/",f,{},!1),F=await D.json();if(D.ok)c(!0);else{n({message:"Failed to submit application: see errors below",state:"error"});const V={...d};Object.entries(F).forEach(([ee,I])=>{V[ee]&&(V[ee]=[!0,I])}),x(V)}}catch(D){n({message:"Internal error (please contact us): "+D.message,state:"error"})}})().then(),_()},u=t=>{i(t.target.checked),t.target.checked&&m({...g,whatsapp_prefix:g.phone_prefix,whatsapp_number:g.phone_number})};return b?e.jsxs(v,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",bgcolor:"#fff",children:[e.jsx(ba,{style:{fontSize:100,color:ja[500]}}),e.jsx(P,{variant:"h4",align:"center",gutterBottom:!0,children:"Your response has been sent."}),e.jsx(P,{variant:"subtitle1",align:"center",children:"Check your inbox to verify your e-mail."})]}):e.jsxs(v,{component:"form",sx:{maxWidth:800,margin:"auto",mt:5,mb:5,px:4},onSubmit:h,children:[e.jsx(P,{variant:"h4",align:"center",gutterBottom:!0,mb:5,children:"ESN Polimi Registration - International Student"}),r&&e.jsx(Fe,{message:r.message,state:r.state}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,sx:{my:4},children:"Personal Information"}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{size:{xs:12,sm:4},children:e.jsx(A,{label:"Name",variant:"outlined",name:"name",value:g.name,onChange:o,fullWidth:!0,required:!0,error:d.name[0]})}),e.jsx(l,{size:{xs:12,sm:4},children:e.jsx(A,{label:"Surname",variant:"outlined",name:"surname",value:g.surname,onChange:o,fullWidth:!0,required:!0})}),e.jsx(l,{size:{xs:12,sm:4},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(be,{label:"Birthdate",value:g.birthdate,onChange:t=>z("birthdate",t),renderInput:t=>e.jsx(A,{...t,fullWidth:!0,required:!0})})})}),e.jsx(l,{size:{xs:12,sm:6},children:e.jsx(A,{label:"Email",variant:"outlined",name:"email",type:"email",value:g.email,onChange:o,fullWidth:!0,required:!0,error:d.email[0],helperText:d.email[1]})}),e.jsx(l,{size:{xs:12,sm:6},children:e.jsx(A,{label:"Confirm Email",variant:"outlined",name:"email_confirm",type:"email",value:g.email_confirm,onChange:o,fullWidth:!0,required:!0,error:d.email_confirm[0],helperText:d.email_confirm[1]})}),e.jsx(l,{size:{xs:12,sm:6},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(se,{id:"country-label",children:"Home University Country"}),e.jsxs(te,{variant:"outlined",labelId:"country-label",name:"country",value:g.country,onChange:o,label:"Home University Country",error:d.country[0],children:[e.jsx($,{value:"",children:e.jsx("em",{children:"None"})}),Ce.map(t=>e.jsx($,{value:t.code,children:t.name},t.code))]})]})}),e.jsx(l,{size:{xs:12,sm:6},children:e.jsx(A,{label:"Home Domicile",variant:"outlined",name:"domicile",value:g.domicile,onChange:o,fullWidth:!0,required:!0})}),e.jsx(l,{size:{xs:4,sm:2},children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(se,{id:"phone-prefix-label",children:"Prefix"}),e.jsx(te,{variant:"outlined",labelId:"phone-prefix-label",id:"phone-prefix",name:"phone_prefix",value:g.phone_prefix,onChange:o,label:"Prefix",renderValue:t=>t,children:Ce.map(t=>e.jsxs($,{value:t.dial,children:[t.dial," (",t.name,")"]},t.code))})]})}),e.jsx(l,{size:{xs:8,sm:4},children:e.jsx(A,{label:"Phone Number",variant:"outlined",name:"phone_number",type:"number",value:g.phone_number,onChange:o,fullWidth:!0,required:!0,error:d.phone_number[0],helperText:d.phone_number[1]})}),e.jsx(l,{size:{xs:12,sm:6},children:e.jsx(ve,{control:e.jsx(we,{checked:s,onChange:u,name:"sameAsPhone",color:"primary"}),label:"Same number for WhatsApp"})}),!s&&e.jsxs(e.Fragment,{children:[e.jsx(l,{size:{xs:4,sm:2},children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(se,{id:"whatsapp-prefix-label",children:"Prefix"}),e.jsx(te,{variant:"outlined",labelId:"whatsapp-prefix-label",id:"whatsapp-prefix",name:"whatsapp_prefix",value:g.whatsapp_prefix,onChange:o,label:"Prefix",renderValue:t=>t,children:Ce.map(t=>e.jsxs($,{value:t.dial,children:[t.dial," (",t.name,")"]},t.code))})]})}),e.jsx(l,{size:{xs:8,sm:4},children:e.jsx(A,{label:"Whatsapp Number",variant:"outlined",name:"whatsapp_number",type:"number",value:g.whatsapp_number,onChange:o,fullWidth:!0,required:!0,error:d.whatsapp_number[0],helperText:d.whatsapp_number[1]})})]})]}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Document Information"}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{size:{xs:12,sm:4},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(se,{id:"idType-label",children:"Type"}),e.jsxs(te,{variant:"outlined",labelId:"document-type-label",name:"document-type",value:g["document-type"],onChange:o,label:"Type",required:!0,error:d["document-type"][0],children:[e.jsx($,{value:"Passport",children:"Passport"}),e.jsx($,{value:"ID Card",children:"ID Card"}),e.jsx($,{value:"Driving License",children:"Driving License"}),e.jsx($,{value:"Residency Permit",children:"Residency Permit"}),e.jsx($,{value:"Other",children:"Other"})]})]})}),e.jsx(l,{size:{xs:12,sm:4},children:e.jsx(A,{label:"Number",variant:"outlined",name:"document-number",value:g["document-number"],onChange:o,fullWidth:!0,required:!0,error:d["document-number"][0],helperText:d["document-number"][1]})}),e.jsx(l,{size:{xs:12,sm:4},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(be,{label:"Expiration Date",value:g["document-expiration"],onChange:t=>z("document-expiration",t),renderInput:t=>e.jsx(A,{...t,fullWidth:!0,required:!0})})})})]}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Exchange Information"}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{size:{xs:12,sm:6},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(se,{id:"course-label",children:"Field of Study"}),e.jsxs(te,{variant:"outlined",labelId:"course-label",name:"course",value:g.course,onChange:o,label:"Field of Study",error:d.course[0],children:[e.jsx($,{value:"Engineering",children:"Engineering"}),e.jsx($,{value:"Design",children:"Design"}),e.jsx($,{value:"Architecture",children:"Architecture"})]})]})}),e.jsx(l,{size:{xs:12,sm:6},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(be,{label:"Exchange End Date",value:g.matricola_expiration,onChange:t=>z("matricola_expiration",t),renderInput:t=>e.jsx(A,{...t,fullWidth:!0,required:!0})})})}),e.jsx(l,{size:{xs:12,sm:6},children:e.jsx(A,{label:"Person Code (8 digits)",variant:"outlined",name:"person_code",type:"number",value:g.person_code,onChange:o,fullWidth:!0,required:!0,error:d.person_code[0],helperText:d.person_code[1]})}),e.jsx(l,{size:{xs:12,sm:6},children:e.jsx(A,{label:"Matricola (6 digits)",variant:"outlined",name:"matricola_number",type:"number",value:g.matricola_number,onChange:o,fullWidth:!0,required:!0,error:d.matricola_number[0],helperText:d.matricola_number[1]})}),e.jsx(l,{size:{xs:12},children:e.jsxs(P,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["You can find your Person Code and Matricola in the Polimi App under your profile section, or from the Online Services.",e.jsx("br",{})," In case the university has not provided you a Matricola yet, you can fill the field with 6 '0's."]})})]}),e.jsxs(l,{container:!0,spacing:3,mt:3,children:[e.jsx(l,{size:{xs:12},children:e.jsx(ve,{control:e.jsx(we,{name:"acceptTerms",required:!0}),label:"I declare that I read and have accepted the ESN Politecnico Milano Charter"})}),e.jsx(l,{size:{xs:12},children:e.jsx(ve,{control:e.jsx(we,{name:"acceptPrivacyPolicy",required:!0}),label:"I declare that I fully share the aims of the Association (ref. Article 2 of the Charter)"})}),e.jsx(l,{size:{xs:12},children:e.jsx(ve,{control:e.jsx(we,{name:"acceptPrivacyPolicy",required:!0}),label:"I declare that I accept all the terms stated in the Charter, the Internal Rules and all subsequent changes and additions"})}),e.jsx(l,{size:{xs:12},children:e.jsx(ve,{control:e.jsx(we,{name:"acceptPrivacyPolicy",required:!0}),label:"I declare that I have read the attached disclaimer about Privacy and that I agree to the usage of my personal data according to the Regulation EU 2016/679 (GDPR) and to be aware of my guaranteed rights by the afore-mentioned law"})})]}),e.jsx(q,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:4},children:"Submit"})]})}const L={id:"Id",name:"Nome",surname:"Cognome",group:"Gruppo",email:"Email",phone_prefix:"Prefisso Tel",phone_number:"Numero Telefono",whatsapp_prefix:"Prefisso WA",whatsapp_number:"Numero WhatsApp",country:"Paese",birthdate:"Data di Nascita",latest_esncard:"ESNcard",latest_document:"Documento",matricola_number:"Matricola",matricola_expiration:"Scadenza Matricola",course:"Corso di Studi",person_code:"Codice Persona",domicile:"Domicilio"},he={id:"Id",name:"Nome Evento",date:"Data Evento",description:"Descrizione",cost:"Costo (€)",subscription_start_date:"Data Apertura Iscrizioni",subscription_end_date:"Data Chiusura Iscrizioni",subscription_date_status:"Stato Iscrizioni",list_name:"Nome Lista",list_capacity:"Capacità Lista"},ue={id:"Id",name:"Nome",status:"Stato",balance:"Saldo",changed_by:"Ultima Modifica",visible_to_groups:"Gruppi di Visibilità"},ae={date:"Data",type:"Tipo",description:"Descrizione",amount:"Importo",executor:"Eseguito da",account:"Cassa",tran_type:{event:"Evento",esncard:"ESNcard",deposit:"Deposito",withdrawal:"Prelievo",subscription:"Iscrizione"}};function Ps(){const[b,c]=xe.useState(!1),[s,i]=a.useState(null),r=L,[n,g]=xe.useState({email:"",email_confirm:"",password:"",password_confirm:"",name:"",surname:"",birthdate:W(),country:"IT",phone_prefix:"+39",phone_number:"",person_code:"",domicile:"","document-type":"","document-number":"","document-expiration":W(),matricola_number:"",is_esner:!0}),[m,d]=xe.useState({email:[!1,""],email_confirm:[!1,""],password:[!1,""],password_confirm:[!1,""],name:[!1,""],surname:[!1,""],birthdate:[!1,""],country:[!1,""],phone_prefix:[!1,""],phone_number:[!1,""],person_code:[!1,""],domicile:[!1,""],"document-type":[!1,""],"document-number":[!1,""],"document-expiration":[!1,""],matricola_number:[!1,""],is_esner:[!1,""]}),x=()=>{let h=!0;const u={...m};return/^\d{6}$/.test(n.matricola_number)?u.matricola_number=[!1,""]:(u.matricola_number=[!0,"Matricola must be exactly 6 digits"],h=!1),/^\d{8}$/.test(n.person_code)?u.person_code=[!1,""]:(u.person_code=[!0,"Person Code must be exactly 8 digits"],h=!1),n.email!==n.email_confirm?(u.email_confirm=[!0,"Emails do not match"],h=!1):u.email_confirm=[!1,""],n.password!==n.password_confirm?(u.password_confirm=[!0,"Passwords not corresponding"],h=!1):u.password_confirm=[!1,""],d(u),h},C=()=>{window.scrollTo({top:0,behavior:"smooth"})},_=h=>W(h).format("YYYY-MM-DD"),j=h=>{g({...n,[h.target.name]:h.target.value})},o=(h,u)=>{g({...n,[h]:u})},z=h=>{if(h.preventDefault(),!x()){C();return}let u={...n,birthdate:_(n.birthdate),"document-expiration":_(n["document-expiration"]),matricola_expiration:_(n.matricola_expiration)};(async()=>{try{const f=await O("POST","/profile/initiate-creation/",u,{},!1),S=await f.json();if(f.ok)c(!0);else{i({message:"Failed to submit application: see errors below",state:"error"});const D={...m};Object.entries(S).forEach(([F,V])=>{D[F]&&(D[F]=[!0,V])}),d(D)}}catch(f){i({message:"Internal error (please contact us): "+f.message,state:"error"})}})().then(),C()};return b?e.jsxs(v,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",bgcolor:"#fff",children:[e.jsx(ba,{style:{fontSize:100,color:ja[500]}}),e.jsx(P,{variant:"h4",align:"center",gutterBottom:!0,children:"Your response has been sent."}),e.jsx(P,{variant:"subtitle1",align:"center",children:"Check your inbox to verify your e-mail."})]}):e.jsxs(v,{component:"form",sx:{maxWidth:800,margin:"auto",mt:5,mb:5,px:4},onSubmit:z,children:[e.jsx(P,{variant:"h4",align:"center",gutterBottom:!0,mb:5,children:"ESN Polimi - Registrazione ESNer"}),s&&e.jsx(Fe,{message:s.message,state:s.state}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,sx:{my:4},children:"Informazioni Personali"}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{size:{xs:12,sm:4},children:e.jsx(A,{label:r.name,variant:"outlined",name:"name",value:n.name,onChange:j,fullWidth:!0,required:!0,error:m.name[0]})}),e.jsx(l,{size:{xs:12,sm:4},children:e.jsx(A,{label:r.surname,variant:"outlined",name:"surname",value:n.surname,onChange:j,fullWidth:!0,required:!0})}),e.jsx(l,{size:{xs:12,sm:4},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(be,{label:r.birthdate,value:n.birthdate,onChange:h=>o("birthdate",h),renderInput:h=>e.jsx(A,{...h,fullWidth:!0,required:!0})})})}),e.jsx(l,{size:{xs:12,sm:6},children:e.jsx(A,{label:r.email,variant:"outlined",name:"email",type:"email",value:n.email,onChange:j,fullWidth:!0,required:!0,error:m.email[0],helperText:m.email[1]})}),e.jsx(l,{size:{xs:12,sm:6},children:e.jsx(A,{label:"Conferma Email",variant:"outlined",name:"email_confirm",type:"email",value:n.email_confirm,onChange:j,fullWidth:!0,required:!0,error:m.email_confirm[0],helperText:m.email_confirm[1]})}),e.jsx(l,{size:{xs:12,sm:6},children:e.jsx(A,{type:"password",label:"Password",variant:"outlined",name:"password",value:n.password,onChange:j,fullWidth:!0,required:!0})}),e.jsx(l,{size:{xs:12,sm:6},children:e.jsx(A,{type:"password",label:"Conferma Password",variant:"outlined",name:"password_confirm",value:n.password_confirm,onChange:j,fullWidth:!0,required:!0,error:m.password_confirm[0],helperText:m.password_confirm[1]})}),e.jsx(l,{size:{xs:12,sm:6},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(se,{id:"country-label",children:r.country}),e.jsxs(te,{variant:"outlined",labelId:"country-label",name:"country",value:n.country,onChange:j,label:r.country,error:m.country[0],children:[e.jsx($,{value:"",children:e.jsx("em",{children:"None"})}),Ce.map(h=>e.jsx($,{value:h.code,children:h.name},h.code))]})]})}),e.jsx(l,{size:{xs:12,sm:6},children:e.jsx(A,{label:r.domicile,variant:"outlined",name:"domicile",value:n.domicile,onChange:j,fullWidth:!0,required:!0})}),e.jsx(l,{size:{xs:4,sm:2},children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(se,{id:"phone-prefix-label",children:r.phone_prefix}),e.jsx(te,{variant:"outlined",labelId:"phone-prefix-label",id:"phone-prefix",name:"phone_prefix",value:n.phone_prefix,onChange:j,label:r.phone_prefix,renderValue:h=>h,children:Ce.map(h=>e.jsxs($,{value:h.dial,children:[h.dial," (",h.name,")"]},h.code))})]})}),e.jsx(l,{size:{xs:8,sm:4},children:e.jsx(A,{label:r.phone_number,variant:"outlined",name:"phone_number",type:"number",value:n.phone_number,onChange:j,fullWidth:!0,required:!0,error:m.phone_number[0],helperText:m.phone_number[1]})})]}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Informazioni Documento"}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{size:{xs:12,sm:4},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(se,{id:"idType-label",children:"Tipo"}),e.jsxs(te,{variant:"outlined",labelId:"document-type-label",name:"document-type",value:n["document-type"],onChange:j,label:"Tipo",required:!0,error:m["document-type"][0],children:[e.jsx($,{value:"Passport",children:"Passport"}),e.jsx($,{value:"ID Card",children:"ID Card"}),e.jsx($,{value:"Driving License",children:"Driving License"}),e.jsx($,{value:"Residency Permit",children:"Residency Permit"}),e.jsx($,{value:"Other",children:"Other"})]})]})}),e.jsx(l,{size:{xs:12,sm:4},children:e.jsx(A,{label:"Numero",variant:"outlined",name:"document-number",value:n["document-number"],onChange:j,fullWidth:!0,required:!0,error:m["document-number"][0],helperText:m["document-number"][1]})}),e.jsx(l,{size:{xs:12,sm:4},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(be,{label:"Data di Scadenza",value:n["document-expiration"],onChange:h=>o("document-expiration",h),renderInput:h=>e.jsx(A,{...h,fullWidth:!0,required:!0})})})})]}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Informazioni Studente"}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{size:{xs:12,sm:6},children:e.jsx(A,{label:r.person_code,variant:"outlined",name:"person_code",type:"number",value:n.person_code,onChange:j,fullWidth:!0,required:!0,error:m.person_code[0],helperText:m.person_code[1]})}),e.jsx(l,{size:{xs:12,sm:6},children:e.jsx(A,{label:r.matricola_number,variant:"outlined",name:"matricola_number",type:"number",value:n.matricola_number,onChange:j,fullWidth:!0,required:!0,error:m.matricola_number[0],helperText:m.matricola_number[1]})})]}),e.jsxs(l,{container:!0,spacing:2,mt:3,children:[e.jsx(l,{size:{xs:12},children:e.jsx(ve,{control:e.jsx(we,{name:"acceptTerms",required:!0}),label:"Dichiaro di aver letto e accettato lo Statuto di ESN Politecnico Milano"})}),e.jsx(l,{size:{xs:12},children:e.jsx(ve,{control:e.jsx(we,{name:"acceptPrivacyPolicy",required:!0}),label:"Dichiaro di condividere pienamente gli scopi dell'Associazione (rif. Articolo 2 dello Statuto)"})}),e.jsx(l,{size:{xs:12},children:e.jsx(ve,{control:e.jsx(we,{name:"acceptPrivacyPolicy",required:!0}),label:"Dichiaro di accettare tutti i termini indicati nello Statuto, nel Regolamento Interno e tutte le successive modifiche e integrazioni"})}),e.jsx(l,{size:{xs:12},children:e.jsx(ve,{control:e.jsx(we,{name:"acceptPrivacyPolicy",required:!0}),label:"Dichiaro di aver letto l'informativa sulla Privacy allegata e di acconsentire al trattamento dei miei dati personali secondo il Regolamento UE 2016/679 (GDPR) e di essere consapevole dei miei diritti garantiti dalla suddetta legge"})})]}),e.jsx(q,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:4},children:"Conferma Dati"})]})}const Ds=({onEdit:b,onCancel:c,onSave:s,saving:i})=>{const[r,n]=a.useState(!1),[g,m]=a.useState(!1),d=()=>{m(!0),b&&b()},x=()=>{i||(m(!1),c&&c())},C=async()=>{n(!0);try{s?await s()!==!1&&m(!1):m(!1)}catch(_){console.error("Error during save:",_)}finally{n(!1)}};return e.jsx("div",{children:g?e.jsxs(v,{sx:{display:"inline-flex"},children:[e.jsx(H,{onClick:x,"aria-label":"Cancel",disabled:i||r,children:e.jsx(Oa,{})}),i||r?e.jsx(H,{disabled:!0,children:e.jsx(Xe,{size:"1rem"})}):e.jsx(H,{onClick:C,"aria-label":"Save",sx:{color:"#0288d1"},children:e.jsx(Wa,{})})]}):e.jsx(H,{onClick:d,"aria-label":"Edit",children:e.jsx(qe,{})})})};function ua({cols:b,initialData:c,title:s,onSave:i,onDelete:r,onCreate:n,createText:g,canCreate:m,canDelete:d,canEdit:x,sortColumn:C}){const _=a.useMemo(()=>b,[b]),[j,o]=a.useState([]),u=x?e.jsx("span",{style:{color:"green"},children:"(Hai i permessi per eseguire modifiche)"}):e.jsx("span",{style:{color:"red"},children:"(Non hai i permessi per eseguire modifiche)"});a.useEffect(()=>{o(c)},[c]);const t=Pe({columns:_,data:j,enableEditing:x,editDisplayMode:"row",createDisplayMode:"row",enableColumnFilters:!1,enableGlobalFilter:!1,enableSorting:C!=null,enableFullScreenToggle:!1,enableColumnOrdering:!1,enableColumnActions:!1,enableDensityToggle:!1,enableHiding:!1,enablePagination:!1,localization:De,initialState:{sorting:[{id:C,desc:!0}]},onCreatingRowSave:async({values:f,table:S})=>{let D=await n(f);D&&(o([...j,D]),S.setCreatingRow(!1))},onEditingRowSave:async({row:f,values:S})=>{if(await i(f.original,S)){const D=j.map((F,V)=>V===f.index?{...f.original,...S}:F);o(D),console.log(D),t.setEditingRow(null)}},getRowId:f=>f.id,renderRowActions:({row:f,table:S})=>e.jsxs(v,{sx:{display:"flex"},children:[e.jsx($e,{title:"Modifica",children:e.jsx(H,{onClick:()=>S.setEditingRow(f),children:e.jsx(qe,{})})}),d&&e.jsx($e,{title:"Elimina",children:e.jsxs(H,{onClick:async()=>{await r(f.original),o(j.filter(D=>D.id!==f.id))},children:[" ",e.jsx(ya,{})]})})]}),renderTopToolbarCustomActions:({table:f})=>e.jsxs(v,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsxs(v,{sx:{ml:3},children:[e.jsx("h3",{children:s}),e.jsx("h5",{children:u})]}),g!=null?e.jsx(q,{variant:"contained",color:"primary",onClick:n,sx:{ml:"auto",mr:2,visibility:m?"visible":"hidden"},children:g}):e.jsx(H,{sx:{ml:"auto",mr:2,visibility:m?"visible":"hidden"},onClick:()=>{f.setCreatingRow(!0)},children:e.jsx($a,{})})]})});return e.jsx(Ne,{table:t})}const Da={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80%",maxWidth:1200,maxHeight:"90vh",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,overflow:"auto"},Re={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",boxShadow:24,p:4,outline:"none",display:"flex",flexDirection:"column"},ye=({message:b,state:c,duration:s=2e3})=>(a.useEffect(()=>{const i=document.createElement("div"),r=document.createElement("button");if(c==="error"){r.style.marginRight="10px",r.style.cursor="pointer",r.style.border="none",r.style.color="white",r.style.backgroundColor="transparent",xa.createRoot(r).render(e.jsx(Ba,{}));const _=document.createElement("span");_.innerText=b,i.appendChild(r),i.appendChild(_)}else i.innerText=b;i.style.display="flex",i.style.alignItems="center",i.style.position="fixed",i.style.top="-100px",i.style.left="50%",i.style.transform="translateX(-50%)",i.style.backgroundColor=c==="success"?"green":"red",i.style.color="white",i.style.padding="10px",i.style.borderRadius="5px",i.style.cursor="pointer",i.style.zIndex="9999",i.style.transition="opacity 0.5s ease-in-out, top 0.5s ease-in-out",document.body.appendChild(i);const n=()=>{navigator.clipboard.writeText(b).then()};c==="error"&&r.addEventListener("click",n);let g;requestAnimationFrame(()=>{i.style.top="20px"});const m=()=>{i.style.top="-100px",setTimeout(()=>{i.removeEventListener("mouseenter",d),i.removeEventListener("mouseleave",x),r.removeEventListener("click",n),document.body.contains(i)&&document.body.removeChild(i)},s/4)},d=()=>{clearTimeout(g)},x=()=>{g=setTimeout(m,s)};i.addEventListener("mouseenter",d),i.addEventListener("mouseleave",x),x()},[b,c,s]),null);function ia({open:b,message:c,onConfirm:s,onClose:i}){return e.jsxs(Ga,{open:b,onClose:i,children:[e.jsx(Ka,{children:"Conferma Azione"}),e.jsx(Va,{children:e.jsx(P,{children:c})}),e.jsxs(qa,{children:[e.jsx(q,{onClick:i,color:"secondary",children:"Annulla"}),e.jsx(q,{onClick:s,color:"primary",autoFocus:!0,children:"Conferma"})]})]})}function fe({size:b=40,fullScreen:c=!1}){return e.jsx(v,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:c?"100vh":"100%",width:"100%",position:c?"fixed":"relative",top:0,left:0,zIndex:c?1300:1,backgroundColor:c?"rgba(255, 255, 255, 0.7)":"transparent"},children:e.jsx(Xe,{size:b})})}function Ms({open:b,profile:c,onClose:s}){const[i,r]=a.useState(0),[n,g]=a.useState(null),[m,d]=a.useState({open:!1,action:null,message:""}),[x,C]=a.useState(!0),[_,j]=a.useState([]),[o,z]=a.useState({esncard_number:"",account_id:""}),[h,u]=a.useState({esncard_number:[!1,""],account_id:[!1,""]}),t=[{field:"esncard_number",value:o.esncard_number,message:"Inserire il numero di ESNcard"},{field:"account_id",value:o.account_id,message:"Selezionare una Cassa"}];a.useEffect(()=>{C(!0),S().then(),f().then()},[]);const f=async()=>{try{const I=await O("GET","/esncard_fees/");if(I.ok){const G=await I.json();console.log("ESNcard fees:",G),c.latest_esncard&&c.latest_esncard?.is_valid?r(parseFloat(G.esncard_lost_fee.replace("€",""))):r(parseFloat(G.esncard_release_fee.replace("€","")))}else{const G=await J(I);g({message:`Errore fees ESNcard: ${G}`,state:"error"})}}catch(I){g({message:`Errore generale: ${I}`,state:"error"})}finally{C(!1)}},S=async()=>{try{const I=await O("GET","/accounts/");if(I.ok){const G=await I.json();j(G.results)}else{const G=await J(I);g({message:`Errore durante il recupero delle casse: ${G}`,state:"error"})}}catch(I){g({message:`Errore generale: ${I}`,state:"error"})}},D=()=>{const I={};return Object.keys(h).forEach(G=>{I[G]=[!1,""]}),u(I),I},F=async()=>{let I=!1;const G=D();if(t.forEach(ne=>{ne.value||(G[ne.field]=[!0,ne.message],I=!0)}),I){u(G);return}let K="Confermi un pagamento di "+i+"€ per l'emissione della ESNcard?";d({open:!0,action:()=>V(),message:K})},V=async()=>{d({open:!1,action:null,message:""});try{const I=await O("POST","/esncard_emission/",{profile_id:c.id,account_id:o.account_id,esncard_number:o.esncard_number,amount:i});if(I.ok)s(!0);else{const G=await J(I);g({message:`Errore durante l'emissione della ESNcard: ${G}`,state:"error"})}}catch(I){g({message:`Errore generale: ${I}`,state:"error"})}},ee=I=>{z({...o,[I.target.name]:I.target.value})};return e.jsx(Ie,{open:b,onClose:()=>{s(!1)},"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsx(v,{sx:Re,children:x?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(H,{onClick:()=>s(!1),sx:{minWidth:0},children:e.jsx(ze,{})})}),e.jsx(P,{variant:"h4",component:"h2",gutterBottom:!0,children:"Emissione ESNcard"}),e.jsx(Oe,{sx:{mb:2}}),e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"A:"})," ",c.name," ",c.surname]}),e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Importo:"})," ",i,"€"]}),e.jsxs(l,{container:!0,spacing:2,direction:"column",children:[e.jsx(l,{size:{xs:12},sx:{mt:2},children:e.jsx(A,{required:!0,label:"Numero ESNcard",name:"esncard_number",value:o.esncard_number,error:h.esncard_number[0],helperText:h.esncard_number[1],onChange:ee,fullWidth:!0})}),e.jsx(l,{size:{xs:12},sx:{mt:0},children:e.jsxs(Z,{fullWidth:!0,required:!0,error:h.account_id[0],children:[e.jsx(se,{htmlFor:"account-selector",sx:{mb:2},children:"Seleziona Cassa"}),e.jsx(te,{variant:"outlined",label:"Seleziona Cassa",labelId:"account-selector-label",id:"account-selector",name:"account_id",value:o.account_id,error:h.account_id[0],onChange:ee,children:_.map(I=>e.jsxs($,{value:I.id,disabled:I.status==="closed",style:{color:I.status==="closed"?"grey":"inherit"},children:[I.name," ",I.status==="closed"?"(Chiusa)":""]},I.id))}),h.account_id[0]&&e.jsx(He,{children:h.account_id[1]})]})})]}),e.jsx(q,{variant:"contained",fullWidth:!0,sx:{mt:2},onClick:F,children:"Conferma"}),n&&e.jsx(ye,{message:n.message,state:n.state}),e.jsx(ia,{open:m.open,message:m.message,onConfirm:m.action,onClose:()=>d({open:!1,action:null,message:""})})]})})})}const As={ESNer:{hideFields:["course","matricola_expiration","whatsapp_prefix","whatsapp_number"]},Erasmus:{hideFields:["group"]}};function Ma({open:b,onClose:c,inProfile:s,profileType:i,updateProfile:r}){const[n,g]=a.useState(!1),[m,d]=a.useState(!0),{user:x}=Ae(),[C,_]=a.useState(s),[j,o]=a.useState(null),[z,h]=a.useState(!1),[u,t]=a.useState({}),[f,S]=a.useState({}),[D,F]=a.useState([]),[V,ee]=a.useState({email:"",name:"",surname:"",birthdate:"",country:"",phone_prefix:"",phone_number:"",whatsapp_prefix:"",whatsapp_number:"",person_code:"",domicile:"",course:"",matricola_number:"",matricola_expiration:"",documents:[],esncards:[],group:""}),[I,G]=a.useState({email:"",name:"",surname:"",birthdate:"",country:"",phone_prefix:"",phone_number:"",whatsapp_prefix:"",whatsapp_number:"",person_code:"",domicile:"",course:"",matricola_number:"",matricola_expiration:"",group:""}),[K,ne]=a.useState({email:[!1,""],name:[!1,""],surname:[!1,""],birthdate:[!1,""],country:[!1,""],phone_prefix:[!1,""],phone_number:[!1,""],whatsapp_prefix:[!1,""],whatsapp_number:[!1,""],person_code:[!1,""],domicile:[!1,""],course:[!1,""],matricola_number:[!1,""],matricola_expiration:[!1,""],group:[!1,""]}),[w,B]=a.useState({email:!0,name:!0,surname:!0,birthdate:!0,country:!0,phone_prefix:!0,phone_number:!0,whatsapp_prefix:!0,whatsapp_number:!0,person_code:!0,domicile:!0,course:!0,matricola_number:!0,matricola_expiration:!0,group:!0});a.useEffect(()=>{d(!0),(async()=>{try{const R=await O("GET",`/profile/${C.id.toString()}/`);if(R.ok){const U=await R.json(),le={};Object.keys(V).map(je=>{le[je]=U[je]}),ee(le),G(le)}else{const U=await J(R);o({message:`Errore: ${U}`,state:"error"})}}catch(R){o({message:`Errore generale: ${R}`,state:"error"})}finally{d(!1)}})().then()},[]),a.useEffect(()=>{(async()=>{try{const R=await O("GET","/groups/");if(R.ok){const U=await R.json();F(U)}else o({message:`Errore nel recupero dei gruppi: ${await J(R)}`,state:"error"})}catch(R){console.error("Error fetching groups:",R),o({message:`Errore generale: ${R}`,state:"error"})}})().then()},[]);const M=As[i]||{hideFields:[]},p=T=>M.hideFields.includes(T),E=async()=>{try{const T=await O("GET",`/profile/${C.id.toString()}/`);if(T.ok){const R=await T.json();ee(R),G(R),r&&r(R),_(R)}else{const R=await J(T);o({message:`Errore: ${R}`,state:"error"})}}catch(T){o({message:`Errore generale: ${T}`,state:"error"})}},y=()=>{h(!0)},k=async T=>{T&&(o({message:"ESNcard emessa con successo!",state:"success"}),await E()),h(!1)},re=a.useMemo(()=>[{accessorKey:"number",header:"Numero",size:100,muiEditTextFieldProps:{required:!0,helperText:u?.number,error:!!u?.number}},{accessorKey:"created_at",enableEditing:!1,header:"Rilascio",size:100,Cell:({cell:T})=>{const R=new Date(T.getValue());return R==null?"Null":R.toISOString().split("T")[0]}},{accessorKey:"expiration",enableEditing:!1,header:"Scadenza",size:100,Cell:({cell:T})=>{const le=new Date(T.getValue())<new Date;return e.jsx("span",{style:{color:le?"orange":"green"},children:T.getValue()})}}],[]),ce=async(T,R)=>{try{const U=await O("PATCH",`/esncard/${T.id}/`,R);if(U.ok)return t({}),o({message:"ESNcard aggiornata con successo!",state:"success"}),await E(),!0;{const le=await J(U);return o({message:`Errore: ${le}`,state:"error"}),!1}}catch(U){o({message:`Errore generale: ${U}`,state:"error"})}},N=a.useMemo(()=>[{accessorKey:"type",header:"Tipo",size:100,editVariant:"select",editSelectOptions:["Passport","ID Card","Driving License","Residency Permit","Other"],muiEditTextFieldProps:{select:!0,helperText:f?.type,error:!!f?.type}},{accessorKey:"number",header:"Numero",size:60,muiEditTextFieldProps:{required:!0,helperText:f?.number,error:!!f?.number}},{accessorKey:"expiration",header:"Scadenza",size:60,muiEditTextFieldProps:{required:!0,helperText:f?.expiration,error:!!f?.expiration,type:"date"},Cell:({cell:T})=>{const le=new Date(T.getValue())<new Date;return e.jsx("span",{style:{color:le?"orange":"green"},children:T.getValue()})}}],[]),Y=async T=>{try{const R=await O("DELETE",`/document/${T.id}/`);if(R.ok)return S({}),o({message:"Documento eliminato con successo!",state:"success"}),await E(),!0;{R.json().then(le=>S(le));const U=await J(R);o({message:`Errore: ${U}`,state:"error"})}}catch(R){o({message:`Errore generale: ${R}`,state:"error"})}},oe=async T=>{let R={...T,profile:C.id};try{const U=await O("POST","/document/",R);if(U.ok)return S({}),o({message:"Documento aggiunto con successo!",state:"success"}),await E(),!0;{U.json().then(je=>S(je));const le=await J(U);return o({message:`Errore: ${le}`,state:"error"}),!1}}catch(U){return o({message:`Errore generale: ${U}`,state:"error"}),!1}},ie=async(T,R)=>{try{const U=await O("PATCH",`/document/${T.id}/`,R);if(U.ok)return S({}),o({message:"Documento aggiornato con successo!",state:"success"}),await E(),!0;{U.json().then(je=>S(je));const le=await J(U);return o({message:`Errore: ${le}`,state:"error"}),!1}}catch(U){return o({message:`Errore generale: ${U}`,state:"error"}),!1}},de=T=>T?W(T).format("YYYY-MM-DD"):null,Q=T=>{G({...I,[T.target.name]:T.target.value})},ge=(T,R)=>{G({...I,[T]:R})},ke=()=>{const T={};Object.keys(K).forEach(R=>{T[R]=[!1,""]}),ne(T)},Le=T=>{B(Object.fromEntries(Object.keys(w).map(R=>[R,!T]))),ke()},Ye=async()=>{if(g(!0),I.matricola_number&&!/^\d{6}$/.test(I.matricola_number))return ne(T=>({...T,matricola_number:[!0,"La Matricola deve essere composta da 6 cifre"]})),g(!1),!1;try{const T={...I,birthdate:de(I.birthdate),matricola_expiration:de(I.matricola_expiration)},R=await O("PATCH",`/profile/${C.id.toString()}/`,T);if(R.ok)await E(),V&&(ke(),o({message:"Profilo aggiornato con successo!",state:"success"}),Le(!1));else{const U=await R.json(),le=Object.fromEntries(Object.keys(K).map(je=>je in U?[je,[!0,U[je]]]:[je,[!1,""]]));ne(le)}}catch(T){G(V),o({message:`Errore generale: ${T}`,state:"error"}),Le(!1)}finally{g(!1)}};return e.jsx(Ie,{open:b,onClose:c,children:e.jsxs(v,{sx:Da,onKeyDown:T=>T.stopPropagation(),children:[e.jsx(v,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(H,{onClick:()=>c(!1),sx:{minWidth:0},children:e.jsx(ze,{})})}),e.jsxs(P,{variant:"h5",gutterBottom:!0,align:"center",children:["Profilo ",i]}),m?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{sx:{p:"20px"},children:e.jsxs(l,{container:!0,spacing:2,children:[e.jsxs(l,{container:!0,size:{xs:12},alignItems:"center",children:[e.jsx(ea,{}),e.jsx(P,{variant:"h6",sx:{m:0},children:"Informazioni Personali"}),e.jsx(l,{sx:{marginLeft:"auto"},children:e.jsx(Ds,{onEdit:()=>Le(!0),onCancel:()=>{Le(!1),G(V)},saving:n,onSave:Ye})})]}),!p("name")&&e.jsx(l,{size:{xs:12,md:4,lg:4},children:e.jsx(A,{label:L.name,name:"name",value:I.name,error:K.name[0],helperText:K.name[1],slotProps:{input:{readOnly:w.name}},onChange:Q,sx:{backgroundColor:w.name?"grey.200":"white"},fullWidth:!0})}),!p("surname")&&e.jsx(l,{size:{xs:12,md:4,lg:4},children:e.jsx(A,{label:L.surname,name:"surname",value:I.surname,error:K.surname[0],helperText:K.surname[1],onChange:Q,slotProps:{input:{readOnly:w.surname}},sx:{backgroundColor:w.surname?"grey.200":"white"},fullWidth:!0})}),!p("email")&&e.jsx(l,{size:{xs:12,md:4,lg:4},children:e.jsx(A,{label:L.email,name:"email",type:"email",value:I.email,error:K.email[0],helperText:K.email[1],slotProps:{input:{readOnly:!0}},sx:{backgroundColor:"grey.200"},onChange:Q,fullWidth:!0})}),!p("country")&&e.jsx(l,{size:{xs:12,md:4,lg:4},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(se,{id:"country-label",children:L.country}),e.jsxs(te,{variant:"outlined",labelId:"country-label",name:"country",label:L.country,value:I.country,error:K.country[0],onChange:Q,slotProps:{input:{readOnly:w.country}},sx:{backgroundColor:w.country?"grey.200":"white"},children:[e.jsx($,{value:"",children:e.jsx("em",{children:"None"})}),Ce.map(T=>e.jsx($,{value:T.code,children:T.name},T.code))]})]})}),!p("domicile")&&e.jsx(l,{size:{xs:12,md:4,lg:5},children:e.jsx(A,{label:L.domicile,name:"domicile",value:I.domicile,error:K.domicile[0],helperText:K.domicile[1],onChange:Q,slotProps:{input:{readOnly:w.domicile}},sx:{backgroundColor:w.domicile?"grey.200":"white"},fullWidth:!0})}),!p("birthdate")&&e.jsx(l,{size:{xs:12,md:4,lg:3},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(be,{label:L.birthdate,value:I.birthdate?W(I.birthdate,"YYYY-MM-DD"):null,readOnly:w.birthdate,onChange:T=>ge("birthdate",T),sx:{backgroundColor:w.birthdate?"grey.200":"white"},renderInput:T=>e.jsx(A,{...T,fullWidth:!0,required:!0})})})}),!p("phone_prefix")&&!p("phone_number")&&e.jsxs(l,{size:{xs:12},container:!0,spacing:2,children:[e.jsx(l,{size:{xs:1.5},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(se,{id:"phone-prefix-label",children:L.phone_prefix}),e.jsx(te,{variant:"outlined",labelId:"phone-prefix-label",id:"phone-prefix",name:"phone_prefix",value:I.phone_prefix||"",onChange:Q,slotProps:{input:{readOnly:w.phone_number}},sx:{backgroundColor:w.phone_number?"grey.200":"white"},label:L.phone_prefix,renderValue:T=>T,children:Ce.map(T=>e.jsxs($,{value:T.dial,children:[T.dial," (",T.name,")"]},T.code))})]})}),e.jsx(l,{size:{xs:3},children:e.jsx(A,{label:L.phone_number,name:"phone_number",value:I.phone_number||"",error:K.phone_number[0],helperText:K.phone_number[1],onChange:Q,slotProps:{input:{readOnly:w.phone_number}},sx:{backgroundColor:w.phone_number?"grey.200":"white"},fullWidth:!0})})]}),!p("whatsapp_prefix")&&!p("whatsapp_number")&&e.jsxs(l,{size:{xs:12},container:!0,spacing:2,children:[e.jsx(l,{size:{xs:1.5},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(se,{id:"whatsapp-prefix-label",children:L.whatsapp_prefix}),e.jsx(te,{variant:"outlined",labelId:"whatsapp-prefix-label",id:"whatsapp-prefix",name:"whatsapp_prefix",value:I.whatsapp_prefix||"",onChange:Q,slotProps:{input:{readOnly:w.whatsapp_prefix}},sx:{backgroundColor:w.whatsapp_prefix?"grey.200":"white"},label:L.whatsapp_prefix,renderValue:T=>T,children:Ce.map(T=>e.jsxs($,{value:T.dial,children:[T.dial," (",T.name,")"]},T.code))})]})}),e.jsx(l,{size:{xs:3},children:e.jsx(A,{label:L.whatsapp_number,name:"whatsapp_number",value:I.whatsapp_number||"",error:K.whatsapp_number[0],helperText:K.whatsapp_number[1],onChange:Q,slotProps:{input:{readOnly:w.whatsapp_number}},sx:{backgroundColor:w.whatsapp_number?"grey.200":"white"},fullWidth:!0})})]}),e.jsxs(l,{container:!0,size:{xs:12},sx:{mt:2},alignItems:"center",children:[e.jsx(Ha,{}),e.jsx(P,{variant:"h6",sx:{m:0},children:"Dati Studente"})]}),!p("person_code")&&e.jsx(l,{size:{xs:12,md:4,lg:3},children:e.jsx(A,{label:L.person_code,name:"person_code",value:I.person_code||"",error:K.person_code[0],helperText:K.person_code[1],onChange:Q,slotProps:{input:{readOnly:w.person_code}},sx:{backgroundColor:w.person_code?"grey.200":"white"},fullWidth:!0})}),!p("course")&&e.jsx(l,{size:{xs:12,md:4,lg:3},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(se,{id:"course-label",children:L.course}),e.jsxs(te,{variant:"outlined",labelId:"course-label",name:"course",label:L.course,value:I.course||"",onChange:Q,slotProps:{input:{readOnly:w.course}},sx:{backgroundColor:w.course?"grey.200":"white"},children:[e.jsx($,{value:"Engineering",children:"Ingegneria"}),e.jsx($,{value:"Design",children:"Design"}),e.jsx($,{value:"Architecture",children:"Architettura"})]})]})}),!p("matricola_number")&&e.jsx(l,{size:{xs:12,md:4,lg:3},children:e.jsx(A,{label:L.matricola_number,name:"matricola_number",value:I.matricola_number||"",error:K.matricola_number[0],helperText:K.matricola_number[1],onChange:Q,sx:{backgroundColor:w.matricola_number?"grey.200":"white"},type:"number",slotProps:{input:{readOnly:w.matricola_number}},fullWidth:!0})}),!p("matricola_expiration")&&e.jsx(l,{size:{xs:12,md:4,lg:3},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(be,{label:L.matricola_expiration,value:I.matricola_expiration?W(I.matricola_expiration,"YYYY-MM-DD"):null,readOnly:w.matricola_expiration,onChange:T=>ge("matricola_expiration",T),sx:{backgroundColor:w.matricola_expiration?"grey.200":"white"},renderInput:T=>e.jsx(A,{...T,fullWidth:!0,required:!0})})})}),!p("group")&&e.jsxs(l,{container:!0,alignItems:"center",spacing:1,sx:{width:"100%",mt:2},children:[e.jsx(Ya,{}),e.jsx(l,{size:{xs:2},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(se,{id:"group-label",children:L.group}),e.jsx(te,{variant:"outlined",labelId:"group-label",label:L.group,name:"group",value:I.group||"",onChange:Q,slotProps:{input:{readOnly:w.group}},sx:{backgroundColor:w.group?"grey.200":"white"},children:D.map(T=>e.jsx($,{value:T.name,children:T.name},T.name))})]})})]})]})}),e.jsxs(Be,{sx:{p:1,mt:2,mb:2,minHeight:"80px",display:"flex",alignItems:"center"},children:[e.jsxs(Ua,{sx:{justifyContent:"space-between",width:"100%",p:0},children:[e.jsx(P,{variant:"h6",children:"Azioni"}),e.jsx(q,{variant:"contained",color:"primary",children:"Esporta Profilo"})]}),z&&e.jsx(Ms,{open:z,profile:C,onClose:k})]}),e.jsxs(l,{container:!0,sx:{width:"100%"},spacing:2,children:[e.jsx(l,{size:{xs:12,md:6},children:e.jsx(ua,{cols:N,canCreate:x.permissions.includes("add_document"),canEdit:x.permissions.includes("change_document"),canDelete:x.permissions.includes("delete_document"),onCreate:oe,onSave:ie,onDelete:Y,initialData:V.documents,title:"Documenti",sortColumn:"expiration"})}),e.jsx(l,{size:{xs:12,md:6},children:e.jsx(ua,{cols:re,canCreate:x.permissions.includes("add_esncard"),onCreate:y,createText:C.latest_esncard?C.latest_esncard.is_valid?"Card Smarrita":"Rinnova":"Rilascia",canEdit:x.permissions.includes("change_esncard"),onSave:ce,initialData:V.esncards,title:"ESNcards",sortColumn:"expiration"})})]}),j&&e.jsx(ye,{message:j.message,state:j.state})]})]})})}const ma=[{value:"valid",label:"Valida"},{value:"expired",label:"Scaduta"},{value:"absent",label:"Assente"}];function Aa({apiEndpoint:b,columns:c,columnVisibility:s,profileType:i}){const[r,n]=a.useState([]),[g,m]=a.useState(!1),[d,x]=a.useState({}),[C,_]=a.useState({pageIndex:0,pageSize:10}),[j,o]=a.useState(0),[z,h]=a.useState([]),[u,t]=a.useState({esncardValidity:[],group:[]}),[f,S]=a.useState(""),[D,F]=a.useState(""),[V,ee]=a.useState(!0),I=a.useRef(null);a.useEffect(()=>{ee(!0),(async()=>{try{const E=new URLSearchParams;E.append("page",C.pageIndex+1),E.append("page_size",C.pageSize),D&&E.append("search",D),u.esncardValidity.length&&E.append("esncardValidity",u.esncardValidity.join(",")),u.group.length&&E.append("group",u.group.join(","));const k=await(await O("GET",`${b}?${E.toString()}`)).json();o(k.count||0),n(k.results)}catch(E){console.error("Error fetching data:",E)}finally{ee(!1)}})().then(),i==="ESNer"&&O("GET","/groups/").then(E=>{E.ok&&E.json().then(y=>h(y))})},[b,C.pageIndex,C.pageSize,i,u,D]);const G=()=>{F(f),_(p=>({...p,pageIndex:0}))},K=()=>{S(""),F(""),_(p=>({...p,pageIndex:0})),I.current&&I.current.focus()},ne=Pe({columns:c,data:r,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableColumnPinning:!0,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableRowPinning:!0,enableExpandAll:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},columnVisibility:s},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",enableGlobalFilter:!1,muiPaginationProps:{color:"secondary",rowsPerPageOptions:[10,20,50],shape:"rounded",variant:"outlined"},manualPagination:!0,rowCount:j,onPaginationChange:_,state:{pagination:C},localization:De,muiTableBodyRowProps:({row:p})=>({onClick:()=>{x(p.original),m(!0)}})}),w=p=>{n(E=>E.map(y=>y.id===p.id?p:y))},B=()=>{m(!1)},M=p=>{const{name:E,value:y}=p.target;t(k=>({...k,[E]:typeof y=="string"?y.split(","):y}))};return e.jsxs(v,{sx:{mx:"5%"},children:[e.jsxs(l,{container:!0,spacing:2,sx:{mb:2,mt:2},alignItems:"center",justifyContent:"flex-end",children:[e.jsx(l,{size:{xs:12,sm:2},children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(se,{id:"esncard-validity-label",children:"Validità ESNcard"}),e.jsx(te,{labelId:"esncard-validity-label",name:"esncardValidity",variant:"outlined",multiple:!0,value:u.esncardValidity,onChange:M,input:e.jsx(_e,{label:"Validità ESNcard"}),renderValue:p=>ma.filter(E=>p.includes(E.value)).map(E=>E.label).join(", "),children:ma.map(p=>e.jsx($,{value:p.value,children:p.label},p.value))})]})}),i==="ESNer"&&z.length>0&&e.jsx(l,{size:{xs:12,sm:2},children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(se,{id:"group-label",children:"Gruppo"}),e.jsx(te,{labelId:"group-label",name:"group",variant:"outlined",multiple:!0,value:u.group,onChange:M,input:e.jsx(_e,{label:"Gruppo"}),renderValue:p=>z.filter(E=>p.includes(E.name)).map(E=>E.name).join(", "),children:z.map(p=>e.jsx($,{value:p.name,children:p.name},p.name))})]})}),e.jsx(l,{size:{xs:12,sm:2},sm:"auto",children:e.jsx(_e,{inputRef:I,size:"small",placeholder:"Cerca",value:f,onChange:p=>S(p.target.value),onKeyDown:p=>{p.key==="Enter"&&G()},endAdornment:f&&D===f?e.jsx(H,{"aria-label":"clear",onClick:K,edge:"end",children:e.jsx(We,{})}):e.jsx(H,{"aria-label":"search",onClick:G,edge:"end",children:e.jsx(aa,{})})})})]}),V?e.jsx(fe,{}):e.jsx(Ne,{table:ne}),g&&e.jsx(Ma,{open:g,inProfile:d,profileType:i,onClose:B,updateProfile:w})]})}const ks=()=>{const{logout:b}=Ae(),c=Ee(),s=()=>{b(),c("/login")};return e.jsx(q,{variant:"contained",sx:{backgroundColor:"black",color:"white",marginTop:2},onClick:s,children:"Logout"})};function Ls({user:b}){const[c,s]=a.useState(!1),i=a.useCallback(()=>{s(!0)},[]),r=a.useCallback(g=>{s(!1)},[]),n=a.useCallback(g=>{b={...b,profile:g}},[b]);return e.jsxs(v,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px"},children:[e.jsx(H,{onClick:i,"aria-label":"Profile",children:e.jsx(ea,{})}),e.jsxs(v,{sx:{flexGrow:1,marginLeft:"10px"},children:[e.jsxs(P,{variant:"body2",children:[b.profile.name," ",b.profile.surname," (",b.groups[0],")"]}),e.jsx(ks,{})]}),e.jsx(Ma,{inProfile:b.profile,profileType:"ESNer - "+b.groups[0],open:c,handleClose:r,updateProfile:n})]})}function Me(){const{isDrawerOpen:b,toggleDrawer:c,expandedSection:s,handleExpand:i}=Ts(),{user:r}=Ae(),n=d=>r?.permissions?.includes(d)||!1,g=[{text:"Home",icon:e.jsx(Ja,{}),path:"/"},{text:"Tesoreria",icon:e.jsx(Za,{}),path:"/treasury",requiredPermission:"change_account"},{text:"Eventi",icon:e.jsx(sa,{}),path:"/events"},{text:"Profili",icon:e.jsx(ea,{}),children:[{text:"Erasmus",icon:e.jsx(va,{}),path:"/profiles/erasmus"},{text:"ESNers",icon:e.jsx(Sa,{}),path:"/profiles/esners"}]}].filter(d=>!d.requiredPermission||n(d.requiredPermission)),m=e.jsxs(v,{sx:{width:250,display:"flex",flexDirection:"column",height:"100%"},role:"presentation",onClick:c(!1),onKeyDown:c(!1),children:[e.jsx(v,{sx:{flexGrow:1},children:g.map(d=>e.jsx(xe.Fragment,{children:d.children?e.jsxs(xe.Fragment,{children:[e.jsxs(Qa,{onClick:x=>{x.stopPropagation(),i(d.text)},children:[e.jsx(Je,{children:d.icon}),e.jsx(Ze,{primary:d.text,slotProps:{primary:{style:{color:"black"}}}}),s===d.text?e.jsx(_a,{}):e.jsx(Ca,{})]}),e.jsx(wa,{in:s===d.text,timeout:"auto",unmountOnExit:!0,children:e.jsx(Xa,{component:"div",disablePadding:!0,children:d.children?.map(x=>e.jsxs(la,{component:da,to:x.path,sx:{pl:4},children:[e.jsx(Je,{children:x.icon}),e.jsx(Ze,{primary:x.text,slotProps:{primary:{style:{color:"black"}}}})]},x.text))||[]})})]},d.text):e.jsxs(la,{component:da,to:d.path,children:[e.jsx(Je,{children:d.icon}),e.jsx(Ze,{primary:d.text,slotProps:{primary:{style:{color:"black"}}}})]},d.text)},d.text))}),r&&e.jsx(v,{sx:{mt:"auto",mb:2},children:e.jsx(Ls,{user:r})})]});return e.jsxs(v,{sx:{display:"flex"},children:[e.jsx(H,{edge:"start",color:"inherit","aria-label":"menu",onClick:c(!0),sx:{margin:"10px"},children:e.jsx(es,{})}),e.jsx(as,{anchor:"left",open:b,onClose:c(!1),children:m})]})}function Ns(){const b=a.useMemo(()=>[{accessorKey:"id",header:L.id,size:50},{accessorKey:"name",header:L.name,size:150},{accessorKey:"surname",header:L.surname,size:150},{accessorKey:"email",header:L.email,size:150},{accessorKey:"latest_esncard",header:L.latest_esncard,size:50,Cell:({cell:s})=>e.jsx(v,{sx:{},children:s.getValue()!==null?e.jsx(X,{label:s.getValue().number,color:s.getValue().is_valid?"success":"warning"}):e.jsx(X,{label:"Nessuna ESNcard",color:"error"})})},{accessorKey:"country",header:L.country,size:150,Cell:({row:s})=>{const i=s.original.country,r=Ce.find(n=>n.code===i);return r?r.name:i||"(vuoto)"}},{accessorKey:"birthdate",header:L.birthdate,size:100},{accessorKey:"course",header:L.course,size:100},{accessorKey:"phone_prefix",header:"Prefisso Telefono",size:60},{accessorKey:"phone_number",header:"Numero Telefono (no prefisso)",size:120},{id:"fullPhoneNumber",header:L.phone_number,size:150,accessorFn:s=>`(${s.phone_prefix||"vuoto"}) ${s.phone_number||"(vuoto)"}`,Cell:({row:s})=>e.jsxs("span",{children:["(",s.original.phone_prefix||"vuoto",") ",s.original.phone_number||"(vuoto)"]})},{accessorKey:"whatsapp_prefix",header:"Prefisso WhatsApp",size:60},{accessorKey:"whatsapp_number",header:"Numero WhatsApp (no prefisso)",size:120},{id:"fullWANumber",header:L.whatsapp_number,size:150,accessorFn:s=>`(${s.whatsapp_prefix||"vuoto"}) ${s.whatsapp_number||"(vuoto)"}`,Cell:({row:s})=>e.jsxs("span",{children:["(",s.original.whatsapp_prefix||"vuoto",") ",s.original.whatsapp_number||"(vuoto)"]})},{accessorKey:"domicile",header:L.domicile,size:200},{accessorKey:"matricola_number",header:L.matricola_number,size:50},{accessorKey:"matricola_expiration",header:L.matricola_expiration,size:50},{accessorKey:"latest_document.number",header:L.latest_document,size:50}],[]),c={id:!0,name:!0,surname:!0,email:!0,country:!1,birthdate:!1,course:!1,fullPhoneNumber:!0,fullWANumber:!0,person_code:!1,domicile:!1,matricola_number:!1,matricola_expiration:!1,"latest_document.number":!1,phone_prefix:!1,phone_number:!1,whatsapp_prefix:!1,whatsapp_number:!1};return e.jsxs(v,{children:[e.jsx(Me,{}),e.jsx(v,{sx:{mx:"5%"},children:e.jsxs(v,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(va,{sx:{marginRight:"10px"}}),e.jsx(P,{variant:"h4",children:"Profili Erasmus"})]})}),e.jsx(Aa,{apiEndpoint:"/erasmus_profiles/",columns:b,columnVisibility:c,profileType:"Erasmus"})]})}function Fs(){const b=a.useMemo(()=>[{accessorKey:"id",header:L.id,size:50},{accessorKey:"name",header:L.name,size:150},{accessorKey:"surname",header:L.surname,size:150},{accessorKey:"group",header:L.group,size:150,Cell:({cell:s})=>{const i=s.getValue();let r="default";return i==="Aspiranti"?r="info":i==="Attivi"?r="success":i==="Board"&&(r="warning"),e.jsx(X,{label:i,color:r})}},{accessorKey:"email",header:L.email,size:150},{accessorKey:"latest_esncard",header:L.latest_esncard,size:50,Cell:({cell:s})=>e.jsx(v,{sx:{},children:s.getValue()!==null?e.jsx(X,{label:s.getValue().number,color:s.getValue().is_valid?"success":"warning"}):e.jsx(X,{label:"Nessuna ESNcard",color:"error"})})},{accessorKey:"country",header:L.country,size:150,Cell:({row:s})=>{const i=s.original.country,r=Ce.find(n=>n.code===i);return r?r.name:i||"(vuoto)"}},{accessorKey:"birthdate",header:L.birthdate,size:100},{accessorKey:"phone_prefix",header:"Prefisso Telefono",size:60},{accessorKey:"phone_number",header:"Numero Telefono (no prefisso)",size:120},{id:"fullPhoneNumber",header:L.phone_number,size:150,accessorFn:s=>`(${s.phone_prefix||"vuoto"}) ${s.phone_number||"(vuoto)"}`,Cell:({row:s})=>e.jsxs("span",{children:["(",s.original.phone_prefix||"vuoto",") ",s.original.phone_number||"(vuoto)"]})},{accessorKey:"person_code",header:L.person_code,size:150},{accessorKey:"domicile",header:L.domicile,size:200},{accessorKey:"matricola_number",header:L.matricola_number,size:50},{accessorKey:"latest_document.number",header:L.latest_document,size:50}],[]),c={id:!0,name:!0,surname:!0,groups:!0,email:!0,country:!0,birthdate:!1,fullPhoneNumber:!0,person_code:!1,domicile:!1,matricola_number:!1,"latest_document.number":!1,phone_prefix:!1,phone_number:!1};return e.jsxs(v,{children:[e.jsx(Me,{}),e.jsx(v,{sx:{mx:"5%"},children:e.jsxs(v,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(Sa,{sx:{marginRight:"10px"}}),e.jsx(P,{variant:"h4",children:"Profili ESNers"})]})}),e.jsx(Aa,{apiEndpoint:"/esner_profiles/",columns:b,columnVisibility:c,profileType:"ESNer"})]})}function ka({open:b,onClose:c,account:s,onSuccess:i}){const{user:r}=Ae(),[n,g]=a.useState({amount:"",type:"deposit",description:""}),m=async x=>{x.preventDefault();try{const C=await O("POST","/transaction/",{account:s.id,amount:n.type==="deposit"?Math.abs(n.amount):-Math.abs(n.amount),description:n.description,type:n.type,executor:r.profile.email});if(C.ok)i("Transazione registrata con successo"),c();else{const _=await C.json();i("Errore durante la registrazione: "+JSON.stringify(_),"error")}}catch(C){i("Errore durante la registrazione: "+C.message,"error")}},d=()=>c(!1);return e.jsx(Ie,{open:b,onClose:d,children:e.jsxs(v,{sx:Re,component:"form",onSubmit:m,noValidate:!0,children:[e.jsx(v,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsxs(H,{onClick:d,sx:{minWidth:0},children:[" ",e.jsx(ze,{})," "]})}),e.jsxs(P,{variant:"h5",gutterBottom:!0,align:"center",sx:{mt:2},children:["Transazione Manuale - Cassa ",s?.name]}),e.jsxs(l,{container:!0,spacing:2,sx:{mt:2},children:[e.jsxs(Z,{fullWidth:!0,children:[e.jsx(se,{children:"Tipo"}),e.jsxs(te,{variant:"outlined",value:n.type,label:"Tipo",onChange:x=>g({...n,type:x.target.value}),children:[e.jsx($,{value:"deposit",children:"Deposito"}),e.jsx($,{value:"withdrawal",children:"Prelievo"})]})]}),e.jsx(A,{margin:"dense",label:"Importo",type:"number",fullWidth:!0,value:n.amount,slotProps:{htmlInput:{min:"0.01",step:"0.01"}},onChange:x=>g({...n,amount:x.target.value})}),e.jsx(A,{margin:"dense",label:"Descrizione",type:"text",fullWidth:!0,multiline:!0,rows:2,value:n.description,onChange:x=>g({...n,description:x.target.value})})]}),e.jsxs(v,{mt:2,children:[e.jsx(q,{fullWidth:!0,onClick:c,children:"Annulla"}),e.jsx(q,{fullWidth:!0,variant:"contained",color:"primary",type:"submit",disabled:!n.amount||n.amount<=0,children:"Conferma"})]})]})})}const Rs={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"top",mt:4,minHeight:"100vh"};function Os(){const{user:b}=Ae(),[c,s]=a.useState([]),[i,r]=a.useState(null),[n,g]=a.useState(!1),[m,d]=a.useState(""),[x,C]=a.useState(!1),[_,j]=a.useState(null),[o,z]=a.useState(!1),h=b?.permissions.includes("change_account");a.useEffect(()=>{u().then()},[b]);const u=async()=>{try{const S=await O("GET","/accounts/");if(S.ok){const D=await S.json();s(D.results)}else{const D=await J(S);j({message:`Errore durante il recupero delle casse: ${D}`,state:"error"})}}catch(S){j({message:`Errore generale: ${S}`,state:"error"})}},t=(S,D)=>{r(S),d(D),g(!0)},f=async()=>{try{const S=await O("PATCH",`/account/${i.id}/`,{status:m==="open"?"open":"closed"});S.ok?(console.log(`Account ${m}ed successfully.`),u().then(),j({message:`Cassa ${m==="open"?"aperta":"chiusa"} con successo!`,state:"success"})):(console.error(`Failed to ${m} account.`),j({message:`Errore account: ${S.statusText}`,state:"error"}))}catch(S){console.error(`Error ${m}ing account:`,S),j({message:`Errore generale: ${S}`,state:"error"})}finally{g(!1)}};return e.jsxs(v,{children:[e.jsx(Me,{}),e.jsx(v,{sx:{width:"100%",maxWidth:"90%",mx:"auto",mt:0},children:e.jsxs(Ge,{elevation:3,sx:{p:2,mb:0,borderRadius:5},children:[e.jsxs(v,{sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>C(S=>!S),children:[e.jsx(P,{variant:"h5",sx:{flexGrow:1,fontWeight:600},children:"Casse"}),e.jsx(H,{children:x?e.jsx(_a,{}):e.jsx(Ca,{})})]}),e.jsx(wa,{in:x,timeout:"auto",unmountOnExit:!0,children:e.jsx(v,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:2,justifyContent:"center"},children:c.map(S=>e.jsxs(Be,{sx:{flex:"1 1 320px",minWidth:320,maxWidth:400,display:"flex",alignItems:"center",boxShadow:4,borderRadius:2,m:1},children:[e.jsxs(Ea,{sx:{flex:1},children:[e.jsx(P,{variant:"h6",sx:{fontWeight:700,color:"#2d3a4b"},children:S.name}),h&&e.jsxs(e.Fragment,{children:[e.jsxs(P,{variant:"body1",sx:{color:"#3e5060"},children:[ue.balance,": ",e.jsxs("b",{children:["€",S.balance]})]}),e.jsxs(P,{variant:"body2",sx:{color:"#607d8b"},children:[ue.changed_by,": ",S.changed_by.name||"N/A"]})]})]}),h?e.jsxs(ss,{sx:{pr:2,flexDirection:"column",alignItems:"flex-end"},children:[S.status==="closed"&&e.jsx(q,{variant:"contained",color:"success",onClick:()=>t(S,"open"),sx:{minWidth:120,fontWeight:600},children:"Apri Cassa"}),S.status==="open"&&e.jsxs(e.Fragment,{children:[e.jsx(q,{variant:"contained",color:"error",onClick:()=>t(S,"close"),sx:{minWidth:120,fontWeight:600,mb:1},children:"Chiudi Cassa"}),e.jsx(q,{variant:"contained",color:"primary",onClick:()=>{r(S),z(!0)},sx:{minWidth:120,fontWeight:600},children:"Deposita/Preleva"})]})]}):e.jsx(P,{variant:"h7",style:{color:S.status==="closed"?"red":"green",fontWeight:"bold",padding:"20px"},children:S.status==="closed"?"Cassa Chiusa":"Cassa Aperta"})]},S.id))})})]})}),e.jsxs(v,{sx:Rs,children:[e.jsx(P,{variant:"h3",gutterBottom:!0,children:"Sistema di Gestione"}),e.jsx("img",{src:ra,alt:"ESN Polimi Logo",style:{height:"25vh",marginTop:"2px"}}),e.jsxs("h1",{children:["Benvenuto, ",b?b.profile.name:"Sir","!"]})]}),e.jsx(ia,{open:n,message:`Confermi la presenza di €${i?.balance} nella cassa "${i?.name}" prima di ${m==="open"?"aprirla":"chiuderla"}?`,onConfirm:f,onClose:()=>g(!1)}),e.jsx(ka,{open:o,onClose:()=>z(!1),account:i,onSuccess:(S,D)=>j({message:S,state:D||"success"})}),_&&e.jsx(ye,{message:_.message,state:_.state})]})}function Ws({limit:b=5}){const[c,s]=a.useState([]),[i,r]=a.useState(!0);a.useEffect(()=>{(async()=>{r(!0);try{const d=await O("GET","/accounts/");if(d.ok){const x=await d.json();s(x.results)}}catch{}finally{r(!1)}})().then()},[]);const n=a.useMemo(()=>[{accessorKey:"name",header:ue.name,size:100},{accessorKey:"balance",header:ue.balance,size:100,Cell:({cell:m})=>e.jsx(v,{children:m.getValue()!==null?e.jsx(X,{label:`€${m.getValue()}`,color:"primary"}):e.jsx(X,{label:"N/A",color:"warning"})})},{accessorKey:"status",header:ue.status,size:100,Cell:({cell:m})=>e.jsx(v,{children:m.getValue()!==null?e.jsx(X,{label:m.getValue()==="open"?"Aperta":"Chiusa",color:m.getValue()==="open"?"success":"error"}):e.jsx(X,{label:"Stato ignoto",color:"warning"})})}],[]),g=Pe({columns:n,data:c.slice(0,b),enableKeyboardShortcuts:!1,enableColumnActions:!1,enableColumnFilters:!1,enablePagination:!1,enableSorting:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!1},paginationDisplayMode:"default",muiTableBodyRowProps:{hover:!1},localization:De});return i?e.jsx(fe,{}):e.jsx(Ia,{table:g})}const $s={subscription:{label:ae.tran_type.subscription,color:"primary"},esncard:{label:ae.tran_type.esncard,color:"secondary"},deposit:{label:ae.tran_type.deposit,color:"success"},withdrawal:{label:ae.tran_type.withdrawal,color:"error"}};function Bs({limit:b=5}){const[c,s]=a.useState([]),[i,r]=a.useState(!0);a.useEffect(()=>{(async()=>{r(!0);try{const d=await O("GET","/transactions/");if(d.ok){const x=await d.json();s(x.results),console.log("Transactions data:",x.results)}}catch{}finally{r(!1)}})().then()},[]);const n=a.useMemo(()=>[{accessorKey:"created_at",header:ae.date,size:100,Cell:({cell:m})=>{const d=new Date(m.getValue());return e.jsx(v,{children:new Intl.DateTimeFormat("it-IT",{dateStyle:"medium",timeStyle:"short"}).format(d)})}},{accessorKey:"type",header:ae.type,size:100,Cell:({cell:m})=>{const d=m.getValue(),x=$s[d]||{label:"Sconosciuto",color:"default"};return e.jsx(X,{label:x.label,color:x.color,variant:"outlined"})}},{accessorKey:"executor.name",header:ae.executor,size:150},{accessorKey:"account.name",header:ae.account,size:100,Cell:({cell:m})=>e.jsx(v,{component:"span",fontWeight:"bold",children:m.getValue()})},{accessorKey:"amount",header:ae.amount,size:100,Cell:({cell:m})=>e.jsx(v,{children:m.getValue()!==null?e.jsx(X,{label:`€${m.getValue()}`,color:"primary"}):e.jsx(X,{label:"N/A",color:"warning"})})}],[]),g=Pe({columns:n,data:c.slice(0,b),enableKeyboardShortcuts:!1,enableColumnActions:!1,enableColumnFilters:!1,enablePagination:!1,enableSorting:!0,initialState:{showColumnFilters:!1,showGlobalFilter:!1,sorting:[{id:"created_at",desc:!0}]},paginationDisplayMode:"default",muiTableBodyRowProps:{hover:!1},localization:De});return i?e.jsx(fe,{}):e.jsx(Ia,{table:g})}function Gs(){const b=Ee();return e.jsxs(v,{children:[e.jsx(Me,{}),e.jsxs(v,{sx:{mx:"5%",mt:0},children:[e.jsx(P,{variant:"h4",sx:{mb:3},children:"Dashboard Tesoreria"}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{size:{xs:12,md:4},children:e.jsxs(Ge,{elevation:3,sx:{p:2},children:[e.jsx(P,{variant:"h6",sx:{mb:2},children:"Casse"}),e.jsx(Ws,{limit:5}),e.jsx(v,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(q,{variant:"outlined",size:"small",onClick:()=>b("/treasury/accounts_list/"),children:"Gestisci Casse"})})]})}),e.jsx(l,{size:{xs:12,md:8},children:e.jsxs(Ge,{elevation:3,sx:{p:2},children:[e.jsx(P,{variant:"h6",sx:{mb:2},children:"Ultime Transazioni"}),e.jsx(Bs,{limit:3}),e.jsx(v,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(q,{variant:"outlined",size:"small",onClick:()=>b("/treasury/transactions_list/"),children:"Gestisci Movimenti"})})]})})]})]})]})}function Ks({open:b,onClose:c,account:s=null}){const i=s!==null,[r,n]=a.useState(!0),[g,m]=a.useState(null),[d,x]=a.useState({name:"",visible_to_groups:[]}),[C,_]=a.useState({name:[!1,""],visible_to_groups:[!1,""]}),[j,o]=a.useState([]);a.useEffect(()=>{(async()=>{try{const S=await O("GET","/groups/");if(S.ok){const D=await S.json();o(D)}else{const D=await J(S);m({message:`Errore nel recupero dei gruppi: ${D}`,state:"error"})}}catch(S){m({message:`Errore nel recupero dei gruppi: ${S}`,state:"error"})}})().then()},[]),a.useEffect(()=>{x(i&&s?{name:s.name||"",visible_to_groups:s.visible_to_groups?.map(f=>f.id)||[]}:{name:"",visible_to_groups:[]}),n(!1)},[i,s]);const z=f=>{const{name:S,value:D}=f.target;x({...d,[S]:D})},h=f=>{x({...d,visible_to_groups:f.target.value})},u=async f=>{f.preventDefault();const S={...C};if(d.name.trim()?S.name=[!1,""]:S.name=[!0,"Il nome è obbligatorio"],d.visible_to_groups.length===0?S.visible_to_groups=[!0,"Seleziona almeno un gruppo"]:S.visible_to_groups=[!1,""],_(S),!(S.name[0]||S.visible_to_groups[0])){n(!0);try{const D={name:d.name,visible_to_groups:d.visible_to_groups};let F;if(i&&s?F=await O("PATCH",`/account/${s.id}/`,D):F=await O("POST","/account/",D),F.ok)c(!0);else{const V=await J(F);m({message:`Errore ${i?"modifica":"creazione"} cassa: ${V}`,state:"error"})}}catch(D){const F=await J(D);m({message:`Errore generale: ${F}`,state:"error"})}finally{n(!1)}}},t=()=>{c(!1)};return e.jsx(Ie,{open:b,onClose:t,children:e.jsx(v,{sx:Re,component:"form",onSubmit:u,noValidate:!0,children:r?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(H,{onClick:t,sx:{minWidth:0},children:e.jsx(ze,{})})}),e.jsx(P,{variant:"h5",gutterBottom:!0,align:"center",sx:{mb:2},children:i?`Modifica Cassa - ${s?.name}`:"Crea Cassa"}),g&&e.jsx(ye,{message:g.message,state:g.state}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{size:{xs:12},children:e.jsx(A,{fullWidth:!0,label:ue.name,name:"name",value:d.name,onChange:z,required:!0,error:C.name[0],helperText:C.name[0]?C.name[1]:""})}),e.jsx(l,{size:{xs:12},children:e.jsxs(Z,{fullWidth:!0,error:C.visible_to_groups[0],children:[e.jsx(se,{id:"groups-label",children:ue.visible_to_groups}),e.jsx(te,{variant:"outlined",labelId:"groups-label",multiple:!0,value:d.visible_to_groups,onChange:h,input:e.jsx(_e,{label:ue.visible_to_groups}),renderValue:f=>e.jsx(v,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:f.map(S=>{const D=j.find(F=>F.id===S);return e.jsx(X,{label:D?D.name:S},S)})}),children:j.map(f=>e.jsx($,{value:f.id,children:f.name},f.id))}),C.visible_to_groups[0]&&e.jsx(He,{children:C.visible_to_groups[1]})]})})]}),e.jsx(v,{mt:2,children:e.jsx(q,{fullWidth:!0,variant:"contained",color:"primary",type:"submit",children:i?"Salva Modifiche":"Crea"})})]})})})}function Vs(){const[b,c]=a.useState([]),[s,i]=a.useState(!0),[r,n]=a.useState(!1),g=Ee(),[m,d]=a.useState(null),[x,C]=a.useState(null),[_,j]=a.useState(!1);a.useEffect(()=>{o().then()},[]);const o=async()=>{i(!0);try{const t=await O("GET","/accounts/");if(t.ok){const f=await t.json();c(f.results),console.log("Account List Data: ",f.results)}else{const f=await J(t);d({message:`Errore: ${f}`,state:"error"})}}catch(t){d({message:`Errore generale: ${t}`,state:"error"})}finally{i(!1)}},z=a.useMemo(()=>[{accessorKey:"id",header:ue.id,size:50},{accessorKey:"name",header:ue.name,size:150},{accessorKey:"changed_by.name",header:ue.changed_by,size:150},{accessorKey:"balance",header:ue.balance,size:100,Cell:({cell:t})=>e.jsx(v,{children:t.getValue()!==null?e.jsx(X,{label:`€${t.getValue()}`,color:"primary"}):e.jsx(X,{label:"N/A",color:"warning"})})},{accessorKey:"status",header:ue.status,size:150,Cell:({cell:t})=>e.jsx(v,{sx:{},children:t.getValue()!==null?e.jsx(X,{label:t.getValue()==="open"?"Aperta":"Chiusa",color:t.getValue()==="open"?"success":"error"}):e.jsx(X,{label:"N/A",color:"warning"})})},{accessorKey:"visible_to_groups",header:ue.visible_to_groups,size:150,Cell:({cell:t})=>e.jsx(v,{sx:{},children:t.getValue()!==null?t.getValue().map(f=>e.jsx(X,{label:f.name,color:"grey",sx:{mr:1}},f.id)):e.jsx(X,{label:"N/A",color:"warning"})})},{header:"Azioni",size:150,Cell:({row:t})=>e.jsxs(v,{sx:{display:"flex",gap:1},children:[e.jsx(H,{color:"primary",onClick:()=>{C(t.original),n(!0)},children:e.jsx(qe,{})}),e.jsx(q,{variant:"contained",color:"primary",onClick:()=>{C(t.original),j(!0)},children:"Deposita/Preleva"})]})}],[]),h=Pe({columns:z,data:b,enablePagination:!1,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableColumnPinning:!1,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableRowPinning:!1,enableExpandAll:!1,initialState:{showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},columnVisibility:{id:!1,name:!0,changed_by:!0,status:!0,balance:!0}},positionToolbarAlertBanner:"bottom",localization:De,muiTableBodyRowProps:()=>({sx:{cursor:"default"}}),renderTopToolbarCustomActions:()=>e.jsx(v,{sx:{display:"flex",flexDirection:"row"},children:e.jsx(q,{variant:"contained",onClick:()=>n(!0),sx:{width:"150px"},children:"Nuova Cassa"})})}),u=async t=>{t&&(d({message:"Cassa creata con successo!",state:"success"}),await o()),C(null),n(!1)};return e.jsxs(v,{children:[e.jsx(Me,{}),r&&e.jsx(Ks,{open:r,onClose:u,account:x}),e.jsx(ka,{open:_,onClose:()=>j(!1),account:x,onSuccess:(t,f)=>d({message:t,state:f||"success"})}),e.jsx(v,{sx:{mx:"5%"},children:s?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsxs(v,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(H,{onClick:()=>{g(-1)},sx:{mr:2},children:e.jsx(ta,{})}),e.jsx(ts,{sx:{marginRight:"10px"}}),e.jsx(P,{variant:"h4",children:"Lista Casse"})]}),e.jsx(Ne,{table:h})]})}),m&&e.jsx(ye,{message:m.message,state:m.state})]})}function La({value:b,onChange:c,readOnly:s=!1}){const i=a.useRef(null),r=a.useRef(null);return a.useEffect(()=>{if(i.current&&!r.current){const n=s?{toolbar:!1}:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["link"],["clean"]]};r.current=new _s(i.current,{theme:"snow",readOnly:s,modules:n}),r.current.on("text-change",()=>{c&&c(r.current.root.innerHTML)}),b&&(r.current.root.innerHTML=b)}},[b,c,s]),e.jsx("div",{ref:i})}function Na({open:b,event:c,isEdit:s,onClose:i}){const[r,n]=a.useState(!0),g=s?"Modifica Evento - "+c.name:"Crea Evento",[m,d]=a.useState(null),[x,C]=a.useState(!1),[_,j]=a.useState({id:"",name:"",date:W(),description:`<h3>Descrizione</h3>    <p>Ecco un <a href="https://www.italia.it" target="_blank">link all'Italia</a>.</p>    <blockquote>Citazione elegante.</blockquote>    <p style="text-align: center;">Adios.</p>`,cost:"",subscription_start_date:W().hour(12).minute(0),subscription_end_date:W().hour(24).minute(0),lists:[{id:"",name:"Main List",capacity:""}]}),[o,z]=xe.useState({name:[!1,""],date:[!1,""],description:[!1,""],cost:[!1,""],subscription_start_date:[!1,""],subscription_end_date:[!1,""],lists:[!1,""],listItems:[]});a.useEffect(()=>{s&&(console.log("Setting form data: ",c),j(c),console.log("#Subsciptions: ",c.subscriptions.length),C(c.subscriptions.length>0)),n(!1)},[]);const h=w=>W(w).format("YYYY-MM-DD"),u=w=>W(w).toISOString(),t=w=>{w&&W(w).isBefore(W(),"day")||j({..._,date:w})},f=w=>{_.subscription_end_date&&W(w).isAfter(W(_.subscription_end_date))?j({..._,subscription_start_date:w,subscription_end_date:W(w).add(1,"day")}):j({..._,subscription_start_date:w})},S=w=>{if(w){const B=W(_.subscription_start_date),M=W(w),p=W();M.isBefore(B)?w=B:M.isBefore(p)&&(w=p)}j({..._,subscription_end_date:w})},D=w=>({name:w.name,date:h(w.date),description:w.description,subscription_start_date:u(w.subscription_start_date),subscription_end_date:u(w.subscription_end_date),cost:Number(w.cost).toFixed(2),lists:w.lists.map(B=>({id:B.id,name:B.name,capacity:Math.floor(Number(B.capacity))}))}),F=()=>{window.scrollTo({top:0,behavior:"smooth"})},V=w=>{const{name:B,value:M,type:p,checked:E}=w.target;j({..._,[B]:p==="checkbox"?E:M})},ee=()=>{j({..._,lists:[..._.lists,{id:"",name:"",capacity:""}]})},I=(w,B)=>{const{name:M,value:p}=B.target,E=_.lists.map((y,k)=>k===w?{...y,[M]:p}:y);j({..._,lists:E})},G=w=>{j({..._,lists:_.lists.filter((B,M)=>M!==w)})},K=async w=>{w.preventDefault();const B=_.lists.map(p=>({name:!p.name.trim(),capacity:p.capacity===""})),M=B.some(p=>p.name||p.capacity);if(z({...o,listItems:B,lists:[M]}),M){d({message:"Errore campi Liste",state:"error"}),F();return}try{const p=s?await O("PATCH",`/event/${_.id}/`,D(_)):await O("POST","/event/",D(_));if(p.ok)i(!0);else{const E=await J(p);d({message:`Errore ${s?"modifica":"creazione"} evento: ${E}`,state:"error"}),F()}}catch(p){console.error("Error creating/updating event:",p);const E=await J(p);d({message:`Errore generale: ${E}`,state:"error"}),F()}},ne=()=>{i(!1)};return e.jsx(Ie,{open:b,onClose:ne,children:e.jsx(v,{sx:Da,component:"form",onSubmit:K,noValidate:!1,children:r?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(H,{onClick:()=>i(!1),sx:{minWidth:0},children:e.jsx(ze,{})})}),e.jsx(P,{variant:"h5",gutterBottom:!0,sx:{mb:2},align:"center",children:g}),m&&e.jsx(Fe,{message:m.message,state:m.state}),s&&x&&e.jsx(v,{sx:{mb:2,p:1,bgcolor:"#fff3e0",borderRadius:1},children:e.jsxs(P,{variant:"body2",color:"warning.main",children:[e.jsx(ns,{fontSize:"small",sx:{verticalAlign:"middle",mr:1}}),"Alcuni campi non sono modificabili perché ci sono già iscrizioni. Rimuovi tutte le iscrizioni per abilitare la modifica."]})}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{size:{xs:12,md:6},children:e.jsx(A,{fullWidth:!0,label:he.name,name:"name",value:_.name,onChange:V,required:!0,error:o.name[0]})}),e.jsx(l,{size:{xs:12,md:6},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(be,{label:he.date,value:_.date,onChange:t,minDate:s?null:W(),renderInput:w=>e.jsx(A,{...w,fullWidth:!0,required:!0}),required:!0,error:o.date[0]})})}),e.jsx(l,{size:{xs:12,md:3},children:e.jsx($e,{title:s&&x?"Non modificabile con iscrizioni esistenti":"",children:e.jsxs("div",{children:[" ",e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(ca,{label:he.subscription_start_date,value:_.subscription_start_date||null,onChange:f,minDate:s?null:W(),slotProps:{textField:{fullWidth:!0,required:!0}},disabled:s&&x,required:!0,error:o.subscription_start_date[0]})})]})})}),e.jsx(l,{size:{xs:12,md:3},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(ca,{label:he.subscription_end_date,value:_.subscription_end_date||null,onChange:S,minDate:W().isAfter(_.subscription_start_date)?W():_.subscription_start_date||W(),slotProps:{textField:{fullWidth:!0,required:!0}},required:!0,error:o.subscription_start_date[0]})})}),e.jsx(l,{size:{xs:12,md:3},children:e.jsx($e,{title:s&&x?"Non modificabile con iscrizioni esistenti":"",children:e.jsxs("div",{children:[" ",e.jsx(A,{fullWidth:!0,label:he.cost,name:"cost",type:"number",slotProps:{htmlInput:{min:"0",step:"0.01"}},value:_.cost,onChange:V,placeholder:"Inserisci 0 se gratuito",required:!0,error:o.cost[0],disabled:s&&x})]})})})]}),e.jsxs(l,{size:{xs:12},"data-color-mode":"light",children:[e.jsx(P,{variant:"h6",component:"div",children:he.description}),e.jsx(La,{value:_.description,onChange:w=>{j({..._,description:w})}})]}),e.jsxs(v,{my:2,children:[e.jsxs(l,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(l,{children:e.jsx(P,{variant:"h6",gutterBottom:!0,children:"Liste"})}),e.jsx(l,{children:e.jsx(H,{onClick:ee,children:e.jsx(rs,{})})})]}),_.lists.map((w,B)=>e.jsxs(l,{container:!0,spacing:2,alignItems:"center",mb:2,children:[e.jsx(l,{children:e.jsx(A,{label:he.list_name,name:"name",value:w.name,onChange:M=>I(B,M),required:!0,error:o.listItems[B]?.name,helperText:o.listItems[B]?.name?"Il nome è obbligatorio":""})}),e.jsx(l,{children:e.jsx(A,{label:he.list_capacity,name:"capacity",type:"number",value:w.capacity,slotProps:{htmlInput:{min:"0",step:"1"}},onChange:M=>I(B,M),placeholder:"Inserisci 0 se illimitata",required:!0,error:o.listItems[B]?.capacity,helperText:o.listItems[B]?.capacity?"La capacità è obbligatoria":""})}),e.jsx(l,{size:{xs:2},children:e.jsx(H,{onClick:()=>G(B),children:e.jsx(ya,{})})})]},B))]}),e.jsx(v,{mt:2,children:e.jsx(q,{variant:"contained",color:"primary",type:"submit",children:s?"Salva Modifiche":"Crea"})})]})})})}const pa=[{value:"open",label:"Iscrizioni aperte"},{value:"not_yet",label:"Non ancora aperte"},{value:"closed",label:"Iscrizioni chiuse"}];function qs(){const[b,c]=a.useState([]),[s,i]=a.useState(!0),[r,n]=a.useState(!1),g=Ee(),[m,d]=a.useState(null),[x,C]=a.useState({pageIndex:0,pageSize:10}),[_,j]=a.useState(0),[o,z]=a.useState(""),[h,u]=a.useState(""),[t,f]=a.useState({subscriptionStatus:[],dateFrom:null,dateTo:null}),[S,D]=a.useState(!1),F=a.useRef(null);a.useEffect(()=>{let M=!1;return(async()=>{D(!0);try{const E=new URLSearchParams;E.append("page",x.pageIndex+1),E.append("page_size",x.pageSize),h&&E.append("search",h),t.subscriptionStatus.length&&t.subscriptionStatus.forEach(k=>E.append("subscription_status",k)),t.dateFrom&&E.append("dateFrom",t.dateFrom.toISOString()),t.dateTo&&E.append("dateTo",t.dateTo.toISOString());const y=await O("GET",`/events/?${E.toString()}`);if(y.ok){const k=await y.json();M||(j(k.count||0),c(k.results))}else{const k=await J(y);d({message:`Errore: ${k}`,state:"error"})}}catch(E){d({message:`Errore generale: ${E}`,state:"error"})}finally{D(!1)}})().then(),()=>{M=!0}},[x.pageIndex,x.pageSize,t,h]);const V=a.useMemo(()=>[{accessorKey:"id",header:he.id,size:50},{accessorKey:"name",header:he.name,size:150},{accessorKey:"date",header:he.date,size:150},{accessorKey:"cost",header:he.cost,size:150},{accessorKey:"subscription_start_date",header:he.subscription_date_status,size:150,Cell:({row:M})=>{const p=W(),E=M.original.subscription_start_date?W(M.original.subscription_start_date):null,y=M.original.subscription_end_date?W(M.original.subscription_end_date):null;let k="Non disponibile",re="error";return E&&y&&(p.isAfter(E)&&p.isBefore(y)?(k="Iscrizioni aperte",re="success"):p.isBefore(E)?(k="Iscrizioni non ancora aperte",re="warning"):p.isAfter(y)&&(k="Iscrizioni chiuse",re="error")),e.jsx(X,{label:k,color:re})}}],[]),ee=Pe({columns:V,data:b,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableColumnPinning:!0,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableRowPinning:!0,enableExpandAll:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},columnVisibility:{id:!0,name:!0,date:!0,cost:!0}},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",enableGlobalFilter:!1,muiPaginationProps:{color:"secondary",rowsPerPageOptions:[10,20,30],shape:"rounded",variant:"outlined"},manualPagination:!0,rowCount:_,onPaginationChange:C,state:{pagination:x},localization:De,muiTableBodyRowProps:({row:M})=>({onClick:()=>{g("/event/"+M.original.id,{state:{event:M.original}})}}),renderTopToolbarCustomActions:()=>e.jsx(v,{sx:{display:"flex",flexDirection:"row"},children:e.jsx(q,{variant:"contained",onClick:()=>n(!0),sx:{width:"150px"},children:"Crea"})})}),I=()=>{u(o),C(M=>({...M,pageIndex:0}))},G=()=>{z(""),u(""),C(M=>({...M,pageIndex:0})),F.current&&F.current.focus()},K=M=>{const{name:p,value:E}=M.target;f(y=>({...y,[p]:typeof E=="string"?E.split(","):E}))},ne=(M,p)=>{f(E=>{let y={...E,[M]:p};return M==="dateFrom"&&y.dateTo&&p&&p>y.dateTo&&(y.dateTo=p),M==="dateTo"&&y.dateFrom&&p&&p<y.dateFrom&&(y.dateFrom=p),y})},w=()=>{f(M=>({...M,dateFrom:null,dateTo:null}))},B=async M=>{M&&(d({message:"Evento creato con successo!",state:"success"}),setAppliedFilters(t)),n(!1)};return e.jsxs(v,{children:[e.jsx(Me,{}),r&&e.jsx(Na,{open:r,onClose:B,isEdit:!1}),e.jsxs(v,{sx:{mx:"5%"},children:[e.jsxs(v,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(sa,{sx:{marginRight:"10px"}}),e.jsx(P,{variant:"h4",children:"Lista Eventi"})]}),e.jsxs(l,{container:!0,spacing:2,sx:{mb:2},alignItems:"center",justifyContent:"flex-end",children:[e.jsx(l,{size:{xs:12,sm:2},children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(se,{id:"subscription-status-label",children:"Stato iscrizione"}),e.jsx(te,{labelId:"subscription-status-label",name:"subscriptionStatus",multiple:!0,value:t.subscriptionStatus,onChange:K,input:e.jsx(_e,{label:"Stato iscrizione"}),variant:"outlined",renderValue:M=>pa.filter(p=>M.includes(p.value)).map(p=>p.label).join(", "),children:pa.map(M=>e.jsx($,{value:M.value,children:M.label},M.value))})]})}),e.jsx(l,{size:{xs:12,sm:2},children:e.jsx(Z,{fullWidth:!0,children:e.jsx(me,{dateAdapter:Ke,adapterLocale:Ve,children:e.jsx(be,{label:"Inizio Iscrizioni",value:t.dateFrom,maxDate:t.dateTo||void 0,onChange:M=>ne("dateFrom",M),format:"d MMM yyyy"})})})}),e.jsx(l,{size:{xs:12,sm:2},children:e.jsx(Z,{fullWidth:!0,children:e.jsx(me,{dateAdapter:Ke,adapterLocale:Ve,children:e.jsx(be,{label:"Fine Iscrizioni",value:t.dateTo,minDate:t.dateFrom||void 0,onChange:M=>ne("dateTo",M),format:"d MMM yyyy"})})})}),(t.dateFrom||t.dateTo)&&e.jsx(l,{size:{xs:12,sm:2},sx:{display:"flex",alignItems:"center"},children:e.jsx(q,{variant:"outlined",color:"secondary",startIcon:e.jsx(We,{}),onClick:w,sx:{height:"100%",minWidth:0,px:1,mr:1},children:"Azzera date"})}),e.jsx(l,{size:{xs:12,sm:2},sx:{ml:"auto"},children:e.jsx(_e,{inputRef:F,size:"small",placeholder:"Cerca",value:o,onChange:M=>z(M.target.value),onKeyDown:M=>{M.key==="Enter"&&I()},endAdornment:o&&h===o?e.jsx(H,{"aria-label":"clear",onClick:G,edge:"end",children:e.jsx(We,{})}):e.jsx(H,{"aria-label":"search",onClick:I,edge:"end",children:e.jsx(aa,{})})})})]}),S?e.jsx(fe,{}):e.jsx(Ne,{table:ee}),m&&e.jsx(ye,{message:m.message,state:m.state})]})]})}function Fa({value:b,onChange:c,error:s,helperText:i,label:r="Cerca profilo",required:n=!1,disabled:g=!1,valid_only:m=!0,esner_only:d=!1}){const[x,C]=a.useState([]),[_,j]=a.useState(""),[o,z]=a.useState(!1);a.useEffect(()=>{if(_.length<3){C([]);return}z(!0);const u=setTimeout(async()=>{try{const t=await O("GET",`/profiles/search/?q=${encodeURIComponent(_)}&valid_only=${m}&esner_only=${d}`);if(t.ok){const f=await t.json();C(f.results||[])}}finally{z(!1)}},300);return()=>clearTimeout(u)},[_]);const h=(u,t)=>{const{key:f,...S}=u,D=t.latest_esncard&&t.latest_esncard.number,F=D&&!t.latest_esncard.is_valid;return e.jsx("li",{...S,children:e.jsxs(l,{container:!0,spacing:1,sx:{width:"100%"},children:[e.jsx(l,{size:{xs:4},children:e.jsxs(P,{children:[t.name," ",t.surname]})}),e.jsx(l,{size:{xs:4},children:e.jsx(P,{component:"span",sx:{color:D?F?"error.main":"text.primary":"error.main"},children:D?F?`${t.latest_esncard.number} (Scaduta)`:t.latest_esncard.number:"No ESNcard"})}),e.jsx(l,{size:{xs:4},children:e.jsx(P,{component:"span",sx:{color:t.is_esner?"primary.main":"success.main",fontWeight:"bold",textAlign:"right",display:"block"},children:t.is_esner?"ESNer":"Erasmus"})})]})},f)};return e.jsx(is,{options:x,loading:o,getOptionLabel:u=>`${u.name}${u.surname?` ${u.surname}`:""}${u.latest_esncard?` (${u.latest_esncard.number})`:""}`,renderOption:h,value:b,onChange:c,onInputChange:(u,t)=>j(t),renderInput:u=>e.jsx(A,{...u,label:r,required:n,error:s,helperText:i}),noOptionsText:"Nessun profilo trovato",loadingText:"Caricamento...",disabled:g})}function Hs({open:b,onClose:c,event:s,listId:i,subscription:r,isEdit:n}){const[g,m]=a.useState(!0),[d,x]=a.useState(null),[C,_]=a.useState([]),[j,o]=a.useState({open:!1,action:null,message:""}),z=n?"Modifica Iscrizione":"Iscrizione Evento",h=n&&r.account_id||null,[u,t]=a.useState({id:"",account_id:"",account_name:"",profile_id:"",profile_name:"",status:"pending",list_id:i||"",list_name:s.lists.find(p=>p.id===i)?.name||"Lista non trovata",notes:""}),[f,S]=a.useState({account_id:[!1,""],account_name:[!1,""],profile_id:[!1,""],profile_name:[!1,""],status:[!1,""],list_id:[!1,""],list_name:[!1,""],notes:[!1,""]}),D=a.useMemo(()=>[{field:"profile_id",value:u?.profile_id,message:"Selezionare un Profilo"},...u?.status==="paid"?[{field:"account_id",value:u?.account_id,message:"Selezionare una Cassa"}]:[]],[u]),[F,V]=a.useState(n?r.status:"pending");a.useEffect(()=>{n&&(console.log("Setting Subscription:",r),t(r),V(r.status)),m(!1),ee().then()},[n]);const ee=async()=>{try{const p=await O("GET","/accounts/");if(p.ok){const E=await p.json();_(E.results)}else{const E=await J(p);x({message:`Errore durante il recupero delle casse: ${E}`,state:"error"})}}catch(p){x({message:`Errore generale: ${p}`,state:"error"})}},I=()=>{const p={};return Object.keys(f).forEach(E=>{p[E]=[!1,""]}),S(p),p},G=async()=>{let p=!1;const E=I();if(D.forEach(y=>{y.value||(E[y.field]=[!0,y.message],p=!0)}),p){S(E);return}if(u.status==="paid"&&(!n||F!=="paid")||n&&F==="paid"&&u.status!=="paid"){let y="";u.status==="paid"&&(!n||F!=="paid")?y="Confermi di registrare un pagamento di €"+s.cost+" per questa iscrizione?":n&&F==="paid"&&u.status!=="paid"&&(y="Confermi di annullare un pagamento di €"+s.cost+" per questa iscrizione?"),o({open:!0,action:()=>K(),message:y});return}if(u.status==="paid"&&n&&F==="paid"&&u.account_id!==h){o({open:!0,action:()=>K(),message:"Confermi di voler cambiare la cassa associata a questo pagamento? Verranno spostati €"+s.cost+" da "+u.account_name+" a "+C.find(y=>y.id===u.account_id)?.name+"."});return}await K()},K=async()=>{o({open:!1,action:null,message:""});try{const p=await O(n?"PATCH":"POST",`/subscription/${n?u.id+"/":""}`,{profile:u.profile_id,event:s.id,list:u.list_id,account_id:u.account_id||h,notes:u.notes,status:u.status});if(p.ok)c(!0,(n?"Modifica Iscrizione":"Iscrizione")+" completata con successo!");else{const E=await J(p);x({message:`Errore: ${E}`,state:"error"})}}catch(p){x({message:`Errore generale: ${p}`,state:"error"})}},ne=async()=>{if(u.status==="paid"){o({open:!0,action:()=>w(),message:"Confermi di voler eliminare un pagamento di €"+s.cost+" per questa iscrizione?"});return}await w()},w=async()=>{if(o({open:!1,action:null,message:""}),!(!n||!u.id))try{const p=await O("DELETE",`/subscription/${u.id}/`);if(p.ok)c(!0,"Eliminazione avvenuta con successo");else{const E=await J(p);x({message:`Errore eliminazione: ${E}`,state:"error"})}}catch(p){x({message:`Errore generale: ${p}`,state:"error"})}},B=p=>{t({...u,[p.target.name]:p.target.value})},M=()=>{t({...u,status:u.status==="paid"?"pending":"paid",...u.status==="paid"?{account_id:""}:{}})};return e.jsx(Ie,{open:b,onClose:()=>{c(!1)},"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(v,{sx:Re,children:[g?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(H,{onClick:()=>c(!1),sx:{minWidth:0},children:e.jsx(ze,{})})}),e.jsx(P,{variant:"h4",component:"h2",gutterBottom:!0,children:z}),e.jsx(Oe,{sx:{mb:2}}),e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Nome Evento:"})," ",s.name]}),e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Lista:"})," ",u.list_name]}),e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Importo:"})," ",s.cost,"€"]}),e.jsxs(l,{container:!0,spacing:2,direction:"column",children:[e.jsx(l,{size:{xs:12},sx:{mt:2},children:e.jsx(Fa,{value:u.profile_id?{id:u.profile_id,name:u.profile_name}:null,onChange:(p,E)=>{t({...u,profile_id:E?.id,profile_name:E?`${E.name} ${E.surname}`:""})},error:f.profile_id&&f.profile_id[0],helperText:f.profile_id&&f.profile_id[1]||"Cerca per nome o numero ESNcard",label:n?u.profile_name:"Cerca profilo",required:!0,disabled:n})}),e.jsx(l,{size:{xs:12},children:e.jsxs(Ge,{elevation:1,sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",bgcolor:u.status==="paid"?"#e3f2fd":"inherit",transition:"background-color 0.3s"},children:[e.jsx(P,{variant:"subtitle1",children:"Stato Pagamento"}),e.jsx(ve,{control:e.jsx(os,{checked:u.status==="paid",onChange:M,color:"primary"}),label:u.status==="paid"?"Pagato":"In attesa",labelPlacement:"start"})]})}),u.status==="paid"&&e.jsx(l,{size:{xs:12},children:e.jsxs(Z,{fullWidth:!0,required:!0,error:f.account_id&&f.account_id[0],children:[e.jsx(se,{htmlFor:"account-selector",sx:{mb:2},children:"Seleziona Cassa"}),e.jsx(te,{variant:"outlined",label:"Seleziona Cassa",labelId:"account-selector-label",id:"account-selector",name:"account_id",value:u.account_id||"",error:f.account_id&&f.account_id[0],onChange:B,children:C.map(p=>e.jsxs($,{value:p.id,disabled:p.status==="closed",style:{color:p.status==="closed"?"grey":"inherit"},children:[p.name," ",p.status==="closed"?"(Chiusa)":""]},p.id))}),f.account_id&&f.account_id[0]&&e.jsx(He,{children:f.account_id[1]})]})}),e.jsx(l,{size:{xs:12},children:e.jsx(A,{label:"Note",name:"notes",value:u.notes,onChange:B,multiline:!0,rows:2,fullWidth:!0})})]}),e.jsx(q,{variant:"contained",fullWidth:!0,sx:{mt:2,bgcolor:u.profile_id?"#1976d2":"#9e9e9e","&:hover":{bgcolor:u.profile_id?"#1565c0":"#757575"}},onClick:G,children:n?"Salva Modifiche":"Conferma"}),n&&e.jsx(q,{variant:"contained",fullWidth:!0,sx:{mt:1,bgcolor:"#d32f2f","&:hover":{bgcolor:"#b71c1c"}},onClick:ne,children:"Elimina Iscrizione"}),d&&e.jsx(ye,{message:d.message,state:d.state})]}),e.jsx(ia,{open:j.open,message:j.message,onConfirm:j.action,onClose:()=>o({open:!1,action:null,message:""})})]})})}function Ys({open:b,onClose:c,selectedRows:s,event:i,listId:r}){const[n,g]=a.useState(null),[m,d]=a.useState([]),[x,C]=a.useState(""),_=i.lists.find(o=>o.id===r)?.name||"Lista non trovata";a.useEffect(()=>{if(i?.lists){const o=i.lists.filter(z=>z.id!==r);d(o)}},[i,r]);const j=async()=>{if(x)try{const o=await O("POST","/move-subscriptions/",{subscriptionIds:s.map(z=>z.original.id),targetListId:x});if(o.ok)c(!0);else{const z=await J(o);g({message:`Errore: ${z}`,state:"error"})}}catch(o){g({message:`Errore generale: ${o}`,state:"error"})}};return e.jsx(Ie,{open:b,onClose:()=>c(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(v,{sx:Re,children:[e.jsx(v,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(H,{onClick:()=>c(!1),sx:{minWidth:0},children:e.jsx(ze,{})})}),e.jsxs(P,{variant:"h4",component:"h3",gutterBottom:!0,children:["Sposta ",s.length," ",s.length===1?"iscrizione":"iscrizioni"]}),e.jsxs(P,{variant:"body1",id:"modal-modal-description",gutterBottom:!0,children:["Lista di origine: ",_]}),e.jsxs(Z,{fullWidth:!0,sx:{mt:1},children:[e.jsx(se,{id:"list-select-label",children:"Lista di destinazione"}),e.jsx(te,{labelId:"list-select-label",label:"Lista di destinazione",value:x,onChange:o=>C(o.target.value),variant:"outlined",children:m.map(o=>e.jsx($,{value:o.id,children:o.name},o.id))})]}),e.jsx(q,{variant:"contained",fullWidth:!0,sx:{mt:2,bgcolor:x?"#1976d2":"#9e9e9e","&:hover":{bgcolor:x?"#1565c0":"#757575"}},onClick:j,disabled:!x,children:"Conferma"}),n&&e.jsx(ye,{message:n.message,state:n.state})]})})}function Us(){const{id:b}=na(),c=ys(),s=Ee(),[i,r]=a.useState(!1),[n,g]=a.useState(!1),[m,d]=a.useState(!1),[x,C]=a.useState([]),[_,j]=a.useState(!0),[o,z]=a.useState(null),[h,u]=a.useState(null),t=c.state?.event,[f,S]=a.useState(null),[D,F]=a.useState(null),[V,ee]=a.useState(null);a.useEffect(()=>{j(!0),(async()=>{try{const Y=b||t?.id,oe=await O("GET",`/event/${Y}/`);if(oe.ok){const ie=await oe.json();u(ie),console.log("Event Data: ",ie)}else{const ie=await J(oe);z({message:`Errore: ${ie}`,state:"error"})}}catch(Y){z({message:`Errore generale: ${Y}`,state:"error"})}finally{j(!1)}})().then()},[b,t]);const I=async()=>{j(!0);try{const N=await O("GET",`/event/${h.id}/`);if(N.ok){const Y=await N.json();u(Y),j(!1)}else{const Y=await J(N);z({message:`Errore: ${Y}`,state:"error"})}}catch(N){z({message:`Errore generale: ${N}`,state:"error"})}finally{j(!1)}},G=()=>{r(!0)},K=async N=>{N&&(z({message:"Evento modificato con successo!",state:"success"}),await I()),r(!1)},ne=N=>{S(N),ee(!1),g(!0)},w=async(N,Y)=>{N&&(z({message:Y,state:"success"}),await I()),g(!1),S(null)},B=()=>{if(!h)return{chip:e.jsx(X,{label:"Loading...",variant:"outlined",size:"medium"}),isActive:!1};const N=W(),Y=h.subscription_start_date?W(h.subscription_start_date):null,oe=h.subscription_end_date?W(h.subscription_end_date):null;let ie="error",de=!1;Y&&oe&&(N.isAfter(Y)&&N.isBefore(oe)?(ie="success",de=!0):N.isBefore(Y)&&(ie="warning"));let Q=h.subscription_start_date?W(h.subscription_start_date).format("DD/MM/YYYY HH:mm"):"Inizio non specificato",ge=h.subscription_end_date?W(h.subscription_end_date).format("DD/MM/YYYY HH:mm"):"Fine non specificata";return{chip:e.jsx(X,{label:Q+" - "+ge,color:ie,variant:"outlined",size:"medium"}),isActive:de}},M=N=>{console.log("Editing subscription:",N),S(null),F(h.subscriptions.find(Y=>Y.id===N)||null),ee(!0),g(!0)},p=xe.useMemo(()=>h?.lists?h.lists.map(N=>{const Y=h.subscriptions?.filter(ie=>ie.list_id===N.id)||[],oe=[{accessorKey:"id",header:"ID",size:50},{accessorKey:"profile_name",header:"Profilo",size:150},{accessorKey:"status",header:"Stato",size:100,Cell:({cell:ie})=>{const de=ie.getValue();let Q,ge;switch(de){case"paid":Q="success",ge="PAGATO";break;case"pending":Q="warning",ge="IN ATTESA";break;case"cancelled":Q="error",ge="CANCELLATO";break;default:Q="default",ge=de}return e.jsx(X,{label:ge,color:Q,size:"small"})}},{accessorKey:"notes",header:"Note",size:200}];return{listId:N.id,listName:N.name,capacity:N.capacity,subscriptions:Y,columns:oe}}):[],[h]),E=xe.useMemo(()=>p.map(N=>({...N,tableOptions:{columns:N.columns,data:N.subscriptions,enableStickyHeader:!0,enablePagination:!0,enableRowSelection:!0,display:!1,initialState:{pagination:{pageSize:10,pageIndex:0}},paginationDisplayMode:"pages",localization:De,renderEmptyRowsFallback:()=>e.jsx(v,{sx:{textAlign:"center",p:2},children:e.jsx(P,{variant:"body1",children:"Nessuna iscrizione presente"})}),muiTablePaginationProps:{labelRowsPerPage:"Righe per pagina:"},renderTopToolbarCustomActions:({table:Y})=>{const oe=Y.getSelectedRowModel().rows,ie=oe.length;return e.jsxs(v,{sx:{display:"flex",gap:1},children:[ie>=1&&e.jsxs(e.Fragment,{children:[e.jsx(q,{variant:"outlined",color:"primary",onClick:()=>k(oe,N.listId),children:"Sposta in Altra Lista"}),e.jsx(q,{variant:"outlined",color:"secondary",onClick:()=>ce(oe),children:"Esporta"})]}),ie===1&&e.jsx(e.Fragment,{children:e.jsx(q,{variant:"contained",color:"primary",onClick:()=>M(oe[0].original.id),children:"Modifica Iscrizione"})})]})}}})),[p]),y=xe.memo(()=>{if(!E||E.length===0)return e.jsx(P,{children:"Nessuna lista disponibile (aggiungine una per poter iscrivere)"});const{isActive:N}=B();return E.map(Y=>{const{listId:oe,listName:ie,capacity:de,subscriptions:Q,tableOptions:ge}=Y,ke=Math.round(Q.length/de*100)||0,Le=ke>=90?"error":ke>=60?"warning":"success",Ye={...ge,paginationDisplayMode:"pages"},T=Pe(Ye);return e.jsxs(ls,{sx:{mt:2},children:[e.jsx(cs,{children:e.jsxs(v,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(ds,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",sx:{flexGrow:1},children:ie}),e.jsxs(v,{sx:{display:"flex",alignItems:"center",cursor:Q.length<de&&N?"pointer":"not-allowed",opacity:Q.length<de&&N?1:.5,px:2,py:1,borderRadius:1,bgcolor:"primary.main",color:"white",ml:2},onClick:Q.length<de&&N?()=>ne(oe):void 0,children:[e.jsx(us,{sx:{mr:1}})," ISCRIVI"]}),e.jsxs(v,{sx:{width:"200px",ml:2},children:[e.jsx(v,{sx:{display:"flex",justifyContent:"space-between"},children:e.jsxs(P,{variant:"body2",children:[Q.length,"/",de]})}),e.jsx(ms,{variant:"determinate",value:ke,color:Le,sx:{height:8,borderRadius:5}})]})]})}),e.jsx(ps,{children:e.jsx(Ne,{table:T})})]},oe)})}),k=(N,Y)=>{console.log("Moving selected rows to another list:",N),C(N),S(Y),d(!0)},re=N=>{N&&(z({message:"Spostamento effettuato con successo!",state:"success"}),I().then()),d(!1)},ce=N=>{console.log("Exporting selected rows:",N)};return e.jsxs(v,{children:[e.jsx(Me,{}),i&&e.jsx(Na,{open:i,onClose:K,event:{...h,date:h.date?W(h.date):null,subscription_start_date:h.subscription_start_date?W(h.subscription_start_date):null,subscription_end_date:h.subscription_end_date?W(h.subscription_end_date):null},isEdit:!0}),n&&e.jsx(Hs,{open:n,onClose:w,event:h,listId:f,subscription:D,isEdit:V}),m&&e.jsx(Ys,{open:m,onClose:re,selectedRows:x,event:h,listId:f}),e.jsxs(v,{sx:{mx:"5%"},children:[_?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsxs(v,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(H,{onClick:()=>{s(-1)},sx:{mr:2},children:e.jsx(ta,{})}),e.jsx(sa,{sx:{marginRight:"10px"}}),e.jsxs(P,{variant:"h4",children:["Evento - ",h.name]})]}),e.jsx(Be,{elevation:3,sx:{mt:5,mb:4,borderRadius:2,overflow:"hidden"},children:e.jsx(Ea,{children:e.jsxs(l,{container:!0,spacing:3,children:[e.jsxs(l,{size:{xs:12,md:4},children:[e.jsxs(v,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(hs,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",children:"Data"})]}),e.jsx(P,{variant:"body1",color:"text.secondary",sx:{mt:2},children:h.date?W(h.date).format("DD/MM/YYYY"):"Data non specificata"})]}),e.jsxs(l,{size:{xs:12,md:4},children:[e.jsxs(v,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(xs,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",children:"Costo"})]}),e.jsx(P,{variant:"body1",color:"text.secondary",sx:{mt:2},children:h.cost!==0?`€ ${h.cost}`:"Gratuito"})]}),e.jsxs(l,{size:{xs:12,md:4},children:[e.jsxs(v,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(fs,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",children:"Periodo Iscrizioni"})]}),e.jsx(v,{sx:{display:"flex",alignItems:"center",mt:2},children:B().chip})]}),e.jsxs(l,{size:{xs:12},children:[e.jsx(Oe,{sx:{my:1}}),e.jsxs(v,{sx:{display:"flex",alignItems:"center",mt:2},children:[e.jsx(gs,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",children:"Descrizione"})]}),e.jsx("div",{"data-color-mode":"light",style:{marginTop:10},children:e.jsx(La,{value:h.description||"Nessuna descrizione disponibile",readOnly:!0})})]}),e.jsxs(l,{size:{xs:12},children:[e.jsx(Oe,{sx:{my:1}}),e.jsxs(v,{sx:{display:"flex",alignItems:"center",mt:2},children:[e.jsx(qe,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",children:"Azioni"})]}),e.jsx(q,{sx:{mt:2},variant:"contained",color:"primary",onClick:G,children:"Modifica Evento"})]}),e.jsxs(l,{size:{xs:12},children:[e.jsx(Oe,{sx:{my:1}}),e.jsxs(v,{sx:{mt:2},children:[e.jsx(P,{variant:"h6",component:"div",sx:{mb:2},children:"Liste"}),e.jsx(y,{})]})]})]})})})]}),o&&e.jsx(ye,{message:o.message,state:o.state})]})]})}function Te({children:b,requiredPermission:c}){const{accessToken:s,user:i,loading:r}=Ae(),n=Ee();return a.useEffect(()=>{!r&&(!s||c&&!i?.permissions.includes(c))&&(console.log("Redirecting to login..."),n("/login",{replace:!0}))},[r,s,i,c,n]),r?e.jsx("div",{children:"Loading..."}):!s||c&&!i?.permissions.includes(c)?null:b}function Js(){const{uid:b,token:c}=na(),[s,i]=a.useState({message:"",state:"loading"});return a.useEffect(()=>{b&&c?(async()=>{try{const n=await O("GET",`/api/profile/verify-email/${b}/${c}/`,null,{},!1),g=await n.json();if(n.ok)i({message:g.message,state:"success"});else{const m=await J(n);i({message:m,state:"error"})}}catch(n){i({message:`General error: ${n}`,state:"error"})}})().then():i({message:"Invalid verification link",state:"error"})},[b,c]),e.jsx(Qe,{maxWidth:"sm",children:e.jsxs(v,{sx:{mt:8,display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",p:3,borderRadius:2,boxShadow:3,bgcolor:"background.paper"},children:[e.jsx(P,{variant:"h4",component:"h1",gutterBottom:!0,children:"Email Verification"}),e.jsx(Fe,{message:s.message,state:s.state,loadingText:"Verifying your email address...",successText:"Your email address has been verified and your account is now active.",errorText:"We couldn't verify your email address. The verification link may be expired or invalid. Please contact us."})]})})}function Zs(){const{uid:b,token:c}=na(),s=Ee(),[i,r]=a.useState(""),[n,g]=a.useState(""),[m,d]=a.useState(null),[x,C]=a.useState(!1),_=async()=>{if(i!==n){d({message:"Le password non coincidono.",state:"error"});return}try{const j=await O("POST",`/api/reset-password/${b}/${c}/`,{password:i,confirm_password:n},{},!1);if(j.ok)C(!0),d({message:"Password reimpostata con successo!",state:"success"});else{const o=await J(j);d({message:`Errore durante il reset della password: ${o}`,state:"error"})}}catch(j){d({message:`Errore generale: ${j}`,state:"error"})}};return e.jsx(Qe,{maxWidth:"xs",children:e.jsxs(v,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("img",{alt:"",src:ra,style:{height:"25vh"}}),e.jsx(P,{style:{marginTop:10},variant:"h5",children:"Reimposta Password"}),m&&e.jsx(Fe,{message:m.message,state:m.state}),!x&&e.jsxs(e.Fragment,{children:[e.jsx(A,{margin:"normal",required:!0,fullWidth:!0,label:"Nuova Password",type:"password",onChange:j=>r(j.target.value)}),e.jsx(A,{margin:"normal",required:!0,fullWidth:!0,label:"Conferma Password",type:"password",onChange:j=>g(j.target.value)}),e.jsx(q,{fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},onClick:_,children:"Reimposta Password"})]}),x&&e.jsx(ga,{component:"button",variant:"body2",sx:{textAlign:"center"},onClick:()=>s("/login"),children:"Vai al Login"})]})})}function Qs({open:b,onClose:c,transaction:s}){const[i,r]=a.useState(!0),[n,g]=a.useState([]),[m,d]=a.useState(null),[x,C]=a.useState({executor:null,account:"",amount:"",description:"",type:""}),[_,j]=a.useState({executor:[!1,""],account:[!1,""],amount:[!1,""],description:[!1,""]});a.useEffect(()=>{console.log("TransactionModal useEffect",s),r(!0),Promise.all([O("GET","/accounts/")]).then(async([t])=>{const f=t.ok?await t.json():{results:[]};g(f.results||[]),s&&C({executor:s.executor||null,account:s.account?.id||"",amount:s.amount||"",description:s.description||"",type:s.type||""})}).finally(()=>r(!1))},[b,s]);const o=t=>{const{name:f,value:S}=t.target;C(D=>({...D,[f]:S}))},z=()=>{let t=!1;const f={..._};return x.executor?f.executor=[!1,""]:(f.executor=[!0,"Seleziona un Esecutore"],t=!0),x.account?f.account=[!1,""]:(f.account=[!0,"Seleziona una Cassa"],t=!0),!x.amount||isNaN(Number(x.amount))?(f.amount=[!0,"Inserisci un importo valido"],t=!0):f.amount=[!1,""],j(f),!t},h=async t=>{if(t.preventDefault(),!!z()){r(!0);try{const f={executor:x.executor.id||x.executor.email,account:x.account,amount:parseFloat(x.amount),description:x.description},S=await O("PATCH",`/transaction/${s.id}/`,f);if(S.ok)c(!0);else{const D=await J(S);d({message:`Errore: ${D}`,state:"error"})}}catch(f){d({message:`Errore generale: ${f}`,state:"error"})}finally{r(!1)}}},u=()=>c(!1);return e.jsx(Ie,{open:b,onClose:u,children:e.jsx(v,{sx:Re,component:"form",onSubmit:h,noValidate:!0,children:i?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(H,{onClick:u,sx:{minWidth:0},children:e.jsx(ze,{})})}),e.jsx(P,{variant:"h5",gutterBottom:!0,align:"center",sx:{mb:2},children:"Modifica Transazione"}),m&&e.jsx(ye,{message:m.message,state:m.state}),e.jsxs(l,{container:!0,spacing:2,sx:{mt:2},children:[e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Tipo:"})," ",ae.tran_type[x.type]||"Non specificato"]}),e.jsx(l,{size:{xs:12},children:e.jsx(Fa,{value:x.executor,onChange:(t,f)=>{C({...x,executor:f})},error:_.executor[0],helperText:_.executor[0]?_.executor[1]:"Cerca per nome o numero ESNcard",label:ae.executor,esner_only:!0,required:!0})}),e.jsx(l,{size:{xs:12},children:e.jsxs(Z,{fullWidth:!0,required:!0,error:_.account[0],children:[e.jsx(se,{id:"account-label",children:ae.account}),e.jsx(te,{labelId:"account-label",name:"account",variant:"outlined",value:x.account,onChange:o,input:e.jsx(_e,{label:ae.account}),children:n.map(t=>e.jsx($,{value:t.id,children:t.name},t.id))}),_.account[0]&&e.jsx(He,{children:_.account[1]})]})}),e.jsx(l,{size:{xs:12},children:e.jsx(A,{label:ae.amount,name:"amount",value:x.amount,onChange:o,required:!0,fullWidth:!0,error:_.amount[0],type:"number",slotProps:{htmlInput:{min:"0.01",step:"0.01"}}})}),e.jsx(l,{size:{xs:12},children:e.jsx(A,{label:"Descrizione",name:"description",value:x.description,onChange:o,fullWidth:!0,multiline:!0,rows:3})})]}),e.jsx(v,{mt:2,children:e.jsx(q,{fullWidth:!0,variant:"contained",color:"primary",type:"submit",children:"Salva Modifiche"})})]})})})}const Ra={subscription:{label:ae.tran_type.subscription,color:"primary"},esncard:{label:ae.tran_type.esncard,color:"secondary"},deposit:{label:ae.tran_type.deposit,color:"success"},withdrawal:{label:ae.tran_type.withdrawal,color:"error"}},ha=[{value:"",label:"Tutti"},...Object.entries(Ra).map(([b,c])=>({value:b,label:c.label,color:c.color}))];function Xs(){const[b,c]=a.useState(!0),[s,i]=a.useState([]),[r,n]=a.useState([]),g=Ee(),[m,d]=a.useState(null),[x,C]=a.useState(!1),[_,j]=a.useState(null),[o,z]=a.useState({pageIndex:0,pageSize:10}),[h,u]=a.useState(0),[t,f]=a.useState({account:[],type:[],dateFrom:null,dateTo:null}),[S,D]=a.useState(""),[F,V]=a.useState(""),ee=a.useRef(null);a.useEffect(()=>{I().then()},[o.pageIndex,o.pageSize,t,F]);const I=async()=>{c(!0);try{const y=new URLSearchParams;y.append("page",o.pageIndex+1),y.append("page_size",o.pageSize),F&&y.append("search",F),t.account.length&&t.account.forEach(Y=>y.append("account",Y)),t.type.length&&t.type.forEach(Y=>y.append("type",Y)),t.dateFrom&&y.append("dateFrom",t.dateFrom.toISOString()),t.dateTo&&y.append("dateTo",t.dateTo.toISOString());const[k,re]=await Promise.all([O("GET",`/transactions/?${y.toString()}`),O("GET","/accounts/")]),ce=k.ok?await k.json():{results:[]},N=re.ok?await re.json():{results:[]};u(ce.count||0),i(ce.results||[]),n(N.results||[])}finally{c(!1)}},G=a.useMemo(()=>[{accessorKey:"created_at",header:ae.date,size:120,Cell:({cell:y})=>{const k=new Date(y.getValue());return new Intl.DateTimeFormat("it-IT",{dateStyle:"medium",timeStyle:"short"}).format(k)}},{accessorKey:"type",header:ae.type,size:100,Cell:({cell:y})=>{const k=y.getValue(),re=Ra[k]||{label:"Sconosciuto",color:"default"};return e.jsx(X,{label:re.label,color:re.color,variant:"outlined"})}},{accessorKey:"executor.name",header:ae.executor,size:150},{accessorKey:"account.name",header:ae.account,size:120,Cell:({cell:y})=>e.jsx(v,{component:"span",fontWeight:"bold",children:y.getValue()})},{accessorKey:"amount",header:ae.amount,size:100,Cell:({cell:y})=>e.jsx(v,{children:y.getValue()!==null?e.jsx(X,{label:`€${y.getValue()}`,color:"primary"}):e.jsx(X,{label:"N/A",color:"warning"})})},{accessorKey:"description",header:ae.description,size:200,Cell:({cell:y})=>e.jsx(v,{component:"span",fontStyle:"italic",children:y.getValue()})}],[]),K=Pe({columns:G,data:s,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableExpandAll:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},sorting:[{id:"created_at",desc:!0}]},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",enableGlobalFilter:!1,muiPaginationProps:{color:"secondary",rowsPerPageOptions:[10,20,30],shape:"rounded",variant:"outlined"},manualPagination:!0,rowCount:h,onPaginationChange:z,state:{pagination:o},localization:De,muiTableBodyRowProps:({row:y})=>({onClick:()=>{j(y.original),C(!0)},sx:{cursor:"pointer"}})}),ne=()=>{V(S),z(y=>({...y,pageIndex:0}))},w=()=>{D(""),V(""),z(y=>({...y,pageIndex:0})),ee.current&&ee.current.focus()},B=async y=>{y&&(d({message:"Transazione modificata con successo!",state:"success"}),await I()),j(null),C(!1)},M=(y,k)=>{f(re=>{let ce={...re,[y]:k};return y==="dateFrom"&&ce.dateTo&&k&&k>ce.dateTo&&(ce.dateTo=k),y==="dateTo"&&ce.dateFrom&&k&&k<ce.dateFrom&&(ce.dateFrom=k),ce})},p=y=>{const{name:k,value:re}=y.target;f(ce=>{let N={...ce,[k]:re};return(k==="account"||k==="type")&&(N[k]=typeof re=="string"?re.split(","):re),N})},E=()=>{f(y=>({...y,dateFrom:null,dateTo:null}))};return e.jsxs(v,{children:[e.jsx(Me,{}),x&&e.jsx(Qs,{open:x,onClose:B,transaction:_}),e.jsxs(v,{sx:{mx:"5%"},children:[e.jsxs(v,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(H,{onClick:()=>g(-1),sx:{mr:2},children:e.jsx(ta,{})}),e.jsx(P,{variant:"h4",children:"Lista Transazioni"})]}),e.jsxs(l,{container:!0,spacing:2,sx:{mb:2,mt:4},alignItems:"center",children:[e.jsx(l,{size:{xs:12,sm:2},children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(se,{id:"account-label",children:"Cassa"}),e.jsx(te,{labelId:"account-label",name:"account",multiple:!0,value:t.account,onChange:p,input:e.jsx(_e,{label:"Cassa"}),variant:"outlined",renderValue:y=>r.filter(k=>y.includes(k.id)).map(k=>k.name).join(", "),children:r.map(y=>e.jsx($,{value:y.id,children:y.name},y.id))})]})}),e.jsx(l,{size:{xs:12,sm:2},children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(se,{id:"type-label",children:"Tipo"}),e.jsx(te,{labelId:"type-label",name:"type",multiple:!0,value:t.type,onChange:p,input:e.jsx(_e,{label:"Tipo"}),variant:"outlined",renderValue:y=>ha.filter(k=>y.includes(k.value)&&k.value).map(k=>k.label).join(", "),children:ha.filter(y=>y.value).map(y=>e.jsx($,{value:y.value,children:y.label},y.value))})]})}),e.jsx(l,{size:{xs:12,sm:2},children:e.jsx(Z,{fullWidth:!0,children:e.jsx(me,{dateAdapter:Ke,adapterLocale:Ve,children:e.jsx(be,{label:"Da",value:t.dateFrom,maxDate:t.dateTo||void 0,onChange:y=>M("dateFrom",y),format:"d MMM yyyy"})})})}),e.jsx(l,{size:{xs:12,sm:2},children:e.jsx(Z,{fullWidth:!0,children:e.jsx(me,{dateAdapter:Ke,adapterLocale:Ve,children:e.jsx(be,{label:"A",value:t.dateTo,minDate:t.dateFrom||void 0,onChange:y=>M("dateTo",y),format:"d MMM yyyy"})})})}),(t.dateFrom||t.dateTo)&&e.jsx(l,{size:{xs:12,sm:2},sx:{display:"flex",alignItems:"center"},children:e.jsx(q,{variant:"outlined",color:"secondary",startIcon:e.jsx(We,{}),onClick:E,sx:{height:"100%",minWidth:0,px:1},children:"Azzera date"})}),e.jsx(l,{size:{xs:12,sm:2},sx:{ml:"auto"},children:e.jsx(Z,{fullWidth:!0,children:e.jsx(_e,{inputRef:ee,size:"small",placeholder:"Cerca",value:S,onChange:y=>D(y.target.value),onKeyDown:y=>{y.key==="Enter"&&ne()},endAdornment:S&&F===S?e.jsx(H,{"aria-label":"clear",onClick:w,edge:"end",children:e.jsx(We,{})}):e.jsx(H,{"aria-label":"search",onClick:ne,edge:"end",children:e.jsx(aa,{})})})})})]}),b?e.jsx(fe,{}):e.jsx(Ne,{sx:{mt:2},table:K}),m&&e.jsx(ye,{message:m.message,state:m.state})]})]})}function et(){return e.jsx(ws,{children:e.jsx(Es,{children:e.jsx(vs,{children:e.jsxs(Ss,{children:[e.jsx(pe,{path:"/verify-email/:uid/:token",element:e.jsx(Js,{})}),e.jsx(pe,{path:"/reset-password/:uid/:token",element:e.jsx(Zs,{})}),e.jsx(pe,{path:"/login",element:e.jsx(Is,{})}),e.jsx(pe,{path:"/",element:e.jsx(Te,{children:e.jsx(Os,{})})}),e.jsx(pe,{path:"/profiles/erasmus",element:e.jsx(Te,{children:e.jsx(Ns,{})})}),e.jsx(pe,{path:"/profiles/esners",element:e.jsx(Te,{children:e.jsx(Fs,{})})}),e.jsx(pe,{path:"/erasmus_form",element:e.jsx(zs,{})}),e.jsx(pe,{path:"/esner_form",element:e.jsx(Ps,{})}),e.jsx(pe,{path:"/treasury",element:e.jsx(Te,{requiredPermission:"change_account",children:e.jsx(Gs,{})})}),e.jsx(pe,{path:"/treasury/accounts_list",element:e.jsx(Te,{requiredPermission:"change_account",children:e.jsx(Vs,{})})}),e.jsx(pe,{path:"/treasury/transactions_list",element:e.jsx(Te,{requiredPermission:"change_account",children:e.jsx(Xs,{})})}),e.jsx(pe,{path:"/events",element:e.jsx(Te,{children:e.jsx(qs,{})})}),e.jsx(pe,{path:"/event/:id",element:e.jsx(Te,{children:e.jsx(Us,{})})})]})})})})}const at=Ta({typography:{fontFamily:"Roboto, Arial, sans-serif",h1:{fontFamily:"Lato, Arial, sans-serif"},h2:{fontFamily:"Lato, Arial, sans-serif"},h3:{fontFamily:"Lato, Arial, sans-serif"},h4:{fontFamily:"Lato, Arial, sans-serif"},h5:{fontFamily:"Lato, Arial, sans-serif"}},palette:{primary:{main:"#1976d2"},secondary:{main:"#dc004e"},cyan:{main:"#00aeef",contrastText:"#ffffff"},magenta:{main:"#ec008c",contrastText:"#ffffff"},gray:{main:"#999999",contrastText:"#ffffff"}}}),st=xa.createRoot(document.getElementById("root"));st.render(e.jsxs(bs,{theme:Ta(at,js),children:[e.jsx(fa,{}),e.jsx(et,{})]}));
