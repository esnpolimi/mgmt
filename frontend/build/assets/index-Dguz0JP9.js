import{r as a,j as e,b as xe}from"./react-C_cg2vJ2.js";import{a as ga}from"./react-dom-D3GiQpVl.js";import{j as Ze}from"./jwt-decode-VWaDGczM.js";import{Q as y,a1 as la,H as D,aA as ea,aB as ba,a8 as F,_ as H,a4 as Be,aC as be,aD as ja,aE as ya,aF as i,aG as me,aH as Se,ax as je,aI as X,aa as te,ab as re,ac as q,as as _e,X as Te,aJ as va,aK as ca,q as Ee,U,v as $a,e as Ba,l as Ye,aL as Ga,y as Ge,aM as _a,C as Ka,ag as qa,ah as Va,ai as Ha,aj as Ya,aN as Pe,ar as We,au as Ue,aO as Ke,aP as aa,aQ as Ua,aR as Ja,aS as Za,aT as Ce,aU as $e,d as sa,aV as Qa,aW as Xa,aX as ta,aY as Sa,aZ as Ca,a_ as da,am as Qe,a$ as Xe,b0 as es,b1 as wa,E as Ea,a0 as Ta,b2 as as,b3 as ss,b4 as ts,$ as ae,z as qe,b5 as Ia,b6 as rs,b7 as ra,b8 as ns,b9 as os,aw as ua,ba as is,bb as Ve,ay as ls,az as cs,bc as ds,bd as us,be as ms,bf as ps,af as hs,bg as xs,bh as fs,bi as gs,bj as bs,bk as js,bl as za,bm as ys,bn as vs}from"./@mui-Ckrn4amK.js";import{u as Ie,L as ma,a as na,b as _s,B as Ss,R as Cs,c as pe}from"./react-router-BQSL4b-H.js";import{d as K}from"./dayjs-C-_GrJyW.js";import{u as ke,M as Fe,a as De,b as Pa}from"./material-react-table-B2dxZAny.js";import{Q as ws}from"./quill-NHzMMpWD.js";import{S as He}from"./date-fns-jgPrqPiU.js";import"./cookie-DhHe99HG.js";import"./scheduler-SPyfQU6S.js";import"./@emotion-Btd9ljfZ.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./@babel-BtohYyOd.js";import"./stylis-DDa9OTMq.js";import"./clsx-B-dksMZM.js";import"./react-transition-group-CZUuWARL.js";import"./dom-helpers-D0mFdbeO.js";import"./prop-types-DO4wCXId.js";import"./@popperjs-DC5wud4b.js";import"./react-is-BPJnJB5S.js";import"./@tanstack-BUN72RuI.js";import"./highlight-words-DCTHEhAM.js";import"./parchment-DI0xVRB_.js";import"./quill-delta-CmVyj_yU.js";import"./fast-diff-BGhgD5-Y.js";import"./lodash.clonedeep-CdAwFVkU.js";import"./lodash.isequal-CVqJ6bXo.js";import"./eventemitter3-DrmIJ5Tj.js";import"./lodash-es-GiBPWDzC.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const _ of c.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&n(_)}).observe(document,{childList:!0,subtree:!0});function s(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(l){if(l.ep)return;l.ep=!0;const c=s(l);fetch(l.href,c)}})();const G=async(h,u,s=null,n={},l=!0)=>{const c=localStorage.getItem("accessToken"),o=`https://mgmt.esnpolimi.it/backend${u}`;if(l&&!c)throw new Error("No access token available");const f={"Content-Type":"application/json",...l&&{Authorization:`Bearer ${c}`},...n.headers},p={method:h,headers:f,credentials:"include",...n};s&&(p.body=typeof s=="string"?s:JSON.stringify(s));const x=await fetch(o,p);if(x.status===401)throw new Error("Unauthorized: Access token may have expired");return x},Q=(h,u)=>{if(!h)return`Server error (${u}) with empty response`;if(typeof h=="string")return h;if(h.detail)return h.detail;if(h.message)return h.message;if(h.non_field_errors)return h.non_field_errors.join(", ");if(h.lists?.non_field_errors)return`Error in lists format: ${h.lists.non_field_errors.join(", ")}`;for(const[s,n]of Object.entries(h))if(n)return Array.isArray(n)?n.join(", "):n.toString();return JSON.stringify(h)},ka=a.createContext(null),Es=({children:h})=>{const u=a.useRef(null),[s,n]=a.useState(localStorage.getItem("accessToken")),[l,c]=a.useState(()=>JSON.parse(localStorage.getItem("user")||"null")),[_,o]=a.useState(!0),f=E=>{try{const{user:t}=Ze(E);return t}catch(t){return console.error("Invalid JWT token",t),null}},p=async(E,t)=>{try{const z=await G("POST","/login/",{username:E,password:t},{},!1);if(z.ok){const T=await z.json(),r=f(T.access);return console.log("Login successful"),n(T.access),console.log("Decoded access token:",r),c(r),localStorage.setItem("accessToken",T.access),localStorage.setItem("user",JSON.stringify(r)),!0}else return console.error("Login error"),await Q(z)}catch(z){return console.error("Login error:",z),z}},x=a.useCallback(async({skipApiCall:E=!1}={})=>{console.log("Logout function called"),u.current&&(console.log("Aborting refresh timer..."),clearTimeout(u.current),u.current=null),E||await G("POST","/logout/"),localStorage.removeItem("accessToken"),localStorage.removeItem("user"),n(null),c(null),console.log("Logged out successfully")},[]),w=a.useCallback(async()=>{if(s)try{const E=l?.profile?.email,t=await G("POST","/api/token/refresh/",{email:E},{},!1);if(t.ok){const z=await t.json(),T=f(z.access);return n(z.access),c(T),localStorage.setItem("accessToken",z.access),localStorage.setItem("user",JSON.stringify(T)),!0}else return console.warn("Token refresh failed. Logging out..."),await x(),!1}catch(E){return console.error("Refresh token error:",E),await x(),!1}else return console.log("Skipping token refresh, user is not logged in"),!1},[l,s,x]);return a.useEffect(()=>{const E=()=>{u.current&&(clearTimeout(u.current),u.current=null)};if(!s){console.log("No access token found, skipping refresh scheduling");return}const{exp:t}=Ze(s),z=Math.floor(Date.now()/1e3),T=(t-z-30)*1e3,r=new Date(t*1e3),m=new Date(z*1e3);if(console.log(`Token expires at: ${r.getHours()}:${r.getMinutes()}, current time: ${m.getHours()}:${m.getMinutes()}, refresh time in s: ${T/1e3}`),T<=0){console.log("Refresh time is not valid, no timer set"),n(null);return}return E(),u.current=setTimeout(()=>{console.log("Refreshing access token..."),w().then()},T),()=>{console.log("Clearing refresh timer"),E()}},[s,w]),a.useEffect(()=>{(async()=>{const t=localStorage.getItem("accessToken"),z=localStorage.getItem("user");if(t&&z)try{const T=Ze(t),r=Math.floor(Date.now()/1e3);T.exp>r?(n(t),c(JSON.parse(z))):await x({skipApiCall:!0})}catch(T){console.error("Token decode error",T),await x({skipApiCall:!0})}o(!1)})().then()},[x]),e.jsx(ka.Provider,{value:{user:l,accessToken:s,refreshAccessToken:w,logout:x,login:p,loading:_},children:h})},Ae=()=>a.useContext(ka),Da=a.createContext(void 0);function Ts({children:h}){const[u,s]=a.useState(!1),[n,l]=a.useState(null);a.useEffect(()=>{const o=localStorage.getItem("sidebarDrawerState");o&&s(JSON.parse(o))},[]),a.useEffect(()=>{localStorage.setItem("sidebarDrawerState",JSON.stringify(u))},[u]);const c=o=>f=>{f&&f.type==="keydown"&&(f.key==="Tab"||f.key==="Shift")||s(o)},_=o=>{l(f=>f===o?null:o)};return e.jsx(Da.Provider,{value:{isDrawerOpen:u,toggleDrawer:c,expandedSection:n,handleExpand:_},children:h})}function Is(){return a.useContext(Da)}const oa=""+new URL("esnpolimi-logo-BJJf0P2z.png",import.meta.url).href,Ne=({message:h,state:u,successText:s,errorText:n})=>e.jsxs(y,{sx:{mt:2,mb:2,display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",p:2,borderRadius:5,boxShadow:3,bgcolor:"background.paper"},children:[u==="success"&&e.jsxs(e.Fragment,{children:[e.jsx(la,{severity:"success",sx:{width:"100%",mb:1},children:h||"Success!"}),s&&e.jsx(D,{children:s})]}),u==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(la,{severity:"error",sx:{width:"100%",mb:1},children:h||"An error occurred"}),n&&e.jsx(D,{children:n})]})]});function zs(){const[h,u]=a.useState(""),[s,n]=a.useState(""),[l,c]=a.useState(!1),{login:_}=Ae(),o=Ie(),[f,p]=a.useState(null),[x,w]=a.useState(!1),[E,t]=a.useState(!1),z=async()=>{t(!0);try{console.log("Sending forgot password request for:",h);const r=await G("POST","/api/forgot-password/",{email:h},{},!1);if(r.ok)w(!0),p({message:`Se il profilo è registrato, l'email è stata inviata con successo a "`+h+'". Controlla la tua casella di posta.',state:"success"});else{const m=await Q(r);p({message:`Errore durante l'invio dell'email: ${m}`,state:"error"})}}catch(r){p({message:`Errore generale: ${r}`,state:"error"})}finally{t(!1)}},T=async()=>{t(!0),p(null);const r=await _(h,s);if(t(!1),r===!0)o("/");else if(typeof r=="string"&&(r.trim().startsWith("<!DOCTYPE html")||r.trim().startsWith("<html"))){const m=window.open();m?(m.document.open(),m.document.write(r),m.document.close()):p({message:"Impossibile aprire la pagina di errore in una nuova scheda.",state:"error"})}else p({message:`Errore durante il login: ${r}`,state:"error"})};return e.jsxs(ea,{component:"main",maxWidth:"xs",children:[e.jsx(ba,{}),e.jsxs(y,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("img",{alt:"",src:oa,style:{height:"25vh"}}),e.jsxs(y,{children:[!x&&e.jsx(F,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email",name:"email",autoComplete:"email",autoFocus:!0,onChange:r=>u(r.target.value),onKeyDown:r=>r.key==="Enter"&&(l?z():T())}),!l&&e.jsx(F,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",onChange:r=>n(r.target.value),onKeyDown:r=>r.key==="Enter"&&T()}),!x&&e.jsx(H,{fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,backgroundColor:"black"},onClick:l?z:T,disabled:E,children:E?e.jsx(Be,{size:24,color:"inherit"}):l?"Invia Email di Reset":"Log In"}),e.jsxs(y,{sx:{display:"flex",justifyContent:"center",width:"100%"},children:[e.jsx(be,{component:"button",variant:"body2",onClick:()=>{c(!l),w(!1),p(null)},sx:{textAlign:"center"},children:l?"Torna al Login":"Password dimenticata?"}),e.jsx(be,{component:"button",variant:"body2",onClick:()=>o("/esner_form"),sx:{textAlign:"center",marginLeft:2},children:"Non hai un account? Registrati"})]})]}),f&&e.jsx(Ne,{message:f.message,state:f.state})]})]})}const we=JSON.parse(`[{"name":"Afghanistan","dial":"+93","code":"AF"},{"name":"Aland Islands","dial":"+358","code":"AX"},{"name":"Albania","dial":"+355","code":"AL"},{"name":"Algeria","dial":"+213","code":"DZ"},{"name":"AmericanSamoa","dial":"+1684","code":"AS"},{"name":"Andorra","dial":"+376","code":"AD"},{"name":"Angola","dial":"+244","code":"AO"},{"name":"Anguilla","dial":"+1264","code":"AI"},{"name":"Antarctica","dial":"+672","code":"AQ"},{"name":"Antigua and Barbuda","dial":"+1268","code":"AG"},{"name":"Argentina","dial":"+54","code":"AR"},{"name":"Armenia","dial":"+374","code":"AM"},{"name":"Aruba","dial":"+297","code":"AW"},{"name":"Australia","dial":"+61","code":"AU"},{"name":"Austria","dial":"+43","code":"AT"},{"name":"Azerbaijan","dial":"+994","code":"AZ"},{"name":"Bahamas","dial":"+1242","code":"BS"},{"name":"Bahrain","dial":"+973","code":"BH"},{"name":"Bangladesh","dial":"+880","code":"BD"},{"name":"Barbados","dial":"+1246","code":"BB"},{"name":"Belarus","dial":"+375","code":"BY"},{"name":"Belgium","dial":"+32","code":"BE"},{"name":"Belize","dial":"+501","code":"BZ"},{"name":"Benin","dial":"+229","code":"BJ"},{"name":"Bermuda","dial":"+1441","code":"BM"},{"name":"Bhutan","dial":"+975","code":"BT"},{"name":"Bolivia, Plurinational State of","dial":"+591","code":"BO"},{"name":"Bosnia and Herzegovina","dial":"+387","code":"BA"},{"name":"Botswana","dial":"+267","code":"BW"},{"name":"Brazil","dial":"+55","code":"BR"},{"name":"British Indian Ocean Territory","dial":"+246","code":"IO"},{"name":"Brunei Darussalam","dial":"+673","code":"BN"},{"name":"Bulgaria","dial":"+359","code":"BG"},{"name":"Burkina Faso","dial":"+226","code":"BF"},{"name":"Burundi","dial":"+257","code":"BI"},{"name":"Cambodia","dial":"+855","code":"KH"},{"name":"Cameroon","dial":"+237","code":"CM"},{"name":"Canada","dial":"+1","code":"CA"},{"name":"Cape Verde","dial":"+238","code":"CV"},{"name":"Cayman Islands","dial":"+ 345","code":"KY"},{"name":"Central African Republic","dial":"+236","code":"CF"},{"name":"Chad","dial":"+235","code":"TD"},{"name":"Chile","dial":"+56","code":"CL"},{"name":"China","dial":"+86","code":"CN"},{"name":"Christmas Island","dial":"+61","code":"CX"},{"name":"Cocos (Keeling) Islands","dial":"+61","code":"CC"},{"name":"Colombia","dial":"+57","code":"CO"},{"name":"Comoros","dial":"+269","code":"KM"},{"name":"Congo","dial":"+242","code":"CG"},{"name":"Congo, The Democratic Republic of the Congo","dial":"+243","code":"CD"},{"name":"Cook Islands","dial":"+682","code":"CK"},{"name":"Costa Rica","dial":"+506","code":"CR"},{"name":"Cote d'Ivoire","dial":"+225","code":"CI"},{"name":"Croatia","dial":"+385","code":"HR"},{"name":"Cuba","dial":"+53","code":"CU"},{"name":"Cyprus","dial":"+357","code":"CY"},{"name":"Czech Republic","dial":"+420","code":"CZ"},{"name":"Denmark","dial":"+45","code":"DK"},{"name":"Djibouti","dial":"+253","code":"DJ"},{"name":"Dominica","dial":"+1767","code":"DM"},{"name":"Dominican Republic","dial":"+1849","code":"DO"},{"name":"Ecuador","dial":"+593","code":"EC"},{"name":"Egypt","dial":"+20","code":"EG"},{"name":"El Salvador","dial":"+503","code":"SV"},{"name":"Equatorial Guinea","dial":"+240","code":"GQ"},{"name":"Eritrea","dial":"+291","code":"ER"},{"name":"Estonia","dial":"+372","code":"EE"},{"name":"Ethiopia","dial":"+251","code":"ET"},{"name":"Falkland Islands (Malvinas)","dial":"+500","code":"FK"},{"name":"Faroe Islands","dial":"+298","code":"FO"},{"name":"Fiji","dial":"+679","code":"FJ"},{"name":"Finland","dial":"+358","code":"FI"},{"name":"France","dial":"+33","code":"FR"},{"name":"French Guiana","dial":"+594","code":"GF"},{"name":"French Polynesia","dial":"+689","code":"PF"},{"name":"Gabon","dial":"+241","code":"GA"},{"name":"Gambia","dial":"+220","code":"GM"},{"name":"Georgia","dial":"+995","code":"GE"},{"name":"Germany","dial":"+49","code":"DE"},{"name":"Ghana","dial":"+233","code":"GH"},{"name":"Gibraltar","dial":"+350","code":"GI"},{"name":"Greece","dial":"+30","code":"GR"},{"name":"Greenland","dial":"+299","code":"GL"},{"name":"Grenada","dial":"+1473","code":"GD"},{"name":"Guadeloupe","dial":"+590","code":"GP"},{"name":"Guam","dial":"+1671","code":"GU"},{"name":"Guatemala","dial":"+502","code":"GT"},{"name":"Guernsey","dial":"+44","code":"GG"},{"name":"Guinea","dial":"+224","code":"GN"},{"name":"Guinea-Bissau","dial":"+245","code":"GW"},{"name":"Guyana","dial":"+595","code":"GY"},{"name":"Haiti","dial":"+509","code":"HT"},{"name":"Holy See (Vatican City State)","dial":"+379","code":"VA"},{"name":"Honduras","dial":"+504","code":"HN"},{"name":"Hong Kong","dial":"+852","code":"HK"},{"name":"Hungary","dial":"+36","code":"HU"},{"name":"Iceland","dial":"+354","code":"IS"},{"name":"India","dial":"+91","code":"IN"},{"name":"Indonesia","dial":"+62","code":"ID"},{"name":"Iran, Islamic Republic of Persian Gulf","dial":"+98","code":"IR"},{"name":"Iraq","dial":"+964","code":"IQ"},{"name":"Ireland","dial":"+353","code":"IE"},{"name":"Isle of Man","dial":"+44","code":"IM"},{"name":"Israel","dial":"+972","code":"IL"},{"name":"Italy","dial":"+39","code":"IT"},{"name":"Jamaica","dial":"+1876","code":"JM"},{"name":"Japan","dial":"+81","code":"JP"},{"name":"Jersey","dial":"+44","code":"JE"},{"name":"Jordan","dial":"+962","code":"JO"},{"name":"Kazakhstan","dial":"+77","code":"KZ"},{"name":"Kenya","dial":"+254","code":"KE"},{"name":"Kiribati","dial":"+686","code":"KI"},{"name":"Korea, Democratic People's Republic of Korea","dial":"+850","code":"KP"},{"name":"Korea, Republic of South Korea","dial":"+82","code":"KR"},{"name":"Kuwait","dial":"+965","code":"KW"},{"name":"Kyrgyzstan","dial":"+996","code":"KG"},{"name":"Laos","dial":"+856","code":"LA"},{"name":"Latvia","dial":"+371","code":"LV"},{"name":"Lebanon","dial":"+961","code":"LB"},{"name":"Lesotho","dial":"+266","code":"LS"},{"name":"Liberia","dial":"+231","code":"LR"},{"name":"Libyan Arab Jamahiriya","dial":"+218","code":"LY"},{"name":"Liechtenstein","dial":"+423","code":"LI"},{"name":"Lithuania","dial":"+370","code":"LT"},{"name":"Luxembourg","dial":"+352","code":"LU"},{"name":"Macao","dial":"+853","code":"MO"},{"name":"Macedonia","dial":"+389","code":"MK"},{"name":"Madagascar","dial":"+261","code":"MG"},{"name":"Malawi","dial":"+265","code":"MW"},{"name":"Malaysia","dial":"+60","code":"MY"},{"name":"Maldives","dial":"+960","code":"MV"},{"name":"Mali","dial":"+223","code":"ML"},{"name":"Malta","dial":"+356","code":"MT"},{"name":"Marshall Islands","dial":"+692","code":"MH"},{"name":"Martinique","dial":"+596","code":"MQ"},{"name":"Mauritania","dial":"+222","code":"MR"},{"name":"Mauritius","dial":"+230","code":"MU"},{"name":"Mayotte","dial":"+262","code":"YT"},{"name":"Mexico","dial":"+52","code":"MX"},{"name":"Micronesia, Federated States of Micronesia","dial":"+691","code":"FM"},{"name":"Moldova","dial":"+373","code":"MD"},{"name":"Monaco","dial":"+377","code":"MC"},{"name":"Mongolia","dial":"+976","code":"MN"},{"name":"Montenegro","dial":"+382","code":"ME"},{"name":"Montserrat","dial":"+1664","code":"MS"},{"name":"Morocco","dial":"+212","code":"MA"},{"name":"Mozambique","dial":"+258","code":"MZ"},{"name":"Myanmar","dial":"+95","code":"MM"},{"name":"Namibia","dial":"+264","code":"NA"},{"name":"Nauru","dial":"+674","code":"NR"},{"name":"Nepal","dial":"+977","code":"NP"},{"name":"Netherlands","dial":"+31","code":"NL"},{"name":"Netherlands Antilles","dial":"+599","code":"AN"},{"name":"New Caledonia","dial":"+687","code":"NC"},{"name":"New Zealand","dial":"+64","code":"NZ"},{"name":"Nicaragua","dial":"+505","code":"NI"},{"name":"Niger","dial":"+227","code":"NE"},{"name":"Nigeria","dial":"+234","code":"NG"},{"name":"Niue","dial":"+683","code":"NU"},{"name":"Norfolk Island","dial":"+672","code":"NF"},{"name":"Northern Mariana Islands","dial":"+1670","code":"MP"},{"name":"Norway","dial":"+47","code":"NO"},{"name":"Oman","dial":"+968","code":"OM"},{"name":"Pakistan","dial":"+92","code":"PK"},{"name":"Palau","dial":"+680","code":"PW"},{"name":"Palestinian Territory, Occupied","dial":"+970","code":"PS"},{"name":"Panama","dial":"+507","code":"PA"},{"name":"Papua New Guinea","dial":"+675","code":"PG"},{"name":"Paraguay","dial":"+595","code":"PY"},{"name":"Peru","dial":"+51","code":"PE"},{"name":"Philippines","dial":"+63","code":"PH"},{"name":"Pitcairn","dial":"+872","code":"PN"},{"name":"Poland","dial":"+48","code":"PL"},{"name":"Portugal","dial":"+351","code":"PT"},{"name":"Puerto Rico","dial":"+1939","code":"PR"},{"name":"Qatar","dial":"+974","code":"QA"},{"name":"Romania","dial":"+40","code":"RO"},{"name":"Russia","dial":"+7","code":"RU"},{"name":"Rwanda","dial":"+250","code":"RW"},{"name":"Reunion","dial":"+262","code":"RE"},{"name":"Saint Barthelemy","dial":"+590","code":"BL"},{"name":"Saint Helena, Ascension and Tristan Da Cunha","dial":"+290","code":"SH"},{"name":"Saint Kitts and Nevis","dial":"+1869","code":"KN"},{"name":"Saint Lucia","dial":"+1758","code":"LC"},{"name":"Saint Martin","dial":"+590","code":"MF"},{"name":"Saint Pierre and Miquelon","dial":"+508","code":"PM"},{"name":"Saint Vincent and the Grenadines","dial":"+1784","code":"VC"},{"name":"Samoa","dial":"+685","code":"WS"},{"name":"San Marino","dial":"+378","code":"SM"},{"name":"Sao Tome and Principe","dial":"+239","code":"ST"},{"name":"Saudi Arabia","dial":"+966","code":"SA"},{"name":"Senegal","dial":"+221","code":"SN"},{"name":"Serbia","dial":"+381","code":"RS"},{"name":"Seychelles","dial":"+248","code":"SC"},{"name":"Sierra Leone","dial":"+232","code":"SL"},{"name":"Singapore","dial":"+65","code":"SG"},{"name":"Slovakia","dial":"+421","code":"SK"},{"name":"Slovenia","dial":"+386","code":"SI"},{"name":"Solomon Islands","dial":"+677","code":"SB"},{"name":"Somalia","dial":"+252","code":"SO"},{"name":"South Africa","dial":"+27","code":"ZA"},{"name":"South Sudan","dial":"+211","code":"SS"},{"name":"South Georgia and the South Sandwich Islands","dial":"+500","code":"GS"},{"name":"Spain","dial":"+34","code":"ES"},{"name":"Sri Lanka","dial":"+94","code":"LK"},{"name":"Sudan","dial":"+249","code":"SD"},{"name":"Suriname","dial":"+597","code":"SR"},{"name":"Svalbard and Jan Mayen","dial":"+47","code":"SJ"},{"name":"Swaziland","dial":"+268","code":"SZ"},{"name":"Sweden","dial":"+46","code":"SE"},{"name":"Switzerland","dial":"+41","code":"CH"},{"name":"Syrian Arab Republic","dial":"+963","code":"SY"},{"name":"Taiwan","dial":"+886","code":"TW"},{"name":"Tajikistan","dial":"+992","code":"TJ"},{"name":"Tanzania, United Republic of Tanzania","dial":"+255","code":"TZ"},{"name":"Thailand","dial":"+66","code":"TH"},{"name":"Timor-Leste","dial":"+670","code":"TL"},{"name":"Togo","dial":"+228","code":"TG"},{"name":"Tokelau","dial":"+690","code":"TK"},{"name":"Tonga","dial":"+676","code":"TO"},{"name":"Trinidad and Tobago","dial":"+1868","code":"TT"},{"name":"Tunisia","dial":"+216","code":"TN"},{"name":"Turkey","dial":"+90","code":"TR"},{"name":"Turkmenistan","dial":"+993","code":"TM"},{"name":"Turks and Caicos Islands","dial":"+1649","code":"TC"},{"name":"Tuvalu","dial":"+688","code":"TV"},{"name":"Uganda","dial":"+256","code":"UG"},{"name":"Ukraine","dial":"+380","code":"UA"},{"name":"United Arab Emirates","dial":"+971","code":"AE"},{"name":"United Kingdom","dial":"+44","code":"GB"},{"name":"United States","dial":"+1","code":"US"},{"name":"Uruguay","dial":"+598","code":"UY"},{"name":"Uzbekistan","dial":"+998","code":"UZ"},{"name":"Vanuatu","dial":"+678","code":"VU"},{"name":"Venezuela, Bolivarian Republic of Venezuela","dial":"+58","code":"VE"},{"name":"Vietnam","dial":"+84","code":"VN"},{"name":"Virgin Islands, British","dial":"+1284","code":"VG"},{"name":"Virgin Islands, U.S.","dial":"+1340","code":"VI"},{"name":"Wallis and Futuna","dial":"+681","code":"WF"},{"name":"Yemen","dial":"+967","code":"YE"},{"name":"Zambia","dial":"+260","code":"ZM"},{"name":"Zimbabwe","dial":"+263","code":"ZW"}]`);function Ps(){const[h,u]=xe.useState(!1),[s,n]=xe.useState(!0),[l,c]=a.useState(null),[_,o]=a.useState(!1),[f,p]=a.useState({acceptStatute:!1,acceptPurposes:!1,acceptRegulation:!1,acceptPrivacy:!1}),[x,w]=a.useState({acceptStatute:!1,acceptPurposes:!1,acceptRegulation:!1,acceptPrivacy:!1}),E={statute:"https://drive.google.com/file/d/1b0gpA3x9yRuAcdEWQyc9KvrnZzm0l-dB/view?usp=sharing",regulation:"https://drive.google.com/file/d/1_s0uBvqfOLRz5rQp1EEeNgtxRjs7Pgxy/view?usp=sharing",privacy:"https://drive.google.com/file/d/12LY0y49cCyjqdF0RotsO6srHrGkinNln/view?usp=sharing"},[t,z]=xe.useState({name:"",surname:"",email:"",email_confirm:"",birthdate:K(),country:"",phone_prefix:"+39",phone_number:"",whatsapp_prefix:"+39",whatsapp_number:"",person_code:"",domicile:"",course:"",document_type:"ID Card",document_number:"",document_expiration:K(),matricola_number:"",matricola_expiration:K(),is_esner:!1}),T={email:[!1,""],email_confirm:[!1,""],name:[!1,""],surname:[!1,""],birthdate:[!1,""],country:[!1,""],phone_prefix:[!1,""],phone_number:[!1,""],whatsapp_prefix:[!1,""],whatsapp_number:[!1,""],person_code:[!1,""],domicile:[!1,""],course:[!1,""],document_type:[!1,""],document_number:[!1,""],document_expiration:[!1,""],matricola_number:[!1,""],matricola_expiration:[!1,""],is_esner:[!1,""]},[r,m]=xe.useState(T),j=()=>{let b=!0;const N={...r},C={...x};["email","email_confirm","name","surname","birthdate","country","phone_prefix","phone_number","person_code","domicile","course","document_type","document_number","document_expiration","matricola_number","matricola_expiration"].forEach(g=>{!t[g]||typeof t[g]=="string"&&t[g].trim()===""?(N[g]=[!0,"This field is required"],b=!1):N[g]=[!1,""]}),/^\d{6}$/.test(t.matricola_number)?N.matricola_number=[!1,""]:(N.matricola_number=[!0,"Matricola must be exactly 6 digits"],b=!1),/^\d{8}$/.test(t.person_code)?N.person_code=[!1,""]:(N.person_code=[!0,"Person Code must be exactly 8 digits"],b=!1);const v=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.email&&!v.test(t.email)&&(N.email=[!0,"Invalid email format"],b=!1),t.email!==t.email_confirm?(N.email_confirm=[!0,"Emails do not match"],b=!1):N.email_confirm=[!1,""],Object.entries(f).forEach(([g,R])=>{R?C[g]=!1:(C[g]=!0,b=!1)}),m(N),w(C),b},S=()=>{window.scrollTo({top:0,behavior:"smooth"})},L=b=>K(b).format("YYYY-MM-DD"),A=b=>{z({...t,[b.target.name]:b.target.value}),r[b.target.name]&&m({...r,[b.target.name]:[!1,""]})},V=(b,N)=>{z({...t,[b]:N})},Y=b=>{const{name:N,checked:C}=b.target;p({...f,[N]:C}),C&&w({...x,[N]:!1})},P=b=>{if(b.preventDefault(),!j()){S();return}o(!0);let N={...t,whatsapp_prefix:s?t.phone_prefix:t.whatsapp_prefix,whatsapp_number:s?t.phone_number:t.whatsapp_number,birthdate:L(t.birthdate),document_expiration:L(t.document_expiration),matricola_expiration:L(t.matricola_expiration)};(async()=>{try{const $=await G("POST","/profile/initiate-creation/",N,{},!1),M=await $.json();if(m(T),$.ok)u(!0);else{c({message:"Failed to submit application: see errors below",state:"error"});const d={...r};Object.entries(M).forEach(([v,g])=>{d[v]&&(d[v]=[!0,g])}),m(d)}}catch($){c({message:"Internal error (please contact us): "+$.message,state:"error"})}finally{o(!1)}})().then()},I=b=>{n(b.target.checked),b.target.checked&&z({...t,whatsapp_prefix:t.phone_prefix,whatsapp_number:t.phone_number})};return h?e.jsxs(y,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",bgcolor:"#fff",children:[e.jsx(ja,{style:{fontSize:100,color:ya[500]}}),e.jsx(D,{variant:"h4",align:"center",gutterBottom:!0,children:"Your response has been sent."}),e.jsx(D,{variant:"subtitle1",align:"center",children:"Check your inbox to verify your e-mail."}),e.jsxs(D,{variant:"body2",align:"center",sx:{mt:2},children:["In case you do not receive an email, please check your spam folder or contact us at ",e.jsx(be,{href:"mailto: informatica@esnpolimi.it",children:"informatica@esnpolimi.it"})]})]}):e.jsxs(y,{component:"form",noValidate:!0,sx:{maxWidth:800,margin:"auto",mt:5,mb:5,px:4},onSubmit:P,children:[e.jsx(D,{variant:"h4",align:"center",gutterBottom:!0,mb:5,children:"ESN Polimi Registration - International Student"}),l&&e.jsx(Ne,{message:l.message,state:l.state}),e.jsx(D,{variant:"h5",align:"center",gutterBottom:!0,sx:{my:4},children:"Personal Information"}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(F,{label:"Name",variant:"outlined",name:"name",value:t.name,onChange:A,fullWidth:!0,required:!0,error:r.name[0],helperText:r.name[1]})}),e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(F,{label:"Surname",variant:"outlined",name:"surname",value:t.surname,onChange:A,fullWidth:!0,required:!0,error:r.surname[0],helperText:r.surname[1]})}),e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(je,{label:"Birthdate",value:t.birthdate,onChange:b=>V("birthdate",b),maxDate:K(),renderInput:b=>e.jsx(F,{...b,fullWidth:!0,required:!0})})})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(F,{label:"Email",variant:"outlined",name:"email",type:"email",value:t.email,onChange:A,fullWidth:!0,required:!0,error:r.email[0],helperText:r.email[1]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(F,{label:"Confirm Email",variant:"outlined",name:"email_confirm",type:"email",value:t.email_confirm,onChange:A,fullWidth:!0,required:!0,error:r.email_confirm[0],helperText:r.email_confirm[1]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(te,{id:"country-label",children:"Home University Country"}),e.jsx(re,{variant:"outlined",labelId:"country-label",name:"country",value:t.country,onChange:A,label:"Home University Country",error:r.country[0],children:we.map(b=>e.jsx(q,{value:b.code,children:b.name},b.code))})]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(F,{label:"Home Domicile",variant:"outlined",name:"domicile",value:t.domicile,onChange:A,fullWidth:!0,required:!0,error:r.domicile[0],helperText:r.domicile[1]})}),e.jsx(i,{size:{xs:4,sm:2},children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(te,{id:"phone-prefix-label",children:"Prefix"}),e.jsx(re,{variant:"outlined",labelId:"phone-prefix-label",id:"phone-prefix",name:"phone_prefix",value:t.phone_prefix,onChange:A,label:"Prefix",renderValue:b=>b,error:r.phone_prefix[0],children:we.map(b=>e.jsxs(q,{value:b.dial,children:[b.dial," (",b.name,")"]},b.code))})]})}),e.jsx(i,{size:{xs:8,sm:4},children:e.jsx(F,{label:"Phone Number",variant:"outlined",name:"phone_number",type:"number",value:t.phone_number,onChange:A,fullWidth:!0,required:!0,error:r.phone_number[0],helperText:r.phone_number[1]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(_e,{control:e.jsx(Te,{checked:s,onChange:I,name:"sameAsPhone",color:"primary"}),label:"Same number for WhatsApp"})}),!s&&e.jsxs(e.Fragment,{children:[e.jsx(i,{size:{xs:4,sm:2},children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(te,{id:"whatsapp-prefix-label",children:"Prefix"}),e.jsx(re,{variant:"outlined",labelId:"whatsapp-prefix-label",id:"whatsapp-prefix",name:"whatsapp_prefix",value:t.whatsapp_prefix,onChange:A,label:"Prefix",renderValue:b=>b,error:r.whatsapp_prefix[0],children:we.map(b=>e.jsxs(q,{value:b.dial,children:[b.dial," (",b.name,")"]},b.code))})]})}),e.jsx(i,{size:{xs:8,sm:4},children:e.jsx(F,{label:"Whatsapp Number",variant:"outlined",name:"whatsapp_number",type:"number",value:t.whatsapp_number,onChange:A,fullWidth:!0,required:!0,error:r.whatsapp_number[0],helperText:r.whatsapp_number[1]})})]})]}),e.jsx(D,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Document Information"}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{size:{xs:12,sm:4},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(te,{id:"idType-label",children:"Type"}),e.jsxs(re,{variant:"outlined",labelId:"document-type-label",name:"document_type",value:t.document_type,onChange:A,label:"Type",required:!0,error:r.document_type[0],children:[e.jsx(q,{value:"Passport",children:"Passport"}),e.jsx(q,{value:"ID Card",children:"ID Card"}),e.jsx(q,{value:"Driving License",children:"Driving License"}),e.jsx(q,{value:"Residency Permit",children:"Residency Permit"}),e.jsx(q,{value:"Other",children:"Other"})]})]})}),e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(F,{label:"Number",variant:"outlined",name:"document_number",value:t.document_number,onChange:A,fullWidth:!0,required:!0,error:r.document_number[0],helperText:r.document_number[1]})}),e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(je,{label:"Expiration Date",value:t.document_expiration,onChange:b=>V("document_expiration",b),renderInput:b=>e.jsx(F,{...b,fullWidth:!0,required:!0})})})})]}),e.jsx(D,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Exchange Information"}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{size:{xs:12,sm:6},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(te,{id:"course-label",children:"Field of Study"}),e.jsxs(re,{variant:"outlined",labelId:"course-label",name:"course",value:t.course,onChange:A,label:"Field of Study",error:r.course[0],children:[e.jsx(q,{value:"Engineering",children:"Engineering"}),e.jsx(q,{value:"Design",children:"Design"}),e.jsx(q,{value:"Architecture",children:"Architecture"})]})]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(je,{label:"Exchange End Date",value:t.matricola_expiration,onChange:b=>V("matricola_expiration",b),renderInput:b=>e.jsx(F,{...b,fullWidth:!0,required:!0})})})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(F,{label:"Person Code (8 digits)",variant:"outlined",name:"person_code",type:"number",value:t.person_code,onChange:A,fullWidth:!0,required:!0,error:r.person_code[0],helperText:r.person_code[1]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(F,{label:"Matricola (6 digits)",variant:"outlined",name:"matricola_number",type:"number",value:t.matricola_number,onChange:A,fullWidth:!0,required:!0,error:r.matricola_number[0],helperText:r.matricola_number[1]})}),e.jsx(i,{size:{xs:12},children:e.jsxs(D,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["You can find your Person Code and Matricola in the Polimi App under your profile section, or from the Online Services.",e.jsx("br",{})," In case the university has not provided you a Matricola yet, you can fill the field with 6 '0's."]})})]}),e.jsxs(i,{container:!0,spacing:3,mt:3,children:[e.jsx(i,{size:{xs:12},children:e.jsx(_e,{control:e.jsx(Te,{name:"acceptStatute",checked:f.acceptStatute,onChange:Y,required:!0,sx:{color:x.acceptStatute?"red":void 0,"&.Mui-checked":{color:x.acceptStatute?"red":void 0}}}),label:e.jsxs("span",{children:["I declare that I have read and accepted the"," ",e.jsx(be,{href:E.statute,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"ESN Politecnico Milano Charter"})]})})}),e.jsx(i,{size:{xs:12},children:e.jsx(_e,{control:e.jsx(Te,{name:"acceptPurposes",checked:f.acceptPurposes,onChange:Y,required:!0,sx:{color:x.acceptPurposes?"red":void 0,"&.Mui-checked":{color:x.acceptPurposes?"red":void 0}}}),label:"I declare that I fully share the aims of the Association (ref. Article 2 of the Charter)"})}),e.jsx(i,{size:{xs:12},children:e.jsx(_e,{control:e.jsx(Te,{name:"acceptRegulation",checked:f.acceptRegulation,onChange:Y,required:!0,sx:{color:x.acceptRegulation?"red":void 0,"&.Mui-checked":{color:x.acceptRegulation?"red":void 0}}}),label:e.jsxs("span",{children:["I declare that I accept all the terms stated in the"," ",e.jsx(be,{href:E.regulation,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Internal Rules"})," ","and all subsequent changes and additions"]})})}),e.jsx(i,{size:{xs:12},children:e.jsx(_e,{control:e.jsx(Te,{name:"acceptPrivacy",checked:f.acceptPrivacy,onChange:Y,required:!0,sx:{color:x.acceptPrivacy?"red":void 0,"&.Mui-checked":{color:x.acceptPrivacy?"red":void 0}}}),label:e.jsxs("span",{children:["I declare that I have read the attached"," ",e.jsx(be,{href:E.privacy,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Privacy Disclaimer"})," ","and that I agree to the usage of my personal data according to the Regulation EU 2016/679 (GDPR) and to be aware of my guaranteed rights by the afore-mentioned law"]})})})]}),e.jsx(H,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:4},startIcon:!_&&e.jsx(va,{}),disabled:_,children:_?e.jsx(Be,{size:24,color:"inherit"}):"Submit"})]})}const O={id:"Id",name:"Nome",surname:"Cognome",group:"Gruppo",email:"Email",phone_prefix:"Prefisso Tel",phone_number:"Numero Telefono",whatsapp_prefix:"Prefisso WA",whatsapp_number:"Numero WhatsApp",country:"Paese",birthdate:"Data di Nascita",latest_esncard:"ESNcard",latest_document:"Documento",matricola_number:"Matricola",matricola_expiration:"Scadenza Matricola",course:"Corso di Studi",person_code:"Codice Persona",domicile:"Domicilio"},he={id:"Id",name:"Nome Evento",date:"Data Evento",description:"Descrizione",cost:"Costo (€)",subscription_start_date:"Data Apertura Iscrizioni",subscription_end_date:"Data Chiusura Iscrizioni",subscription_date_status:"Stato Iscrizioni",list_name:"Nome Lista",list_capacity:"Capacità Lista"},ue={id:"Id",name:"Nome",status:"Stato",balance:"Saldo",changed_by:"Ultima Modifica",visible_to_groups:"Gruppi di Visibilità"},se={date:"Data",type:"Tipo",description:"Descrizione",amount:"Importo",executor:"Eseguito da",account:"Cassa",tran_type:{event:"Evento",esncard:"ESNcard",deposit:"Deposito",withdrawal:"Prelievo",subscription:"Iscrizione"}};function ks(){const[h,u]=xe.useState(!1),[s,n]=a.useState(null),[l,c]=a.useState(!1),_=O,[o,f]=xe.useState({email:"",email_confirm:"",password:"",password_confirm:"",name:"",surname:"",birthdate:K(),country:"IT",phone_prefix:"+39",phone_number:"",person_code:"",domicile:"",document_type:"ID Card",document_number:"",document_expiration:K(),matricola_number:"",is_esner:!0}),p={email:[!1,""],email_confirm:[!1,""],password:[!1,""],password_confirm:[!1,""],name:[!1,""],surname:[!1,""],birthdate:[!1,""],country:[!1,""],phone_prefix:[!1,""],phone_number:[!1,""],person_code:[!1,""],domicile:[!1,""],document_type:[!1,""],document_number:[!1,""],document_expiration:[!1,""],matricola_number:[!1,""],is_esner:[!1,""]},[x,w]=xe.useState(p),[E,t]=a.useState({acceptStatute:!1,acceptPurposes:!1,acceptRegulation:!1,acceptPrivacy:!1}),[z,T]=a.useState({acceptStatute:!1,acceptPurposes:!1,acceptRegulation:!1,acceptPrivacy:!1}),r={statute:"https://drive.google.com/file/d/1rYtF01hrvQDIYHPebn1nNTDUOazS0kK2/view?usp=sharing",regulation:"https://drive.google.com/file/d/1ZuPfEshihDJ3lvoKyiQ_1L1BpsxBuZdq/view?usp=sharing",privacy:"https://drive.google.com/file/d/12LY0y49cCyjqdF0RotsO6srHrGkinNln/view?usp=sharing"},m=[{label:"Almeno 10 caratteri",test:I=>I.length>=10},{label:"Almeno 1 numero",test:I=>/\d/.test(I)},{label:"Almeno 1 lettera maiuscola",test:I=>/[A-Z]/.test(I)}],j=()=>{let I=!0;const b={...x},N={...z};["email","email_confirm","password","password_confirm","name","surname","birthdate","country","phone_prefix","phone_number","person_code","domicile","document_type","document_number","document_expiration","matricola_number"].forEach(v=>{!o[v]||typeof o[v]=="string"&&o[v].trim()===""?(b[v]=[!0,"Questo campo è obbligatorio"],I=!1):b[v]=[!1,""]}),/^\d{6}$/.test(o.matricola_number)?b.matricola_number=[!1,""]:(b.matricola_number=[!0,"La Matricola deve essere di 6 cifre"],I=!1),/^\d{8}$/.test(o.person_code)?b.person_code=[!1,""]:(b.person_code=[!0,"Il Codice Persona deve essere di 8 cifre"],I=!1);const d=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return o.email&&!d.test(o.email)&&(b.email=[!0,"Formato email non valido"],I=!1),o.email!==o.email_confirm?(b.email_confirm=[!0,"Le email non corrispondono"],I=!1):b.email_confirm=[!1,""],o.password!==o.password_confirm?(b.password_confirm=[!0,"Le password non corrispondono"],I=!1):b.password_confirm=[!1,""],Object.entries(E).forEach(([v,g])=>{g?N[v]=!1:(N[v]=!0,I=!1)}),w(b),T(N),I},S=()=>{window.scrollTo({top:0,behavior:"smooth"})},L=I=>K(I).format("YYYY-MM-DD"),A=I=>{f({...o,[I.target.name]:I.target.value}),x[I.target.name]&&w({...x,[I.target.name]:[!1,""]})},V=(I,b)=>{f({...o,[I]:b})},Y=I=>{const{name:b,checked:N}=I.target;t({...E,[b]:N}),N&&T({...z,[b]:!1})},P=I=>{if(I.preventDefault(),!j()){S();return}c(!0);let b={...o,birthdate:L(o.birthdate),document_expiration:L(o.document_expiration),matricola_expiration:L(o.matricola_expiration)};(async()=>{try{const C=await G("POST","/profile/initiate-creation/",b,{},!1),$=await C.json();if(w(p),C.ok)u(!0);else{n({message:"Errore nell'invio dati, guarda gli errori sotto",state:"error"});const M={...x};Object.entries($).forEach(([d,v])=>{M[d]&&(M[d]=[!0,v])}),w(M)}}catch(C){n({message:"Internal error (please contact us): "+C.message,state:"error"})}finally{c(!1)}})().then()};return h?e.jsxs(y,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",bgcolor:"#fff",children:[e.jsx(ja,{style:{fontSize:100,color:ya[500]}}),e.jsx(D,{variant:"h4",align:"center",gutterBottom:!0,children:"La tua richiesta di registrazione è stata inviata con successo!"}),e.jsx(D,{variant:"subtitle1",align:"center",children:"Controlla la tua email per ulteriori istruzioni."}),e.jsxs(D,{variant:"body2",align:"center",sx:{mt:2},children:["In caso non avessi ricevuto nulla, controlla la cartella spam o contattaci all'indirizzo ",e.jsx(be,{href:"mailto: informatica@esnpolimi.it",children:"informatica@esnpolimi.it"})]}),e.jsx(be,{href:"/login",underline:"always",sx:{mt:3},children:"Torna al Login"})]}):e.jsxs(y,{component:"form",noValidate:!0,sx:{maxWidth:800,margin:"auto",mt:5,mb:5,px:4},onSubmit:P,children:[e.jsx(D,{variant:"h4",align:"center",gutterBottom:!0,mb:5,children:"ESN Polimi - Registrazione ESNer"}),s&&e.jsx(Ne,{message:s.message,state:s.state}),e.jsx(D,{variant:"h5",align:"center",gutterBottom:!0,sx:{my:4},children:"Informazioni Personali"}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(F,{label:_.name,variant:"outlined",name:"name",value:o.name,onChange:A,fullWidth:!0,required:!0,error:x.name[0],helperText:x.name[1]})}),e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(F,{label:_.surname,variant:"outlined",name:"surname",value:o.surname,onChange:A,fullWidth:!0,required:!0,error:x.surname[0],helperText:x.surname[1]})}),e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(je,{label:_.birthdate,value:o.birthdate,onChange:I=>V("birthdate",I),maxDate:K(),required:!0,renderInput:I=>e.jsx(F,{...I,fullWidth:!0,required:!0})})})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(F,{label:_.email,variant:"outlined",name:"email",type:"email",value:o.email,onChange:A,fullWidth:!0,required:!0,error:x.email[0],helperText:x.email[1]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(F,{label:"Conferma Email",variant:"outlined",name:"email_confirm",type:"email",value:o.email_confirm,onChange:A,fullWidth:!0,required:!0,error:x.email_confirm[0],helperText:x.email_confirm[1]})}),e.jsxs(i,{size:{xs:12,sm:6},children:[e.jsx(F,{type:"password",label:"Password",variant:"outlined",name:"password",value:o.password,onChange:A,fullWidth:!0,required:!0,error:x.password[0],helperText:x.password[1]}),e.jsxs(y,{sx:{mt:1,mb:2},children:[e.jsx(D,{variant:"caption",color:"text.secondary",children:"La password deve contenere:"}),e.jsx("ul",{style:{margin:0,paddingLeft:20},children:m.map((I,b)=>{const N=I.test(o.password);return e.jsxs("li",{style:{color:N?"green":"grey",display:"flex",alignItems:"center",marginBottom:2},children:[N?e.jsx(ca,{fontSize:"small",sx:{mr:.5}}):e.jsx(Ee,{fontSize:"small",sx:{mr:.5}}),e.jsx("span",{children:I.label})]},b)})})]})]}),e.jsxs(i,{size:{xs:12,sm:6},children:[e.jsx(F,{type:"password",label:"Conferma Password",variant:"outlined",name:"password_confirm",value:o.password_confirm,onChange:A,fullWidth:!0,required:!0,error:x.password_confirm[0],helperText:x.password_confirm[1]}),e.jsx(y,{sx:{mt:1},children:o.password_confirm&&e.jsxs(D,{variant:"caption",sx:{display:"flex",alignItems:"center",color:o.password===o.password_confirm?"green":"grey"},children:[o.password===o.password_confirm?e.jsx(ca,{fontSize:"small",sx:{mr:.5}}):e.jsx(Ee,{fontSize:"small",sx:{mr:.5}}),o.password===o.password_confirm?"Le password corrispondono":"Le password non corrispondono"]})})]}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(te,{id:"country-label",children:_.country}),e.jsx(re,{variant:"outlined",labelId:"country-label",name:"country",value:o.country,onChange:A,label:_.country,error:x.country[0],children:we.map(I=>e.jsx(q,{value:I.code,children:I.name},I.code))})]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(F,{label:_.domicile,variant:"outlined",name:"domicile",value:o.domicile,onChange:A,fullWidth:!0,required:!0,error:x.domicile[0],helperText:x.domicile[1]})}),e.jsx(i,{size:{xs:4,sm:2},children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(te,{id:"phone-prefix-label",children:_.phone_prefix}),e.jsx(re,{variant:"outlined",labelId:"phone-prefix-label",id:"phone-prefix",name:"phone_prefix",value:o.phone_prefix,onChange:A,label:_.phone_prefix,renderValue:I=>I,error:x.phone_prefix[0],children:we.map(I=>e.jsxs(q,{value:I.dial,children:[I.dial," (",I.name,")"]},I.code))})]})}),e.jsx(i,{size:{xs:8,sm:4},children:e.jsx(F,{label:_.phone_number,variant:"outlined",name:"phone_number",type:"number",value:o.phone_number,onChange:A,fullWidth:!0,required:!0,error:x.phone_number[0],helperText:x.phone_number[1]})})]}),e.jsx(D,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Informazioni Documento"}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{size:{xs:12,sm:4},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(te,{id:"idType-label",children:"Tipo"}),e.jsxs(re,{variant:"outlined",labelId:"document-type-label",name:"document_type",value:o.document_type,onChange:A,label:"Tipo",required:!0,error:x.document_type[0],children:[e.jsx(q,{value:"Passport",children:"Passport"}),e.jsx(q,{value:"ID Card",children:"ID Card"}),e.jsx(q,{value:"Driving License",children:"Driving License"}),e.jsx(q,{value:"Residency Permit",children:"Residency Permit"}),e.jsx(q,{value:"Other",children:"Other"})]})]})}),e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(F,{label:"Numero",variant:"outlined",name:"document_number",value:o.document_number,onChange:A,fullWidth:!0,required:!0,error:x.document_number[0],helperText:x.document_number[1]})}),e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(je,{label:"Data di Scadenza",value:o.document_expiration,onChange:I=>V("document_expiration",I),renderInput:I=>e.jsx(F,{...I,fullWidth:!0,required:!0})})})})]}),e.jsx(D,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Informazioni Studente"}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(F,{label:_.person_code,variant:"outlined",name:"person_code",type:"number",value:o.person_code,onChange:A,fullWidth:!0,required:!0,error:x.person_code[0],helperText:x.person_code[1]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(F,{label:_.matricola_number,variant:"outlined",name:"matricola_number",type:"number",value:o.matricola_number,onChange:A,fullWidth:!0,required:!0,error:x.matricola_number[0],helperText:x.matricola_number[1]})})]}),e.jsxs(i,{container:!0,spacing:2,mt:3,children:[e.jsx(i,{size:{xs:12},children:e.jsx(_e,{control:e.jsx(Te,{name:"acceptStatute",checked:E.acceptStatute,onChange:Y,required:!0,sx:{color:z.acceptStatute?"red":void 0,"&.Mui-checked":{color:z.acceptStatute?"red":void 0}}}),label:e.jsxs("span",{children:["Dichiaro di aver letto e accettato lo"," ",e.jsx(be,{href:r.statute,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Statuto di ESN Politecnico Milano"})]})})}),e.jsx(i,{size:{xs:12},children:e.jsx(_e,{control:e.jsx(Te,{name:"acceptPurposes",checked:E.acceptPurposes,onChange:Y,required:!0,sx:{color:z.acceptPurposes?"red":void 0,"&.Mui-checked":{color:z.acceptPurposes?"red":void 0}}}),label:"Dichiaro di condividere pienamente gli scopi dell'Associazione (rif. Articolo 2 dello Statuto)"})}),e.jsx(i,{size:{xs:12},children:e.jsx(_e,{control:e.jsx(Te,{name:"acceptRegulation",checked:E.acceptRegulation,onChange:Y,required:!0,sx:{color:z.acceptRegulation?"red":void 0,"&.Mui-checked":{color:z.acceptRegulation?"red":void 0}}}),label:e.jsxs("span",{children:["Dichiaro di accettare tutti i termini indicati nello"," ",e.jsx(be,{href:r.regulation,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Regolamento Interno"})," ","e tutte le successive modifiche e integrazioni"]})})}),e.jsx(i,{size:{xs:12},children:e.jsx(_e,{control:e.jsx(Te,{name:"acceptPrivacy",checked:E.acceptPrivacy,onChange:Y,required:!0,sx:{color:z.acceptPrivacy?"red":void 0,"&.Mui-checked":{color:z.acceptPrivacy?"red":void 0}}}),label:e.jsxs("span",{children:["Dichiaro di aver letto l'",e.jsx(be,{href:r.privacy,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Informativa sulla Privacy"})," ","e di acconsentire al trattamento dei miei dati personali secondo il Regolamento UE 2016/679 (GDPR) e di essere consapevole dei miei diritti garantiti dalla suddetta legge"]})})})]}),e.jsx(H,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:4},startIcon:!l&&e.jsx(va,{}),disabled:l,children:l?e.jsx(Be,{size:24,color:"inherit"}):"Conferma Dati"})]})}const Ds=({onEdit:h,onCancel:u,onSave:s,saving:n})=>{const[l,c]=a.useState(!1),[_,o]=a.useState(!1),f=()=>{o(!0),h&&h()},p=()=>{n||(o(!1),u&&u())},x=async()=>{c(!0);try{s?await s()!==!1&&o(!1):o(!1)}catch(w){console.error("Error during save:",w)}finally{c(!1)}};return e.jsx("div",{children:_?e.jsxs(y,{sx:{display:"inline-flex"},children:[e.jsx(U,{onClick:p,"aria-label":"Cancel",disabled:n||l,children:e.jsx($a,{})}),n||l?e.jsx(U,{disabled:!0,children:e.jsx(Be,{size:"1rem"})}):e.jsx(U,{onClick:x,"aria-label":"Save",sx:{color:"#0288d1"},children:e.jsx(Ba,{})})]}):e.jsx(U,{onClick:f,"aria-label":"Edit",children:e.jsx(Ye,{})})})};function pa({cols:h,initialData:u,title:s,onSave:n,onDelete:l,onCreate:c,createText:_,canCreate:o,canDelete:f,canEdit:p,sortColumn:x}){const w=a.useMemo(()=>h,[h]),[E,t]=a.useState([]),r=p?e.jsx("span",{style:{color:"green"},children:"(Hai i permessi per eseguire modifiche)"}):e.jsx("span",{style:{color:"red"},children:"(Non hai i permessi per eseguire modifiche)"});a.useEffect(()=>{t(u)},[u]);const m=ke({columns:w,data:E,enableEditing:p,editDisplayMode:"row",createDisplayMode:"row",enableColumnFilters:!1,enableGlobalFilter:!1,enableSorting:x!=null,enableFullScreenToggle:!1,enableColumnOrdering:!1,enableColumnActions:!1,enableDensityToggle:!1,enableHiding:!1,enablePagination:!1,localization:De,initialState:{sorting:[{id:x,desc:!0}]},onCreatingRowSave:async({values:j,table:S})=>{let L=await c(j);L&&(t([...E,L]),S.setCreatingRow(!1))},onEditingRowSave:async({row:j,values:S})=>{if(await n(j.original,S)){const L=E.map((A,V)=>V===j.index?{...j.original,...S}:A);t(L),console.log(L),m.setEditingRow(null)}},getRowId:j=>j.id,renderRowActions:({row:j,table:S})=>e.jsxs(y,{sx:{display:"flex"},children:[e.jsx(Ge,{title:"Modifica",children:e.jsx(U,{onClick:()=>S.setEditingRow(j),children:e.jsx(Ye,{})})}),f&&e.jsx(Ge,{title:"Elimina",children:e.jsxs(U,{onClick:async()=>{await l(j.original),t(E.filter(L=>L.id!==j.id))},children:[" ",e.jsx(_a,{})]})})]}),renderTopToolbarCustomActions:({table:j})=>e.jsxs(y,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsxs(y,{sx:{ml:3},children:[e.jsx("h3",{children:s}),e.jsx("h5",{children:r})]}),_!=null?e.jsx(H,{variant:"contained",color:"primary",onClick:c,sx:{ml:"auto",mr:2,visibility:o?"visible":"hidden"},children:_}):e.jsx(U,{sx:{ml:"auto",mr:2,visibility:o?"visible":"hidden"},onClick:()=>{j.setCreatingRow(!0)},children:e.jsx(Ga,{})})]})});return e.jsx(Fe,{table:m})}const Ma={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80%",maxWidth:1200,maxHeight:"90vh",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,overflow:"auto"},Oe={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",boxShadow:24,p:4,outline:"none",display:"flex",flexDirection:"column"},ve=({message:h,state:u,duration:s=2e3})=>(a.useEffect(()=>{const n=document.createElement("div"),l=document.createElement("button");if(u==="error"){l.style.marginRight="10px",l.style.cursor="pointer",l.style.border="none",l.style.color="white",l.style.backgroundColor="transparent",ga.createRoot(l).render(e.jsx(Ka,{}));const w=document.createElement("span");w.innerText=h,n.appendChild(l),n.appendChild(w)}else n.innerText=h;n.style.display="flex",n.style.alignItems="center",n.style.position="fixed",n.style.top="-100px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.backgroundColor=u==="success"?"green":"red",n.style.color="white",n.style.padding="10px",n.style.borderRadius="5px",n.style.cursor="pointer",n.style.zIndex="9999",n.style.transition="opacity 0.5s ease-in-out, top 0.5s ease-in-out",document.body.appendChild(n);const c=()=>{navigator.clipboard.writeText(h).then()};u==="error"&&l.addEventListener("click",c);let _;requestAnimationFrame(()=>{n.style.top="20px"});const o=()=>{n.style.top="-100px",setTimeout(()=>{n.removeEventListener("mouseenter",f),n.removeEventListener("mouseleave",p),l.removeEventListener("click",c),document.body.contains(n)&&document.body.removeChild(n)},s/4)},f=()=>{clearTimeout(_)},p=()=>{_=setTimeout(o,s)};n.addEventListener("mouseenter",f),n.addEventListener("mouseleave",p),p()},[h,u,s]),null);function ia({open:h,message:u,onConfirm:s,onClose:n}){return e.jsxs(qa,{open:h,onClose:n,children:[e.jsx(Va,{children:"Conferma Azione"}),e.jsx(Ha,{children:e.jsx(D,{children:u})}),e.jsxs(Ya,{children:[e.jsx(H,{onClick:n,color:"secondary",children:"Annulla"}),e.jsx(H,{onClick:s,color:"primary",autoFocus:!0,children:"Conferma"})]})]})}function fe({size:h=40,fullScreen:u=!1}){return e.jsx(y,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:u?"100vh":"100%",width:"100%",position:u?"fixed":"relative",top:0,left:0,zIndex:u?1300:1,backgroundColor:u?"rgba(255, 255, 255, 0.7)":"transparent"},children:e.jsx(Be,{size:h})})}function Ms({open:h,profile:u,onClose:s}){const[n,l]=a.useState(0),[c,_]=a.useState(null),[o,f]=a.useState({open:!1,action:null,message:""}),[p,x]=a.useState(!0),[w,E]=a.useState([]),[t,z]=a.useState({esncard_number:"",account_id:""}),[T,r]=a.useState({esncard_number:[!1,""],account_id:[!1,""]}),m=[{field:"esncard_number",value:t.esncard_number,message:"Inserire il numero di ESNcard"},{field:"account_id",value:t.account_id,message:"Selezionare una Cassa"}];a.useEffect(()=>{x(!0),S().then(),j().then()},[]);const j=async()=>{try{const P=await G("GET","/esncard_fees/");if(P.ok){const I=await P.json();console.log("ESNcard fees:",I),u.latest_esncard&&u.latest_esncard?.is_valid?l(parseFloat(I.esncard_lost_fee.replace("€",""))):l(parseFloat(I.esncard_release_fee.replace("€","")))}else{const I=await Q(P);_({message:`Errore fees ESNcard: ${I}`,state:"error"})}}catch(P){_({message:`Errore generale: ${P}`,state:"error"})}finally{x(!1)}},S=async()=>{try{const P=await G("GET","/accounts/");if(P.ok){const I=await P.json();E(I.results)}else{const I=await Q(P);_({message:`Errore durante il recupero delle casse: ${I}`,state:"error"})}}catch(P){_({message:`Errore generale: ${P}`,state:"error"})}},L=()=>{const P={};return Object.keys(T).forEach(I=>{P[I]=[!1,""]}),r(P),P},A=async()=>{let P=!1;const I=L();if(m.forEach(N=>{N.value||(I[N.field]=[!0,N.message],P=!0)}),P){r(I);return}let b="Confermi un pagamento di "+n+"€ per l'emissione della ESNcard?";f({open:!0,action:()=>V(),message:b})},V=async()=>{f({open:!1,action:null,message:""});try{const P=await G("POST","/esncard_emission/",{profile_id:u.id,account_id:t.account_id,esncard_number:t.esncard_number,amount:n});if(P.ok)s(!0);else{const I=await Q(P);_({message:`Errore durante l'emissione della ESNcard: ${I}`,state:"error"})}}catch(P){_({message:`Errore generale: ${P}`,state:"error"})}},Y=P=>{z({...t,[P.target.name]:P.target.value})};return e.jsx(Pe,{open:h,onClose:()=>{s(!1)},"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsx(y,{sx:Oe,children:p?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(U,{onClick:()=>s(!1),sx:{minWidth:0},children:e.jsx(Ee,{})})}),e.jsx(D,{variant:"h4",component:"h2",gutterBottom:!0,children:"Emissione ESNcard"}),e.jsx(We,{sx:{mb:2}}),e.jsxs(D,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"A:"})," ",u.name," ",u.surname]}),e.jsxs(D,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Importo:"})," ",n,"€"]}),e.jsxs(i,{container:!0,spacing:2,direction:"column",children:[e.jsx(i,{size:{xs:12},sx:{mt:2},children:e.jsx(F,{required:!0,label:"Numero ESNcard",name:"esncard_number",value:t.esncard_number,error:T.esncard_number[0],helperText:T.esncard_number[1],onChange:Y,fullWidth:!0})}),e.jsx(i,{size:{xs:12},sx:{mt:0},children:e.jsxs(X,{fullWidth:!0,required:!0,error:T.account_id[0],children:[e.jsx(te,{htmlFor:"account-selector",sx:{mb:2},children:"Seleziona Cassa"}),e.jsx(re,{variant:"outlined",label:"Seleziona Cassa",labelId:"account-selector-label",id:"account-selector",name:"account_id",value:t.account_id,error:T.account_id[0],onChange:Y,children:w.map(P=>e.jsxs(q,{value:P.id,disabled:P.status==="closed",style:{color:P.status==="closed"?"grey":"inherit"},children:[P.name," ",P.status==="closed"?"(Chiusa)":""]},P.id))}),T.account_id[0]&&e.jsx(Ue,{children:T.account_id[1]})]})})]}),e.jsx(H,{variant:"contained",fullWidth:!0,sx:{mt:2},onClick:A,children:"Conferma"}),c&&e.jsx(ve,{message:c.message,state:c.state}),e.jsx(ia,{open:o.open,message:o.message,onConfirm:o.action,onClose:()=>f({open:!1,action:null,message:""})})]})})})}const As={ESNer:{hideFields:["course","matricola_expiration","whatsapp_prefix","whatsapp_number"]},Erasmus:{hideFields:["group"]}};function Aa({open:h,onClose:u,inProfile:s,profileType:n,updateProfile:l}){const[c,_]=a.useState(!1),[o,f]=a.useState(!0),{user:p}=Ae(),[x,w]=a.useState(s),[E,t]=a.useState(null),[z,T]=a.useState(!1),[r,m]=a.useState({}),[j,S]=a.useState({}),[L,A]=a.useState([]),[V,Y]=a.useState({email:"",name:"",surname:"",birthdate:"",country:"",phone_prefix:"",phone_number:"",whatsapp_prefix:"",whatsapp_number:"",person_code:"",domicile:"",course:"",matricola_number:"",matricola_expiration:"",documents:[],esncards:[],group:""}),[P,I]=a.useState({email:"",name:"",surname:"",birthdate:"",country:"",phone_prefix:"",phone_number:"",whatsapp_prefix:"",whatsapp_number:"",person_code:"",domicile:"",course:"",matricola_number:"",matricola_expiration:"",group:""}),[b,N]=a.useState({email:[!1,""],name:[!1,""],surname:[!1,""],birthdate:[!1,""],country:[!1,""],phone_prefix:[!1,""],phone_number:[!1,""],whatsapp_prefix:[!1,""],whatsapp_number:[!1,""],person_code:[!1,""],domicile:[!1,""],course:[!1,""],matricola_number:[!1,""],matricola_expiration:[!1,""],group:[!1,""]}),[C,$]=a.useState({email:!0,name:!0,surname:!0,birthdate:!0,country:!0,phone_prefix:!0,phone_number:!0,whatsapp_prefix:!0,whatsapp_number:!0,person_code:!0,domicile:!0,course:!0,matricola_number:!0,matricola_expiration:!0,group:!0});a.useEffect(()=>{f(!0),(async()=>{try{const B=await G("GET",`/profile/${x.id.toString()}/`);if(B.ok){const Z=await B.json(),le={};Object.keys(V).map(ye=>{le[ye]=Z[ye]}),Y(le),I(le)}else{const Z=await Q(B);t({message:`Errore: ${Z}`,state:"error"})}}catch(B){t({message:`Errore generale: ${B}`,state:"error"})}finally{f(!1)}})().then()},[]),a.useEffect(()=>{(async()=>{try{const B=await G("GET","/groups/");if(B.ok){const Z=await B.json();A(Z)}else t({message:`Errore nel recupero dei gruppi: ${await Q(B)}`,state:"error"})}catch(B){console.error("Error fetching groups:",B),t({message:`Errore generale: ${B}`,state:"error"})}})().then()},[]);const M=As[n]||{hideFields:[]},d=k=>M.hideFields.includes(k),v=async()=>{try{const k=await G("GET",`/profile/${x.id.toString()}/`);if(k.ok){const B=await k.json();Y(B),I(B),l&&l(B),w(B)}else{const B=await Q(k);t({message:`Errore: ${B}`,state:"error"})}}catch(k){t({message:`Errore generale: ${k}`,state:"error"})}},g=()=>{T(!0)},R=async k=>{k&&(t({message:"ESNcard emessa con successo!",state:"success"}),await v()),T(!1)},ne=a.useMemo(()=>[{accessorKey:"number",header:"Numero",size:100,muiEditTextFieldProps:{required:!0,helperText:r?.number,error:!!r?.number}},{accessorKey:"created_at",enableEditing:!1,header:"Rilascio",size:100,Cell:({cell:k})=>{const B=new Date(k.getValue());return B==null?"Null":B.toISOString().split("T")[0]}},{accessorKey:"expiration",enableEditing:!1,header:"Scadenza",size:100,Cell:({cell:k})=>{const le=new Date(k.getValue())<new Date;return e.jsx("span",{style:{color:le?"orange":"green"},children:k.getValue()})}}],[]),ce=async(k,B)=>{try{const Z=await G("PATCH",`/esncard/${k.id}/`,B);if(Z.ok)return m({}),t({message:"ESNcard aggiornata con successo!",state:"success"}),await v(),!0;{const le=await Q(Z);return t({message:`Errore: ${le}`,state:"error"}),!1}}catch(Z){t({message:`Errore generale: ${Z}`,state:"error"})}},W=a.useMemo(()=>[{accessorKey:"type",header:"Tipo",size:100,editVariant:"select",editSelectOptions:["Passport","ID Card","Driving License","Residency Permit","Other"],muiEditTextFieldProps:{select:!0,helperText:j?.type,error:!!j?.type}},{accessorKey:"number",header:"Numero",size:60,muiEditTextFieldProps:{required:!0,helperText:j?.number,error:!!j?.number}},{accessorKey:"expiration",header:"Scadenza",size:60,muiEditTextFieldProps:{required:!0,helperText:j?.expiration,error:!!j?.expiration,type:"date"},Cell:({cell:k})=>{const le=new Date(k.getValue())<new Date;return e.jsx("span",{style:{color:le?"orange":"green"},children:k.getValue()})}}],[]),J=async k=>{try{const B=await G("DELETE",`/document/${k.id}/`);if(B.ok)return S({}),t({message:"Documento eliminato con successo!",state:"success"}),await v(),!0;{B.json().then(le=>S(le));const Z=await Q(B);t({message:`Errore: ${Z}`,state:"error"})}}catch(B){t({message:`Errore generale: ${B}`,state:"error"})}},ie=async k=>{let B={...k,profile:x.id};try{const Z=await G("POST","/document/",B);if(Z.ok)return S({}),t({message:"Documento aggiunto con successo!",state:"success"}),await v(),!0;{Z.json().then(ye=>S(ye));const le=await Q(Z);return t({message:`Errore: ${le}`,state:"error"}),!1}}catch(Z){return t({message:`Errore generale: ${Z}`,state:"error"}),!1}},oe=async(k,B)=>{try{const Z=await G("PATCH",`/document/${k.id}/`,B);if(Z.ok)return S({}),t({message:"Documento aggiornato con successo!",state:"success"}),await v(),!0;{Z.json().then(ye=>S(ye));const le=await Q(Z);return t({message:`Errore: ${le}`,state:"error"}),!1}}catch(Z){return t({message:`Errore generale: ${Z}`,state:"error"}),!1}},de=k=>k?K(k).format("YYYY-MM-DD"):null,ee=k=>{I({...P,[k.target.name]:k.target.value})},ge=(k,B)=>{I({...P,[k]:B})},Le=()=>{const k={};Object.keys(b).forEach(B=>{k[B]=[!1,""]}),N(k)},Re=k=>{$(Object.fromEntries(Object.keys(C).map(B=>[B,!k]))),Le()},Je=async()=>{if(_(!0),P.matricola_number&&!/^\d{6}$/.test(P.matricola_number))return N(k=>({...k,matricola_number:[!0,"La Matricola deve essere composta da 6 cifre"]})),_(!1),!1;try{const k={...P,birthdate:de(P.birthdate),matricola_expiration:de(P.matricola_expiration)},B=await G("PATCH",`/profile/${x.id.toString()}/`,k);if(B.ok)await v(),V&&(Le(),t({message:"Profilo aggiornato con successo!",state:"success"}),Re(!1));else{const Z=await B.json(),le=Object.fromEntries(Object.keys(b).map(ye=>ye in Z?[ye,[!0,Z[ye]]]:[ye,[!1,""]]));N(le)}}catch(k){I(V),t({message:`Errore generale: ${k}`,state:"error"}),Re(!1)}finally{_(!1)}};return e.jsx(Pe,{open:h,onClose:u,children:e.jsxs(y,{sx:Ma,onKeyDown:k=>k.stopPropagation(),children:[e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(U,{onClick:()=>u(!1),sx:{minWidth:0},children:e.jsx(Ee,{})})}),e.jsxs(D,{variant:"h5",gutterBottom:!0,align:"center",children:["Profilo ",n]}),o?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{sx:{p:"20px"},children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{container:!0,size:{xs:12},alignItems:"center",children:[e.jsx(aa,{}),e.jsx(D,{variant:"h6",sx:{m:0},children:"Informazioni Personali"}),e.jsx(i,{sx:{marginLeft:"auto"},children:e.jsx(Ds,{onEdit:()=>Re(!0),onCancel:()=>{Re(!1),I(V)},saving:c,onSave:Je})})]}),!d("name")&&e.jsx(i,{size:{xs:12,md:4,lg:4},children:e.jsx(F,{label:O.name,name:"name",value:P.name,error:b.name[0],helperText:b.name[1],slotProps:{input:{readOnly:C.name}},onChange:ee,sx:{backgroundColor:C.name?"grey.200":"white"},fullWidth:!0})}),!d("surname")&&e.jsx(i,{size:{xs:12,md:4,lg:4},children:e.jsx(F,{label:O.surname,name:"surname",value:P.surname,error:b.surname[0],helperText:b.surname[1],onChange:ee,slotProps:{input:{readOnly:C.surname}},sx:{backgroundColor:C.surname?"grey.200":"white"},fullWidth:!0})}),!d("email")&&e.jsx(i,{size:{xs:12,md:4,lg:4},children:e.jsx(F,{label:O.email,name:"email",type:"email",value:P.email,error:b.email[0],helperText:b.email[1],slotProps:{input:{readOnly:!0}},sx:{backgroundColor:"grey.200"},onChange:ee,fullWidth:!0})}),!d("country")&&e.jsx(i,{size:{xs:12,md:4,lg:4},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(te,{id:"country-label",children:O.country}),e.jsxs(re,{variant:"outlined",labelId:"country-label",name:"country",label:O.country,value:P.country,error:b.country[0],onChange:ee,slotProps:{input:{readOnly:C.country}},sx:{backgroundColor:C.country?"grey.200":"white"},children:[e.jsx(q,{value:"",children:e.jsx("em",{children:"None"})}),we.map(k=>e.jsx(q,{value:k.code,children:k.name},k.code))]})]})}),!d("domicile")&&e.jsx(i,{size:{xs:12,md:4,lg:5},children:e.jsx(F,{label:O.domicile,name:"domicile",value:P.domicile,error:b.domicile[0],helperText:b.domicile[1],onChange:ee,slotProps:{input:{readOnly:C.domicile}},sx:{backgroundColor:C.domicile?"grey.200":"white"},fullWidth:!0})}),!d("birthdate")&&e.jsx(i,{size:{xs:12,md:4,lg:3},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(je,{label:O.birthdate,value:P.birthdate?K(P.birthdate,"YYYY-MM-DD"):null,readOnly:C.birthdate,onChange:k=>ge("birthdate",k),sx:{backgroundColor:C.birthdate?"grey.200":"white"},renderInput:k=>e.jsx(F,{...k,fullWidth:!0,required:!0})})})}),!d("phone_prefix")&&!d("phone_number")&&e.jsxs(i,{size:{xs:12},container:!0,spacing:2,children:[e.jsx(i,{size:{xs:1.5},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(te,{id:"phone-prefix-label",children:O.phone_prefix}),e.jsx(re,{variant:"outlined",labelId:"phone-prefix-label",id:"phone-prefix",name:"phone_prefix",value:P.phone_prefix||"",onChange:ee,slotProps:{input:{readOnly:C.phone_number}},sx:{backgroundColor:C.phone_number?"grey.200":"white"},label:O.phone_prefix,renderValue:k=>k,children:we.map(k=>e.jsxs(q,{value:k.dial,children:[k.dial," (",k.name,")"]},k.code))})]})}),e.jsx(i,{size:{xs:3},children:e.jsx(F,{label:O.phone_number,name:"phone_number",value:P.phone_number||"",error:b.phone_number[0],helperText:b.phone_number[1],onChange:ee,slotProps:{input:{readOnly:C.phone_number}},sx:{backgroundColor:C.phone_number?"grey.200":"white"},fullWidth:!0})})]}),!d("whatsapp_prefix")&&!d("whatsapp_number")&&e.jsxs(i,{size:{xs:12},container:!0,spacing:2,children:[e.jsx(i,{size:{xs:1.5},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(te,{id:"whatsapp-prefix-label",children:O.whatsapp_prefix}),e.jsx(re,{variant:"outlined",labelId:"whatsapp-prefix-label",id:"whatsapp-prefix",name:"whatsapp_prefix",value:P.whatsapp_prefix||"",onChange:ee,slotProps:{input:{readOnly:C.whatsapp_prefix}},sx:{backgroundColor:C.whatsapp_prefix?"grey.200":"white"},label:O.whatsapp_prefix,renderValue:k=>k,children:we.map(k=>e.jsxs(q,{value:k.dial,children:[k.dial," (",k.name,")"]},k.code))})]})}),e.jsx(i,{size:{xs:3},children:e.jsx(F,{label:O.whatsapp_number,name:"whatsapp_number",value:P.whatsapp_number||"",error:b.whatsapp_number[0],helperText:b.whatsapp_number[1],onChange:ee,slotProps:{input:{readOnly:C.whatsapp_number}},sx:{backgroundColor:C.whatsapp_number?"grey.200":"white"},fullWidth:!0})})]}),e.jsxs(i,{container:!0,size:{xs:12},sx:{mt:2},alignItems:"center",children:[e.jsx(Ua,{}),e.jsx(D,{variant:"h6",sx:{m:0},children:"Dati Studente"})]}),!d("person_code")&&e.jsx(i,{size:{xs:12,md:4,lg:3},children:e.jsx(F,{label:O.person_code,name:"person_code",value:P.person_code||"",error:b.person_code[0],helperText:b.person_code[1],onChange:ee,slotProps:{input:{readOnly:C.person_code}},sx:{backgroundColor:C.person_code?"grey.200":"white"},fullWidth:!0})}),!d("course")&&e.jsx(i,{size:{xs:12,md:4,lg:3},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(te,{id:"course-label",children:O.course}),e.jsxs(re,{variant:"outlined",labelId:"course-label",name:"course",label:O.course,value:P.course||"",onChange:ee,slotProps:{input:{readOnly:C.course}},sx:{backgroundColor:C.course?"grey.200":"white"},children:[e.jsx(q,{value:"Engineering",children:"Ingegneria"}),e.jsx(q,{value:"Design",children:"Design"}),e.jsx(q,{value:"Architecture",children:"Architettura"})]})]})}),!d("matricola_number")&&e.jsx(i,{size:{xs:12,md:4,lg:3},children:e.jsx(F,{label:O.matricola_number,name:"matricola_number",value:P.matricola_number||"",error:b.matricola_number[0],helperText:b.matricola_number[1],onChange:ee,sx:{backgroundColor:C.matricola_number?"grey.200":"white"},type:"number",slotProps:{input:{readOnly:C.matricola_number}},fullWidth:!0})}),!d("matricola_expiration")&&e.jsx(i,{size:{xs:12,md:4,lg:3},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(je,{label:O.matricola_expiration,value:P.matricola_expiration?K(P.matricola_expiration,"YYYY-MM-DD"):null,readOnly:C.matricola_expiration,onChange:k=>ge("matricola_expiration",k),sx:{backgroundColor:C.matricola_expiration?"grey.200":"white"},renderInput:k=>e.jsx(F,{...k,fullWidth:!0,required:!0})})})}),!d("group")&&e.jsxs(i,{container:!0,alignItems:"center",spacing:1,sx:{width:"100%",mt:2},children:[e.jsx(Ja,{}),e.jsx(i,{size:{xs:2},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(te,{id:"group-label",children:O.group}),e.jsx(re,{variant:"outlined",labelId:"group-label",label:O.group,name:"group",value:P.group||"",onChange:ee,slotProps:{input:{readOnly:C.group}},sx:{backgroundColor:C.group?"grey.200":"white"},children:L.map(k=>e.jsx(q,{value:k.name,children:k.name},k.name))})]})})]})]})}),e.jsxs(Ke,{sx:{p:1,mt:2,mb:2,minHeight:"80px",display:"flex",alignItems:"center"},children:[e.jsxs(Za,{sx:{justifyContent:"space-between",width:"100%",p:0},children:[e.jsx(D,{variant:"h6",children:"Azioni"}),e.jsx(H,{variant:"contained",color:"primary",children:"Esporta Profilo"})]}),z&&e.jsx(Ms,{open:z,profile:x,onClose:R})]}),e.jsxs(i,{container:!0,sx:{width:"100%"},spacing:2,children:[e.jsx(i,{size:{xs:12,md:6},children:e.jsx(pa,{cols:W,canCreate:p.permissions.includes("add_document"),canEdit:p.permissions.includes("change_document"),canDelete:p.permissions.includes("delete_document"),onCreate:ie,onSave:oe,onDelete:J,initialData:V.documents,title:"Documenti",sortColumn:"expiration"})}),e.jsx(i,{size:{xs:12,md:6},children:e.jsx(pa,{cols:ne,canCreate:p.permissions.includes("add_esncard"),onCreate:g,createText:x.latest_esncard?x.latest_esncard.is_valid?"Card Smarrita":"Rinnova":"Rilascia",canEdit:p.permissions.includes("change_esncard"),onSave:ce,initialData:V.esncards,title:"ESNcards",sortColumn:"expiration"})})]}),E&&e.jsx(ve,{message:E.message,state:E.state})]})]})})}const ha=[{value:"valid",label:"Valida"},{value:"expired",label:"Scaduta"},{value:"absent",label:"Assente"}];function La({apiEndpoint:h,columns:u,columnVisibility:s,profileType:n}){const[l,c]=a.useState([]),[_,o]=a.useState(!1),[f,p]=a.useState({}),[x,w]=a.useState({pageIndex:0,pageSize:10}),[E,t]=a.useState(0),[z,T]=a.useState([]),[r,m]=a.useState({esncardValidity:[],group:[]}),[j,S]=a.useState(""),[L,A]=a.useState(""),[V,Y]=a.useState(!0),P=a.useRef(null);a.useEffect(()=>{Y(!0),(async()=>{try{const v=new URLSearchParams;v.append("page",x.pageIndex+1),v.append("page_size",x.pageSize),L&&v.append("search",L),r.esncardValidity.length&&v.append("esncardValidity",r.esncardValidity.join(",")),r.group.length&&v.append("group",r.group.join(","));const R=await(await G("GET",`${h}?${v.toString()}`)).json();t(R.count||0),c(R.results)}catch(v){console.error("Error fetching data:",v)}finally{Y(!1)}})().then(),n==="ESNer"&&G("GET","/groups/").then(v=>{v.ok&&v.json().then(g=>T(g))})},[h,x.pageIndex,x.pageSize,n,r,L]);const I=()=>{A(j),w(d=>({...d,pageIndex:0}))},b=()=>{S(""),A(""),w(d=>({...d,pageIndex:0})),P.current&&P.current.focus()},N=ke({columns:u,data:l,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableColumnPinning:!0,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableRowPinning:!0,enableExpandAll:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},columnVisibility:s},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",enableGlobalFilter:!1,muiPaginationProps:{color:"secondary",rowsPerPageOptions:[10,20,50],shape:"rounded",variant:"outlined"},manualPagination:!0,rowCount:E,onPaginationChange:w,state:{pagination:x},localization:De,muiTableBodyRowProps:({row:d})=>({onClick:()=>{p(d.original),o(!0)}})}),C=d=>{c(v=>v.map(g=>g.id===d.id?d:g))},$=()=>{o(!1)},M=d=>{const{name:v,value:g}=d.target;m(R=>({...R,[v]:typeof g=="string"?g.split(","):g}))};return e.jsxs(y,{sx:{mx:"5%"},children:[e.jsxs(i,{container:!0,spacing:2,sx:{mb:2,mt:2},alignItems:"center",justifyContent:"flex-end",children:[e.jsx(i,{size:{xs:12,sm:2},children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(te,{id:"esncard-validity-label",children:"Validità ESNcard"}),e.jsx(re,{labelId:"esncard-validity-label",name:"esncardValidity",variant:"outlined",multiple:!0,value:r.esncardValidity,onChange:M,input:e.jsx(Ce,{label:"Validità ESNcard"}),renderValue:d=>ha.filter(v=>d.includes(v.value)).map(v=>v.label).join(", "),children:ha.map(d=>e.jsx(q,{value:d.value,children:d.label},d.value))})]})}),n==="ESNer"&&z.length>0&&e.jsx(i,{size:{xs:12,sm:2},children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(te,{id:"group-label",children:"Gruppo"}),e.jsx(re,{labelId:"group-label",name:"group",variant:"outlined",multiple:!0,value:r.group,onChange:M,input:e.jsx(Ce,{label:"Gruppo"}),renderValue:d=>z.filter(v=>d.includes(v.name)).map(v=>v.name).join(", "),children:z.map(d=>e.jsx(q,{value:d.name,children:d.name},d.name))})]})}),e.jsx(i,{size:{xs:12,sm:2},sm:"auto",children:e.jsx(Ce,{inputRef:P,size:"small",placeholder:"Cerca",value:j,onChange:d=>S(d.target.value),onKeyDown:d=>{d.key==="Enter"&&I()},endAdornment:j&&L===j?e.jsx(U,{"aria-label":"clear",onClick:b,edge:"end",children:e.jsx($e,{})}):e.jsx(U,{"aria-label":"search",onClick:I,edge:"end",children:e.jsx(sa,{})})})})]}),V?e.jsx(fe,{}):e.jsx(Fe,{table:N}),_&&e.jsx(Aa,{open:_,inProfile:f,profileType:n,onClose:$,updateProfile:C})]})}const Ls=()=>{const{logout:h}=Ae(),u=Ie(),s=()=>{h(),u("/login")};return e.jsx(H,{variant:"contained",sx:{backgroundColor:"black",color:"white",marginTop:2},onClick:s,children:"Logout"})};function Rs({user:h}){const[u,s]=a.useState(!1),n=a.useCallback(()=>{s(!0)},[]),l=a.useCallback(_=>{s(!1)},[]),c=a.useCallback(_=>{h={...h,profile:_}},[h]);return e.jsxs(y,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px"},children:[e.jsx(U,{onClick:n,"aria-label":"Profile",children:e.jsx(aa,{})}),e.jsxs(y,{sx:{flexGrow:1,marginLeft:"10px"},children:[e.jsxs(D,{variant:"body2",children:[h.profile.name," ",h.profile.surname," (",h.groups[0],")"]}),e.jsx(Ls,{})]}),e.jsx(Aa,{inProfile:h.profile,profileType:"ESNer - "+h.groups[0],open:u,handleClose:l,updateProfile:c})]})}function Me(){const{isDrawerOpen:h,toggleDrawer:u,expandedSection:s,handleExpand:n}=Is(),{user:l}=Ae(),c=f=>l?.permissions?.includes(f)||!1,_=[{text:"Home",icon:e.jsx(Qa,{}),path:"/"},{text:"Tesoreria",icon:e.jsx(Xa,{}),path:"/treasury",requiredPermission:"change_account"},{text:"Eventi",icon:e.jsx(ta,{}),path:"/events"},{text:"Profili",icon:e.jsx(aa,{}),children:[{text:"Erasmus",icon:e.jsx(Sa,{}),path:"/profiles/erasmus"},{text:"ESNers",icon:e.jsx(Ca,{}),path:"/profiles/esners"}]}].filter(f=>!f.requiredPermission||c(f.requiredPermission)),o=e.jsxs(y,{sx:{width:250,display:"flex",flexDirection:"column",height:"100%"},role:"presentation",onClick:u(!1),onKeyDown:u(!1),children:[e.jsx(y,{sx:{flexGrow:1},children:_.map(f=>e.jsx(xe.Fragment,{children:f.children?e.jsxs(xe.Fragment,{children:[e.jsxs(es,{onClick:p=>{p.stopPropagation(),n(f.text)},children:[e.jsx(Qe,{children:f.icon}),e.jsx(Xe,{primary:f.text,slotProps:{primary:{style:{color:"black"}}}}),s===f.text?e.jsx(wa,{}):e.jsx(Ea,{})]}),e.jsx(Ta,{in:s===f.text,timeout:"auto",unmountOnExit:!0,children:e.jsx(as,{component:"div",disablePadding:!0,children:f.children?.map(p=>e.jsxs(da,{component:ma,to:p.path,sx:{pl:4},children:[e.jsx(Qe,{children:p.icon}),e.jsx(Xe,{primary:p.text,slotProps:{primary:{style:{color:"black"}}}})]},p.text))||[]})})]},f.text):e.jsxs(da,{component:ma,to:f.path,children:[e.jsx(Qe,{children:f.icon}),e.jsx(Xe,{primary:f.text,slotProps:{primary:{style:{color:"black"}}}})]},f.text)},f.text))}),l&&e.jsx(y,{sx:{mt:"auto",mb:2},children:e.jsx(Rs,{user:l})})]});return e.jsxs(y,{sx:{display:"flex"},children:[e.jsx(U,{edge:"start",color:"inherit","aria-label":"menu",onClick:u(!0),sx:{margin:"10px"},children:e.jsx(ss,{})}),e.jsx(ts,{anchor:"left",open:h,onClose:u(!1),children:o})]})}function Fs(){const h=a.useMemo(()=>[{accessorKey:"id",header:O.id,size:50},{accessorKey:"name",header:O.name,size:150},{accessorKey:"surname",header:O.surname,size:150},{accessorKey:"email",header:O.email,size:150},{accessorKey:"latest_esncard",header:O.latest_esncard,size:50,Cell:({cell:s})=>e.jsx(y,{sx:{},children:s.getValue()!==null?e.jsx(ae,{label:s.getValue().number,color:s.getValue().is_valid?"success":"warning"}):e.jsx(ae,{label:"Nessuna ESNcard",color:"error"})})},{accessorKey:"country",header:O.country,size:150,Cell:({row:s})=>{const n=s.original.country,l=we.find(c=>c.code===n);return l?l.name:n||"(vuoto)"}},{accessorKey:"birthdate",header:O.birthdate,size:100},{accessorKey:"course",header:O.course,size:100},{accessorKey:"phone_prefix",header:"Prefisso Telefono",size:60},{accessorKey:"phone_number",header:"Numero Telefono (no prefisso)",size:120},{id:"fullPhoneNumber",header:O.phone_number,size:150,accessorFn:s=>`(${s.phone_prefix||"vuoto"}) ${s.phone_number||"(vuoto)"}`,Cell:({row:s})=>e.jsxs("span",{children:["(",s.original.phone_prefix||"vuoto",") ",s.original.phone_number||"(vuoto)"]})},{accessorKey:"whatsapp_prefix",header:"Prefisso WhatsApp",size:60},{accessorKey:"whatsapp_number",header:"Numero WhatsApp (no prefisso)",size:120},{id:"fullWANumber",header:O.whatsapp_number,size:150,accessorFn:s=>`(${s.whatsapp_prefix||"vuoto"}) ${s.whatsapp_number||"(vuoto)"}`,Cell:({row:s})=>e.jsxs("span",{children:["(",s.original.whatsapp_prefix||"vuoto",") ",s.original.whatsapp_number||"(vuoto)"]})},{accessorKey:"domicile",header:O.domicile,size:200},{accessorKey:"matricola_number",header:O.matricola_number,size:50},{accessorKey:"matricola_expiration",header:O.matricola_expiration,size:50},{accessorKey:"latest_document.number",header:O.latest_document,size:50}],[]),u={id:!0,name:!0,surname:!0,email:!0,country:!1,birthdate:!1,course:!1,fullPhoneNumber:!0,fullWANumber:!0,person_code:!1,domicile:!1,matricola_number:!1,matricola_expiration:!1,"latest_document.number":!1,phone_prefix:!1,phone_number:!1,whatsapp_prefix:!1,whatsapp_number:!1};return e.jsxs(y,{children:[e.jsx(Me,{}),e.jsx(y,{sx:{mx:"5%"},children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(Sa,{sx:{marginRight:"10px"}}),e.jsx(D,{variant:"h4",children:"Profili Erasmus"})]})}),e.jsx(La,{apiEndpoint:"/erasmus_profiles/",columns:h,columnVisibility:u,profileType:"Erasmus"})]})}function Ns(){const h=a.useMemo(()=>[{accessorKey:"id",header:O.id,size:50},{accessorKey:"name",header:O.name,size:150},{accessorKey:"surname",header:O.surname,size:150},{accessorKey:"group",header:O.group,size:150,Cell:({cell:s})=>{const n=s.getValue();let l="default";return n==="Aspiranti"?l="info":n==="Attivi"?l="success":n==="Board"&&(l="warning"),e.jsx(ae,{label:n,color:l})}},{accessorKey:"email",header:O.email,size:150},{accessorKey:"latest_esncard",header:O.latest_esncard,size:50,Cell:({cell:s})=>e.jsx(y,{sx:{},children:s.getValue()!==null?e.jsx(ae,{label:s.getValue().number,color:s.getValue().is_valid?"success":"warning"}):e.jsx(ae,{label:"Nessuna ESNcard",color:"error"})})},{accessorKey:"country",header:O.country,size:150,Cell:({row:s})=>{const n=s.original.country,l=we.find(c=>c.code===n);return l?l.name:n||"(vuoto)"}},{accessorKey:"birthdate",header:O.birthdate,size:100},{accessorKey:"phone_prefix",header:"Prefisso Telefono",size:60},{accessorKey:"phone_number",header:"Numero Telefono (no prefisso)",size:120},{id:"fullPhoneNumber",header:O.phone_number,size:150,accessorFn:s=>`(${s.phone_prefix||"vuoto"}) ${s.phone_number||"(vuoto)"}`,Cell:({row:s})=>e.jsxs("span",{children:["(",s.original.phone_prefix||"vuoto",") ",s.original.phone_number||"(vuoto)"]})},{accessorKey:"person_code",header:O.person_code,size:150},{accessorKey:"domicile",header:O.domicile,size:200},{accessorKey:"matricola_number",header:O.matricola_number,size:50},{accessorKey:"latest_document.number",header:O.latest_document,size:50}],[]),u={id:!0,name:!0,surname:!0,groups:!0,email:!0,country:!0,birthdate:!1,fullPhoneNumber:!0,person_code:!1,domicile:!1,matricola_number:!1,"latest_document.number":!1,phone_prefix:!1,phone_number:!1};return e.jsxs(y,{children:[e.jsx(Me,{}),e.jsx(y,{sx:{mx:"5%"},children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(Ca,{sx:{marginRight:"10px"}}),e.jsx(D,{variant:"h4",children:"Profili ESNers"})]})}),e.jsx(La,{apiEndpoint:"/esner_profiles/",columns:h,columnVisibility:u,profileType:"ESNer"})]})}function Ra({open:h,onClose:u,account:s,onSuccess:n}){const{user:l}=Ae(),[c,_]=a.useState({amount:"",type:"deposit",description:""}),o=async p=>{p.preventDefault();try{const x=await G("POST","/transaction/",{account:s.id,amount:c.type==="deposit"?Math.abs(c.amount):-Math.abs(c.amount),description:c.description,type:c.type,executor:l.profile.email});if(x.ok)n("Transazione registrata con successo"),u();else{const w=await x.json();n("Errore durante la registrazione: "+JSON.stringify(w),"error")}}catch(x){n("Errore durante la registrazione: "+x.message,"error")}},f=()=>u(!1);return e.jsx(Pe,{open:h,onClose:f,children:e.jsxs(y,{sx:Oe,component:"form",onSubmit:o,noValidate:!0,children:[e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsxs(U,{onClick:f,sx:{minWidth:0},children:[" ",e.jsx(Ee,{})," "]})}),e.jsxs(D,{variant:"h5",gutterBottom:!0,align:"center",sx:{mt:2},children:["Transazione Manuale - Cassa ",s?.name]}),e.jsxs(i,{container:!0,spacing:2,sx:{mt:2},children:[e.jsxs(X,{fullWidth:!0,children:[e.jsx(te,{children:"Tipo"}),e.jsxs(re,{variant:"outlined",value:c.type,label:"Tipo",onChange:p=>_({...c,type:p.target.value}),children:[e.jsx(q,{value:"deposit",children:"Deposito"}),e.jsx(q,{value:"withdrawal",children:"Prelievo"})]})]}),e.jsx(F,{margin:"dense",label:"Importo",type:"number",fullWidth:!0,value:c.amount,slotProps:{htmlInput:{min:"0.01",step:"0.01"}},onChange:p=>_({...c,amount:p.target.value})}),e.jsx(F,{margin:"dense",label:"Descrizione",type:"text",fullWidth:!0,multiline:!0,rows:2,value:c.description,onChange:p=>_({...c,description:p.target.value})})]}),e.jsxs(y,{mt:2,children:[e.jsx(H,{fullWidth:!0,onClick:u,children:"Annulla"}),e.jsx(H,{fullWidth:!0,variant:"contained",color:"primary",type:"submit",disabled:!c.amount||c.amount<=0,children:"Conferma"})]})]})})}const Os={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"top",mt:4,minHeight:"100vh"};function Ws(){const{user:h}=Ae(),[u,s]=a.useState([]),[n,l]=a.useState(null),[c,_]=a.useState(!1),[o,f]=a.useState(""),[p,x]=a.useState(!1),[w,E]=a.useState(null),[t,z]=a.useState(!1),T=h?.permissions.includes("change_account");a.useEffect(()=>{r().then()},[h]);const r=async()=>{try{const S=await G("GET","/accounts/");if(S.ok){const L=await S.json();s(L.results)}else{const L=await Q(S);E({message:`Errore durante il recupero delle casse: ${L}`,state:"error"})}}catch(S){E({message:`Errore generale: ${S}`,state:"error"})}},m=(S,L)=>{l(S),f(L),_(!0)},j=async()=>{try{const S=await G("PATCH",`/account/${n.id}/`,{status:o==="open"?"open":"closed"});S.ok?(console.log(`Account ${o}ed successfully.`),r().then(),E({message:`Cassa ${o==="open"?"aperta":"chiusa"} con successo!`,state:"success"})):(console.error(`Failed to ${o} account.`),E({message:`Errore account: ${S.statusText}`,state:"error"}))}catch(S){console.error(`Error ${o}ing account:`,S),E({message:`Errore generale: ${S}`,state:"error"})}finally{_(!1)}};return e.jsxs(y,{children:[e.jsx(Me,{}),e.jsx(y,{sx:{width:"100%",maxWidth:"90%",mx:"auto",mt:0},children:e.jsxs(qe,{elevation:3,sx:{p:2,mb:0,borderRadius:5},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>x(S=>!S),children:[e.jsx(D,{variant:"h5",sx:{flexGrow:1,fontWeight:600},children:"Casse"}),e.jsx(U,{children:p?e.jsx(wa,{}):e.jsx(Ea,{})})]}),e.jsx(Ta,{in:p,timeout:"auto",unmountOnExit:!0,children:e.jsx(y,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:2,justifyContent:"center"},children:u.map(S=>e.jsxs(Ke,{sx:{flex:"1 1 320px",minWidth:320,maxWidth:400,display:"flex",alignItems:"center",boxShadow:4,borderRadius:2,m:1},children:[e.jsxs(Ia,{sx:{flex:1},children:[e.jsx(D,{variant:"h6",sx:{fontWeight:700,color:"#2d3a4b"},children:S.name}),T&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{variant:"body1",sx:{color:"#3e5060"},children:[ue.balance,": ",e.jsxs("b",{children:["€",S.balance]})]}),e.jsxs(D,{variant:"body2",sx:{color:"#607d8b"},children:[ue.changed_by,": ",S.changed_by.name||"N/A"]})]})]}),T?e.jsxs(rs,{sx:{pr:2,flexDirection:"column",alignItems:"flex-end"},children:[S.status==="closed"&&e.jsx(H,{variant:"contained",color:"success",onClick:()=>m(S,"open"),sx:{minWidth:120,fontWeight:600},children:"Apri Cassa"}),S.status==="open"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{variant:"contained",color:"error",onClick:()=>m(S,"close"),sx:{minWidth:120,fontWeight:600,mb:1},children:"Chiudi Cassa"}),e.jsx(H,{variant:"contained",color:"primary",onClick:()=>{l(S),z(!0)},sx:{minWidth:120,fontWeight:600},children:"Deposita/Preleva"})]})]}):e.jsx(D,{variant:"h7",style:{color:S.status==="closed"?"red":"green",fontWeight:"bold",padding:"20px"},children:S.status==="closed"?"Cassa Chiusa":"Cassa Aperta"})]},S.id))})})]})}),e.jsxs(y,{sx:Os,children:[e.jsx(D,{variant:"h3",gutterBottom:!0,children:"Sistema di Gestione"}),e.jsx("img",{src:oa,alt:"ESN Polimi Logo",style:{height:"25vh",marginTop:"2px"}}),e.jsxs("h1",{children:["Benvenuto, ",h?h.profile.name:"Sir","!"]})]}),e.jsx(ia,{open:c,message:`Confermi la presenza di €${n?.balance} nella cassa "${n?.name}" prima di ${o==="open"?"aprirla":"chiuderla"}?`,onConfirm:j,onClose:()=>_(!1)}),e.jsx(Ra,{open:t,onClose:()=>z(!1),account:n,onSuccess:(S,L)=>E({message:S,state:L||"success"})}),w&&e.jsx(ve,{message:w.message,state:w.state})]})}function $s({limit:h=5}){const[u,s]=a.useState([]),[n,l]=a.useState(!0);a.useEffect(()=>{(async()=>{l(!0);try{const f=await G("GET","/accounts/");if(f.ok){const p=await f.json();s(p.results)}}catch{}finally{l(!1)}})().then()},[]);const c=a.useMemo(()=>[{accessorKey:"name",header:ue.name,size:100},{accessorKey:"balance",header:ue.balance,size:100,Cell:({cell:o})=>e.jsx(y,{children:o.getValue()!==null?e.jsx(ae,{label:`€${o.getValue()}`,color:"primary"}):e.jsx(ae,{label:"N/A",color:"warning"})})},{accessorKey:"status",header:ue.status,size:100,Cell:({cell:o})=>e.jsx(y,{children:o.getValue()!==null?e.jsx(ae,{label:o.getValue()==="open"?"Aperta":"Chiusa",color:o.getValue()==="open"?"success":"error"}):e.jsx(ae,{label:"Stato ignoto",color:"warning"})})}],[]),_=ke({columns:c,data:u.slice(0,h),enableKeyboardShortcuts:!1,enableColumnActions:!1,enableColumnFilters:!1,enablePagination:!1,enableSorting:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!1},paginationDisplayMode:"default",muiTableBodyRowProps:{hover:!1},localization:De});return n?e.jsx(fe,{}):e.jsx(Pa,{table:_})}const Bs={subscription:{label:se.tran_type.subscription,color:"primary"},esncard:{label:se.tran_type.esncard,color:"secondary"},deposit:{label:se.tran_type.deposit,color:"success"},withdrawal:{label:se.tran_type.withdrawal,color:"error"}};function Gs({limit:h=5}){const[u,s]=a.useState([]),[n,l]=a.useState(!0);a.useEffect(()=>{(async()=>{l(!0);try{const f=await G("GET","/transactions/");if(f.ok){const p=await f.json();s(p.results),console.log("Transactions data:",p.results)}}catch{}finally{l(!1)}})().then()},[]);const c=a.useMemo(()=>[{accessorKey:"created_at",header:se.date,size:100,Cell:({cell:o})=>{const f=new Date(o.getValue());return e.jsx(y,{children:new Intl.DateTimeFormat("it-IT",{dateStyle:"medium",timeStyle:"short"}).format(f)})}},{accessorKey:"type",header:se.type,size:100,Cell:({cell:o})=>{const f=o.getValue(),p=Bs[f]||{label:"Sconosciuto",color:"default"};return e.jsx(ae,{label:p.label,color:p.color,variant:"outlined"})}},{accessorKey:"executor.name",header:se.executor,size:150},{accessorKey:"account.name",header:se.account,size:100,Cell:({cell:o})=>e.jsx(y,{component:"span",fontWeight:"bold",children:o.getValue()})},{accessorKey:"amount",header:se.amount,size:100,Cell:({cell:o})=>e.jsx(y,{children:o.getValue()!==null?e.jsx(ae,{label:`€${o.getValue()}`,color:"primary"}):e.jsx(ae,{label:"N/A",color:"warning"})})}],[]),_=ke({columns:c,data:u.slice(0,h),enableKeyboardShortcuts:!1,enableColumnActions:!1,enableColumnFilters:!1,enablePagination:!1,enableSorting:!0,initialState:{showColumnFilters:!1,showGlobalFilter:!1,sorting:[{id:"created_at",desc:!0}]},paginationDisplayMode:"default",muiTableBodyRowProps:{hover:!1},localization:De});return n?e.jsx(fe,{}):e.jsx(Pa,{table:_})}function Ks(){const h=Ie();return e.jsxs(y,{children:[e.jsx(Me,{}),e.jsxs(y,{sx:{mx:"5%",mt:0},children:[e.jsx(D,{variant:"h4",sx:{mb:3},children:"Dashboard Tesoreria"}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{size:{xs:12,md:4},children:e.jsxs(qe,{elevation:3,sx:{p:2},children:[e.jsx(D,{variant:"h6",sx:{mb:2},children:"Casse"}),e.jsx($s,{limit:5}),e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(H,{variant:"outlined",size:"small",onClick:()=>h("/treasury/accounts_list/"),children:"Gestisci Casse"})})]})}),e.jsx(i,{size:{xs:12,md:8},children:e.jsxs(qe,{elevation:3,sx:{p:2},children:[e.jsx(D,{variant:"h6",sx:{mb:2},children:"Ultime Transazioni"}),e.jsx(Gs,{limit:3}),e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(H,{variant:"outlined",size:"small",onClick:()=>h("/treasury/transactions_list/"),children:"Gestisci Movimenti"})})]})})]})]})]})}function qs({open:h,onClose:u,account:s=null}){const n=s!==null,[l,c]=a.useState(!0),[_,o]=a.useState(null),[f,p]=a.useState({name:"",visible_to_groups:[]}),[x,w]=a.useState({name:[!1,""],visible_to_groups:[!1,""]}),[E,t]=a.useState([]);a.useEffect(()=>{(async()=>{try{const S=await G("GET","/groups/");if(S.ok){const L=await S.json();t(L)}else{const L=await Q(S);o({message:`Errore nel recupero dei gruppi: ${L}`,state:"error"})}}catch(S){o({message:`Errore nel recupero dei gruppi: ${S}`,state:"error"})}})().then()},[]),a.useEffect(()=>{p(n&&s?{name:s.name||"",visible_to_groups:s.visible_to_groups?.map(j=>j.id)||[]}:{name:"",visible_to_groups:[]}),c(!1)},[n,s]);const z=j=>{const{name:S,value:L}=j.target;p({...f,[S]:L})},T=j=>{p({...f,visible_to_groups:j.target.value})},r=async j=>{j.preventDefault();const S={...x};if(f.name.trim()?S.name=[!1,""]:S.name=[!0,"Il nome è obbligatorio"],f.visible_to_groups.length===0?S.visible_to_groups=[!0,"Seleziona almeno un gruppo"]:S.visible_to_groups=[!1,""],w(S),!(S.name[0]||S.visible_to_groups[0])){c(!0);try{const L={name:f.name,visible_to_groups:f.visible_to_groups};let A;if(n&&s?A=await G("PATCH",`/account/${s.id}/`,L):A=await G("POST","/account/",L),A.ok)u(!0);else{const V=await Q(A);o({message:`Errore ${n?"modifica":"creazione"} cassa: ${V}`,state:"error"})}}catch(L){const A=await Q(L);o({message:`Errore generale: ${A}`,state:"error"})}finally{c(!1)}}},m=()=>{u(!1)};return e.jsx(Pe,{open:h,onClose:m,children:e.jsx(y,{sx:Oe,component:"form",onSubmit:r,noValidate:!0,children:l?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(U,{onClick:m,sx:{minWidth:0},children:e.jsx(Ee,{})})}),e.jsx(D,{variant:"h5",gutterBottom:!0,align:"center",sx:{mb:2},children:n?`Modifica Cassa - ${s?.name}`:"Crea Cassa"}),_&&e.jsx(ve,{message:_.message,state:_.state}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{size:{xs:12},children:e.jsx(F,{fullWidth:!0,label:ue.name,name:"name",value:f.name,onChange:z,required:!0,error:x.name[0],helperText:x.name[0]?x.name[1]:""})}),e.jsx(i,{size:{xs:12},children:e.jsxs(X,{fullWidth:!0,error:x.visible_to_groups[0],children:[e.jsx(te,{id:"groups-label",children:ue.visible_to_groups}),e.jsx(re,{variant:"outlined",labelId:"groups-label",multiple:!0,value:f.visible_to_groups,onChange:T,input:e.jsx(Ce,{label:ue.visible_to_groups}),renderValue:j=>e.jsx(y,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:j.map(S=>{const L=E.find(A=>A.id===S);return e.jsx(ae,{label:L?L.name:S},S)})}),children:E.map(j=>e.jsx(q,{value:j.id,children:j.name},j.id))}),x.visible_to_groups[0]&&e.jsx(Ue,{children:x.visible_to_groups[1]})]})})]}),e.jsx(y,{mt:2,children:e.jsx(H,{fullWidth:!0,variant:"contained",color:"primary",type:"submit",children:n?"Salva Modifiche":"Crea"})})]})})})}function Vs(){const[h,u]=a.useState([]),[s,n]=a.useState(!0),[l,c]=a.useState(!1),_=Ie(),[o,f]=a.useState(null),[p,x]=a.useState(null),[w,E]=a.useState(!1);a.useEffect(()=>{t().then()},[]);const t=async()=>{n(!0);try{const m=await G("GET","/accounts/");if(m.ok){const j=await m.json();u(j.results),console.log("Account List Data: ",j.results)}else{const j=await Q(m);f({message:`Errore: ${j}`,state:"error"})}}catch(m){f({message:`Errore generale: ${m}`,state:"error"})}finally{n(!1)}},z=a.useMemo(()=>[{accessorKey:"id",header:ue.id,size:50},{accessorKey:"name",header:ue.name,size:150},{accessorKey:"changed_by.name",header:ue.changed_by,size:150},{accessorKey:"balance",header:ue.balance,size:100,Cell:({cell:m})=>e.jsx(y,{children:m.getValue()!==null?e.jsx(ae,{label:`€${m.getValue()}`,color:"primary"}):e.jsx(ae,{label:"N/A",color:"warning"})})},{accessorKey:"status",header:ue.status,size:150,Cell:({cell:m})=>e.jsx(y,{sx:{},children:m.getValue()!==null?e.jsx(ae,{label:m.getValue()==="open"?"Aperta":"Chiusa",color:m.getValue()==="open"?"success":"error"}):e.jsx(ae,{label:"N/A",color:"warning"})})},{accessorKey:"visible_to_groups",header:ue.visible_to_groups,size:150,Cell:({cell:m})=>e.jsx(y,{sx:{},children:m.getValue()!==null?m.getValue().map(j=>e.jsx(ae,{label:j.name,color:"grey",sx:{mr:1}},j.id)):e.jsx(ae,{label:"N/A",color:"warning"})})},{header:"Azioni",size:150,Cell:({row:m})=>e.jsxs(y,{sx:{display:"flex",gap:1},children:[e.jsx(U,{color:"primary",onClick:()=>{x(m.original),c(!0)},children:e.jsx(Ye,{})}),e.jsx(H,{variant:"contained",color:"primary",onClick:()=>{x(m.original),E(!0)},children:"Deposita/Preleva"})]})}],[]),T=ke({columns:z,data:h,enablePagination:!1,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableColumnPinning:!1,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableRowPinning:!1,enableExpandAll:!1,initialState:{showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},columnVisibility:{id:!1,name:!0,changed_by:!0,status:!0,balance:!0}},positionToolbarAlertBanner:"bottom",localization:De,muiTableBodyRowProps:()=>({sx:{cursor:"default"}}),renderTopToolbarCustomActions:()=>e.jsx(y,{sx:{display:"flex",flexDirection:"row"},children:e.jsx(H,{variant:"contained",onClick:()=>c(!0),sx:{width:"150px"},children:"Nuova Cassa"})})}),r=async m=>{m&&(f({message:"Cassa creata con successo!",state:"success"}),await t()),x(null),c(!1)};return e.jsxs(y,{children:[e.jsx(Me,{}),l&&e.jsx(qs,{open:l,onClose:r,account:p}),e.jsx(Ra,{open:w,onClose:()=>E(!1),account:p,onSuccess:(m,j)=>f({message:m,state:j||"success"})}),e.jsx(y,{sx:{mx:"5%"},children:s?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(U,{onClick:()=>{_(-1)},sx:{mr:2},children:e.jsx(ra,{})}),e.jsx(ns,{sx:{marginRight:"10px"}}),e.jsx(D,{variant:"h4",children:"Lista Casse"})]}),e.jsx(Fe,{table:T})]})}),o&&e.jsx(ve,{message:o.message,state:o.state})]})}function Fa({value:h,onChange:u,readOnly:s=!1}){const n=a.useRef(null),l=a.useRef(null);return a.useEffect(()=>{if(n.current&&!l.current){const c=s?{toolbar:!1}:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["link"],["clean"]]};l.current=new ws(n.current,{theme:"snow",readOnly:s,modules:c}),l.current.on("text-change",()=>{u&&u(l.current.root.innerHTML)}),h&&(l.current.root.innerHTML=h)}},[h,u,s]),e.jsx("div",{ref:n})}function Na({open:h,event:u,isEdit:s,onClose:n}){const[l,c]=a.useState(!0),_=s?"Modifica Evento - "+u.name:"Crea Evento",[o,f]=a.useState(null),[p,x]=a.useState(!1),[w,E]=a.useState({id:"",name:"",date:K(),description:`<h3>Descrizione</h3>    <p>Ecco un <a href="https://www.italia.it" target="_blank">link all'Italia</a>.</p>    <blockquote>Citazione elegante.</blockquote>    <p style="text-align: center;">Adios.</p>`,cost:"",subscription_start_date:K().hour(12).minute(0),subscription_end_date:K().hour(24).minute(0),lists:[{id:"",name:"Main List",capacity:""}]}),[t,z]=xe.useState({name:[!1,""],date:[!1,""],description:[!1,""],cost:[!1,""],subscription_start_date:[!1,""],subscription_end_date:[!1,""],lists:[!1,""],listItems:[]});a.useEffect(()=>{s&&(console.log("Setting form data: ",u),E(u),console.log("#Subsciptions: ",u.subscriptions.length),x(u.subscriptions.length>0)),c(!1)},[]);const T=C=>K(C).format("YYYY-MM-DD"),r=C=>K(C).toISOString(),m=C=>{C&&K(C).isBefore(K(),"day")||E({...w,date:C})},j=C=>{w.subscription_end_date&&K(C).isAfter(K(w.subscription_end_date))?E({...w,subscription_start_date:C,subscription_end_date:K(C).add(1,"day")}):E({...w,subscription_start_date:C})},S=C=>{if(C){const $=K(w.subscription_start_date),M=K(C),d=K();M.isBefore($)?C=$:M.isBefore(d)&&(C=d)}E({...w,subscription_end_date:C})},L=C=>({name:C.name,date:T(C.date),description:C.description,subscription_start_date:r(C.subscription_start_date),subscription_end_date:r(C.subscription_end_date),cost:Number(C.cost).toFixed(2),lists:C.lists.map($=>({id:$.id,name:$.name,capacity:Math.floor(Number($.capacity))}))}),A=()=>{window.scrollTo({top:0,behavior:"smooth"})},V=C=>{const{name:$,value:M,type:d,checked:v}=C.target;E({...w,[$]:d==="checkbox"?v:M})},Y=()=>{E({...w,lists:[...w.lists,{id:"",name:"",capacity:""}]})},P=(C,$)=>{const{name:M,value:d}=$.target,v=w.lists.map((g,R)=>R===C?{...g,[M]:d}:g);E({...w,lists:v})},I=C=>{E({...w,lists:w.lists.filter(($,M)=>M!==C)})},b=async C=>{C.preventDefault();const $=w.lists.map(d=>({name:!d.name.trim(),capacity:d.capacity===""})),M=$.some(d=>d.name||d.capacity);if(z({...t,listItems:$,lists:[M]}),M){f({message:"Errore campi Liste",state:"error"}),A();return}try{const d=s?await G("PATCH",`/event/${w.id}/`,L(w)):await G("POST","/event/",L(w));if(d.ok)n(!0);else{const v=await Q(d);f({message:`Errore ${s?"modifica":"creazione"} evento: ${v}`,state:"error"}),A()}}catch(d){console.error("Error creating/updating event:",d);const v=await Q(d);f({message:`Errore generale: ${v}`,state:"error"}),A()}},N=()=>{n(!1)};return e.jsx(Pe,{open:h,onClose:N,children:e.jsx(y,{sx:Ma,component:"form",onSubmit:b,noValidate:!1,children:l?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(U,{onClick:()=>n(!1),sx:{minWidth:0},children:e.jsx(Ee,{})})}),e.jsx(D,{variant:"h5",gutterBottom:!0,sx:{mb:2},align:"center",children:_}),o&&e.jsx(Ne,{message:o.message,state:o.state}),s&&p&&e.jsx(y,{sx:{mb:2,p:1,bgcolor:"#fff3e0",borderRadius:1},children:e.jsxs(D,{variant:"body2",color:"warning.main",children:[e.jsx(os,{fontSize:"small",sx:{verticalAlign:"middle",mr:1}}),"Alcuni campi non sono modificabili perché ci sono già iscrizioni. Rimuovi tutte le iscrizioni per abilitare la modifica."]})}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{size:{xs:12,md:6},children:e.jsx(F,{fullWidth:!0,label:he.name,name:"name",value:w.name,onChange:V,required:!0,error:t.name[0]})}),e.jsx(i,{size:{xs:12,md:6},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(je,{label:he.date,value:w.date,onChange:m,minDate:s?null:K(),renderInput:C=>e.jsx(F,{...C,fullWidth:!0,required:!0}),required:!0,error:t.date[0]})})}),e.jsx(i,{size:{xs:12,md:3},children:e.jsx(Ge,{title:s&&p?"Non modificabile con iscrizioni esistenti":"",children:e.jsxs("div",{children:[" ",e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(ua,{label:he.subscription_start_date,value:w.subscription_start_date||null,onChange:j,minDate:s?null:K(),slotProps:{textField:{fullWidth:!0,required:!0}},disabled:s&&p,required:!0,error:t.subscription_start_date[0]})})]})})}),e.jsx(i,{size:{xs:12,md:3},children:e.jsx(me,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(ua,{label:he.subscription_end_date,value:w.subscription_end_date||null,onChange:S,minDate:K().isAfter(w.subscription_start_date)?K():w.subscription_start_date||K(),slotProps:{textField:{fullWidth:!0,required:!0}},required:!0,error:t.subscription_start_date[0]})})}),e.jsx(i,{size:{xs:12,md:3},children:e.jsx(Ge,{title:s&&p?"Non modificabile con iscrizioni esistenti":"",children:e.jsxs("div",{children:[" ",e.jsx(F,{fullWidth:!0,label:he.cost,name:"cost",type:"number",slotProps:{htmlInput:{min:"0",step:"0.01"}},value:w.cost,onChange:V,placeholder:"Inserisci 0 se gratuito",required:!0,error:t.cost[0],disabled:s&&p})]})})})]}),e.jsxs(i,{size:{xs:12},"data-color-mode":"light",children:[e.jsx(D,{variant:"h6",component:"div",children:he.description}),e.jsx(Fa,{value:w.description,onChange:C=>{E({...w,description:C})}})]}),e.jsxs(y,{my:2,children:[e.jsxs(i,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(i,{children:e.jsx(D,{variant:"h6",gutterBottom:!0,children:"Liste"})}),e.jsx(i,{children:e.jsx(U,{onClick:Y,children:e.jsx(is,{})})})]}),w.lists.map((C,$)=>e.jsxs(i,{container:!0,spacing:2,alignItems:"center",mb:2,children:[e.jsx(i,{children:e.jsx(F,{label:he.list_name,name:"name",value:C.name,onChange:M=>P($,M),required:!0,error:t.listItems[$]?.name,helperText:t.listItems[$]?.name?"Il nome è obbligatorio":""})}),e.jsx(i,{children:e.jsx(F,{label:he.list_capacity,name:"capacity",type:"number",value:C.capacity,slotProps:{htmlInput:{min:"0",step:"1"}},onChange:M=>P($,M),placeholder:"Inserisci 0 se illimitata",required:!0,error:t.listItems[$]?.capacity,helperText:t.listItems[$]?.capacity?"La capacità è obbligatoria":""})}),e.jsx(i,{size:{xs:2},children:e.jsx(U,{onClick:()=>I($),children:e.jsx(_a,{})})})]},$))]}),e.jsx(y,{mt:2,children:e.jsx(H,{variant:"contained",color:"primary",type:"submit",children:s?"Salva Modifiche":"Crea"})})]})})})}const xa=[{value:"open",label:"Iscrizioni aperte"},{value:"not_yet",label:"Non ancora aperte"},{value:"closed",label:"Iscrizioni chiuse"}];function Hs(){const[h,u]=a.useState([]),[s,n]=a.useState(!0),[l,c]=a.useState(!1),_=Ie(),[o,f]=a.useState(null),[p,x]=a.useState({pageIndex:0,pageSize:10}),[w,E]=a.useState(0),[t,z]=a.useState(""),[T,r]=a.useState(""),[m,j]=a.useState({subscriptionStatus:[],dateFrom:null,dateTo:null}),[S,L]=a.useState(!1),A=a.useRef(null);a.useEffect(()=>{let M=!1;return(async()=>{L(!0);try{const v=new URLSearchParams;v.append("page",p.pageIndex+1),v.append("page_size",p.pageSize),T&&v.append("search",T),m.subscriptionStatus.length&&m.subscriptionStatus.forEach(R=>v.append("subscription_status",R)),m.dateFrom&&v.append("dateFrom",m.dateFrom.toISOString()),m.dateTo&&v.append("dateTo",m.dateTo.toISOString());const g=await G("GET",`/events/?${v.toString()}`);if(g.ok){const R=await g.json();M||(E(R.count||0),u(R.results))}else{const R=await Q(g);f({message:`Errore: ${R}`,state:"error"})}}catch(v){f({message:`Errore generale: ${v}`,state:"error"})}finally{L(!1)}})().then(),()=>{M=!0}},[p.pageIndex,p.pageSize,m,T]);const V=a.useMemo(()=>[{accessorKey:"id",header:he.id,size:50},{accessorKey:"name",header:he.name,size:150},{accessorKey:"date",header:he.date,size:150},{accessorKey:"cost",header:he.cost,size:150},{accessorKey:"subscription_start_date",header:he.subscription_date_status,size:150,Cell:({row:M})=>{const d=K(),v=M.original.subscription_start_date?K(M.original.subscription_start_date):null,g=M.original.subscription_end_date?K(M.original.subscription_end_date):null;let R="Non disponibile",ne="error";return v&&g&&(d.isAfter(v)&&d.isBefore(g)?(R="Iscrizioni aperte",ne="success"):d.isBefore(v)?(R="Iscrizioni non ancora aperte",ne="warning"):d.isAfter(g)&&(R="Iscrizioni chiuse",ne="error")),e.jsx(ae,{label:R,color:ne})}}],[]),Y=ke({columns:V,data:h,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableColumnPinning:!0,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableRowPinning:!0,enableExpandAll:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},columnVisibility:{id:!0,name:!0,date:!0,cost:!0}},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",enableGlobalFilter:!1,muiPaginationProps:{color:"secondary",rowsPerPageOptions:[10,20,30],shape:"rounded",variant:"outlined"},manualPagination:!0,rowCount:w,onPaginationChange:x,state:{pagination:p},localization:De,muiTableBodyRowProps:({row:M})=>({onClick:()=>{_("/event/"+M.original.id,{state:{event:M.original}})}}),renderTopToolbarCustomActions:()=>e.jsx(y,{sx:{display:"flex",flexDirection:"row"},children:e.jsx(H,{variant:"contained",onClick:()=>c(!0),sx:{width:"150px"},children:"Crea"})})}),P=()=>{r(t),x(M=>({...M,pageIndex:0}))},I=()=>{z(""),r(""),x(M=>({...M,pageIndex:0})),A.current&&A.current.focus()},b=M=>{const{name:d,value:v}=M.target;j(g=>({...g,[d]:typeof v=="string"?v.split(","):v}))},N=(M,d)=>{j(v=>{let g={...v,[M]:d};return M==="dateFrom"&&g.dateTo&&d&&d>g.dateTo&&(g.dateTo=d),M==="dateTo"&&g.dateFrom&&d&&d<g.dateFrom&&(g.dateFrom=d),g})},C=()=>{j(M=>({...M,dateFrom:null,dateTo:null}))},$=async M=>{M&&(f({message:"Evento creato con successo!",state:"success"}),setAppliedFilters(m)),c(!1)};return e.jsxs(y,{children:[e.jsx(Me,{}),l&&e.jsx(Na,{open:l,onClose:$,isEdit:!1}),e.jsxs(y,{sx:{mx:"5%"},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(ta,{sx:{marginRight:"10px"}}),e.jsx(D,{variant:"h4",children:"Lista Eventi"})]}),e.jsxs(i,{container:!0,spacing:2,sx:{mb:2},alignItems:"center",justifyContent:"flex-end",children:[e.jsx(i,{size:{xs:12,sm:2},children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(te,{id:"subscription-status-label",children:"Stato iscrizione"}),e.jsx(re,{labelId:"subscription-status-label",name:"subscriptionStatus",multiple:!0,value:m.subscriptionStatus,onChange:b,input:e.jsx(Ce,{label:"Stato iscrizione"}),variant:"outlined",renderValue:M=>xa.filter(d=>M.includes(d.value)).map(d=>d.label).join(", "),children:xa.map(M=>e.jsx(q,{value:M.value,children:M.label},M.value))})]})}),e.jsx(i,{size:{xs:12,sm:2},children:e.jsx(X,{fullWidth:!0,children:e.jsx(me,{dateAdapter:Ve,adapterLocale:He,children:e.jsx(je,{label:"Inizio Iscrizioni",value:m.dateFrom,maxDate:m.dateTo||void 0,onChange:M=>N("dateFrom",M),format:"d MMM yyyy"})})})}),e.jsx(i,{size:{xs:12,sm:2},children:e.jsx(X,{fullWidth:!0,children:e.jsx(me,{dateAdapter:Ve,adapterLocale:He,children:e.jsx(je,{label:"Fine Iscrizioni",value:m.dateTo,minDate:m.dateFrom||void 0,onChange:M=>N("dateTo",M),format:"d MMM yyyy"})})})}),(m.dateFrom||m.dateTo)&&e.jsx(i,{size:{xs:12,sm:2},sx:{display:"flex",alignItems:"center"},children:e.jsx(H,{variant:"outlined",color:"secondary",startIcon:e.jsx($e,{}),onClick:C,sx:{height:"100%",minWidth:0,px:1,mr:1},children:"Azzera date"})}),e.jsx(i,{size:{xs:12,sm:2},sx:{ml:"auto"},children:e.jsx(Ce,{inputRef:A,size:"small",placeholder:"Cerca",value:t,onChange:M=>z(M.target.value),onKeyDown:M=>{M.key==="Enter"&&P()},endAdornment:t&&T===t?e.jsx(U,{"aria-label":"clear",onClick:I,edge:"end",children:e.jsx($e,{})}):e.jsx(U,{"aria-label":"search",onClick:P,edge:"end",children:e.jsx(sa,{})})})})]}),S?e.jsx(fe,{}):e.jsx(Fe,{table:Y}),o&&e.jsx(ve,{message:o.message,state:o.state})]})]})}function Oa({value:h,onChange:u,error:s,helperText:n,label:l="Cerca profilo",required:c=!1,disabled:_=!1,valid_only:o=!0,esner_only:f=!1}){const[p,x]=a.useState([]),[w,E]=a.useState(""),[t,z]=a.useState(!1);a.useEffect(()=>{if(w.length<3){x([]);return}z(!0);const r=setTimeout(async()=>{try{const m=await G("GET",`/profiles/search/?q=${encodeURIComponent(w)}&valid_only=${o}&esner_only=${f}`);if(m.ok){const j=await m.json();x(j.results||[])}}finally{z(!1)}},300);return()=>clearTimeout(r)},[w]);const T=(r,m)=>{const{key:j,...S}=r,L=m.latest_esncard&&m.latest_esncard.number,A=L&&!m.latest_esncard.is_valid;return e.jsx("li",{...S,children:e.jsxs(i,{container:!0,spacing:1,sx:{width:"100%"},children:[e.jsx(i,{size:{xs:4},children:e.jsxs(D,{children:[m.name," ",m.surname]})}),e.jsx(i,{size:{xs:4},children:e.jsx(D,{component:"span",sx:{color:L?A?"error.main":"text.primary":"error.main"},children:L?A?`${m.latest_esncard.number} (Scaduta)`:m.latest_esncard.number:"No ESNcard"})}),e.jsx(i,{size:{xs:4},children:e.jsx(D,{component:"span",sx:{color:m.is_esner?"primary.main":"success.main",fontWeight:"bold",textAlign:"right",display:"block"},children:m.is_esner?"ESNer":"Erasmus"})})]})},j)};return e.jsx(ls,{options:p,loading:t,getOptionLabel:r=>`${r.name}${r.surname?` ${r.surname}`:""}${r.latest_esncard?` (${r.latest_esncard.number})`:""}`,renderOption:T,value:h,onChange:u,onInputChange:(r,m)=>E(m),renderInput:r=>e.jsx(F,{...r,label:l,required:c,error:s,helperText:n}),noOptionsText:"Nessun profilo trovato",loadingText:"Caricamento...",disabled:_})}function Ys({open:h,onClose:u,event:s,listId:n,subscription:l,isEdit:c}){const[_,o]=a.useState(!0),[f,p]=a.useState(null),[x,w]=a.useState([]),[E,t]=a.useState({open:!1,action:null,message:""}),z=c?"Modifica Iscrizione":"Iscrizione Evento",T=c&&l.account_id||null,[r,m]=a.useState({id:"",account_id:"",account_name:"",profile_id:"",profile_name:"",status:"pending",list_id:n||"",list_name:s.lists.find(d=>d.id===n)?.name||"Lista non trovata",notes:""}),[j,S]=a.useState({account_id:[!1,""],account_name:[!1,""],profile_id:[!1,""],profile_name:[!1,""],status:[!1,""],list_id:[!1,""],list_name:[!1,""],notes:[!1,""]}),L=a.useMemo(()=>[{field:"profile_id",value:r?.profile_id,message:"Selezionare un Profilo"},...r?.status==="paid"?[{field:"account_id",value:r?.account_id,message:"Selezionare una Cassa"}]:[]],[r]),[A,V]=a.useState(c?l.status:"pending");a.useEffect(()=>{c&&(console.log("Setting Subscription:",l),m(l),V(l.status)),o(!1),Y().then()},[c]);const Y=async()=>{try{const d=await G("GET","/accounts/");if(d.ok){const v=await d.json();w(v.results)}else{const v=await Q(d);p({message:`Errore durante il recupero delle casse: ${v}`,state:"error"})}}catch(d){p({message:`Errore generale: ${d}`,state:"error"})}},P=()=>{const d={};return Object.keys(j).forEach(v=>{d[v]=[!1,""]}),S(d),d},I=async()=>{let d=!1;const v=P();if(L.forEach(g=>{g.value||(v[g.field]=[!0,g.message],d=!0)}),d){S(v);return}if(r.status==="paid"&&(!c||A!=="paid")||c&&A==="paid"&&r.status!=="paid"){let g="";r.status==="paid"&&(!c||A!=="paid")?g="Confermi di registrare un pagamento di €"+s.cost+" per questa iscrizione?":c&&A==="paid"&&r.status!=="paid"&&(g="Confermi di annullare un pagamento di €"+s.cost+" per questa iscrizione?"),t({open:!0,action:()=>b(),message:g});return}if(r.status==="paid"&&c&&A==="paid"&&r.account_id!==T){t({open:!0,action:()=>b(),message:"Confermi di voler cambiare la cassa associata a questo pagamento? Verranno spostati €"+s.cost+" da "+r.account_name+" a "+x.find(g=>g.id===r.account_id)?.name+"."});return}await b()},b=async()=>{t({open:!1,action:null,message:""});try{const d=await G(c?"PATCH":"POST",`/subscription/${c?r.id+"/":""}`,{profile:r.profile_id,event:s.id,list:r.list_id,account_id:r.account_id||T,notes:r.notes,status:r.status});if(d.ok)u(!0,(c?"Modifica Iscrizione":"Iscrizione")+" completata con successo!");else{const v=await Q(d);p({message:`Errore: ${v}`,state:"error"})}}catch(d){p({message:`Errore generale: ${d}`,state:"error"})}},N=async()=>{if(r.status==="paid"){t({open:!0,action:()=>C(),message:"Confermi di voler eliminare un pagamento di €"+s.cost+" per questa iscrizione?"});return}await C()},C=async()=>{if(t({open:!1,action:null,message:""}),!(!c||!r.id))try{const d=await G("DELETE",`/subscription/${r.id}/`);if(d.ok)u(!0,"Eliminazione avvenuta con successo");else{const v=await Q(d);p({message:`Errore eliminazione: ${v}`,state:"error"})}}catch(d){p({message:`Errore generale: ${d}`,state:"error"})}},$=d=>{m({...r,[d.target.name]:d.target.value})},M=()=>{m({...r,status:r.status==="paid"?"pending":"paid",...r.status==="paid"?{account_id:""}:{}})};return e.jsx(Pe,{open:h,onClose:()=>{u(!1)},"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(y,{sx:Oe,children:[_?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(U,{onClick:()=>u(!1),sx:{minWidth:0},children:e.jsx(Ee,{})})}),e.jsx(D,{variant:"h4",component:"h2",gutterBottom:!0,children:z}),e.jsx(We,{sx:{mb:2}}),e.jsxs(D,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Nome Evento:"})," ",s.name]}),e.jsxs(D,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Lista:"})," ",r.list_name]}),e.jsxs(D,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Importo:"})," ",s.cost,"€"]}),e.jsxs(i,{container:!0,spacing:2,direction:"column",children:[e.jsx(i,{size:{xs:12},sx:{mt:2},children:e.jsx(Oa,{value:r.profile_id?{id:r.profile_id,name:r.profile_name}:null,onChange:(d,v)=>{m({...r,profile_id:v?.id,profile_name:v?`${v.name} ${v.surname}`:""})},error:j.profile_id&&j.profile_id[0],helperText:j.profile_id&&j.profile_id[1]||"Cerca per nome o numero ESNcard",label:c?r.profile_name:"Cerca profilo",required:!0,disabled:c})}),e.jsx(i,{size:{xs:12},children:e.jsxs(qe,{elevation:1,sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",bgcolor:r.status==="paid"?"#e3f2fd":"inherit",transition:"background-color 0.3s"},children:[e.jsx(D,{variant:"subtitle1",children:"Stato Pagamento"}),e.jsx(_e,{control:e.jsx(cs,{checked:r.status==="paid",onChange:M,color:"primary"}),label:r.status==="paid"?"Pagato":"In attesa",labelPlacement:"start"})]})}),r.status==="paid"&&e.jsx(i,{size:{xs:12},children:e.jsxs(X,{fullWidth:!0,required:!0,error:j.account_id&&j.account_id[0],children:[e.jsx(te,{htmlFor:"account-selector",sx:{mb:2},children:"Seleziona Cassa"}),e.jsx(re,{variant:"outlined",label:"Seleziona Cassa",labelId:"account-selector-label",id:"account-selector",name:"account_id",value:r.account_id||"",error:j.account_id&&j.account_id[0],onChange:$,children:x.map(d=>e.jsxs(q,{value:d.id,disabled:d.status==="closed",style:{color:d.status==="closed"?"grey":"inherit"},children:[d.name," ",d.status==="closed"?"(Chiusa)":""]},d.id))}),j.account_id&&j.account_id[0]&&e.jsx(Ue,{children:j.account_id[1]})]})}),e.jsx(i,{size:{xs:12},children:e.jsx(F,{label:"Note",name:"notes",value:r.notes,onChange:$,multiline:!0,rows:2,fullWidth:!0})})]}),e.jsx(H,{variant:"contained",fullWidth:!0,sx:{mt:2,bgcolor:r.profile_id?"#1976d2":"#9e9e9e","&:hover":{bgcolor:r.profile_id?"#1565c0":"#757575"}},onClick:I,children:c?"Salva Modifiche":"Conferma"}),c&&e.jsx(H,{variant:"contained",fullWidth:!0,sx:{mt:1,bgcolor:"#d32f2f","&:hover":{bgcolor:"#b71c1c"}},onClick:N,children:"Elimina Iscrizione"}),f&&e.jsx(ve,{message:f.message,state:f.state})]}),e.jsx(ia,{open:E.open,message:E.message,onConfirm:E.action,onClose:()=>t({open:!1,action:null,message:""})})]})})}function Us({open:h,onClose:u,selectedRows:s,event:n,listId:l}){const[c,_]=a.useState(null),[o,f]=a.useState([]),[p,x]=a.useState(""),w=n.lists.find(t=>t.id===l)?.name||"Lista non trovata";a.useEffect(()=>{if(n?.lists){const t=n.lists.filter(z=>z.id!==l);f(t)}},[n,l]);const E=async()=>{if(p)try{const t=await G("POST","/move-subscriptions/",{subscriptionIds:s.map(z=>z.original.id),targetListId:p});if(t.ok)u(!0);else{const z=await Q(t);_({message:`Errore: ${z}`,state:"error"})}}catch(t){_({message:`Errore generale: ${t}`,state:"error"})}};return e.jsx(Pe,{open:h,onClose:()=>u(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(y,{sx:Oe,children:[e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(U,{onClick:()=>u(!1),sx:{minWidth:0},children:e.jsx(Ee,{})})}),e.jsxs(D,{variant:"h4",component:"h3",gutterBottom:!0,children:["Sposta ",s.length," ",s.length===1?"iscrizione":"iscrizioni"]}),e.jsxs(D,{variant:"body1",id:"modal-modal-description",gutterBottom:!0,children:["Lista di origine: ",w]}),e.jsxs(X,{fullWidth:!0,sx:{mt:1},children:[e.jsx(te,{id:"list-select-label",children:"Lista di destinazione"}),e.jsx(re,{labelId:"list-select-label",label:"Lista di destinazione",value:p,onChange:t=>x(t.target.value),variant:"outlined",children:o.map(t=>e.jsx(q,{value:t.id,children:t.name},t.id))})]}),e.jsx(H,{variant:"contained",fullWidth:!0,sx:{mt:2,bgcolor:p?"#1976d2":"#9e9e9e","&:hover":{bgcolor:p?"#1565c0":"#757575"}},onClick:E,disabled:!p,children:"Conferma"}),c&&e.jsx(ve,{message:c.message,state:c.state})]})})}function Js(){const{id:h}=na(),u=_s(),s=Ie(),[n,l]=a.useState(!1),[c,_]=a.useState(!1),[o,f]=a.useState(!1),[p,x]=a.useState([]),[w,E]=a.useState(!0),[t,z]=a.useState(null),[T,r]=a.useState(null),m=u.state?.event,[j,S]=a.useState(null),[L,A]=a.useState(null),[V,Y]=a.useState(null);a.useEffect(()=>{E(!0),(async()=>{try{const J=h||m?.id,ie=await G("GET",`/event/${J}/`);if(ie.ok){const oe=await ie.json();r(oe),console.log("Event Data: ",oe)}else{const oe=await Q(ie);z({message:`Errore: ${oe}`,state:"error"})}}catch(J){z({message:`Errore generale: ${J}`,state:"error"})}finally{E(!1)}})().then()},[h,m]);const P=async()=>{E(!0);try{const W=await G("GET",`/event/${T.id}/`);if(W.ok){const J=await W.json();r(J),E(!1)}else{const J=await Q(W);z({message:`Errore: ${J}`,state:"error"})}}catch(W){z({message:`Errore generale: ${W}`,state:"error"})}finally{E(!1)}},I=()=>{l(!0)},b=async W=>{W&&(z({message:"Evento modificato con successo!",state:"success"}),await P()),l(!1)},N=W=>{S(W),Y(!1),_(!0)},C=async(W,J)=>{W&&(z({message:J,state:"success"}),await P()),_(!1),S(null)},$=()=>{if(!T)return{chip:e.jsx(ae,{label:"Loading...",variant:"outlined",size:"medium"}),isActive:!1};const W=K(),J=T.subscription_start_date?K(T.subscription_start_date):null,ie=T.subscription_end_date?K(T.subscription_end_date):null;let oe="error",de=!1;J&&ie&&(W.isAfter(J)&&W.isBefore(ie)?(oe="success",de=!0):W.isBefore(J)&&(oe="warning"));let ee=T.subscription_start_date?K(T.subscription_start_date).format("DD/MM/YYYY HH:mm"):"Inizio non specificato",ge=T.subscription_end_date?K(T.subscription_end_date).format("DD/MM/YYYY HH:mm"):"Fine non specificata";return{chip:e.jsx(ae,{label:ee+" - "+ge,color:oe,variant:"outlined",size:"medium"}),isActive:de}},M=W=>{console.log("Editing subscription:",W),S(null),A(T.subscriptions.find(J=>J.id===W)||null),Y(!0),_(!0)},d=xe.useMemo(()=>T?.lists?T.lists.map(W=>{const J=T.subscriptions?.filter(oe=>oe.list_id===W.id)||[],ie=[{accessorKey:"id",header:"ID",size:50},{accessorKey:"profile_name",header:"Profilo",size:150},{accessorKey:"status",header:"Stato",size:100,Cell:({cell:oe})=>{const de=oe.getValue();let ee,ge;switch(de){case"paid":ee="success",ge="PAGATO";break;case"pending":ee="warning",ge="IN ATTESA";break;case"cancelled":ee="error",ge="CANCELLATO";break;default:ee="default",ge=de}return e.jsx(ae,{label:ge,color:ee,size:"small"})}},{accessorKey:"notes",header:"Note",size:200}];return{listId:W.id,listName:W.name,capacity:W.capacity,subscriptions:J,columns:ie}}):[],[T]),v=xe.useMemo(()=>d.map(W=>({...W,tableOptions:{columns:W.columns,data:W.subscriptions,enableStickyHeader:!0,enablePagination:!0,enableRowSelection:!0,display:!1,initialState:{pagination:{pageSize:10,pageIndex:0}},paginationDisplayMode:"pages",localization:De,renderEmptyRowsFallback:()=>e.jsx(y,{sx:{textAlign:"center",p:2},children:e.jsx(D,{variant:"body1",children:"Nessuna iscrizione presente"})}),muiTablePaginationProps:{labelRowsPerPage:"Righe per pagina:"},renderTopToolbarCustomActions:({table:J})=>{const ie=J.getSelectedRowModel().rows,oe=ie.length;return e.jsxs(y,{sx:{display:"flex",gap:1},children:[oe>=1&&e.jsxs(e.Fragment,{children:[e.jsx(H,{variant:"outlined",color:"primary",onClick:()=>R(ie,W.listId),children:"Sposta in Altra Lista"}),e.jsx(H,{variant:"outlined",color:"secondary",onClick:()=>ce(ie),children:"Esporta"})]}),oe===1&&e.jsx(e.Fragment,{children:e.jsx(H,{variant:"contained",color:"primary",onClick:()=>M(ie[0].original.id),children:"Modifica Iscrizione"})})]})}}})),[d]),g=xe.memo(()=>{if(!v||v.length===0)return e.jsx(D,{children:"Nessuna lista disponibile (aggiungine una per poter iscrivere)"});const{isActive:W}=$();return v.map(J=>{const{listId:ie,listName:oe,capacity:de,subscriptions:ee,tableOptions:ge}=J,Le=Math.round(ee.length/de*100)||0,Re=Le>=90?"error":Le>=60?"warning":"success",Je={...ge,paginationDisplayMode:"pages"},k=ke(Je);return e.jsxs(ds,{sx:{mt:2},children:[e.jsx(us,{children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(ms,{sx:{color:"primary.main",mr:1}}),e.jsx(D,{variant:"h6",component:"div",sx:{flexGrow:1},children:oe}),e.jsxs(y,{sx:{display:"flex",alignItems:"center",cursor:ee.length<de&&W?"pointer":"not-allowed",opacity:ee.length<de&&W?1:.5,px:2,py:1,borderRadius:1,bgcolor:"primary.main",color:"white",ml:2},onClick:ee.length<de&&W?()=>N(ie):void 0,children:[e.jsx(ps,{sx:{mr:1}})," ISCRIVI"]}),e.jsxs(y,{sx:{width:"200px",ml:2},children:[e.jsx(y,{sx:{display:"flex",justifyContent:"space-between"},children:e.jsxs(D,{variant:"body2",children:[ee.length,"/",de]})}),e.jsx(hs,{variant:"determinate",value:Le,color:Re,sx:{height:8,borderRadius:5}})]})]})}),e.jsx(xs,{children:e.jsx(Fe,{table:k})})]},ie)})}),R=(W,J)=>{console.log("Moving selected rows to another list:",W),x(W),S(J),f(!0)},ne=W=>{W&&(z({message:"Spostamento effettuato con successo!",state:"success"}),P().then()),f(!1)},ce=W=>{console.log("Exporting selected rows:",W)};return e.jsxs(y,{children:[e.jsx(Me,{}),n&&e.jsx(Na,{open:n,onClose:b,event:{...T,date:T.date?K(T.date):null,subscription_start_date:T.subscription_start_date?K(T.subscription_start_date):null,subscription_end_date:T.subscription_end_date?K(T.subscription_end_date):null},isEdit:!0}),c&&e.jsx(Ys,{open:c,onClose:C,event:T,listId:j,subscription:L,isEdit:V}),o&&e.jsx(Us,{open:o,onClose:ne,selectedRows:p,event:T,listId:j}),e.jsxs(y,{sx:{mx:"5%"},children:[w?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(U,{onClick:()=>{s(-1)},sx:{mr:2},children:e.jsx(ra,{})}),e.jsx(ta,{sx:{marginRight:"10px"}}),e.jsxs(D,{variant:"h4",children:["Evento - ",T.name]})]}),e.jsx(Ke,{elevation:3,sx:{mt:5,mb:4,borderRadius:2,overflow:"hidden"},children:e.jsx(Ia,{children:e.jsxs(i,{container:!0,spacing:3,children:[e.jsxs(i,{size:{xs:12,md:4},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(fs,{sx:{color:"primary.main",mr:1}}),e.jsx(D,{variant:"h6",component:"div",children:"Data"})]}),e.jsx(D,{variant:"body1",color:"text.secondary",sx:{mt:2},children:T.date?K(T.date).format("DD/MM/YYYY"):"Data non specificata"})]}),e.jsxs(i,{size:{xs:12,md:4},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(gs,{sx:{color:"primary.main",mr:1}}),e.jsx(D,{variant:"h6",component:"div",children:"Costo"})]}),e.jsx(D,{variant:"body1",color:"text.secondary",sx:{mt:2},children:T.cost!==0?`€ ${T.cost}`:"Gratuito"})]}),e.jsxs(i,{size:{xs:12,md:4},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(bs,{sx:{color:"primary.main",mr:1}}),e.jsx(D,{variant:"h6",component:"div",children:"Periodo Iscrizioni"})]}),e.jsx(y,{sx:{display:"flex",alignItems:"center",mt:2},children:$().chip})]}),e.jsxs(i,{size:{xs:12},children:[e.jsx(We,{sx:{my:1}}),e.jsxs(y,{sx:{display:"flex",alignItems:"center",mt:2},children:[e.jsx(js,{sx:{color:"primary.main",mr:1}}),e.jsx(D,{variant:"h6",component:"div",children:"Descrizione"})]}),e.jsx("div",{"data-color-mode":"light",style:{marginTop:10},children:e.jsx(Fa,{value:T.description||"Nessuna descrizione disponibile",readOnly:!0})})]}),e.jsxs(i,{size:{xs:12},children:[e.jsx(We,{sx:{my:1}}),e.jsxs(y,{sx:{display:"flex",alignItems:"center",mt:2},children:[e.jsx(Ye,{sx:{color:"primary.main",mr:1}}),e.jsx(D,{variant:"h6",component:"div",children:"Azioni"})]}),e.jsx(H,{sx:{mt:2},variant:"contained",color:"primary",onClick:I,children:"Modifica Evento"})]}),e.jsxs(i,{size:{xs:12},children:[e.jsx(We,{sx:{my:1}}),e.jsxs(y,{sx:{mt:2},children:[e.jsx(D,{variant:"h6",component:"div",sx:{mb:2},children:"Liste"}),e.jsx(g,{})]})]})]})})})]}),t&&e.jsx(ve,{message:t.message,state:t.state})]})]})}function ze({children:h,requiredPermission:u}){const{accessToken:s,user:n,loading:l}=Ae(),c=Ie();return a.useEffect(()=>{!l&&(!s||u&&!n?.permissions.includes(u))&&(console.log("Redirecting to login..."),c("/login",{replace:!0}))},[l,s,n,u,c]),l?e.jsx("div",{children:"Loading..."}):!s||u&&!n?.permissions.includes(u)?null:h}function Zs(){const{uid:h,token:u}=na(),[s,n]=a.useState({message:"",state:"loading"});return a.useEffect(()=>{h&&u?(async()=>{try{const c=await G("GET",`/api/profile/verify-email/${h}/${u}/`,null,{},!1),_=await c.json();if(c.ok)n({message:_.message,state:"success"});else{const o=Q(_,c.status);n({message:o,state:"error"})}}catch(c){n({message:`General error: ${c}`,state:"error"})}})().then():n({message:"Invalid verification link",state:"error"})},[h,u]),e.jsx(ea,{maxWidth:"sm",children:e.jsxs(y,{sx:{mt:8,display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",p:3,borderRadius:2,boxShadow:3,bgcolor:"background.paper"},children:[e.jsx(D,{variant:"h4",component:"h1",gutterBottom:!0,children:"Email Verification"}),e.jsx(Ne,{message:s.message,state:s.state,loadingText:"Verifying your email address..."})]})})}function Qs(){const{uid:h,token:u}=na(),s=Ie(),[n,l]=a.useState(""),[c,_]=a.useState(""),[o,f]=a.useState(null),[p,x]=a.useState(!1),w=async()=>{if(n!==c){f({message:"Le password non coincidono.",state:"error"});return}try{const E=await G("POST",`/api/reset-password/${h}/${u}/`,{password:n,confirm_password:c},{},!1);if(E.ok)x(!0),f({message:"Password reimpostata con successo!",state:"success"});else{const t=await Q(E);f({message:`Errore durante il reset della password: ${t}`,state:"error"})}}catch(E){f({message:`Errore generale: ${E}`,state:"error"})}};return e.jsx(ea,{maxWidth:"xs",children:e.jsxs(y,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("img",{alt:"",src:oa,style:{height:"25vh"}}),e.jsx(D,{style:{marginTop:10},variant:"h5",children:"Reimposta Password"}),o&&e.jsx(Ne,{message:o.message,state:o.state}),!p&&e.jsxs(e.Fragment,{children:[e.jsx(F,{margin:"normal",required:!0,fullWidth:!0,label:"Nuova Password",type:"password",onChange:E=>l(E.target.value)}),e.jsx(F,{margin:"normal",required:!0,fullWidth:!0,label:"Conferma Password",type:"password",onChange:E=>_(E.target.value)}),e.jsx(H,{fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},onClick:w,children:"Reimposta Password"})]}),p&&e.jsx(be,{component:"button",variant:"body2",sx:{textAlign:"center"},onClick:()=>s("/login"),children:"Vai al Login"})]})})}function Xs({open:h,onClose:u,transaction:s}){const[n,l]=a.useState(!0),[c,_]=a.useState([]),[o,f]=a.useState(null),[p,x]=a.useState({executor:null,account:"",amount:"",description:"",type:""}),[w,E]=a.useState({executor:[!1,""],account:[!1,""],amount:[!1,""],description:[!1,""]});a.useEffect(()=>{console.log("TransactionModal useEffect",s),l(!0),Promise.all([G("GET","/accounts/")]).then(async([m])=>{const j=m.ok?await m.json():{results:[]};_(j.results||[]),s&&x({executor:s.executor||null,account:s.account?.id||"",amount:s.amount||"",description:s.description||"",type:s.type||""})}).finally(()=>l(!1))},[h,s]);const t=m=>{const{name:j,value:S}=m.target;x(L=>({...L,[j]:S}))},z=()=>{let m=!1;const j={...w};return p.executor?j.executor=[!1,""]:(j.executor=[!0,"Seleziona un Esecutore"],m=!0),p.account?j.account=[!1,""]:(j.account=[!0,"Seleziona una Cassa"],m=!0),!p.amount||isNaN(Number(p.amount))?(j.amount=[!0,"Inserisci un importo valido"],m=!0):j.amount=[!1,""],E(j),!m},T=async m=>{if(m.preventDefault(),!!z()){l(!0);try{const j={executor:p.executor.id||p.executor.email,account:p.account,amount:parseFloat(p.amount),description:p.description},S=await G("PATCH",`/transaction/${s.id}/`,j);if(S.ok)u(!0);else{const L=await Q(S);f({message:`Errore: ${L}`,state:"error"})}}catch(j){f({message:`Errore generale: ${j}`,state:"error"})}finally{l(!1)}}},r=()=>u(!1);return e.jsx(Pe,{open:h,onClose:r,children:e.jsx(y,{sx:Oe,component:"form",onSubmit:T,noValidate:!0,children:n?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(U,{onClick:r,sx:{minWidth:0},children:e.jsx(Ee,{})})}),e.jsx(D,{variant:"h5",gutterBottom:!0,align:"center",sx:{mb:2},children:"Modifica Transazione"}),o&&e.jsx(ve,{message:o.message,state:o.state}),e.jsxs(i,{container:!0,spacing:2,sx:{mt:2},children:[e.jsxs(D,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Tipo:"})," ",se.tran_type[p.type]||"Non specificato"]}),e.jsx(i,{size:{xs:12},children:e.jsx(Oa,{value:p.executor,onChange:(m,j)=>{x({...p,executor:j})},error:w.executor[0],helperText:w.executor[0]?w.executor[1]:"Cerca per nome o numero ESNcard",label:se.executor,esner_only:!0,required:!0})}),e.jsx(i,{size:{xs:12},children:e.jsxs(X,{fullWidth:!0,required:!0,error:w.account[0],children:[e.jsx(te,{id:"account-label",children:se.account}),e.jsx(re,{labelId:"account-label",name:"account",variant:"outlined",value:p.account,onChange:t,input:e.jsx(Ce,{label:se.account}),children:c.map(m=>e.jsx(q,{value:m.id,children:m.name},m.id))}),w.account[0]&&e.jsx(Ue,{children:w.account[1]})]})}),e.jsx(i,{size:{xs:12},children:e.jsx(F,{label:se.amount,name:"amount",value:p.amount,onChange:t,required:!0,fullWidth:!0,error:w.amount[0],type:"number",slotProps:{htmlInput:{min:"0.01",step:"0.01"}}})}),e.jsx(i,{size:{xs:12},children:e.jsx(F,{label:"Descrizione",name:"description",value:p.description,onChange:t,fullWidth:!0,multiline:!0,rows:3})})]}),e.jsx(y,{mt:2,children:e.jsx(H,{fullWidth:!0,variant:"contained",color:"primary",type:"submit",children:"Salva Modifiche"})})]})})})}const Wa={subscription:{label:se.tran_type.subscription,color:"primary"},esncard:{label:se.tran_type.esncard,color:"secondary"},deposit:{label:se.tran_type.deposit,color:"success"},withdrawal:{label:se.tran_type.withdrawal,color:"error"}},fa=[{value:"",label:"Tutti"},...Object.entries(Wa).map(([h,u])=>({value:h,label:u.label,color:u.color}))];function et(){const[h,u]=a.useState(!0),[s,n]=a.useState([]),[l,c]=a.useState([]),_=Ie(),[o,f]=a.useState(null),[p,x]=a.useState(!1),[w,E]=a.useState(null),[t,z]=a.useState({pageIndex:0,pageSize:10}),[T,r]=a.useState(0),[m,j]=a.useState({account:[],type:[],dateFrom:null,dateTo:null}),[S,L]=a.useState(""),[A,V]=a.useState(""),Y=a.useRef(null);a.useEffect(()=>{P().then()},[t.pageIndex,t.pageSize,m,A]);const P=async()=>{u(!0);try{const g=new URLSearchParams;g.append("page",t.pageIndex+1),g.append("page_size",t.pageSize),A&&g.append("search",A),m.account.length&&m.account.forEach(J=>g.append("account",J)),m.type.length&&m.type.forEach(J=>g.append("type",J)),m.dateFrom&&g.append("dateFrom",m.dateFrom.toISOString()),m.dateTo&&g.append("dateTo",m.dateTo.toISOString());const[R,ne]=await Promise.all([G("GET",`/transactions/?${g.toString()}`),G("GET","/accounts/")]),ce=R.ok?await R.json():{results:[]},W=ne.ok?await ne.json():{results:[]};r(ce.count||0),n(ce.results||[]),c(W.results||[])}finally{u(!1)}},I=a.useMemo(()=>[{accessorKey:"created_at",header:se.date,size:120,Cell:({cell:g})=>{const R=new Date(g.getValue());return new Intl.DateTimeFormat("it-IT",{dateStyle:"medium",timeStyle:"short"}).format(R)}},{accessorKey:"type",header:se.type,size:100,Cell:({cell:g})=>{const R=g.getValue(),ne=Wa[R]||{label:"Sconosciuto",color:"default"};return e.jsx(ae,{label:ne.label,color:ne.color,variant:"outlined"})}},{accessorKey:"executor.name",header:se.executor,size:150},{accessorKey:"account.name",header:se.account,size:120,Cell:({cell:g})=>e.jsx(y,{component:"span",fontWeight:"bold",children:g.getValue()})},{accessorKey:"amount",header:se.amount,size:100,Cell:({cell:g})=>e.jsx(y,{children:g.getValue()!==null?e.jsx(ae,{label:`€${g.getValue()}`,color:"primary"}):e.jsx(ae,{label:"N/A",color:"warning"})})},{accessorKey:"description",header:se.description,size:200,Cell:({cell:g})=>e.jsx(y,{component:"span",fontStyle:"italic",children:g.getValue()})}],[]),b=ke({columns:I,data:s,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableExpandAll:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},sorting:[{id:"created_at",desc:!0}]},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",enableGlobalFilter:!1,muiPaginationProps:{color:"secondary",rowsPerPageOptions:[10,20,30],shape:"rounded",variant:"outlined"},manualPagination:!0,rowCount:T,onPaginationChange:z,state:{pagination:t},localization:De,muiTableBodyRowProps:({row:g})=>({onClick:()=>{E(g.original),x(!0)},sx:{cursor:"pointer"}})}),N=()=>{V(S),z(g=>({...g,pageIndex:0}))},C=()=>{L(""),V(""),z(g=>({...g,pageIndex:0})),Y.current&&Y.current.focus()},$=async g=>{g&&(f({message:"Transazione modificata con successo!",state:"success"}),await P()),E(null),x(!1)},M=(g,R)=>{j(ne=>{let ce={...ne,[g]:R};return g==="dateFrom"&&ce.dateTo&&R&&R>ce.dateTo&&(ce.dateTo=R),g==="dateTo"&&ce.dateFrom&&R&&R<ce.dateFrom&&(ce.dateFrom=R),ce})},d=g=>{const{name:R,value:ne}=g.target;j(ce=>{let W={...ce,[R]:ne};return(R==="account"||R==="type")&&(W[R]=typeof ne=="string"?ne.split(","):ne),W})},v=()=>{j(g=>({...g,dateFrom:null,dateTo:null}))};return e.jsxs(y,{children:[e.jsx(Me,{}),p&&e.jsx(Xs,{open:p,onClose:$,transaction:w}),e.jsxs(y,{sx:{mx:"5%"},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(U,{onClick:()=>_(-1),sx:{mr:2},children:e.jsx(ra,{})}),e.jsx(D,{variant:"h4",children:"Lista Transazioni"})]}),e.jsxs(i,{container:!0,spacing:2,sx:{mb:2,mt:4},alignItems:"center",children:[e.jsx(i,{size:{xs:12,sm:2},children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(te,{id:"account-label",children:"Cassa"}),e.jsx(re,{labelId:"account-label",name:"account",multiple:!0,value:m.account,onChange:d,input:e.jsx(Ce,{label:"Cassa"}),variant:"outlined",renderValue:g=>l.filter(R=>g.includes(R.id)).map(R=>R.name).join(", "),children:l.map(g=>e.jsx(q,{value:g.id,children:g.name},g.id))})]})}),e.jsx(i,{size:{xs:12,sm:2},children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(te,{id:"type-label",children:"Tipo"}),e.jsx(re,{labelId:"type-label",name:"type",multiple:!0,value:m.type,onChange:d,input:e.jsx(Ce,{label:"Tipo"}),variant:"outlined",renderValue:g=>fa.filter(R=>g.includes(R.value)&&R.value).map(R=>R.label).join(", "),children:fa.filter(g=>g.value).map(g=>e.jsx(q,{value:g.value,children:g.label},g.value))})]})}),e.jsx(i,{size:{xs:12,sm:2},children:e.jsx(X,{fullWidth:!0,children:e.jsx(me,{dateAdapter:Ve,adapterLocale:He,children:e.jsx(je,{label:"Da",value:m.dateFrom,maxDate:m.dateTo||void 0,onChange:g=>M("dateFrom",g),format:"d MMM yyyy"})})})}),e.jsx(i,{size:{xs:12,sm:2},children:e.jsx(X,{fullWidth:!0,children:e.jsx(me,{dateAdapter:Ve,adapterLocale:He,children:e.jsx(je,{label:"A",value:m.dateTo,minDate:m.dateFrom||void 0,onChange:g=>M("dateTo",g),format:"d MMM yyyy"})})})}),(m.dateFrom||m.dateTo)&&e.jsx(i,{size:{xs:12,sm:2},sx:{display:"flex",alignItems:"center"},children:e.jsx(H,{variant:"outlined",color:"secondary",startIcon:e.jsx($e,{}),onClick:v,sx:{height:"100%",minWidth:0,px:1},children:"Azzera date"})}),e.jsx(i,{size:{xs:12,sm:2},sx:{ml:"auto"},children:e.jsx(X,{fullWidth:!0,children:e.jsx(Ce,{inputRef:Y,size:"small",placeholder:"Cerca",value:S,onChange:g=>L(g.target.value),onKeyDown:g=>{g.key==="Enter"&&N()},endAdornment:S&&A===S?e.jsx(U,{"aria-label":"clear",onClick:C,edge:"end",children:e.jsx($e,{})}):e.jsx(U,{"aria-label":"search",onClick:N,edge:"end",children:e.jsx(sa,{})})})})})]}),h?e.jsx(fe,{}):e.jsx(Fe,{sx:{mt:2},table:b}),o&&e.jsx(ve,{message:o.message,state:o.state})]})]})}function at(){return e.jsx(Es,{children:e.jsx(Ts,{children:e.jsx(Ss,{children:e.jsxs(Cs,{children:[e.jsx(pe,{path:"/verify-email/:uid/:token",element:e.jsx(Zs,{})}),e.jsx(pe,{path:"/reset-password/:uid/:token",element:e.jsx(Qs,{})}),e.jsx(pe,{path:"/login",element:e.jsx(zs,{})}),e.jsx(pe,{path:"/",element:e.jsx(ze,{children:e.jsx(Ws,{})})}),e.jsx(pe,{path:"/profiles/erasmus",element:e.jsx(ze,{children:e.jsx(Fs,{})})}),e.jsx(pe,{path:"/profiles/esners",element:e.jsx(ze,{children:e.jsx(Ns,{})})}),e.jsx(pe,{path:"/erasmus_form",element:e.jsx(Ps,{})}),e.jsx(pe,{path:"/esner_form",element:e.jsx(ks,{})}),e.jsx(pe,{path:"/treasury",element:e.jsx(ze,{requiredPermission:"change_account",children:e.jsx(Ks,{})})}),e.jsx(pe,{path:"/treasury/accounts_list",element:e.jsx(ze,{requiredPermission:"change_account",children:e.jsx(Vs,{})})}),e.jsx(pe,{path:"/treasury/transactions_list",element:e.jsx(ze,{requiredPermission:"change_account",children:e.jsx(et,{})})}),e.jsx(pe,{path:"/events",element:e.jsx(ze,{children:e.jsx(Hs,{})})}),e.jsx(pe,{path:"/event/:id",element:e.jsx(ze,{children:e.jsx(Js,{})})})]})})})})}const st=za({typography:{fontFamily:"Roboto, Arial, sans-serif",h1:{fontFamily:"Lato, Arial, sans-serif"},h2:{fontFamily:"Lato, Arial, sans-serif"},h3:{fontFamily:"Lato, Arial, sans-serif"},h4:{fontFamily:"Lato, Arial, sans-serif"},h5:{fontFamily:"Lato, Arial, sans-serif"}},palette:{primary:{main:"#1976d2"},secondary:{main:"#dc004e"},cyan:{main:"#00aeef",contrastText:"#ffffff"},magenta:{main:"#ec008c",contrastText:"#ffffff"},gray:{main:"#999999",contrastText:"#ffffff"}}}),tt=ga.createRoot(document.getElementById("root"));tt.render(e.jsxs(ys,{theme:za(st,vs),children:[e.jsx(ba,{}),e.jsx(at,{})]}));
