import"./cookie-CRiBltyB.js";import{r as s,j as e,b as xe}from"./react-DHWqukR0.js";import{a as ja}from"./react-dom-CDc9nE-R.js";import{j as aa}from"./jwt-decode-DDStzonf.js";import{e as H,g as $a,E as Ba}from"./@sentry-DkvdqFJA.js";import{Q as b,a1 as da,H as P,aA as ra,aB as ya,a8 as G,_ as Z,a4 as Be,aC as ye,aD as va,aE as _a,aF as c,aG as fe,aH as Ee,ax as ve,aI as Ge,q as Se,aJ as X,aa as re,ab as oe,ac as Y,as as we,X as Pe,aK as Sa,aL as ua,aM as Te,U,aN as $e,d as oa,aO as Ga,aP as Ka,aQ as Va,aR as qa,aS as ia,aT as Ca,aU as wa,aV as na,aW as ma,am as sa,aX as ta,aY as Ha,aZ as Ea,E as Ta,a0 as za,a_ as Ya,a$ as Ua,b0 as Ja,$ as te,ag as Za,ah as Qa,ai as Xa,aj as es,C as as,b1 as Le,z as Ke,b2 as Ve,b3 as Ia,b4 as ss,au as Ue,l as Je,b5 as Ze,b6 as ts,b7 as ns,y as qe,aw as pa,b8 as rs,b9 as Pa,ba as He,ay as os,ar as We,az as is,bb as ls,bc as cs,bd as ds,be as us,af as ms,bf as ps,bg as hs,bh as xs,bi as fs,bj as gs,v as bs,e as js,bk as ys,bl as vs,bm as _s,bn as Ss,bo as ka,bp as Cs,bq as ws}from"./@mui-y9i3HReL.js";import{u as _e,L as ha,a as Qe,b as Es,B as Ts,R as zs,c as pe}from"./react-router-BSFJQRw0.js";import{d as V}from"./dayjs-Cg-mR3Zw.js";import{u as Me,M as Re,a as Ae,b as Da}from"./material-react-table-CCu21pRN.js";import{Q as Is}from"./quill-DqnIBbSv.js";import{S as Ye}from"./date-fns-oYXSj1kO.js";import"./scheduler-B2dZuLdE.js";import"./@sentry-internal-DqnXlSZe.js";import"./hoist-non-react-statics-DAej_wB6.js";import"./@emotion-D9RY1oPI.js";import"./@babel-zdx3XWTU.js";import"./stylis-DqWqFrCZ.js";import"./clsx-DQJ8k6jq.js";import"./react-transition-group-BqV1mj1-.js";import"./dom-helpers-DcUkJCiN.js";import"./prop-types-B8FIWPTw.js";import"./@popperjs-BZJNqh9-.js";import"./react-is-B0FiP7H5.js";import"./@tanstack-D2fpN8pH.js";import"./highlight-words-CVfDedPj.js";import"./parchment-X3vGbvB2.js";import"./quill-delta-F5QpAkgi.js";import"./fast-diff-B2R4kQOm.js";import"./lodash.clonedeep-52FLCVUX.js";import"./lodash.isequal-DZZZJmYz.js";import"./eventemitter3-Df_GUamD.js";import"./lodash-es-BHhXrHsP.js";try{let p=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},u=new p.Error().stack;u&&(p._sentryDebugIds=p._sentryDebugIds||{},p._sentryDebugIds[u]="aa06b2af-f8ea-4814-952e-87368a3063b4",p._sentryDebugIdIdentifier="sentry-dbid-aa06b2af-f8ea-4814-952e-87368a3063b4")}catch{}(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))o(m);new MutationObserver(m=>{for(const l of m)if(l.type==="childList")for(const w of l.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&o(w)}).observe(document,{childList:!0,subtree:!0});function t(m){const l={};return m.integrity&&(l.integrity=m.integrity),m.referrerPolicy&&(l.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?l.credentials="include":m.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(m){if(m.ep)return;m.ep=!0;const l=t(m);fetch(m.href,l)}})();const K=async(p,u,t=null,o={},m=!0)=>{const l=localStorage.getItem("accessToken"),y=`https://mgmt.esnpolimi.it/backend${u}`;if(m&&!l)throw new Error("No access token available");const x={"Content-Type":"application/json",...m&&{Authorization:`Bearer ${l}`},...o.headers},a={method:p,headers:x,credentials:"include",...o};t&&(a.body=typeof t=="string"?t:JSON.stringify(t));const E=await fetch(y,a);if(E.status===401)throw new Error("Unauthorized: Access token may have expired");return E},se=(p,u)=>{if(!p)return`Server error (${u}) with empty response`;if(typeof p=="string")return p;if(p.detail)return p.detail;if(p.message)return p.message;if(p.non_field_errors)return p.non_field_errors.join(", ");if(p.lists?.non_field_errors)return`Error in lists format: ${p.lists.non_field_errors.join(", ")}`;for(const[,t]of Object.entries(p))if(t)return Array.isArray(t)?t.join(", "):t.toString();return JSON.stringify(p)},Ma=s.createContext(null),Ps=({children:p})=>{const u=s.useRef(null),[t,o]=s.useState(localStorage.getItem("accessToken")),[m,l]=s.useState(()=>JSON.parse(localStorage.getItem("user")||"null")),[w,y]=s.useState(!0),x=i=>{try{const{user:n}=aa(i);return n}catch(n){return H(n),console.error("Invalid JWT token",n),null}},a=async(i,n)=>{try{const I=await K("POST","/login/",{email:i,password:n},{},!1),g=await I.json();if(I.ok){const r=x(g.access);return console.log("Login successful"),o(g.access),console.log("Decoded access token:",r),l(r),localStorage.setItem("accessToken",g.access),localStorage.setItem("user",JSON.stringify(r)),!0}else return await se(g,I.status)}catch(I){return H(I),I}},E=s.useCallback(async({skipApiCall:i=!1}={})=>{console.log("Logout function called"),u.current&&(console.log("Aborting refresh timer..."),clearTimeout(u.current),u.current=null),i||await K("POST","/logout/"),localStorage.removeItem("accessToken"),localStorage.removeItem("user"),o(null),l(null),console.log("Logged out successfully")},[]),C=s.useCallback(async()=>{if(t)try{const i=m?.profile?.email,n=await K("POST","/api/token/refresh/",{email:i},{},!1);if(n.ok){const I=await n.json(),g=x(I.access);return o(I.access),l(g),localStorage.setItem("accessToken",I.access),localStorage.setItem("user",JSON.stringify(g)),!0}else return console.warn("Token refresh failed. Logging out..."),await E(),!1}catch(i){return H(i),console.error("Refresh token error:",i),await E(),!1}else return console.log("Skipping token refresh, user is not logged in"),!1},[m,t,E]);return s.useEffect(()=>{const i=()=>{u.current&&(clearTimeout(u.current),u.current=null)};if(!t){console.log("No access token found, skipping refresh scheduling");return}const{exp:n}=aa(t),I=Math.floor(Date.now()/1e3),g=(n-I-30)*1e3,r=new Date(n*1e3),h=new Date(I*1e3);if(console.log(`Token expires at: ${r.getHours()}:${r.getMinutes()}, current time: ${h.getHours()}:${h.getMinutes()}, refresh time in s: ${g/1e3}`),g<=0){console.log("Refresh time is not valid, no timer set"),o(null);return}return i(),u.current=setTimeout(()=>{console.log("Refreshing access token..."),C().then()},g),()=>{console.log("Clearing refresh timer"),i()}},[t,C]),s.useEffect(()=>{(async()=>{const n=localStorage.getItem("accessToken"),I=localStorage.getItem("user");if(n&&I)try{const g=aa(n),r=Math.floor(Date.now()/1e3);g.exp>r?(o(n),l(JSON.parse(I))):await E({skipApiCall:!0})}catch(g){H(g),console.error("Token decode error",g),await E({skipApiCall:!0})}y(!1)})().then()},[E]),e.jsx(Ma.Provider,{value:{user:m,accessToken:t,refreshAccessToken:C,logout:E,login:a,loading:w},children:p})},Fe=()=>s.useContext(Ma),Aa=s.createContext(void 0);function ks({children:p}){const[u,t]=s.useState(!1),[o,m]=s.useState(null);s.useEffect(()=>{const x=localStorage.getItem("sidebarDrawerState");x&&t(JSON.parse(x))},[]),s.useEffect(()=>{localStorage.setItem("sidebarDrawerState",JSON.stringify(u))},[u]);const l=x=>a=>{a&&a.type==="keydown"&&(a.key==="Tab"||a.key==="Shift")||t(x)},w=x=>{m(a=>a===x?null:x)},y=()=>t(!1);return e.jsx(Aa.Provider,{value:{isDrawerOpen:u,toggleDrawer:l,closeDrawer:y,expandedSection:o,handleExpand:w},children:p})}function Ds(){return s.useContext(Aa)}const la="/assets/esnpolimi-logo-BJJf0P2z.png",Ne=({message:p,state:u,successText:t,errorText:o})=>e.jsxs(b,{sx:{mt:2,mb:2,display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",p:2,borderRadius:5,boxShadow:3,bgcolor:"background.paper"},children:[u==="success"&&e.jsxs(e.Fragment,{children:[e.jsx(da,{severity:"success",sx:{width:"100%",mb:1},children:p||"Success!"}),t&&e.jsx(P,{children:t})]}),u==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(da,{severity:"error",sx:{width:"100%",mb:1},children:p||"An error occurred"}),o&&e.jsx(P,{children:o})]})]});function Ms(){const[p,u]=s.useState(""),[t,o]=s.useState(""),[m,l]=s.useState(!1),{login:w}=Fe(),y=_e(),[x,a]=s.useState(null),[E,C]=s.useState(!1),[i,n]=s.useState(!1),I=async()=>{n(!0);try{console.log("Sending forgot password request for:",p);const r=await K("POST","/api/forgot-password/",{email:p},{},!1);if(r.ok)C(!0),a({message:`Se il profilo è registrato, l'email è stata inviata con successo a "`+p+'". Controlla la tua casella di posta.',state:"success"});else{const h=await r.json(),v=await se(h,r.status);a({message:`Errore durante l'invio dell'email: ${v}`,state:"error"})}}catch(r){H(r),a({message:`Errore generale: ${r}`,state:"error"})}finally{n(!1)}},g=async()=>{n(!0),a(null);const r=await w(p,t);if(n(!1),r===!0)y("/");else if(typeof r=="string"&&(r.trim().startsWith("<!DOCTYPE html")||r.trim().startsWith("<html"))){const h=window.open();h?(h.document.open(),h.document.write(r),h.document.close()):a({message:"Impossibile aprire la pagina di errore in una nuova scheda.",state:"error"})}else a({message:`Errore durante il login: ${r}`,state:"error"})};return e.jsxs(ra,{component:"main",maxWidth:"xs",children:[e.jsx(ya,{}),e.jsxs(b,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("img",{alt:"",src:la,style:{height:"25vh"}}),e.jsxs(b,{children:[!E&&e.jsx(G,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email",name:"email",autoComplete:"email",autoFocus:!0,onChange:r=>u(r.target.value),onKeyDown:r=>r.key==="Enter"&&(m?I():g())}),!m&&e.jsx(G,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",onChange:r=>o(r.target.value),onKeyDown:r=>r.key==="Enter"&&g()}),!E&&e.jsx(Z,{fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,backgroundColor:"black"},onClick:m?I:g,disabled:i,children:i?e.jsx(Be,{size:24,color:"inherit"}):m?"Invia Email di Reset":"Log In"}),e.jsxs(b,{sx:{display:"flex",justifyContent:"center",width:"100%"},children:[e.jsx(ye,{component:"button",variant:"body2",onClick:()=>{l(!m),C(!1),a(null)},sx:{textAlign:"center"},children:m?"Torna al Login":"Password dimenticata?"}),e.jsx(ye,{component:"button",variant:"body2",onClick:()=>y("/esner_form"),sx:{textAlign:"center",marginLeft:2},children:"Non hai un account? Registrati"})]})]}),x&&e.jsx(Ne,{message:x.message,state:x.state})]})]})}const ze=JSON.parse(`[{"name":"Afghanistan","dial":"+93","code":"AF"},{"name":"Aland Islands","dial":"+358","code":"AX"},{"name":"Albania","dial":"+355","code":"AL"},{"name":"Algeria","dial":"+213","code":"DZ"},{"name":"AmericanSamoa","dial":"+1684","code":"AS"},{"name":"Andorra","dial":"+376","code":"AD"},{"name":"Angola","dial":"+244","code":"AO"},{"name":"Anguilla","dial":"+1264","code":"AI"},{"name":"Antarctica","dial":"+672","code":"AQ"},{"name":"Antigua and Barbuda","dial":"+1268","code":"AG"},{"name":"Argentina","dial":"+54","code":"AR"},{"name":"Armenia","dial":"+374","code":"AM"},{"name":"Aruba","dial":"+297","code":"AW"},{"name":"Australia","dial":"+61","code":"AU"},{"name":"Austria","dial":"+43","code":"AT"},{"name":"Azerbaijan","dial":"+994","code":"AZ"},{"name":"Bahamas","dial":"+1242","code":"BS"},{"name":"Bahrain","dial":"+973","code":"BH"},{"name":"Bangladesh","dial":"+880","code":"BD"},{"name":"Barbados","dial":"+1246","code":"BB"},{"name":"Belarus","dial":"+375","code":"BY"},{"name":"Belgium","dial":"+32","code":"BE"},{"name":"Belize","dial":"+501","code":"BZ"},{"name":"Benin","dial":"+229","code":"BJ"},{"name":"Bermuda","dial":"+1441","code":"BM"},{"name":"Bhutan","dial":"+975","code":"BT"},{"name":"Bolivia, Plurinational State of","dial":"+591","code":"BO"},{"name":"Bosnia and Herzegovina","dial":"+387","code":"BA"},{"name":"Botswana","dial":"+267","code":"BW"},{"name":"Brazil","dial":"+55","code":"BR"},{"name":"British Indian Ocean Territory","dial":"+246","code":"IO"},{"name":"Brunei Darussalam","dial":"+673","code":"BN"},{"name":"Bulgaria","dial":"+359","code":"BG"},{"name":"Burkina Faso","dial":"+226","code":"BF"},{"name":"Burundi","dial":"+257","code":"BI"},{"name":"Cambodia","dial":"+855","code":"KH"},{"name":"Cameroon","dial":"+237","code":"CM"},{"name":"Canada","dial":"+1","code":"CA"},{"name":"Cape Verde","dial":"+238","code":"CV"},{"name":"Cayman Islands","dial":"+ 345","code":"KY"},{"name":"Central African Republic","dial":"+236","code":"CF"},{"name":"Chad","dial":"+235","code":"TD"},{"name":"Chile","dial":"+56","code":"CL"},{"name":"China","dial":"+86","code":"CN"},{"name":"Christmas Island","dial":"+61","code":"CX"},{"name":"Cocos (Keeling) Islands","dial":"+61","code":"CC"},{"name":"Colombia","dial":"+57","code":"CO"},{"name":"Comoros","dial":"+269","code":"KM"},{"name":"Congo","dial":"+242","code":"CG"},{"name":"Congo, The Democratic Republic of the Congo","dial":"+243","code":"CD"},{"name":"Cook Islands","dial":"+682","code":"CK"},{"name":"Costa Rica","dial":"+506","code":"CR"},{"name":"Cote d'Ivoire","dial":"+225","code":"CI"},{"name":"Croatia","dial":"+385","code":"HR"},{"name":"Cuba","dial":"+53","code":"CU"},{"name":"Cyprus","dial":"+357","code":"CY"},{"name":"Czech Republic","dial":"+420","code":"CZ"},{"name":"Denmark","dial":"+45","code":"DK"},{"name":"Djibouti","dial":"+253","code":"DJ"},{"name":"Dominica","dial":"+1767","code":"DM"},{"name":"Dominican Republic","dial":"+1849","code":"DO"},{"name":"Ecuador","dial":"+593","code":"EC"},{"name":"Egypt","dial":"+20","code":"EG"},{"name":"El Salvador","dial":"+503","code":"SV"},{"name":"Equatorial Guinea","dial":"+240","code":"GQ"},{"name":"Eritrea","dial":"+291","code":"ER"},{"name":"Estonia","dial":"+372","code":"EE"},{"name":"Ethiopia","dial":"+251","code":"ET"},{"name":"Falkland Islands (Malvinas)","dial":"+500","code":"FK"},{"name":"Faroe Islands","dial":"+298","code":"FO"},{"name":"Fiji","dial":"+679","code":"FJ"},{"name":"Finland","dial":"+358","code":"FI"},{"name":"France","dial":"+33","code":"FR"},{"name":"French Guiana","dial":"+594","code":"GF"},{"name":"French Polynesia","dial":"+689","code":"PF"},{"name":"Gabon","dial":"+241","code":"GA"},{"name":"Gambia","dial":"+220","code":"GM"},{"name":"Georgia","dial":"+995","code":"GE"},{"name":"Germany","dial":"+49","code":"DE"},{"name":"Ghana","dial":"+233","code":"GH"},{"name":"Gibraltar","dial":"+350","code":"GI"},{"name":"Greece","dial":"+30","code":"GR"},{"name":"Greenland","dial":"+299","code":"GL"},{"name":"Grenada","dial":"+1473","code":"GD"},{"name":"Guadeloupe","dial":"+590","code":"GP"},{"name":"Guam","dial":"+1671","code":"GU"},{"name":"Guatemala","dial":"+502","code":"GT"},{"name":"Guernsey","dial":"+44","code":"GG"},{"name":"Guinea","dial":"+224","code":"GN"},{"name":"Guinea-Bissau","dial":"+245","code":"GW"},{"name":"Guyana","dial":"+595","code":"GY"},{"name":"Haiti","dial":"+509","code":"HT"},{"name":"Holy See (Vatican City State)","dial":"+379","code":"VA"},{"name":"Honduras","dial":"+504","code":"HN"},{"name":"Hong Kong","dial":"+852","code":"HK"},{"name":"Hungary","dial":"+36","code":"HU"},{"name":"Iceland","dial":"+354","code":"IS"},{"name":"India","dial":"+91","code":"IN"},{"name":"Indonesia","dial":"+62","code":"ID"},{"name":"Iran, Islamic Republic of Persian Gulf","dial":"+98","code":"IR"},{"name":"Iraq","dial":"+964","code":"IQ"},{"name":"Ireland","dial":"+353","code":"IE"},{"name":"Isle of Man","dial":"+44","code":"IM"},{"name":"Israel","dial":"+972","code":"IL"},{"name":"Italy","dial":"+39","code":"IT"},{"name":"Jamaica","dial":"+1876","code":"JM"},{"name":"Japan","dial":"+81","code":"JP"},{"name":"Jersey","dial":"+44","code":"JE"},{"name":"Jordan","dial":"+962","code":"JO"},{"name":"Kazakhstan","dial":"+77","code":"KZ"},{"name":"Kenya","dial":"+254","code":"KE"},{"name":"Kiribati","dial":"+686","code":"KI"},{"name":"Korea, Democratic People's Republic of Korea","dial":"+850","code":"KP"},{"name":"Korea, Republic of South Korea","dial":"+82","code":"KR"},{"name":"Kuwait","dial":"+965","code":"KW"},{"name":"Kyrgyzstan","dial":"+996","code":"KG"},{"name":"Laos","dial":"+856","code":"LA"},{"name":"Latvia","dial":"+371","code":"LV"},{"name":"Lebanon","dial":"+961","code":"LB"},{"name":"Lesotho","dial":"+266","code":"LS"},{"name":"Liberia","dial":"+231","code":"LR"},{"name":"Libyan Arab Jamahiriya","dial":"+218","code":"LY"},{"name":"Liechtenstein","dial":"+423","code":"LI"},{"name":"Lithuania","dial":"+370","code":"LT"},{"name":"Luxembourg","dial":"+352","code":"LU"},{"name":"Macao","dial":"+853","code":"MO"},{"name":"Macedonia","dial":"+389","code":"MK"},{"name":"Madagascar","dial":"+261","code":"MG"},{"name":"Malawi","dial":"+265","code":"MW"},{"name":"Malaysia","dial":"+60","code":"MY"},{"name":"Maldives","dial":"+960","code":"MV"},{"name":"Mali","dial":"+223","code":"ML"},{"name":"Malta","dial":"+356","code":"MT"},{"name":"Marshall Islands","dial":"+692","code":"MH"},{"name":"Martinique","dial":"+596","code":"MQ"},{"name":"Mauritania","dial":"+222","code":"MR"},{"name":"Mauritius","dial":"+230","code":"MU"},{"name":"Mayotte","dial":"+262","code":"YT"},{"name":"Mexico","dial":"+52","code":"MX"},{"name":"Micronesia, Federated States of Micronesia","dial":"+691","code":"FM"},{"name":"Moldova","dial":"+373","code":"MD"},{"name":"Monaco","dial":"+377","code":"MC"},{"name":"Mongolia","dial":"+976","code":"MN"},{"name":"Montenegro","dial":"+382","code":"ME"},{"name":"Montserrat","dial":"+1664","code":"MS"},{"name":"Morocco","dial":"+212","code":"MA"},{"name":"Mozambique","dial":"+258","code":"MZ"},{"name":"Myanmar","dial":"+95","code":"MM"},{"name":"Namibia","dial":"+264","code":"NA"},{"name":"Nauru","dial":"+674","code":"NR"},{"name":"Nepal","dial":"+977","code":"NP"},{"name":"Netherlands","dial":"+31","code":"NL"},{"name":"Netherlands Antilles","dial":"+599","code":"AN"},{"name":"New Caledonia","dial":"+687","code":"NC"},{"name":"New Zealand","dial":"+64","code":"NZ"},{"name":"Nicaragua","dial":"+505","code":"NI"},{"name":"Niger","dial":"+227","code":"NE"},{"name":"Nigeria","dial":"+234","code":"NG"},{"name":"Niue","dial":"+683","code":"NU"},{"name":"Norfolk Island","dial":"+672","code":"NF"},{"name":"Northern Mariana Islands","dial":"+1670","code":"MP"},{"name":"Norway","dial":"+47","code":"NO"},{"name":"Oman","dial":"+968","code":"OM"},{"name":"Pakistan","dial":"+92","code":"PK"},{"name":"Palau","dial":"+680","code":"PW"},{"name":"Palestinian Territory, Occupied","dial":"+970","code":"PS"},{"name":"Panama","dial":"+507","code":"PA"},{"name":"Papua New Guinea","dial":"+675","code":"PG"},{"name":"Paraguay","dial":"+595","code":"PY"},{"name":"Peru","dial":"+51","code":"PE"},{"name":"Philippines","dial":"+63","code":"PH"},{"name":"Pitcairn","dial":"+872","code":"PN"},{"name":"Poland","dial":"+48","code":"PL"},{"name":"Portugal","dial":"+351","code":"PT"},{"name":"Puerto Rico","dial":"+1939","code":"PR"},{"name":"Qatar","dial":"+974","code":"QA"},{"name":"Romania","dial":"+40","code":"RO"},{"name":"Russia","dial":"+7","code":"RU"},{"name":"Rwanda","dial":"+250","code":"RW"},{"name":"Reunion","dial":"+262","code":"RE"},{"name":"Saint Barthelemy","dial":"+590","code":"BL"},{"name":"Saint Helena, Ascension and Tristan Da Cunha","dial":"+290","code":"SH"},{"name":"Saint Kitts and Nevis","dial":"+1869","code":"KN"},{"name":"Saint Lucia","dial":"+1758","code":"LC"},{"name":"Saint Martin","dial":"+590","code":"MF"},{"name":"Saint Pierre and Miquelon","dial":"+508","code":"PM"},{"name":"Saint Vincent and the Grenadines","dial":"+1784","code":"VC"},{"name":"Samoa","dial":"+685","code":"WS"},{"name":"San Marino","dial":"+378","code":"SM"},{"name":"Sao Tome and Principe","dial":"+239","code":"ST"},{"name":"Saudi Arabia","dial":"+966","code":"SA"},{"name":"Senegal","dial":"+221","code":"SN"},{"name":"Serbia","dial":"+381","code":"RS"},{"name":"Seychelles","dial":"+248","code":"SC"},{"name":"Sierra Leone","dial":"+232","code":"SL"},{"name":"Singapore","dial":"+65","code":"SG"},{"name":"Slovakia","dial":"+421","code":"SK"},{"name":"Slovenia","dial":"+386","code":"SI"},{"name":"Solomon Islands","dial":"+677","code":"SB"},{"name":"Somalia","dial":"+252","code":"SO"},{"name":"South Africa","dial":"+27","code":"ZA"},{"name":"South Sudan","dial":"+211","code":"SS"},{"name":"South Georgia and the South Sandwich Islands","dial":"+500","code":"GS"},{"name":"Spain","dial":"+34","code":"ES"},{"name":"Sri Lanka","dial":"+94","code":"LK"},{"name":"Sudan","dial":"+249","code":"SD"},{"name":"Suriname","dial":"+597","code":"SR"},{"name":"Svalbard and Jan Mayen","dial":"+47","code":"SJ"},{"name":"Swaziland","dial":"+268","code":"SZ"},{"name":"Sweden","dial":"+46","code":"SE"},{"name":"Switzerland","dial":"+41","code":"CH"},{"name":"Syrian Arab Republic","dial":"+963","code":"SY"},{"name":"Taiwan","dial":"+886","code":"TW"},{"name":"Tajikistan","dial":"+992","code":"TJ"},{"name":"Tanzania, United Republic of Tanzania","dial":"+255","code":"TZ"},{"name":"Thailand","dial":"+66","code":"TH"},{"name":"Timor-Leste","dial":"+670","code":"TL"},{"name":"Togo","dial":"+228","code":"TG"},{"name":"Tokelau","dial":"+690","code":"TK"},{"name":"Tonga","dial":"+676","code":"TO"},{"name":"Trinidad and Tobago","dial":"+1868","code":"TT"},{"name":"Tunisia","dial":"+216","code":"TN"},{"name":"Turkey","dial":"+90","code":"TR"},{"name":"Turkmenistan","dial":"+993","code":"TM"},{"name":"Turks and Caicos Islands","dial":"+1649","code":"TC"},{"name":"Tuvalu","dial":"+688","code":"TV"},{"name":"Uganda","dial":"+256","code":"UG"},{"name":"Ukraine","dial":"+380","code":"UA"},{"name":"United Arab Emirates","dial":"+971","code":"AE"},{"name":"United Kingdom","dial":"+44","code":"GB"},{"name":"United States","dial":"+1","code":"US"},{"name":"Uruguay","dial":"+598","code":"UY"},{"name":"Uzbekistan","dial":"+998","code":"UZ"},{"name":"Vanuatu","dial":"+678","code":"VU"},{"name":"Venezuela, Bolivarian Republic of Venezuela","dial":"+58","code":"VE"},{"name":"Vietnam","dial":"+84","code":"VN"},{"name":"Virgin Islands, British","dial":"+1284","code":"VG"},{"name":"Virgin Islands, U.S.","dial":"+1340","code":"VI"},{"name":"Wallis and Futuna","dial":"+681","code":"WF"},{"name":"Yemen","dial":"+967","code":"YE"},{"name":"Zambia","dial":"+260","code":"ZM"},{"name":"Zimbabwe","dial":"+263","code":"ZW"}]`);function As(){const[p,u]=xe.useState(!1),[t,o]=xe.useState(!0),[m,l]=s.useState(null),[w,y]=s.useState(!1),[x,a]=s.useState({acceptStatute:!1,acceptPurposes:!1,acceptRegulation:!1,acceptPrivacy:!1}),[E,C]=s.useState({acceptStatute:!1,acceptPurposes:!1,acceptRegulation:!1,acceptPrivacy:!1}),i={statute:"https://drive.google.com/file/d/1b0gpA3x9yRuAcdEWQyc9KvrnZzm0l-dB/view?usp=sharing",regulation:"https://drive.google.com/file/d/1_s0uBvqfOLRz5rQp1EEeNgtxRjs7Pgxy/view?usp=sharing",privacy:"https://drive.google.com/file/d/12LY0y49cCyjqdF0RotsO6srHrGkinNln/view?usp=sharing"},[n,I]=xe.useState({name:"",surname:"",email:"",email_confirm:"",birthdate:V(),country:"",phone_prefix:"+39",phone_number:"",whatsapp_prefix:"+39",whatsapp_number:"",person_code:"",domicile:"",course:"",document_type:"ID Card",document_number:"",document_expiration:V(),matricola_number:"",matricola_expiration:V(),is_esner:!1}),g={email:[!1,""],email_confirm:[!1,""],name:[!1,""],surname:[!1,""],birthdate:[!1,""],country:[!1,""],phone_prefix:[!1,""],phone_number:[!1,""],whatsapp_prefix:[!1,""],whatsapp_number:[!1,""],person_code:[!1,""],domicile:[!1,""],course:[!1,""],document_type:[!1,""],document_number:[!1,""],document_expiration:[!1,""],matricola_number:[!1,""],matricola_expiration:[!1,""],is_esner:[!1,""]},[r,h]=xe.useState(g),v=()=>{let _=!0;const T={...r},D={...E};["email","email_confirm","name","surname","birthdate","country","phone_prefix","phone_number","person_code","domicile","course","document_type","document_number","document_expiration","matricola_number","matricola_expiration"].forEach(j=>{!n[j]||typeof n[j]=="string"&&n[j].trim()===""?(T[j]=[!0,"This field is required"],_=!1):T[j]=[!1,""]}),/^\d{6}$/.test(n.matricola_number)?T.matricola_number=[!1,""]:(T.matricola_number=[!0,"Matricola must be exactly 6 digits"],_=!1),/^\d{8}$/.test(n.person_code)?T.person_code=[!1,""]:(T.person_code=[!0,"Person Code must be exactly 8 digits"],_=!1);const R=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return n.email&&!R.test(n.email)&&(T.email=[!0,"Invalid email format"],_=!1),n.email!==n.email_confirm?(T.email_confirm=[!0,"Emails do not match"],_=!1):T.email_confirm=[!1,""],Object.entries(x).forEach(([j,W])=>{W?D[j]=!1:(D[j]=!0,_=!1)}),h(T),C(D),_||l({message:"Error in form submission, check the errors below",state:"error"}),_},S=()=>{window.scrollTo({top:0,behavior:"smooth"})},F=_=>V(_).format("YYYY-MM-DD"),M=_=>{I({...n,[_.target.name]:_.target.value}),r[_.target.name]&&h({...r,[_.target.name]:[!1,""]})},J=(_,T)=>{I({...n,[_]:T})},A=_=>{const{name:T,checked:D}=_.target;a({...x,[T]:D}),D&&C({...E,[T]:!1})},L=_=>{if(_.preventDefault(),!v()){S();return}l(null),y(!0);let T={...n,whatsapp_prefix:t?n.phone_prefix:n.whatsapp_prefix,whatsapp_number:t?n.phone_number:n.whatsapp_number,birthdate:F(n.birthdate),document_expiration:F(n.document_expiration),matricola_expiration:F(n.matricola_expiration)};(async()=>{try{const d=await K("POST","/profile/initiate-creation/",T,{},!1),z=await d.json();if(h(g),d.ok)u(!0);else{l({message:"Failed to submit application: see errors below",state:"error"});const f={...r};Object.entries(z).forEach(([R,j])=>{f[R]&&(f[R]=[!0,j])}),h(f)}}catch(d){H(d),l({message:"Internal error (please contact us): "+d.message,state:"error"})}finally{y(!1)}})().then()},N=_=>{o(_.target.checked),_.target.checked&&I({...n,whatsapp_prefix:n.phone_prefix,whatsapp_number:n.phone_number})};return p?e.jsxs(b,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",bgcolor:"#fff",children:[e.jsx(va,{style:{fontSize:100,color:_a[500]}}),e.jsx(P,{variant:"h4",align:"center",gutterBottom:!0,children:"Your response has been sent."}),e.jsx(P,{variant:"subtitle1",align:"center",children:"Check your inbox to verify your e-mail."}),e.jsxs(P,{variant:"body2",align:"center",sx:{mt:2},children:["In case you do not receive an email, please check your spam folder or contact us at ",e.jsx(ye,{href:"mailto: informatica@esnpolimi.it",children:"informatica@esnpolimi.it"})]})]}):e.jsxs(b,{component:"form",noValidate:!0,sx:{maxWidth:800,margin:"auto",mt:5,mb:5,px:4},onSubmit:L,children:[e.jsx(P,{variant:"h4",align:"center",gutterBottom:!0,mb:5,children:"ESN Polimi Registration - International Student"}),m&&e.jsx(Ne,{message:m.message,state:m.state}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,sx:{my:4},children:"Personal Information"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(G,{label:"Name",variant:"outlined",name:"name",value:n.name,onChange:M,fullWidth:!0,required:!0,error:r.name[0],helperText:r.name[1]})}),e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(G,{label:"Surname",variant:"outlined",name:"surname",value:n.surname,onChange:M,fullWidth:!0,required:!0,error:r.surname[0],helperText:r.surname[1]})}),e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(fe,{dateAdapter:Ee,adapterLocale:"en-gb",children:e.jsx(ve,{label:"Birthdate",value:n.birthdate,onChange:_=>J("birthdate",_),maxDate:V(),slotProps:{textField:{variant:"outlined"}}})})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(G,{label:"Email",variant:"outlined",name:"email",type:"email",value:n.email,onChange:M,fullWidth:!0,required:!0,error:r.email[0],helperText:r.email[1]})}),e.jsxs(c,{size:{xs:12,sm:6},children:[e.jsx(G,{label:"Confirm Email",variant:"outlined",name:"email_confirm",type:"email",value:n.email_confirm,onChange:M,fullWidth:!0,required:!0,error:r.email_confirm[0],helperText:r.email_confirm[1]}),e.jsx(b,{sx:{mt:1},children:n.email_confirm&&e.jsxs(P,{variant:"caption",sx:{display:"flex",alignItems:"center",color:n.email===n.email_confirm?"green":"grey"},children:[n.email===n.email_confirm?e.jsx(Ge,{fontSize:"small",sx:{mr:.5}}):e.jsx(Se,{fontSize:"small",sx:{mr:.5}}),n.email===n.email_confirm?"The emails match":"The emails do not match"]})})]}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(re,{id:"country-label",children:"Home University Country"}),e.jsx(oe,{variant:"outlined",labelId:"country-label",name:"country",value:n.country,onChange:M,label:"Home University Country",error:r.country[0],children:ze.map(_=>e.jsx(Y,{value:_.code,children:_.name},_.code))})]})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(G,{label:"Home Domicile",variant:"outlined",name:"domicile",value:n.domicile,onChange:M,fullWidth:!0,required:!0,error:r.domicile[0],helperText:r.domicile[1]})}),e.jsx(c,{size:{xs:4,sm:2},children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(re,{id:"phone-prefix-label",children:"Prefix"}),e.jsx(oe,{variant:"outlined",labelId:"phone-prefix-label",id:"phone-prefix",name:"phone_prefix",value:n.phone_prefix,onChange:M,label:"Prefix",renderValue:_=>_,error:r.phone_prefix[0],children:ze.map(_=>e.jsxs(Y,{value:_.dial,children:[_.dial," (",_.name,")"]},_.code))})]})}),e.jsx(c,{size:{xs:8,sm:4},children:e.jsx(G,{label:"Phone Number",variant:"outlined",name:"phone_number",type:"number",value:n.phone_number,onChange:M,fullWidth:!0,required:!0,error:r.phone_number[0],helperText:r.phone_number[1]})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(we,{control:e.jsx(Pe,{checked:t,onChange:N,name:"sameAsPhone",color:"primary"}),label:"Same number for WhatsApp"})}),!t&&e.jsxs(e.Fragment,{children:[e.jsx(c,{size:{xs:4,sm:2},children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(re,{id:"whatsapp-prefix-label",children:"Prefix"}),e.jsx(oe,{variant:"outlined",labelId:"whatsapp-prefix-label",id:"whatsapp-prefix",name:"whatsapp_prefix",value:n.whatsapp_prefix,onChange:M,label:"Prefix",renderValue:_=>_,error:r.whatsapp_prefix[0],children:ze.map(_=>e.jsxs(Y,{value:_.dial,children:[_.dial," (",_.name,")"]},_.code))})]})}),e.jsx(c,{size:{xs:8,sm:4},children:e.jsx(G,{label:"Whatsapp Number",variant:"outlined",name:"whatsapp_number",type:"number",value:n.whatsapp_number,onChange:M,fullWidth:!0,required:!0,error:r.whatsapp_number[0],helperText:r.whatsapp_number[1]})})]})]}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Document Information"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{size:{xs:12,sm:4},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(re,{id:"idType-label",children:"Type"}),e.jsxs(oe,{variant:"outlined",labelId:"document-type-label",name:"document_type",value:n.document_type,onChange:M,label:"Type",required:!0,error:r.document_type[0],children:[e.jsx(Y,{value:"Passport",children:"Passport"}),e.jsx(Y,{value:"ID Card",children:"ID Card"}),e.jsx(Y,{value:"Driving License",children:"Driving License"}),e.jsx(Y,{value:"Residency Permit",children:"Residency Permit"}),e.jsx(Y,{value:"Other",children:"Other"})]})]})}),e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(G,{label:"Number",variant:"outlined",name:"document_number",value:n.document_number,onChange:M,fullWidth:!0,required:!0,error:r.document_number[0],helperText:r.document_number[1]})}),e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(fe,{dateAdapter:Ee,adapterLocale:"en-gb",children:e.jsx(ve,{label:"Expiration Date",value:n.document_expiration,onChange:_=>J("document_expiration",_),slotProps:{textField:{variant:"outlined"}}})})})]}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Exchange Information"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{size:{xs:12,sm:6},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(re,{id:"course-label",children:"Field of Study"}),e.jsxs(oe,{variant:"outlined",labelId:"course-label",name:"course",value:n.course,onChange:M,label:"Field of Study",error:r.course[0],children:[e.jsx(Y,{value:"Engineering",children:"Engineering"}),e.jsx(Y,{value:"Design",children:"Design"}),e.jsx(Y,{value:"Architecture",children:"Architecture"})]})]})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(fe,{dateAdapter:Ee,adapterLocale:"en-gb",children:e.jsx(ve,{label:"Exchange End Date",value:n.matricola_expiration,onChange:_=>J("matricola_expiration",_),slotProps:{textField:{variant:"outlined"}}})})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(G,{label:"Person Code (8 digits)",variant:"outlined",name:"person_code",type:"number",value:n.person_code,onChange:M,fullWidth:!0,required:!0,error:r.person_code[0],helperText:r.person_code[1]})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(G,{label:"Matricola (6 digits)",variant:"outlined",name:"matricola_number",type:"number",value:n.matricola_number,onChange:M,fullWidth:!0,required:!0,error:r.matricola_number[0],helperText:r.matricola_number[1]})}),e.jsx(c,{size:{xs:12},children:e.jsxs(P,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["You can find your Person Code and Matricola in the Polimi App under your profile section, or from the Online Services.",e.jsx("br",{})," In case the university has not provided you a Matricola yet, you can fill the field with 6 0s."]})})]}),e.jsxs(c,{container:!0,spacing:3,mt:3,children:[e.jsx(c,{size:{xs:12},children:e.jsx(we,{control:e.jsx(Pe,{name:"acceptStatute",checked:x.acceptStatute,onChange:A,required:!0,sx:{color:E.acceptStatute?"red":void 0,"&.Mui-checked":{color:E.acceptStatute?"red":void 0}}}),label:e.jsxs("span",{children:["I declare that I have read and accepted the"," ",e.jsx(ye,{href:i.statute,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"ESN Politecnico Milano Charter"})]})})}),e.jsx(c,{size:{xs:12},children:e.jsx(we,{control:e.jsx(Pe,{name:"acceptPurposes",checked:x.acceptPurposes,onChange:A,required:!0,sx:{color:E.acceptPurposes?"red":void 0,"&.Mui-checked":{color:E.acceptPurposes?"red":void 0}}}),label:"I declare that I fully share the aims of the Association (ref. Article 2 of the Charter)"})}),e.jsx(c,{size:{xs:12},children:e.jsx(we,{control:e.jsx(Pe,{name:"acceptRegulation",checked:x.acceptRegulation,onChange:A,required:!0,sx:{color:E.acceptRegulation?"red":void 0,"&.Mui-checked":{color:E.acceptRegulation?"red":void 0}}}),label:e.jsxs("span",{children:["I declare that I accept all the terms stated in the"," ",e.jsx(ye,{href:i.regulation,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Internal Rules"})," ","and all subsequent changes and additions"]})})}),e.jsx(c,{size:{xs:12},children:e.jsx(we,{control:e.jsx(Pe,{name:"acceptPrivacy",checked:x.acceptPrivacy,onChange:A,required:!0,sx:{color:E.acceptPrivacy?"red":void 0,"&.Mui-checked":{color:E.acceptPrivacy?"red":void 0}}}),label:e.jsxs("span",{children:["I declare that I have read the attached"," ",e.jsx(ye,{href:i.privacy,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Privacy Disclaimer"})," ","and that I agree to the usage of my personal data according to the Regulation EU 2016/679 (GDPR) and to be aware of my guaranteed rights by the afore-mentioned law"]})})})]}),e.jsx(Z,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:4},startIcon:!w&&e.jsx(Sa,{}),disabled:w,children:w?e.jsx(Be,{size:24,color:"inherit"}):"Submit"})]})}const B={id:"Id",name:"Nome",surname:"Cognome",group:"Gruppo",email:"Email",phone_prefix:"Prefisso Tel",phone_number:"Numero Telefono",whatsapp_prefix:"Prefisso WA",whatsapp_number:"Numero WhatsApp",country:"Paese",birthdate:"Data di Nascita",latest_esncard:"ESNcard",latest_document:"Documento",matricola_number:"Matricola",matricola_expiration:"Scadenza Matricola",course:"Corso di Studi",person_code:"Codice Persona",domicile:"Domicilio"},ge={id:"Id",name:"Nome Evento",date:"Data Evento",description:"Descrizione",cost:"Costo (€)",subscription_start_date:"Data Apertura Iscrizioni",subscription_end_date:"Data Chiusura Iscrizioni",subscription_date_status:"Stato Iscrizioni",list_name:"Nome Lista",list_capacity:"Capacità Lista"},he={id:"Id",name:"Nome",status:"Stato",balance:"Saldo",changed_by:"Ultima Modifica",visible_to_groups:"Gruppi di Visibilità"},ne={date:"Data",type:"Tipo",description:"Descrizione",amount:"Importo",executor:"Eseguito da",account:"Cassa",tran_type:{event:"Evento",esncard:"ESNcard",deposit:"Deposito",withdrawal:"Prelievo",subscription:"Iscrizione"}};function Ls(){const[p,u]=xe.useState(!1),[t,o]=s.useState(null),[m,l]=s.useState(!1),[w,y]=s.useState({password:!1,password_confirm:!1}),x=B,[a,E]=xe.useState({email:"",email_confirm:"",password:"",password_confirm:"",name:"",surname:"",birthdate:V(),country:"IT",phone_prefix:"+39",phone_number:"",person_code:"",domicile:"",document_type:"ID Card",document_number:"",document_expiration:V(),matricola_number:"",is_esner:!0}),C={email:[!1,""],email_confirm:[!1,""],password:[!1,""],password_confirm:[!1,""],name:[!1,""],surname:[!1,""],birthdate:[!1,""],country:[!1,""],phone_prefix:[!1,""],phone_number:[!1,""],person_code:[!1,""],domicile:[!1,""],document_type:[!1,""],document_number:[!1,""],document_expiration:[!1,""],matricola_number:[!1,""],is_esner:[!1,""]},[i,n]=xe.useState(C),[I,g]=s.useState({acceptStatute:!1,acceptPurposes:!1,acceptRegulation:!1,acceptPrivacy:!1}),[r,h]=s.useState({acceptStatute:!1,acceptPurposes:!1,acceptRegulation:!1,acceptPrivacy:!1}),v={statute:"https://drive.google.com/file/d/1rYtF01hrvQDIYHPebn1nNTDUOazS0kK2/view?usp=sharing",regulation:"https://drive.google.com/file/d/1ZuPfEshihDJ3lvoKyiQ_1L1BpsxBuZdq/view?usp=sharing",privacy:"https://drive.google.com/file/d/12LY0y49cCyjqdF0RotsO6srHrGkinNln/view?usp=sharing"},S=[{label:"Almeno 10 caratteri",test:d=>d.length>=10},{label:"Almeno 1 numero",test:d=>/\d/.test(d)},{label:"Almeno 1 lettera maiuscola",test:d=>/[A-Z]/.test(d)}],F=()=>{let d=!0;const z={...i},f={...r};["email","email_confirm","password","password_confirm","name","surname","birthdate","country","phone_prefix","phone_number","person_code","domicile","document_type","document_number","document_expiration","matricola_number"].forEach(ee=>{!a[ee]||typeof a[ee]=="string"&&a[ee].trim()===""?(z[ee]=[!0,"Questo campo è obbligatorio"],d=!1):z[ee]=[!1,""]}),/^\d{6}$/.test(a.matricola_number)?z.matricola_number=[!1,""]:(z.matricola_number=[!0,"La Matricola deve essere di 6 cifre"],d=!1),/^\d{8}$/.test(a.person_code)?z.person_code=[!1,""]:(z.person_code=[!0,"Il Codice Persona deve essere di 8 cifre"],d=!1);const ie=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return a.email&&!ie.test(a.email)&&(z.email=[!0,"Formato email non valido"],d=!1),a.email!==a.email_confirm?(z.email_confirm=[!0,"Le email non corrispondono"],d=!1):z.email_confirm=[!1,""],a.password!==a.password_confirm?(z.password_confirm=[!0,"Le password non corrispondono"],d=!1):z.password_confirm=[!1,""],Object.entries(I).forEach(([ee,O])=>{O?f[ee]=!1:(f[ee]=!0,d=!1)}),n(z),h(f),d||o({message:"Errore nella compilazione del form, controlla i campi evidenziati.",state:"error"}),d},M=()=>{window.scrollTo({top:0,behavior:"smooth"})},J=d=>V(d).format("YYYY-MM-DD"),A=d=>{E({...a,[d.target.name]:d.target.value}),i[d.target.name]&&n({...i,[d.target.name]:[!1,""]})},L=(d,z)=>{E({...a,[d]:z})},N=d=>{const{name:z,checked:f}=d.target;g({...I,[z]:f}),f&&h({...r,[z]:!1})},_=d=>z=>{y(f=>({...f,[d]:z.getModifierState&&z.getModifierState("CapsLock")}))},T=d=>z=>{y(f=>({...f,[d]:z.getModifierState&&z.getModifierState("CapsLock")}))},D=d=>{if(d.preventDefault(),!F()){M();return}o(null),l(!0);let z={...a,birthdate:J(a.birthdate),document_expiration:J(a.document_expiration),matricola_expiration:J(a.matricola_expiration)};(async()=>{try{const R=await K("POST","/profile/initiate-creation/",z,{},!1),j=await R.json();if(n(C),R.ok)u(!0);else{o({message:"Errore nell'invio dati, guarda gli errori sotto",state:"error"});const W={...i};Object.entries(j).forEach(([ie,ee])=>{W[ie]&&(W[ie]=[!0,ee])}),n(W)}}catch(R){H(R),o({message:"Internal error (please contact us): "+R.message,state:"error"})}finally{l(!1)}})().then()};return p?e.jsxs(b,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",bgcolor:"#fff",children:[e.jsx(va,{style:{fontSize:100,color:_a[500]}}),e.jsx(P,{variant:"h4",align:"center",gutterBottom:!0,children:"La tua richiesta di registrazione è stata inviata con successo!"}),e.jsx(P,{variant:"subtitle1",align:"center",children:"Controlla la tua email per ulteriori istruzioni."}),e.jsxs(P,{variant:"body2",align:"center",sx:{mt:2},children:["In caso non avessi ricevuto nulla, controlla la cartella spam o contattaci all'indirizzo ",e.jsx(ye,{href:"mailto: informatica@esnpolimi.it",children:"informatica@esnpolimi.it"})]}),e.jsx(ye,{href:"/login",underline:"always",sx:{mt:3},children:"Torna al Login"})]}):e.jsxs(b,{component:"form",noValidate:!0,sx:{maxWidth:800,margin:"auto",mt:5,mb:5,px:4},onSubmit:D,children:[e.jsx(P,{variant:"h4",align:"center",gutterBottom:!0,mb:5,children:"ESN Polimi - Registrazione ESNer"}),t&&e.jsx(Ne,{message:t.message,state:t.state}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,sx:{my:4},children:"Informazioni Personali"}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(G,{label:x.name,variant:"outlined",name:"name",value:a.name,onChange:A,fullWidth:!0,required:!0,error:i.name[0],helperText:i.name[1]})}),e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(G,{label:x.surname,variant:"outlined",name:"surname",value:a.surname,onChange:A,fullWidth:!0,required:!0,error:i.surname[0],helperText:i.surname[1]})}),e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(fe,{dateAdapter:Ee,adapterLocale:"en-gb",children:e.jsx(ve,{label:x.birthdate,value:a.birthdate,onChange:d=>L("birthdate",d),maxDate:V(),required:!0,slotProps:{textField:{variant:"outlined"}}})})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(G,{label:x.email,variant:"outlined",name:"email",type:"email",value:a.email,onChange:A,fullWidth:!0,required:!0,error:i.email[0],helperText:i.email[1]})}),e.jsxs(c,{size:{xs:12,sm:6},children:[e.jsx(G,{label:"Conferma Email",variant:"outlined",name:"email_confirm",type:"email",value:a.email_confirm,onChange:A,fullWidth:!0,required:!0,error:i.email_confirm[0],helperText:i.email_confirm[1]}),e.jsx(b,{sx:{mt:1},children:a.email_confirm&&e.jsxs(P,{variant:"caption",sx:{display:"flex",alignItems:"center",color:a.email===a.email_confirm?"green":"grey"},children:[a.email===a.email_confirm?e.jsx(Ge,{fontSize:"small",sx:{mr:.5}}):e.jsx(Se,{fontSize:"small",sx:{mr:.5}}),a.email===a.email_confirm?"Le due email coincidono":"Le email non corrispondono"]})})]}),e.jsxs(c,{size:{xs:12,sm:6},children:[e.jsx(G,{type:"password",label:"Password",variant:"outlined",name:"password",value:a.password,onChange:A,onKeyDown:_("password"),onKeyUp:T("password"),fullWidth:!0,required:!0,error:i.password[0],helperText:i.password[1]}),w.password&&e.jsxs(b,{sx:{display:"flex",alignItems:"center",color:"orange",mt:.5},children:[e.jsx(ua,{fontSize:"small",sx:{mr:.5}}),e.jsx(P,{variant:"caption",children:"Attenzione: il tasto Bloc Maiusc è attivo"})]}),e.jsxs(b,{sx:{mt:1,mb:2},children:[e.jsx(P,{variant:"caption",color:"text.secondary",children:"La password deve contenere:"}),e.jsx("ul",{style:{margin:0,paddingLeft:20},children:S.map((d,z)=>{const f=d.test(a.password);return e.jsxs("li",{style:{color:f?"green":"grey",display:"flex",alignItems:"center",marginBottom:2},children:[f?e.jsx(Ge,{fontSize:"small",sx:{mr:.5}}):e.jsx(Se,{fontSize:"small",sx:{mr:.5}}),e.jsx("span",{children:d.label})]},z)})})]})]}),e.jsxs(c,{size:{xs:12,sm:6},children:[e.jsx(G,{type:"password",label:"Conferma Password",variant:"outlined",name:"password_confirm",value:a.password_confirm,onChange:A,onKeyDown:_("password_confirm"),onKeyUp:T("password_confirm"),fullWidth:!0,required:!0,error:i.password_confirm[0],helperText:i.password_confirm[1]}),w.password_confirm&&e.jsxs(b,{sx:{display:"flex",alignItems:"center",color:"orange",mt:.5},children:[e.jsx(ua,{fontSize:"small",sx:{mr:.5}}),e.jsx(P,{variant:"caption",children:"Attenzione: il tasto Bloc Maiusc è attivo"})]}),e.jsx(b,{sx:{mt:1},children:a.password_confirm&&e.jsxs(P,{variant:"caption",sx:{display:"flex",alignItems:"center",color:a.password===a.password_confirm?"green":"grey"},children:[a.password===a.password_confirm?e.jsx(Ge,{fontSize:"small",sx:{mr:.5}}):e.jsx(Se,{fontSize:"small",sx:{mr:.5}}),a.password===a.password_confirm?"Le password corrispondono":"Le password non corrispondono"]})})]}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(re,{id:"country-label",children:x.country}),e.jsx(oe,{variant:"outlined",labelId:"country-label",name:"country",value:a.country,onChange:A,label:x.country,error:i.country[0],children:ze.map(d=>e.jsx(Y,{value:d.code,children:d.name},d.code))})]})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(G,{label:x.domicile,variant:"outlined",name:"domicile",value:a.domicile,onChange:A,fullWidth:!0,required:!0,error:i.domicile[0],helperText:i.domicile[1]})}),e.jsx(c,{size:{xs:4,sm:2},children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(re,{id:"phone-prefix-label",children:x.phone_prefix}),e.jsx(oe,{variant:"outlined",labelId:"phone-prefix-label",id:"phone-prefix",name:"phone_prefix",value:a.phone_prefix,onChange:A,label:x.phone_prefix,renderValue:d=>d,error:i.phone_prefix[0],children:ze.map(d=>e.jsxs(Y,{value:d.dial,children:[d.dial," (",d.name,")"]},d.code))})]})}),e.jsx(c,{size:{xs:8,sm:4},children:e.jsx(G,{label:x.phone_number,variant:"outlined",name:"phone_number",type:"number",value:a.phone_number,onChange:A,fullWidth:!0,required:!0,error:i.phone_number[0],helperText:i.phone_number[1]})})]}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Informazioni Documento"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{size:{xs:12,sm:4},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(re,{id:"idType-label",children:"Tipo"}),e.jsxs(oe,{variant:"outlined",labelId:"document-type-label",name:"document_type",value:a.document_type,onChange:A,label:"Tipo",required:!0,error:i.document_type[0],children:[e.jsx(Y,{value:"Passport",children:"Passport"}),e.jsx(Y,{value:"ID Card",children:"ID Card"}),e.jsx(Y,{value:"Driving License",children:"Driving License"}),e.jsx(Y,{value:"Residency Permit",children:"Residency Permit"}),e.jsx(Y,{value:"Other",children:"Other"})]})]})}),e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(G,{label:"Numero",variant:"outlined",name:"document_number",value:a.document_number,onChange:A,fullWidth:!0,required:!0,error:i.document_number[0],helperText:i.document_number[1]})}),e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(fe,{dateAdapter:Ee,adapterLocale:"en-gb",children:e.jsx(ve,{label:"Data di Scadenza",value:a.document_expiration,onChange:d=>L("document_expiration",d),slotProps:{textField:{variant:"outlined"}}})})})]}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Informazioni Studente"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(G,{label:x.person_code,variant:"outlined",name:"person_code",type:"number",value:a.person_code,onChange:A,fullWidth:!0,required:!0,error:i.person_code[0],helperText:i.person_code[1]})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(G,{label:x.matricola_number,variant:"outlined",name:"matricola_number",type:"number",value:a.matricola_number,onChange:A,fullWidth:!0,required:!0,error:i.matricola_number[0],helperText:i.matricola_number[1]})})]}),e.jsxs(c,{container:!0,spacing:2,mt:3,children:[e.jsx(c,{size:{xs:12},children:e.jsx(we,{control:e.jsx(Pe,{name:"acceptStatute",checked:I.acceptStatute,onChange:N,required:!0,sx:{color:r.acceptStatute?"red":void 0,"&.Mui-checked":{color:r.acceptStatute?"red":void 0}}}),label:e.jsxs("span",{children:["Dichiaro di aver letto e accettato lo"," ",e.jsx(ye,{href:v.statute,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Statuto di ESN Politecnico Milano"})]})})}),e.jsx(c,{size:{xs:12},children:e.jsx(we,{control:e.jsx(Pe,{name:"acceptPurposes",checked:I.acceptPurposes,onChange:N,required:!0,sx:{color:r.acceptPurposes?"red":void 0,"&.Mui-checked":{color:r.acceptPurposes?"red":void 0}}}),label:"Dichiaro di condividere pienamente gli scopi dell'Associazione (rif. Articolo 2 dello Statuto)"})}),e.jsx(c,{size:{xs:12},children:e.jsx(we,{control:e.jsx(Pe,{name:"acceptRegulation",checked:I.acceptRegulation,onChange:N,required:!0,sx:{color:r.acceptRegulation?"red":void 0,"&.Mui-checked":{color:r.acceptRegulation?"red":void 0}}}),label:e.jsxs("span",{children:["Dichiaro di accettare tutti i termini indicati nello"," ",e.jsx(ye,{href:v.regulation,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Regolamento Interno"})," ","e tutte le successive modifiche e integrazioni"]})})}),e.jsx(c,{size:{xs:12},children:e.jsx(we,{control:e.jsx(Pe,{name:"acceptPrivacy",checked:I.acceptPrivacy,onChange:N,required:!0,sx:{color:r.acceptPrivacy?"red":void 0,"&.Mui-checked":{color:r.acceptPrivacy?"red":void 0}}}),label:e.jsxs("span",{children:["Dichiaro di aver letto l'",e.jsx(ye,{href:v.privacy,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Informativa sulla Privacy"})," ","e di acconsentire al trattamento dei miei dati personali secondo il Regolamento UE 2016/679 (GDPR) e di essere consapevole dei miei diritti garantiti dalla suddetta legge"]})})})]}),e.jsx(Z,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:4},startIcon:!m&&e.jsx(Sa,{}),disabled:m,children:m?e.jsx(Be,{size:24,color:"inherit"}):"Conferma Dati"})]})}function be({size:p=40,fullScreen:u=!1}){return e.jsx(b,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:u?"100vh":"100%",width:"100%",position:u?"fixed":"relative",top:0,left:0,zIndex:u?1300:1,backgroundColor:u?"rgba(255, 255, 255, 0.7)":"transparent"},children:e.jsx(Be,{size:p})})}const xa=[{value:"valid",label:"Valida"},{value:"expired",label:"Scaduta"},{value:"absent",label:"Assente"}];function La({apiEndpoint:p,columns:u,columnVisibility:t,profileType:o}){const[m,l]=s.useState([]),[w,y]=s.useState({pageIndex:0,pageSize:10}),[x,a]=s.useState(0),[E,C]=s.useState([]),[i,n]=s.useState({esncardValidity:[],group:[]}),[I,g]=s.useState(""),[r,h]=s.useState(""),[v,S]=s.useState(!0),F=s.useRef(null),M=_e();s.useEffect(()=>{S(!0),(async()=>{try{const T=new URLSearchParams;T.append("page",w.pageIndex+1),T.append("page_size",w.pageSize),r&&T.append("search",r),i.esncardValidity.length&&T.append("esncardValidity",i.esncardValidity.join(",")),i.group.length&&T.append("group",i.group.join(","));const d=await(await K("GET",`${p}?${T.toString()}`)).json();a(d.count||0),l(d.results)}catch(T){H(T)}finally{S(!1)}})().then(),o==="ESNer"&&K("GET","/groups/").then(T=>{T.ok&&T.json().then(D=>C(D))})},[p,w.pageIndex,w.pageSize,o,i,r]);const J=()=>{h(I),y(_=>({..._,pageIndex:0}))},A=()=>{g(""),h(""),y(_=>({..._,pageIndex:0})),F.current&&F.current.focus()},L=Me({columns:u,data:m,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableColumnPinning:!0,enableFacetedValues:!0,enableRowActions:!0,enableRowSelection:!1,enableRowPinning:!1,enableExpandAll:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},columnVisibility:t},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",enableGlobalFilter:!1,muiPaginationProps:{color:"secondary",rowsPerPageOptions:[10,20,50],shape:"rounded",variant:"outlined"},manualPagination:!0,rowCount:x,onPaginationChange:y,state:{pagination:w},localization:Ae,muiTableBodyRowProps:()=>({}),renderRowActions:({row:_})=>e.jsx(U,{"aria-label":"Modifica profilo",onClick:T=>{T.stopPropagation(),M(`/profile/${_.original.id.toString()}`)},children:e.jsx(Ga,{})})}),N=_=>{const{name:T,value:D}=_.target;n(d=>({...d,[T]:typeof D=="string"?D.split(","):D}))};return e.jsxs(b,{sx:{mx:"5%"},children:[e.jsxs(c,{container:!0,spacing:2,sx:{mb:2,mt:2},alignItems:"center",justifyContent:"flex-end",children:[e.jsx(c,{size:{xs:12,sm:2},children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(re,{id:"esncard-validity-label",children:"Validità ESNcard"}),e.jsx(oe,{labelId:"esncard-validity-label",name:"esncardValidity",variant:"outlined",multiple:!0,value:i.esncardValidity,onChange:N,input:e.jsx(Te,{label:"Validità ESNcard"}),renderValue:_=>xa.filter(T=>_.includes(T.value)).map(T=>T.label).join(", "),children:xa.map(_=>e.jsx(Y,{value:_.value,children:_.label},_.value))})]})}),o==="ESNer"&&E.length>0&&e.jsx(c,{size:{xs:12,sm:2},children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(re,{id:"group-label",children:"Gruppo"}),e.jsx(oe,{labelId:"group-label",name:"group",variant:"outlined",multiple:!0,value:i.group,onChange:N,input:e.jsx(Te,{label:"Gruppo"}),renderValue:_=>E.filter(T=>_.includes(T.name)).map(T=>T.name).join(", "),children:E.map(_=>e.jsx(Y,{value:_.name,children:_.name},_.name))})]})}),e.jsx(c,{size:{xs:12,sm:"auto"},children:e.jsx(Te,{inputRef:F,size:"small",placeholder:"Cerca",value:I,onChange:_=>g(_.target.value),onKeyDown:_=>{_.key==="Enter"&&J()},endAdornment:I&&r===I?e.jsx(U,{"aria-label":"clear",onClick:A,edge:"end",children:e.jsx($e,{})}):e.jsx(U,{"aria-label":"search",onClick:J,edge:"end",children:e.jsx(oa,{})})})})]}),v?e.jsx(be,{}):e.jsx(Re,{table:L})]})}const Fs=()=>{const{logout:p}=Fe(),u=_e(),t=()=>{p(),u("/login")};return e.jsx(U,{variant:"contained",sx:{backgroundColor:"black",color:"white"},onClick:t,children:e.jsx(Ka,{})})};function ke(){const{isDrawerOpen:p,toggleDrawer:u,closeDrawer:t,expandedSection:o,handleExpand:m}=Ds(),{user:l}=Fe(),w=_e(),y=i=>l?.permissions?.includes(i)||!1,x=[{text:"Home",icon:e.jsx(Va,{}),path:"/"},{text:"Tesoreria",icon:e.jsx(qa,{}),path:"/treasury",requiredPermission:"change_account"},{text:"Eventi",icon:e.jsx(ia,{}),path:"/events"},{text:"Profili",icon:e.jsx(na,{}),children:[{text:"Erasmus",icon:e.jsx(Ca,{}),path:"/profiles/erasmus"},{text:"ESNers",icon:e.jsx(wa,{}),path:"/profiles/esners"}]}].filter(i=>!i.requiredPermission||y(i.requiredPermission)),a=s.useCallback(()=>{w(`/profile/${l.profile.id.toString()}`)},[w,l?.profile?.id]),E=i=>{(i.button===0||i.button===1)&&t()},C=e.jsxs(b,{sx:{width:250,display:"flex",flexDirection:"column",height:"100%"},role:"presentation",onClick:u(!1),onKeyDown:u(!1),children:[e.jsx(b,{sx:{flexGrow:1},children:x.map(i=>e.jsx(xe.Fragment,{children:i.children?e.jsxs(xe.Fragment,{children:[e.jsxs(Ha,{onClick:n=>{n.stopPropagation(),m(i.text)},children:[e.jsx(sa,{children:i.icon}),e.jsx(ta,{primary:i.text,slotProps:{primary:{style:{color:"black"}}}}),o===i.text?e.jsx(Ea,{}):e.jsx(Ta,{})]}),e.jsx(za,{in:o===i.text,timeout:"auto",unmountOnExit:!0,children:e.jsx(Ya,{component:"div",disablePadding:!0,children:i.children?.map(n=>e.jsxs(ma,{component:ha,to:n.path,onClick:E,onAuxClick:E,sx:{pl:4},children:[e.jsx(sa,{children:n.icon}),e.jsx(ta,{primary:n.text,slotProps:{primary:{style:{color:"black"}}}})]},n.text))||[]})})]},i.text):e.jsxs(ma,{component:ha,to:i.path,onClick:E,onAuxClick:E,children:[e.jsx(sa,{children:i.icon}),e.jsx(ta,{primary:i.text,slotProps:{primary:{style:{color:"black"}}}})]},i.text)},i.text))}),l&&e.jsxs(b,{sx:{mt:"auto",mb:2,ml:.5,mr:.5,px:2,py:1.5,display:"flex",alignItems:"center",borderRadius:2,background:"#f5f5f5",boxShadow:1,gap:1},children:[e.jsx(U,{onClick:a,"aria-label":"Profile",sx:{background:"#e0e0e0",mr:.5,width:44,height:44,"&:hover":{background:"#d1c4e9"}},children:e.jsx(na,{sx:{fontSize:28}})}),e.jsx(b,{sx:{flexGrow:1,minWidth:0},children:e.jsx(P,{variant:"title",sx:{fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:l.profile.name.length>10?l.profile.name.slice(0,10)+"...":l.profile.name})}),e.jsx(Fs,{})]})]});return e.jsxs(b,{sx:{display:"flex"},children:[e.jsx(U,{edge:"start",color:"inherit","aria-label":"menu",onClick:u(!0),sx:{margin:"10px"},children:e.jsx(Ua,{})}),e.jsx(Ja,{anchor:"left",open:p,onClose:u(!1),children:C})]})}function Rs(){const p=s.useMemo(()=>[{accessorKey:"id",header:B.id,size:50},{accessorKey:"name",header:B.name,size:150},{accessorKey:"surname",header:B.surname,size:150},{accessorKey:"email",header:B.email,size:150},{accessorKey:"latest_esncard",header:B.latest_esncard,size:50,Cell:({cell:t})=>e.jsx(b,{sx:{},children:t.getValue()!==null?e.jsx(te,{label:t.getValue().number,color:t.getValue().is_valid?"success":"warning"}):e.jsx(te,{label:"Nessuna ESNcard",color:"error"})})},{accessorKey:"country",header:B.country,size:150,Cell:({row:t})=>{const o=t.original.country,m=ze.find(l=>l.code===o);return m?m.name:o||"(vuoto)"}},{accessorKey:"birthdate",header:B.birthdate,size:100},{accessorKey:"course",header:B.course,size:100},{accessorKey:"phone_prefix",header:"Prefisso Telefono",size:60},{accessorKey:"phone_number",header:"Numero Telefono (no prefisso)",size:120},{id:"fullPhoneNumber",header:B.phone_number,size:150,accessorFn:t=>`(${t.phone_prefix||"vuoto"}) ${t.phone_number||"(vuoto)"}`,Cell:({row:t})=>e.jsxs("span",{children:["(",t.original.phone_prefix||"vuoto",") ",t.original.phone_number||"(vuoto)"]})},{accessorKey:"whatsapp_prefix",header:"Prefisso WhatsApp",size:60},{accessorKey:"whatsapp_number",header:"Numero WhatsApp (no prefisso)",size:120},{id:"fullWANumber",header:B.whatsapp_number,size:150,accessorFn:t=>`(${t.whatsapp_prefix||"vuoto"}) ${t.whatsapp_number||"(vuoto)"}`,Cell:({row:t})=>e.jsxs("span",{children:["(",t.original.whatsapp_prefix||"vuoto",") ",t.original.whatsapp_number||"(vuoto)"]})},{accessorKey:"domicile",header:B.domicile,size:200},{accessorKey:"matricola_number",header:B.matricola_number,size:50},{accessorKey:"matricola_expiration",header:B.matricola_expiration,size:50},{accessorKey:"latest_document.number",header:B.latest_document,size:50}],[]),u={id:!0,name:!0,surname:!0,email:!0,country:!1,birthdate:!1,course:!1,fullPhoneNumber:!0,fullWANumber:!0,person_code:!1,domicile:!1,matricola_number:!1,matricola_expiration:!1,"latest_document.number":!1,phone_prefix:!1,phone_number:!1,whatsapp_prefix:!1,whatsapp_number:!1};return e.jsxs(b,{children:[e.jsx(ke,{}),e.jsx(b,{sx:{mx:"5%"},children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(Ca,{sx:{marginRight:"10px"}}),e.jsx(P,{variant:"h4",children:"Profili Erasmus"})]})}),e.jsx(La,{apiEndpoint:"/erasmus_profiles/",columns:p,columnVisibility:u,profileType:"Erasmus"})]})}function Ns(){const p=s.useMemo(()=>[{accessorKey:"id",header:B.id,size:50},{accessorKey:"name",header:B.name,size:150},{accessorKey:"surname",header:B.surname,size:150},{accessorKey:"group",header:B.group,size:150,Cell:({cell:t})=>{const o=t.getValue();let m="default";return o==="Aspiranti"?m="info":o==="Attivi"?m="success":o==="Board"&&(m="warning"),e.jsx(te,{label:o,color:m})}},{accessorKey:"email",header:B.email,size:150},{accessorKey:"latest_esncard",header:B.latest_esncard,size:50,Cell:({cell:t})=>e.jsx(b,{sx:{},children:t.getValue()!==null?e.jsx(te,{label:t.getValue().number,color:t.getValue().is_valid?"success":"warning"}):e.jsx(te,{label:"Nessuna ESNcard",color:"error"})})},{accessorKey:"country",header:B.country,size:150,Cell:({row:t})=>{const o=t.original.country,m=ze.find(l=>l.code===o);return m?m.name:o||"(vuoto)"}},{accessorKey:"birthdate",header:B.birthdate,size:100},{accessorKey:"phone_prefix",header:"Prefisso Telefono",size:60},{accessorKey:"phone_number",header:"Numero Telefono (no prefisso)",size:120},{id:"fullPhoneNumber",header:B.phone_number,size:150,accessorFn:t=>`(${t.phone_prefix||"vuoto"}) ${t.phone_number||"(vuoto)"}`,Cell:({row:t})=>e.jsxs("span",{children:["(",t.original.phone_prefix||"vuoto",") ",t.original.phone_number||"(vuoto)"]})},{accessorKey:"person_code",header:B.person_code,size:150},{accessorKey:"domicile",header:B.domicile,size:200},{accessorKey:"matricola_number",header:B.matricola_number,size:50},{accessorKey:"latest_document.number",header:B.latest_document,size:50}],[]),u={id:!0,name:!0,surname:!0,groups:!0,email:!0,country:!0,birthdate:!1,fullPhoneNumber:!0,person_code:!1,domicile:!1,matricola_number:!1,"latest_document.number":!1,phone_prefix:!1,phone_number:!1};return e.jsxs(b,{children:[e.jsx(ke,{}),e.jsx(b,{sx:{mx:"5%"},children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(wa,{sx:{marginRight:"10px"}}),e.jsx(P,{variant:"h4",children:"Profili ESNers"})]})}),e.jsx(La,{apiEndpoint:"/esner_profiles/",columns:p,columnVisibility:u,profileType:"ESNer"})]})}function ca({open:p,message:u,onConfirm:t,onClose:o}){return e.jsxs(Za,{open:p,onClose:o,children:[e.jsx(Qa,{children:"Conferma Azione"}),e.jsx(Xa,{children:e.jsx(P,{children:u})}),e.jsxs(es,{children:[e.jsx(Z,{onClick:o,color:"secondary",children:"Annulla"}),e.jsx(Z,{onClick:t,color:"primary",autoFocus:!0,children:"Conferma"})]})]})}const Ce=({message:p,state:u,duration:t=2e3})=>(s.useEffect(()=>{const o=document.createElement("div"),m=document.createElement("button");if(u==="error"){m.style.marginRight="10px",m.style.cursor="pointer",m.style.border="none",m.style.color="white",m.style.backgroundColor="transparent",ja.createRoot(m).render(e.jsx(as,{}));const C=document.createElement("span");C.innerText=p,o.appendChild(m),o.appendChild(C)}else o.innerText=p;o.style.display="flex",o.style.alignItems="center",o.style.position="fixed",o.style.top="-100px",o.style.left="50%",o.style.transform="translateX(-50%)",o.style.backgroundColor=u==="success"?"green":"red",o.style.color="white",o.style.padding="10px",o.style.borderRadius="5px",o.style.cursor="pointer",o.style.zIndex="9999",o.style.transition="opacity 0.5s ease-in-out, top 0.5s ease-in-out",document.body.appendChild(o);const l=()=>{navigator.clipboard.writeText(p).then()};u==="error"&&m.addEventListener("click",l);let w;requestAnimationFrame(()=>{o.style.top="20px"});const y=()=>{o.style.top="-100px",setTimeout(()=>{o.removeEventListener("mouseenter",x),o.removeEventListener("mouseleave",a),m.removeEventListener("click",l),document.body.contains(o)&&document.body.removeChild(o)},t/4)},x=()=>{clearTimeout(w)},a=()=>{w=setTimeout(y,t)};o.addEventListener("mouseenter",x),o.addEventListener("mouseleave",a),a()},[p,u,t]),null),Os={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80%",maxWidth:1200,maxHeight:"90vh",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,overflow:"auto"},Oe={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",boxShadow:24,p:4,outline:"none",display:"flex",flexDirection:"column"};function Fa({open:p,onClose:u,account:t,onSuccess:o}){const{user:m}=Fe(),[l,w]=s.useState({amount:"",type:"deposit",description:""}),y=async a=>{a.preventDefault();try{const E=await K("POST","/transaction/",{account:t.id,amount:l.type==="deposit"?Math.abs(l.amount):-Math.abs(l.amount),description:l.description,type:l.type,executor:m.profile.email});if(E.ok)o("Transazione registrata con successo"),u();else{const C=await E.json();o("Errore durante la registrazione: "+JSON.stringify(C),"error")}}catch(E){H(E),o("Errore durante la registrazione: "+E.message,"error")}},x=()=>u(!1);return e.jsx(Le,{open:p,onClose:x,children:e.jsxs(b,{sx:Oe,component:"form",onSubmit:y,noValidate:!0,children:[e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsxs(U,{onClick:x,sx:{minWidth:0},children:[" ",e.jsx(Se,{})," "]})}),e.jsxs(P,{variant:"h5",gutterBottom:!0,align:"center",sx:{mt:2},children:["Transazione Manuale - Cassa ",t?.name]}),e.jsxs(c,{container:!0,spacing:2,sx:{mt:2},children:[e.jsxs(X,{fullWidth:!0,children:[e.jsx(re,{children:"Tipo"}),e.jsxs(oe,{variant:"outlined",value:l.type,label:"Tipo",onChange:a=>w({...l,type:a.target.value}),children:[e.jsx(Y,{value:"deposit",children:"Deposito"}),e.jsx(Y,{value:"withdrawal",children:"Prelievo"})]})]}),e.jsx(G,{margin:"dense",label:"Importo",type:"number",fullWidth:!0,value:l.amount,slotProps:{htmlInput:{min:"0.01",step:"0.01"}},onChange:a=>w({...l,amount:a.target.value})}),e.jsx(G,{margin:"dense",label:"Descrizione",type:"text",fullWidth:!0,multiline:!0,rows:2,value:l.description,onChange:a=>w({...l,description:a.target.value})})]}),e.jsxs(b,{mt:2,children:[e.jsx(Z,{fullWidth:!0,onClick:u,children:"Annulla"}),e.jsx(Z,{fullWidth:!0,variant:"contained",color:"primary",type:"submit",disabled:!l.amount||l.amount<=0,children:"Conferma"})]})]})})}const Ws={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"top",mt:4,minHeight:"100vh"};function $s(){const{user:p}=Fe(),[u,t]=s.useState([]),[o,m]=s.useState(null),[l,w]=s.useState(!1),[y,x]=s.useState(""),[a,E]=s.useState(!1),[C,i]=s.useState(null),[n,I]=s.useState(!1),g=p?.permissions.includes("change_account");s.useEffect(()=>{r().then()},[p]);const r=async()=>{try{const S=await K("GET","/accounts/"),F=await S.json();if(S.ok)t(F.results);else{const M=await se(F,S.status);i({message:`Errore durante il recupero delle casse: ${M}`,state:"error"})}}catch(S){H(S),i({message:`Errore generale: ${S}`,state:"error"})}},h=(S,F)=>{m(S),x(F),w(!0)},v=async()=>{try{const S=await K("PATCH",`/account/${o.id}/`,{status:y==="open"?"open":"closed"});S.ok?(console.log(`Account ${y}ed successfully.`),r().then(),i({message:`Cassa ${y==="open"?"aperta":"chiusa"} con successo!`,state:"success"})):(console.error(`Failed to ${y} account.`),i({message:`Errore account: ${S.statusText}`,state:"error"}))}catch(S){H(S),i({message:`Errore generale: ${S}`,state:"error"})}finally{w(!1)}};return e.jsxs(b,{children:[e.jsx(ke,{}),e.jsx(b,{sx:{width:"100%",maxWidth:"90%",mx:"auto",mt:0},children:e.jsxs(Ke,{elevation:3,sx:{p:2,mb:0,borderRadius:5},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>E(S=>!S),children:[e.jsx(P,{variant:"h5",sx:{flexGrow:1,fontWeight:600},children:"Casse"}),e.jsx(U,{children:a?e.jsx(Ea,{}):e.jsx(Ta,{})})]}),e.jsx(za,{in:a,timeout:"auto",unmountOnExit:!0,children:e.jsx(b,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:2,justifyContent:"center"},children:u.map(S=>e.jsxs(Ve,{sx:{flex:"1 1 320px",minWidth:320,maxWidth:400,display:"flex",alignItems:"center",boxShadow:4,borderRadius:2,m:1},children:[e.jsxs(Ia,{sx:{flex:1},children:[e.jsx(P,{variant:"h6",sx:{fontWeight:700,color:"#2d3a4b"},children:S.name}),g&&e.jsxs(e.Fragment,{children:[e.jsxs(P,{variant:"body1",sx:{color:"#3e5060"},children:[he.balance,": ",e.jsxs("b",{children:["€",S.balance]})]}),e.jsxs(P,{variant:"body2",sx:{color:"#607d8b"},children:[he.changed_by,": ",S.changed_by.name||"N/A"]})]})]}),g?e.jsxs(ss,{sx:{pr:2,flexDirection:"column",alignItems:"flex-end"},children:[S.status==="closed"&&e.jsx(Z,{variant:"contained",color:"success",onClick:()=>h(S,"open"),sx:{minWidth:120,fontWeight:600},children:"Apri Cassa"}),S.status==="open"&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{variant:"contained",color:"error",onClick:()=>h(S,"close"),sx:{minWidth:120,fontWeight:600,mb:1},children:"Chiudi Cassa"}),e.jsx(Z,{variant:"contained",color:"primary",onClick:()=>{m(S),I(!0)},sx:{minWidth:120,fontWeight:600},children:"Deposita/Preleva"})]})]}):e.jsx(P,{variant:"h7",style:{color:S.status==="closed"?"red":"green",fontWeight:"bold",padding:"20px"},children:S.status==="closed"?"Cassa Chiusa":"Cassa Aperta"})]},S.id))})})]})}),e.jsxs(b,{sx:Ws,children:[e.jsx(P,{variant:"h3",gutterBottom:!0,children:"Sistema di Gestione"}),e.jsx("img",{src:la,alt:"ESN Polimi Logo",style:{height:"25vh",marginTop:"2px"}}),e.jsxs("h1",{children:["Benvenuto, ",p?p.profile.name:"Sir","!"]})]}),e.jsx(ca,{open:l,message:`Confermi la presenza di €${o?.balance} nella cassa "${o?.name}" prima di ${y==="open"?"aprirla":"chiuderla"}?`,onConfirm:v,onClose:()=>w(!1)}),e.jsx(Fa,{open:n,onClose:()=>I(!1),account:o,onSuccess:(S,F)=>i({message:S,state:F||"success"})}),C&&e.jsx(Ce,{message:C.message,state:C.state})]})}function Bs({limit:p=5}){const[u,t]=s.useState([]),[o,m]=s.useState(!0);s.useEffect(()=>{(async()=>{m(!0);try{const x=await K("GET","/accounts/");if(x.ok){const a=await x.json();t(a.results)}}catch(x){H(x)}finally{m(!1)}})().then()},[]);const l=s.useMemo(()=>[{accessorKey:"name",header:he.name,size:100},{accessorKey:"balance",header:he.balance,size:100,Cell:({cell:y})=>e.jsx(b,{children:y.getValue()!==null?e.jsx(te,{label:`€${y.getValue()}`,color:"primary"}):e.jsx(te,{label:"N/A",color:"warning"})})},{accessorKey:"status",header:he.status,size:100,Cell:({cell:y})=>e.jsx(b,{children:y.getValue()!==null?e.jsx(te,{label:y.getValue()==="open"?"Aperta":"Chiusa",color:y.getValue()==="open"?"success":"error"}):e.jsx(te,{label:"Stato ignoto",color:"warning"})})}],[]),w=Me({columns:l,data:u.slice(0,p),enableKeyboardShortcuts:!1,enableColumnActions:!1,enableColumnFilters:!1,enablePagination:!1,enableSorting:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!1},paginationDisplayMode:"default",muiTableBodyRowProps:{hover:!1},localization:Ae});return o?e.jsx(be,{}):e.jsx(Da,{table:w})}const Gs={subscription:{label:ne.tran_type.subscription,color:"primary"},esncard:{label:ne.tran_type.esncard,color:"secondary"},deposit:{label:ne.tran_type.deposit,color:"success"},withdrawal:{label:ne.tran_type.withdrawal,color:"error"}};function Ks({limit:p=5}){const[u,t]=s.useState([]),[o,m]=s.useState(!0);s.useEffect(()=>{(async()=>{m(!0);try{const x=await K("GET","/transactions/");if(x.ok){const a=await x.json();t(a.results),console.log("Transactions data:",a.results)}}catch(x){H(x)}finally{m(!1)}})().then()},[]);const l=s.useMemo(()=>[{accessorKey:"created_at",header:ne.date,size:100,Cell:({cell:y})=>{const x=new Date(y.getValue());return e.jsx(b,{children:new Intl.DateTimeFormat("it-IT",{dateStyle:"medium",timeStyle:"short"}).format(x)})}},{accessorKey:"type",header:ne.type,size:100,Cell:({cell:y})=>{const x=y.getValue(),a=Gs[x]||{label:"Sconosciuto",color:"default"};return e.jsx(te,{label:a.label,color:a.color,variant:"outlined"})}},{accessorKey:"executor.name",header:ne.executor,size:150},{accessorKey:"account.name",header:ne.account,size:100,Cell:({cell:y})=>e.jsx(b,{component:"span",fontWeight:"bold",children:y.getValue()})},{accessorKey:"amount",header:ne.amount,size:100,Cell:({cell:y})=>e.jsx(b,{children:y.getValue()!==null?e.jsx(te,{label:`€${y.getValue()}`,color:"primary"}):e.jsx(te,{label:"N/A",color:"warning"})})}],[]),w=Me({columns:l,data:u.slice(0,p),enableKeyboardShortcuts:!1,enableColumnActions:!1,enableColumnFilters:!1,enablePagination:!1,enableSorting:!0,initialState:{showColumnFilters:!1,showGlobalFilter:!1,sorting:[{id:"created_at",desc:!0}]},paginationDisplayMode:"default",muiTableBodyRowProps:{hover:!1},localization:Ae});return o?e.jsx(be,{}):e.jsx(Da,{table:w})}function Vs(){const p=_e();return e.jsxs(b,{children:[e.jsx(ke,{}),e.jsxs(b,{sx:{mx:"5%",mt:0},children:[e.jsx(P,{variant:"h4",sx:{mb:3},children:"Dashboard Tesoreria"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{size:{xs:12,md:4},children:e.jsxs(Ke,{elevation:3,sx:{p:2},children:[e.jsx(P,{variant:"h6",sx:{mb:2},children:"Casse"}),e.jsx(Bs,{limit:5}),e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(Z,{variant:"outlined",size:"small",onClick:()=>p("/treasury/accounts_list/"),children:"Gestisci Casse"})})]})}),e.jsx(c,{size:{xs:12,md:8},children:e.jsxs(Ke,{elevation:3,sx:{p:2},children:[e.jsx(P,{variant:"h6",sx:{mb:2},children:"Ultime Transazioni"}),e.jsx(Ks,{limit:3}),e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(Z,{variant:"outlined",size:"small",onClick:()=>p("/treasury/transactions_list/"),children:"Gestisci Movimenti"})})]})})]})]})]})}function qs({open:p,onClose:u,account:t=null}){const o=t!==null,[m,l]=s.useState(!0),[w,y]=s.useState(null),[x,a]=s.useState({name:"",visible_to_groups:[]}),[E,C]=s.useState({name:[!1,""],visible_to_groups:[!1,""]}),[i,n]=s.useState([]);s.useEffect(()=>{(async()=>{try{const S=await K("GET","/groups/"),F=await S.json();if(S.ok)n(F);else{const M=await se(F,S.status);y({message:`Errore nel recupero dei gruppi: ${M}`,state:"error"})}}catch(S){H(S),y({message:`Errore nel recupero dei gruppi: ${S}`,state:"error"})}})().then()},[]),s.useEffect(()=>{a(o&&t?{name:t.name||"",visible_to_groups:t.visible_to_groups?.map(v=>v.id)||[]}:{name:"",visible_to_groups:[]}),l(!1)},[o,t]);const I=v=>{const{name:S,value:F}=v.target;a({...x,[S]:F})},g=v=>{a({...x,visible_to_groups:v.target.value})},r=async v=>{v.preventDefault();const S={...E};if(x.name.trim()?S.name=[!1,""]:S.name=[!0,"Il nome è obbligatorio"],x.visible_to_groups.length===0?S.visible_to_groups=[!0,"Seleziona almeno un gruppo"]:S.visible_to_groups=[!1,""],C(S),!(S.name[0]||S.visible_to_groups[0])){l(!0);try{const F={name:x.name,visible_to_groups:x.visible_to_groups};let M;if(o&&t?M=await K("PATCH",`/account/${t.id}/`,F):M=await K("POST","/account/",F),M.ok)u(!0);else{const J=await M.json(),A=await se(J,M.status);y({message:`Errore ${o?"modifica":"creazione"} cassa: ${A}`,state:"error"})}}catch(F){H(F),y({message:`Errore generale: ${F}`,state:"error"})}finally{l(!1)}}},h=()=>{u(!1)};return e.jsx(Le,{open:p,onClose:h,children:e.jsx(b,{sx:Oe,component:"form",onSubmit:r,noValidate:!0,children:m?e.jsx(be,{}):e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(U,{onClick:h,sx:{minWidth:0},children:e.jsx(Se,{})})}),e.jsx(P,{variant:"h5",gutterBottom:!0,align:"center",sx:{mb:2},children:o?`Modifica Cassa - ${t?.name}`:"Crea Cassa"}),w&&e.jsx(Ce,{message:w.message,state:w.state}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{size:{xs:12},children:e.jsx(G,{fullWidth:!0,label:he.name,name:"name",value:x.name,onChange:I,required:!0,error:E.name[0],helperText:E.name[0]?E.name[1]:""})}),e.jsx(c,{size:{xs:12},children:e.jsxs(X,{fullWidth:!0,error:E.visible_to_groups[0],children:[e.jsx(re,{id:"groups-label",children:he.visible_to_groups}),e.jsx(oe,{variant:"outlined",labelId:"groups-label",multiple:!0,value:x.visible_to_groups,onChange:g,input:e.jsx(Te,{label:he.visible_to_groups}),renderValue:v=>e.jsx(b,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:v.map(S=>{const F=i.find(M=>M.id===S);return e.jsx(te,{label:F?F.name:S},S)})}),children:i.map(v=>e.jsx(Y,{value:v.id,children:v.name},v.id))}),E.visible_to_groups[0]&&e.jsx(Ue,{children:E.visible_to_groups[1]})]})})]}),e.jsx(b,{mt:2,children:e.jsx(Z,{fullWidth:!0,variant:"contained",color:"primary",type:"submit",children:o?"Salva Modifiche":"Crea"})})]})})})}function Hs(){const[p,u]=s.useState([]),[t,o]=s.useState(!0),[m,l]=s.useState(!1),w=_e(),[y,x]=s.useState(null),[a,E]=s.useState(null),[C,i]=s.useState(!1);s.useEffect(()=>{n().then()},[]);const n=async()=>{o(!0);try{const h=await K("GET","/accounts/"),v=await h.json();if(h.ok)u(v.results),console.log("Account List Data: ",v.results);else{const S=await se(v,h.status);x({message:`Errore: ${S}`,state:"error"})}}catch(h){H(h),x({message:`Errore generale: ${h}`,state:"error"})}finally{o(!1)}},I=s.useMemo(()=>[{accessorKey:"id",header:he.id,size:50},{accessorKey:"name",header:he.name,size:150},{accessorKey:"changed_by.name",header:he.changed_by,size:150},{accessorKey:"balance",header:he.balance,size:100,Cell:({cell:h})=>e.jsx(b,{children:h.getValue()!==null?e.jsx(te,{label:`€${h.getValue()}`,color:"primary"}):e.jsx(te,{label:"N/A",color:"warning"})})},{accessorKey:"status",header:he.status,size:150,Cell:({cell:h})=>e.jsx(b,{sx:{},children:h.getValue()!==null?e.jsx(te,{label:h.getValue()==="open"?"Aperta":"Chiusa",color:h.getValue()==="open"?"success":"error"}):e.jsx(te,{label:"N/A",color:"warning"})})},{accessorKey:"visible_to_groups",header:he.visible_to_groups,size:150,Cell:({cell:h})=>e.jsx(b,{sx:{},children:h.getValue()!==null?h.getValue().map(v=>e.jsx(te,{label:v.name,color:"grey",sx:{mr:1}},v.id)):e.jsx(te,{label:"N/A",color:"warning"})})},{header:"Azioni",size:150,Cell:({row:h})=>e.jsxs(b,{sx:{display:"flex",gap:1},children:[e.jsx(U,{color:"primary",onClick:()=>{E(h.original),l(!0)},children:e.jsx(Je,{})}),e.jsx(Z,{variant:"contained",color:"primary",onClick:()=>{E(h.original),i(!0)},children:"Deposita/Preleva"})]})}],[]),g=Me({columns:I,data:p,enablePagination:!1,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableColumnPinning:!1,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableRowPinning:!1,enableExpandAll:!1,initialState:{showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},columnVisibility:{id:!1,name:!0,changed_by:!0,status:!0,balance:!0}},positionToolbarAlertBanner:"bottom",localization:Ae,muiTableBodyRowProps:()=>({sx:{cursor:"default"}}),renderTopToolbarCustomActions:()=>e.jsx(b,{sx:{display:"flex",flexDirection:"row"},children:e.jsx(Z,{variant:"contained",onClick:()=>l(!0),sx:{width:"150px"},children:"Nuova Cassa"})})}),r=async h=>{h&&(x({message:"Cassa creata con successo!",state:"success"}),await n()),E(null),l(!1)};return e.jsxs(b,{children:[e.jsx(ke,{}),m&&e.jsx(qs,{open:m,onClose:r,account:a}),e.jsx(Fa,{open:C,onClose:()=>i(!1),account:a,onSuccess:(h,v)=>x({message:h,state:v||"success"})}),e.jsx(b,{sx:{mx:"5%"},children:t?e.jsx(be,{}):e.jsxs(e.Fragment,{children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(U,{onClick:()=>{w(-1)},sx:{mr:2},children:e.jsx(Ze,{})}),e.jsx(ts,{sx:{marginRight:"10px"}}),e.jsx(P,{variant:"h4",children:"Lista Casse"})]}),e.jsx(Re,{table:g})]})}),y&&e.jsx(Ce,{message:y.message,state:y.state})]})}function Ra({value:p,onChange:u,readOnly:t=!1}){const o=s.useRef(null),m=s.useRef(null);return s.useEffect(()=>{if(o.current&&!m.current){const l=t?{toolbar:!1}:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["link"],["clean"]]};m.current=new Is(o.current,{theme:"snow",readOnly:t,modules:l}),m.current.on("text-change",()=>{u&&u(m.current.root.innerHTML)}),p&&(m.current.root.innerHTML=p)}},[p,u,t]),e.jsx("div",{ref:o})}function Na({open:p,event:u,isEdit:t,onClose:o}){const[m,l]=s.useState(!0),w=t?"Modifica Evento - "+u.name:"Crea Evento",[y,x]=s.useState(null),[a,E]=s.useState(!1),[C,i]=s.useState({id:"",name:"",date:V(),description:`<h3>Descrizione</h3>    <p>Ecco un <a href="https://www.italia.it" target="_blank">link all'Italia</a>.</p>    <blockquote>Citazione elegante.</blockquote>    <p style="text-align: center;">Adios.</p>`,cost:"",subscription_start_date:V().hour(12).minute(0),subscription_end_date:V().hour(24).minute(0),lists:[{id:"",name:"Main List",capacity:""}]}),[n,I]=xe.useState({name:[!1,""],date:[!1,""],description:[!1,""],cost:[!1,""],subscription_start_date:[!1,""],subscription_end_date:[!1,""],lists:[!1,""],listItems:[]});s.useEffect(()=>{t&&(console.log("Setting form data: ",u),i(u),console.log("#Subsciptions: ",u.subscriptions.length),E(u.subscriptions.length>0)),l(!1)},[]);const g=D=>V(D).format("YYYY-MM-DD"),r=D=>V(D).toISOString(),h=D=>{D&&V(D).isBefore(V(),"day")||i({...C,date:D})},v=D=>{C.subscription_end_date&&V(D).isAfter(V(C.subscription_end_date))?i({...C,subscription_start_date:D,subscription_end_date:V(D).add(1,"day")}):i({...C,subscription_start_date:D})},S=D=>{if(D){const d=V(C.subscription_start_date),z=V(D),f=V();z.isBefore(d)?D=d:z.isBefore(f)&&(D=f)}i({...C,subscription_end_date:D})},F=D=>({name:D.name,date:g(D.date),description:D.description,subscription_start_date:r(D.subscription_start_date),subscription_end_date:r(D.subscription_end_date),cost:Number(D.cost).toFixed(2),lists:D.lists.map(d=>({id:d.id,name:d.name,capacity:Math.floor(Number(d.capacity))}))}),M=()=>{window.scrollTo({top:0,behavior:"smooth"})},J=D=>{const{name:d,value:z,type:f,checked:R}=D.target;i({...C,[d]:f==="checkbox"?R:z})},A=()=>{i({...C,lists:[...C.lists,{id:"",name:"",capacity:""}]})},L=(D,d)=>{const{name:z,value:f}=d.target,R=C.lists.map((j,W)=>W===D?{...j,[z]:f}:j);i({...C,lists:R})},N=D=>{i({...C,lists:C.lists.filter((d,z)=>z!==D)})},_=async D=>{D.preventDefault();const d=C.lists.map(f=>({name:!f.name.trim(),capacity:f.capacity===""})),z=d.some(f=>f.name||f.capacity);if(I({...n,listItems:d,lists:[z]}),z){x({message:"Errore campi Liste",state:"error"}),M();return}try{const f=t?await K("PATCH",`/event/${C.id}/`,F(C)):await K("POST","/event/",F(C));if(f.ok)o(!0);else{const R=await f.json(),j=await se(R,f.status);x({message:`Errore ${t?"modifica":"creazione"} evento: ${j}`,state:"error"}),M()}}catch(f){H(f),x({message:`Errore generale: ${f}`,state:"error"}),M()}},T=()=>{o(!1)};return e.jsx(Le,{open:p,onClose:T,children:e.jsx(b,{sx:Os,component:"form",onSubmit:_,noValidate:!1,children:m?e.jsx(be,{}):e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(U,{onClick:()=>o(!1),sx:{minWidth:0},children:e.jsx(Se,{})})}),e.jsx(P,{variant:"h5",gutterBottom:!0,sx:{mb:2},align:"center",children:w}),y&&e.jsx(Ne,{message:y.message,state:y.state}),t&&a&&e.jsx(b,{sx:{mb:2,p:1,bgcolor:"#fff3e0",borderRadius:1},children:e.jsxs(P,{variant:"body2",color:"warning.main",children:[e.jsx(ns,{fontSize:"small",sx:{verticalAlign:"middle",mr:1}}),"Alcuni campi non sono modificabili perché ci sono già iscrizioni. Rimuovi tutte le iscrizioni per abilitare la modifica."]})}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{size:{xs:12,md:6},children:e.jsx(G,{fullWidth:!0,label:ge.name,name:"name",value:C.name,onChange:J,required:!0,error:n.name[0]})}),e.jsx(c,{size:{xs:12,md:6},children:e.jsx(fe,{dateAdapter:Ee,adapterLocale:"en-gb",children:e.jsx(ve,{label:ge.date,value:C.date,onChange:h,minDate:t?null:V(),slotProps:{textField:{variant:"outlined"}},required:!0,error:n.date[0]})})}),e.jsx(c,{size:{xs:12,md:3},children:e.jsx(qe,{title:t&&a?"Non modificabile con iscrizioni esistenti":"",children:e.jsxs("div",{children:[" ",e.jsx(fe,{dateAdapter:Ee,adapterLocale:"en-gb",children:e.jsx(pa,{label:ge.subscription_start_date,value:C.subscription_start_date||null,onChange:v,minDate:t?null:V(),slotProps:{textField:{fullWidth:!0,required:!0}},disabled:t&&a,required:!0,error:n.subscription_start_date[0]})})]})})}),e.jsx(c,{size:{xs:12,md:3},children:e.jsx(fe,{dateAdapter:Ee,adapterLocale:"en-gb",children:e.jsx(pa,{label:ge.subscription_end_date,value:C.subscription_end_date||null,onChange:S,minDate:V().isAfter(C.subscription_start_date)?V():C.subscription_start_date||V(),slotProps:{textField:{fullWidth:!0,required:!0}},required:!0,error:n.subscription_start_date[0]})})}),e.jsx(c,{size:{xs:12,md:3},children:e.jsx(qe,{title:t&&a?"Non modificabile con iscrizioni esistenti":"",children:e.jsxs("div",{children:[" ",e.jsx(G,{fullWidth:!0,label:ge.cost,name:"cost",type:"number",slotProps:{htmlInput:{min:"0",step:"0.01"}},value:C.cost,onChange:J,placeholder:"Inserisci 0 se gratuito",required:!0,error:n.cost[0],disabled:t&&a})]})})})]}),e.jsxs(c,{size:{xs:12},"data-color-mode":"light",children:[e.jsx(P,{variant:"h6",component:"div",children:ge.description}),e.jsx(Ra,{value:C.description,onChange:D=>{i({...C,description:D})}})]}),e.jsxs(b,{my:2,children:[e.jsxs(c,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(c,{children:e.jsx(P,{variant:"h6",gutterBottom:!0,children:"Liste"})}),e.jsx(c,{children:e.jsx(U,{onClick:A,children:e.jsx(rs,{})})})]}),C.lists.map((D,d)=>e.jsxs(c,{container:!0,spacing:2,alignItems:"center",mb:2,children:[e.jsx(c,{children:e.jsx(G,{label:ge.list_name,name:"name",value:D.name,onChange:z=>L(d,z),required:!0,error:n.listItems[d]?.name,helperText:n.listItems[d]?.name?"Il nome è obbligatorio":""})}),e.jsx(c,{children:e.jsx(G,{label:ge.list_capacity,name:"capacity",type:"number",value:D.capacity,slotProps:{htmlInput:{min:"0",step:"1"}},onChange:z=>L(d,z),placeholder:"Inserisci 0 se illimitata",required:!0,error:n.listItems[d]?.capacity,helperText:n.listItems[d]?.capacity?"La capacità è obbligatoria":""})}),e.jsx(c,{size:{xs:2},children:e.jsx(U,{onClick:()=>N(d),children:e.jsx(Pa,{})})})]},d))]}),e.jsx(b,{mt:2,children:e.jsx(Z,{variant:"contained",color:"primary",type:"submit",children:t?"Salva Modifiche":"Crea"})})]})})})}const fa=[{value:"open",label:"Iscrizioni aperte"},{value:"not_yet",label:"Non ancora aperte"},{value:"closed",label:"Iscrizioni chiuse"}];function Ys(){const[p,u]=s.useState([]),[t,o]=s.useState(!1),m=_e(),[l,w]=s.useState(null),[y,x]=s.useState({pageIndex:0,pageSize:10}),[a,E]=s.useState(0),[C,i]=s.useState(""),[n,I]=s.useState(""),[g,r]=s.useState({subscriptionStatus:[],dateFrom:null,dateTo:null}),[h,v]=s.useState(!1),S=s.useRef(null),F=d=>V(d).format("YYYY-MM-DD");s.useEffect(()=>{let d=!1;return(async()=>{v(!0);try{const f=new URLSearchParams;f.append("page",y.pageIndex+1),f.append("page_size",y.pageSize),n&&f.append("search",n),g.subscriptionStatus.length&&f.append("subscription_status",g.subscriptionStatus.join(",")),g.dateFrom&&f.append("dateFrom",F(g.dateFrom)),g.dateTo&&f.append("dateTo",F(g.dateTo));const R=await K("GET",`/events/?${f.toString()}`),j=await R.json();if(R.ok)d||(E(j.count||0),u(j.results));else{const W=await se(j,R.status);w({message:`Errore: ${W}`,state:"error"})}}catch(f){H(f),w({message:`Errore generale: ${f}`,state:"error"})}finally{v(!1)}})().then(),()=>{d=!0}},[y.pageIndex,y.pageSize,g,n]);const M=s.useMemo(()=>[{accessorKey:"id",header:ge.id,size:50},{accessorKey:"name",header:ge.name,size:150},{accessorKey:"date",header:ge.date,size:150},{accessorKey:"cost",header:ge.cost,size:150},{accessorKey:"subscription_start_date",header:ge.subscription_date_status,size:150,Cell:({row:d})=>{const z=V(),f=d.original.subscription_start_date?V(d.original.subscription_start_date):null,R=d.original.subscription_end_date?V(d.original.subscription_end_date):null;let j="Non disponibile",W="error";return f&&R&&(z.isAfter(f)&&z.isBefore(R)?(j="Iscrizioni aperte",W="success"):z.isBefore(f)?(j="Iscrizioni non ancora aperte",W="warning"):z.isAfter(R)&&(j="Iscrizioni chiuse",W="error")),e.jsx(te,{label:j,color:W})}}],[]),J=Me({columns:M,data:p,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableColumnPinning:!0,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableRowPinning:!0,enableExpandAll:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},columnVisibility:{id:!0,name:!0,date:!0,cost:!0}},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",enableGlobalFilter:!1,muiPaginationProps:{color:"secondary",rowsPerPageOptions:[10,20,30],shape:"rounded",variant:"outlined"},manualPagination:!0,rowCount:a,onPaginationChange:x,state:{pagination:y},localization:Ae,muiTableBodyRowProps:({row:d})=>({onClick:()=>{m("/event/"+d.original.id,{state:{event:d.original}})}}),renderTopToolbarCustomActions:()=>e.jsx(b,{sx:{display:"flex",flexDirection:"row"},children:e.jsx(Z,{variant:"contained",onClick:()=>o(!0),sx:{width:"150px"},children:"Crea"})})}),A=()=>{I(C),x(d=>({...d,pageIndex:0}))},L=()=>{i(""),I(""),x(d=>({...d,pageIndex:0})),S.current&&S.current.focus()},N=d=>{const{name:z,value:f}=d.target;r(R=>({...R,[z]:typeof f=="string"?f.split(","):f}))},_=(d,z)=>{r(f=>{let R={...f,[d]:z};return d==="dateFrom"&&R.dateTo&&z&&z>R.dateTo&&(R.dateTo=z),d==="dateTo"&&R.dateFrom&&z&&z<R.dateFrom&&(R.dateFrom=z),R})},T=()=>{r(d=>({...d,dateFrom:null,dateTo:null}))},D=async d=>{d&&w({message:"Evento creato con successo!",state:"success"}),o(!1)};return e.jsxs(b,{children:[e.jsx(ke,{}),t&&e.jsx(Na,{open:t,onClose:D,isEdit:!1}),e.jsxs(b,{sx:{mx:"5%"},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(ia,{sx:{marginRight:"10px"}}),e.jsx(P,{variant:"h4",children:"Lista Eventi"})]}),e.jsxs(c,{container:!0,spacing:2,sx:{mb:2},alignItems:"center",justifyContent:"flex-end",children:[e.jsx(c,{size:{xs:12,sm:2},children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(re,{id:"subscription-status-label",children:"Stato iscrizione"}),e.jsx(oe,{labelId:"subscription-status-label",name:"subscriptionStatus",multiple:!0,value:g.subscriptionStatus,onChange:N,input:e.jsx(Te,{label:"Stato iscrizione"}),variant:"outlined",renderValue:d=>fa.filter(z=>d.includes(z.value)).map(z=>z.label).join(", "),children:fa.map(d=>e.jsx(Y,{value:d.value,children:d.label},d.value))})]})}),e.jsx(c,{size:{xs:12,sm:2},children:e.jsx(X,{fullWidth:!0,children:e.jsx(fe,{dateAdapter:He,adapterLocale:Ye,children:e.jsx(ve,{label:"Inizio Data Evento",value:g.dateFrom,maxDate:g.dateTo||void 0,onChange:d=>_("dateFrom",d),format:"d MMM yyyy"})})})}),e.jsx(c,{size:{xs:12,sm:2},children:e.jsx(X,{fullWidth:!0,children:e.jsx(fe,{dateAdapter:He,adapterLocale:Ye,children:e.jsx(ve,{label:"Fine Data Evento",value:g.dateTo,minDate:g.dateFrom||void 0,onChange:d=>_("dateTo",d),format:"d MMM yyyy"})})})}),(g.dateFrom||g.dateTo)&&e.jsx(c,{size:{xs:12,sm:2},sx:{display:"flex",alignItems:"center"},children:e.jsx(Z,{variant:"outlined",color:"secondary",startIcon:e.jsx($e,{}),onClick:T,sx:{height:"100%",minWidth:0,px:1,mr:1},children:"Azzera date"})}),e.jsx(c,{size:{xs:12,sm:2},sx:{ml:"auto"},children:e.jsx(Te,{inputRef:S,size:"small",placeholder:"Cerca",value:C,onChange:d=>i(d.target.value),onKeyDown:d=>{d.key==="Enter"&&A()},endAdornment:C&&n===C?e.jsx(U,{"aria-label":"clear",onClick:L,edge:"end",children:e.jsx($e,{})}):e.jsx(U,{"aria-label":"search",onClick:A,edge:"end",children:e.jsx(oa,{})})})})]}),h?e.jsx(be,{}):e.jsx(Re,{table:J}),l&&e.jsx(Ce,{message:l.message,state:l.state})]})]})}function Oa({value:p,onChange:u,error:t,helperText:o,label:m="Cerca profilo",required:l=!1,disabled:w=!1,valid_only:y=!0,esner_only:x=!1}){const[a,E]=s.useState([]),[C,i]=s.useState(""),[n,I]=s.useState(!1);s.useEffect(()=>{if(C.length<3){E([]);return}I(!0);const r=setTimeout(async()=>{try{const h=await K("GET",`/profiles/search/?q=${encodeURIComponent(C)}&valid_only=${y}&esner_only=${x}`);if(h.ok){const v=await h.json();E(v.results||[])}}finally{I(!1)}},300);return()=>clearTimeout(r)},[C]);const g=(r,h)=>{const{key:v,...S}=r,F=h.latest_esncard&&h.latest_esncard.number,M=F&&!h.latest_esncard.is_valid;return e.jsx("li",{...S,children:e.jsxs(c,{container:!0,spacing:1,sx:{width:"100%"},children:[e.jsx(c,{size:{xs:4},children:e.jsxs(P,{children:[h.name," ",h.surname]})}),e.jsx(c,{size:{xs:4},children:e.jsx(P,{component:"span",sx:{color:F?M?"error.main":"text.primary":"error.main"},children:F?M?`${h.latest_esncard.number} (Scaduta)`:h.latest_esncard.number:"No ESNcard"})}),e.jsx(c,{size:{xs:4},children:e.jsx(P,{component:"span",sx:{color:h.is_esner?"primary.main":"success.main",fontWeight:"bold",textAlign:"right",display:"block"},children:h.is_esner?"ESNer":"Erasmus"})})]})},v)};return e.jsx(os,{options:a,loading:n,getOptionLabel:r=>`${r.name}${r.surname?` ${r.surname}`:""}${r.latest_esncard?` (${r.latest_esncard.number})`:""}`,renderOption:g,value:p,onChange:u,onInputChange:(r,h)=>i(h),renderInput:r=>e.jsx(G,{...r,label:m,required:l,error:t,helperText:o}),noOptionsText:"Nessun profilo trovato",loadingText:"Caricamento...",disabled:w})}function Us({open:p,onClose:u,event:t,listId:o,subscription:m,isEdit:l}){const[w,y]=s.useState(!0),[x,a]=s.useState(null),[E,C]=s.useState([]),[i,n]=s.useState({open:!1,action:null,message:""}),I=l?"Modifica Iscrizione":"Iscrizione Evento",g=l&&m.account_id||null,[r,h]=s.useState({id:"",account_id:"",account_name:"",profile_id:"",profile_name:"",status:"pending",list_id:o||"",list_name:t.lists.find(f=>f.id===o)?.name||"Lista non trovata",notes:""}),[v,S]=s.useState({account_id:[!1,""],account_name:[!1,""],profile_id:[!1,""],profile_name:[!1,""],status:[!1,""],list_id:[!1,""],list_name:[!1,""],notes:[!1,""]}),F=s.useMemo(()=>[{field:"profile_id",value:r?.profile_id,message:"Selezionare un Profilo"},...r?.status==="paid"?[{field:"account_id",value:r?.account_id,message:"Selezionare una Cassa"}]:[]],[r]),[M,J]=s.useState(l?m.status:"pending");s.useEffect(()=>{l&&(console.log("Setting Subscription:",m),h(m),J(m.status)),y(!1),A().then()},[l]);const A=async()=>{try{const f=await K("GET","/accounts/"),R=await f.json();if(f.ok)C(R.results);else{const j=await se(R,f.status);a({message:`Errore durante il recupero delle casse: ${j}`,state:"error"})}}catch(f){H(f),a({message:`Errore generale: ${f}`,state:"error"})}},L=()=>{const f={};return Object.keys(v).forEach(R=>{f[R]=[!1,""]}),S(f),f},N=async()=>{let f=!1;const R=L();if(F.forEach(j=>{j.value||(R[j.field]=[!0,j.message],f=!0)}),f){S(R);return}if(r.status==="paid"&&(!l||M!=="paid")||l&&M==="paid"&&r.status!=="paid"){let j="";r.status==="paid"&&(!l||M!=="paid")?j="Confermi di registrare un pagamento di €"+t.cost+" per questa iscrizione?":l&&M==="paid"&&r.status!=="paid"&&(j="Confermi di annullare un pagamento di €"+t.cost+" per questa iscrizione?"),n({open:!0,action:()=>_(),message:j});return}if(r.status==="paid"&&l&&M==="paid"&&r.account_id!==g){n({open:!0,action:()=>_(),message:"Confermi di voler cambiare la cassa associata a questo pagamento? Verranno spostati €"+t.cost+" da "+r.account_name+" a "+E.find(j=>j.id===r.account_id)?.name+"."});return}await _()},_=async()=>{n({open:!1,action:null,message:""});try{const f=await K(l?"PATCH":"POST",`/subscription/${l?r.id+"/":""}`,{profile:r.profile_id,event:t.id,list:r.list_id,account_id:r.account_id||g,notes:r.notes,status:r.status});if(f.ok)u(!0,(l?"Modifica Iscrizione":"Iscrizione")+" completata con successo!");else{const R=await f.json(),j=await se(R,f.status);a({message:`Errore: ${j}`,state:"error"})}}catch(f){H(f),a({message:`Errore generale: ${f}`,state:"error"})}},T=async()=>{if(r.status==="paid"){n({open:!0,action:()=>D(),message:"Confermi di voler eliminare un pagamento di €"+t.cost+" per questa iscrizione?"});return}await D()},D=async()=>{if(n({open:!1,action:null,message:""}),!(!l||!r.id))try{const f=await K("DELETE",`/subscription/${r.id}/`);if(f.ok)u(!0,"Eliminazione avvenuta con successo");else{const R=await f.json(),j=await se(R,f.status);a({message:`Errore eliminazione: ${j}`,state:"error"})}}catch(f){H(f),a({message:`Errore generale: ${f}`,state:"error"})}},d=f=>{h({...r,[f.target.name]:f.target.value})},z=()=>{h({...r,status:r.status==="paid"?"pending":"paid",...r.status==="paid"?{account_id:""}:{}})};return e.jsx(Le,{open:p,onClose:()=>{u(!1)},"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(b,{sx:Oe,children:[w?e.jsx(be,{}):e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(U,{onClick:()=>u(!1),sx:{minWidth:0},children:e.jsx(Se,{})})}),e.jsx(P,{variant:"h4",component:"h2",gutterBottom:!0,children:I}),e.jsx(We,{sx:{mb:2}}),e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Nome Evento:"})," ",t.name]}),e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Lista:"})," ",r.list_name]}),e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Importo:"})," ",t.cost,"€"]}),e.jsxs(c,{container:!0,spacing:2,direction:"column",children:[e.jsx(c,{size:{xs:12},sx:{mt:2},children:e.jsx(Oa,{value:r.profile_id?{id:r.profile_id,name:r.profile_name}:null,onChange:(f,R)=>{h({...r,profile_id:R?.id,profile_name:R?`${R.name} ${R.surname}`:""})},error:v.profile_id&&v.profile_id[0],helperText:v.profile_id&&v.profile_id[1]||"Cerca per nome o numero ESNcard",label:l?r.profile_name:"Cerca profilo",required:!0,disabled:l})}),e.jsx(c,{size:{xs:12},children:e.jsxs(Ke,{elevation:1,sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",bgcolor:r.status==="paid"?"#e3f2fd":"inherit",transition:"background-color 0.3s"},children:[e.jsx(P,{variant:"subtitle1",children:"Stato Pagamento"}),e.jsx(we,{control:e.jsx(is,{checked:r.status==="paid",onChange:z,color:"primary"}),label:r.status==="paid"?"Pagato":"In attesa",labelPlacement:"start"})]})}),r.status==="paid"&&e.jsx(c,{size:{xs:12},children:e.jsxs(X,{fullWidth:!0,required:!0,error:v.account_id&&v.account_id[0],children:[e.jsx(re,{htmlFor:"account-selector",sx:{mb:2},children:"Seleziona Cassa"}),e.jsx(oe,{variant:"outlined",label:"Seleziona Cassa",labelId:"account-selector-label",id:"account-selector",name:"account_id",value:r.account_id||"",error:v.account_id&&v.account_id[0],onChange:d,children:E.map(f=>e.jsxs(Y,{value:f.id,disabled:f.status==="closed",style:{color:f.status==="closed"?"grey":"inherit"},children:[f.name," ",f.status==="closed"?"(Chiusa)":""]},f.id))}),v.account_id&&v.account_id[0]&&e.jsx(Ue,{children:v.account_id[1]})]})}),e.jsx(c,{size:{xs:12},children:e.jsx(G,{label:"Note",name:"notes",value:r.notes,onChange:d,multiline:!0,rows:2,fullWidth:!0})})]}),e.jsx(Z,{variant:"contained",fullWidth:!0,sx:{mt:2,bgcolor:r.profile_id?"#1976d2":"#9e9e9e","&:hover":{bgcolor:r.profile_id?"#1565c0":"#757575"}},onClick:N,children:l?"Salva Modifiche":"Conferma"}),l&&e.jsx(Z,{variant:"contained",fullWidth:!0,sx:{mt:1,bgcolor:"#d32f2f","&:hover":{bgcolor:"#b71c1c"}},onClick:T,children:"Elimina Iscrizione"}),x&&e.jsx(Ce,{message:x.message,state:x.state})]}),e.jsx(ca,{open:i.open,message:i.message,onConfirm:i.action,onClose:()=>n({open:!1,action:null,message:""})})]})})}function Js({open:p,onClose:u,selectedRows:t,event:o,listId:m}){const[l,w]=s.useState(null),[y,x]=s.useState([]),[a,E]=s.useState(""),C=o.lists.find(n=>n.id===m)?.name||"Lista non trovata";s.useEffect(()=>{if(o?.lists){const n=o.lists.filter(I=>I.id!==m);x(n)}},[o,m]);const i=async()=>{if(a)try{const n=await K("POST","/move-subscriptions/",{subscriptionIds:t.map(I=>I.original.id),targetListId:a});if(n.ok)u(!0);else{const I=await n.json(),g=await se(I,n.status);w({message:`Errore: ${g}`,state:"error"})}}catch(n){H(n),w({message:`Errore generale: ${n}`,state:"error"})}};return e.jsx(Le,{open:p,onClose:()=>u(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(b,{sx:Oe,children:[e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(U,{onClick:()=>u(!1),sx:{minWidth:0},children:e.jsx(Se,{})})}),e.jsxs(P,{variant:"h4",component:"h3",gutterBottom:!0,children:["Sposta ",t.length," ",t.length===1?"iscrizione":"iscrizioni"]}),e.jsxs(P,{variant:"body1",id:"modal-modal-description",gutterBottom:!0,children:["Lista di origine: ",C]}),e.jsxs(X,{fullWidth:!0,sx:{mt:1},children:[e.jsx(re,{id:"list-select-label",children:"Lista di destinazione"}),e.jsx(oe,{labelId:"list-select-label",label:"Lista di destinazione",value:a,onChange:n=>E(n.target.value),variant:"outlined",children:y.map(n=>e.jsx(Y,{value:n.id,children:n.name},n.id))})]}),e.jsx(Z,{variant:"contained",fullWidth:!0,sx:{mt:2,bgcolor:a?"#1976d2":"#9e9e9e","&:hover":{bgcolor:a?"#1565c0":"#757575"}},onClick:i,disabled:!a,children:"Conferma"}),l&&e.jsx(Ce,{message:l.message,state:l.state})]})})}function Zs(){const{id:p}=Qe(),u=Es(),t=_e(),[o,m]=s.useState(!1),[l,w]=s.useState(!1),[y,x]=s.useState(!1),[a,E]=s.useState([]),[C,i]=s.useState(!0),[n,I]=s.useState(null),[g,r]=s.useState(null),h=u.state?.event,[v,S]=s.useState(null),[F,M]=s.useState(null),[J,A]=s.useState(null);s.useEffect(()=>{i(!0),(async()=>{try{const Q=p||h?.id,le=await K("GET",`/event/${Q}/`),ce=await le.json();if(le.ok)r(ce),console.log("Event Data: ",ce);else{const ae=await se(ce,le.status);I({message:`Errore: ${ae}`,state:"error"})}}catch(Q){H(Q),I({message:`Errore generale: ${Q}`,state:"error"})}finally{i(!1)}})().then()},[p,h]);const L=async()=>{i(!0);try{const O=await K("GET",`/event/${g.id}/`),Q=await O.json();if(O.ok)r(Q),i(!1);else{const le=await se(Q,O.status);I({message:`Errore: ${le}`,state:"error"})}}catch(O){H(O),I({message:`Errore generale: ${O}`,state:"error"})}finally{i(!1)}},N=()=>{m(!0)},_=async O=>{O&&(I({message:"Evento modificato con successo!",state:"success"}),await L()),m(!1)},T=O=>{S(O),A(!1),w(!0)},D=async(O,Q)=>{O&&(I({message:Q,state:"success"}),await L()),w(!1),S(null)},d=()=>{if(!g)return{chip:e.jsx(te,{label:"Loading...",variant:"outlined",size:"medium"}),isActive:!1};const O=V(),Q=g.subscription_start_date?V(g.subscription_start_date):null,le=g.subscription_end_date?V(g.subscription_end_date):null;let ce="error",ae=!1;Q&&le&&(O.isAfter(Q)&&O.isBefore(le)?(ce="success",ae=!0):O.isBefore(Q)&&(ce="warning"));let ue=g.subscription_start_date?V(g.subscription_start_date).format("DD/MM/YYYY HH:mm"):"Inizio non specificato",je=g.subscription_end_date?V(g.subscription_end_date).format("DD/MM/YYYY HH:mm"):"Fine non specificata";return{chip:e.jsx(te,{label:ue+" - "+je,color:ce,variant:"outlined",size:"medium"}),isActive:ae}},z=O=>{console.log("Editing subscription:",O),S(null),M(g.subscriptions.find(Q=>Q.id===O)||null),A(!0),w(!0)},f=xe.useMemo(()=>g?.lists?g.lists.map(O=>{const Q=g.subscriptions?.filter(ce=>ce.list_id===O.id)||[],le=[{accessorKey:"id",header:"ID",size:50},{accessorKey:"profile_name",header:"Profilo",size:150},{accessorKey:"status",header:"Stato",size:100,Cell:({cell:ce})=>{const ae=ce.getValue();let ue,je;switch(ae){case"paid":ue="success",je="PAGATO";break;case"pending":ue="warning",je="IN ATTESA";break;case"cancelled":ue="error",je="CANCELLATO";break;default:ue="default",je=ae}return e.jsx(te,{label:je,color:ue,size:"small"})}},{accessorKey:"notes",header:"Note",size:200}];return{listId:O.id,listName:O.name,capacity:O.capacity,subscriptions:Q,columns:le}}):[],[g]),R=xe.useMemo(()=>f.map(O=>({...O,tableOptions:{columns:O.columns,data:O.subscriptions,enableStickyHeader:!0,enablePagination:!0,enableRowSelection:!0,display:!1,initialState:{pagination:{pageSize:10,pageIndex:0}},paginationDisplayMode:"pages",localization:Ae,renderEmptyRowsFallback:()=>e.jsx(b,{sx:{textAlign:"center",p:2},children:e.jsx(P,{variant:"body1",children:"Nessuna iscrizione presente"})}),muiTablePaginationProps:{labelRowsPerPage:"Righe per pagina:"},renderTopToolbarCustomActions:({table:Q})=>{const le=Q.getSelectedRowModel().rows,ce=le.length;return e.jsxs(b,{sx:{display:"flex",gap:1},children:[ce>=1&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{variant:"outlined",color:"primary",onClick:()=>W(le,O.listId),children:"Sposta in Altra Lista"}),e.jsx(Z,{variant:"outlined",color:"secondary",onClick:()=>ee(le),children:"Esporta"})]}),ce===1&&e.jsx(e.Fragment,{children:e.jsx(Z,{variant:"contained",color:"primary",onClick:()=>z(le[0].original.id),children:"Modifica Iscrizione"})})]})}}})),[f]),j=xe.memo(()=>{if(!R||R.length===0)return e.jsx(P,{children:"Nessuna lista disponibile (aggiungine una per poter iscrivere)"});const{isActive:O}=d();return R.map(Q=>{const{listId:le,listName:ce,capacity:ae,subscriptions:ue,tableOptions:je}=Q,De=Math.round(ue.length/ae*100)||0,Xe=De>=90?"error":De>=60?"warning":"success",k={...je,paginationDisplayMode:"pages"},$=Me(k);return e.jsxs(ls,{sx:{mt:2},children:[e.jsx(cs,{children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(ds,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",sx:{flexGrow:1},children:ce}),e.jsxs(b,{sx:{display:"flex",alignItems:"center",cursor:ue.length<ae&&O?"pointer":"not-allowed",opacity:ue.length<ae&&O?1:.5,px:2,py:1,borderRadius:1,bgcolor:"primary.main",color:"white",ml:2},onClick:ue.length<ae&&O?()=>T(le):void 0,children:[e.jsx(us,{sx:{mr:1}})," ISCRIVI"]}),e.jsxs(b,{sx:{width:"200px",ml:2},children:[e.jsx(b,{sx:{display:"flex",justifyContent:"space-between"},children:e.jsxs(P,{variant:"body2",children:[ue.length,"/",ae]})}),e.jsx(ms,{variant:"determinate",value:De,color:Xe,sx:{height:8,borderRadius:5}})]})]})}),e.jsx(ps,{children:e.jsx(Re,{table:$})})]},le)})});j.displayName="ListAccordions";const W=(O,Q)=>{console.log("Moving selected rows to another list:",O),E(O),S(Q),x(!0)},ie=O=>{O&&(I({message:"Spostamento effettuato con successo!",state:"success"}),L().then()),x(!1)},ee=O=>{console.log("Exporting selected rows:",O)};return e.jsxs(b,{children:[e.jsx(ke,{}),o&&e.jsx(Na,{open:o,onClose:_,event:{...g,date:g.date?V(g.date):null,subscription_start_date:g.subscription_start_date?V(g.subscription_start_date):null,subscription_end_date:g.subscription_end_date?V(g.subscription_end_date):null},isEdit:!0}),l&&e.jsx(Us,{open:l,onClose:D,event:g,listId:v,subscription:F,isEdit:J}),y&&e.jsx(Js,{open:y,onClose:ie,selectedRows:a,event:g,listId:v}),e.jsxs(b,{sx:{mx:"5%"},children:[C?e.jsx(be,{}):e.jsxs(e.Fragment,{children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(U,{onClick:()=>{t(-1)},sx:{mr:2},children:e.jsx(Ze,{})}),e.jsx(ia,{sx:{marginRight:"10px"}}),e.jsxs(P,{variant:"h4",children:["Evento - ",g.name]})]}),e.jsx(Ve,{elevation:3,sx:{mt:5,mb:4,borderRadius:2,overflow:"hidden"},children:e.jsx(Ia,{children:e.jsxs(c,{container:!0,spacing:3,children:[e.jsxs(c,{size:{xs:12,md:4},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(hs,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",children:"Data"})]}),e.jsx(P,{variant:"body1",color:"text.secondary",sx:{mt:2},children:g.date?V(g.date).format("DD/MM/YYYY"):"Data non specificata"})]}),e.jsxs(c,{size:{xs:12,md:4},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(xs,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",children:"Costo"})]}),e.jsx(P,{variant:"body1",color:"text.secondary",sx:{mt:2},children:g.cost!==0?`€ ${g.cost}`:"Gratuito"})]}),e.jsxs(c,{size:{xs:12,md:4},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(fs,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",children:"Periodo Iscrizioni"})]}),e.jsx(b,{sx:{display:"flex",alignItems:"center",mt:2},children:d().chip})]}),e.jsxs(c,{size:{xs:12},children:[e.jsx(We,{sx:{my:1}}),e.jsxs(b,{sx:{display:"flex",alignItems:"center",mt:2},children:[e.jsx(gs,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",children:"Descrizione"})]}),e.jsx("div",{"data-color-mode":"light",style:{marginTop:10},children:e.jsx(Ra,{value:g.description||"Nessuna descrizione disponibile",readOnly:!0})})]}),e.jsxs(c,{size:{xs:12},children:[e.jsx(We,{sx:{my:1}}),e.jsxs(b,{sx:{display:"flex",alignItems:"center",mt:2},children:[e.jsx(Je,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",children:"Azioni"})]}),e.jsx(Z,{sx:{mt:2},variant:"contained",color:"primary",onClick:N,children:"Modifica Evento"})]}),e.jsxs(c,{size:{xs:12},children:[e.jsx(We,{sx:{my:1}}),e.jsxs(b,{sx:{mt:2},children:[e.jsx(P,{variant:"h6",component:"div",sx:{mb:2},children:"Liste"}),e.jsx(j,{})]})]})]})})})]}),n&&e.jsx(Ce,{message:n.message,state:n.state})]})]})}function Ie({children:p,requiredPermission:u}){const{accessToken:t,user:o,loading:m}=Fe(),l=_e();return s.useEffect(()=>{!m&&(!t||u&&!o?.permissions.includes(u))&&(console.log("Redirecting to login..."),l("/login",{replace:!0}))},[m,t,o,u,l]),m?e.jsx("div",{children:"Loading..."}):!t||u&&!o?.permissions.includes(u)?null:p}function Qs(){const{uid:p,token:u}=Qe(),[t,o]=s.useState({message:"",state:"loading"});return s.useEffect(()=>{p&&u?(async()=>{try{const l=await K("GET",`/api/profile/verify-email/${p}/${u}/`,null,{},!1),w=await l.json();if(l.ok)o({message:w.message,state:"success"});else{const y=se(w,l.status);o({message:y,state:"error"})}}catch(l){H(l),o({message:`General error: ${l}`,state:"error"})}})().then():o({message:"Invalid verification link",state:"error"})},[p,u]),e.jsx(ra,{maxWidth:"sm",children:e.jsxs(b,{sx:{mt:8,display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",p:3,borderRadius:2,boxShadow:3,bgcolor:"background.paper"},children:[e.jsx(P,{variant:"h4",component:"h1",gutterBottom:!0,children:"Email Verification"}),e.jsx(Ne,{message:t.message,state:t.state,loadingText:"Verifying your email address..."})]})})}function Xs(){const{uid:p,token:u}=Qe(),t=_e(),[o,m]=s.useState(""),[l,w]=s.useState(""),[y,x]=s.useState(null),[a,E]=s.useState(!1),C=async()=>{if(o!==l){x({message:"Le password non coincidono.",state:"error"});return}try{const i=await K("POST",`/api/reset-password/${p}/${u}/`,{password:o,confirm_password:l},{},!1);if(i.ok)E(!0),x({message:"Password reimpostata con successo!",state:"success"});else{const n=await i.json(),I=await se(n,i.status);x({message:`Errore durante il reset della password: ${I}`,state:"error"})}}catch(i){H(i),x({message:`Errore generale: ${i}`,state:"error"})}};return e.jsx(ra,{maxWidth:"xs",children:e.jsxs(b,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("img",{alt:"",src:la,style:{height:"25vh"}}),e.jsx(P,{style:{marginTop:10},variant:"h5",children:"Reimposta Password"}),y&&e.jsx(Ne,{message:y.message,state:y.state}),!a&&e.jsxs(e.Fragment,{children:[e.jsx(G,{margin:"normal",required:!0,fullWidth:!0,label:"Nuova Password",type:"password",onChange:i=>m(i.target.value)}),e.jsx(G,{margin:"normal",required:!0,fullWidth:!0,label:"Conferma Password",type:"password",onChange:i=>w(i.target.value)}),e.jsx(Z,{fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},onClick:C,children:"Reimposta Password"})]}),a&&e.jsx(ye,{component:"button",variant:"body2",sx:{textAlign:"center"},onClick:()=>t("/login"),children:"Vai al Login"})]})})}function et({open:p,onClose:u,transaction:t}){const[o,m]=s.useState(!0),[l,w]=s.useState([]),[y,x]=s.useState(null),[a,E]=s.useState({executor:null,account:"",amount:"",description:"",type:""}),[C,i]=s.useState({executor:[!1,""],account:[!1,""],amount:[!1,""],description:[!1,""]});s.useEffect(()=>{console.log("TransactionModal useEffect",t),m(!0),Promise.all([K("GET","/accounts/")]).then(async([h])=>{const v=h.ok?await h.json():{results:[]};w(v.results||[]),t&&E({executor:t.executor||null,account:t.account?.id||"",amount:t.amount||"",description:t.description||"",type:t.type||""})}).finally(()=>m(!1))},[p,t]);const n=h=>{const{name:v,value:S}=h.target;E(F=>({...F,[v]:S}))},I=()=>{let h=!1;const v={...C};return a.executor?v.executor=[!1,""]:(v.executor=[!0,"Seleziona un Esecutore"],h=!0),a.account?v.account=[!1,""]:(v.account=[!0,"Seleziona una Cassa"],h=!0),!a.amount||isNaN(Number(a.amount))?(v.amount=[!0,"Inserisci un importo valido"],h=!0):v.amount=[!1,""],i(v),!h},g=async h=>{if(h.preventDefault(),!!I()){m(!0);try{const v={executor:a.executor.id||a.executor.email,account:a.account,amount:parseFloat(a.amount),description:a.description},S=await K("PATCH",`/transaction/${t.id}/`,v);if(S.ok)u(!0);else{const F=await S.json(),M=await se(F,S.status);x({message:`Errore: ${M}`,state:"error"})}}catch(v){H(v),x({message:`Errore generale: ${v}`,state:"error"})}finally{m(!1)}}},r=()=>u(!1);return e.jsx(Le,{open:p,onClose:r,children:e.jsx(b,{sx:Oe,component:"form",onSubmit:g,noValidate:!0,children:o?e.jsx(be,{}):e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(U,{onClick:r,sx:{minWidth:0},children:e.jsx(Se,{})})}),e.jsx(P,{variant:"h5",gutterBottom:!0,align:"center",sx:{mb:2},children:"Modifica Transazione"}),y&&e.jsx(Ce,{message:y.message,state:y.state}),e.jsxs(c,{container:!0,spacing:2,sx:{mt:2},children:[e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Tipo:"})," ",ne.tran_type[a.type]||"Non specificato"]}),e.jsx(c,{size:{xs:12},children:e.jsx(Oa,{value:a.executor,onChange:(h,v)=>{E({...a,executor:v})},error:C.executor[0],helperText:C.executor[0]?C.executor[1]:"Cerca per nome o numero ESNcard",label:ne.executor,esner_only:!0,required:!0})}),e.jsx(c,{size:{xs:12},children:e.jsxs(X,{fullWidth:!0,required:!0,error:C.account[0],children:[e.jsx(re,{id:"account-label",children:ne.account}),e.jsx(oe,{labelId:"account-label",name:"account",variant:"outlined",value:a.account,onChange:n,input:e.jsx(Te,{label:ne.account}),children:l.map(h=>e.jsx(Y,{value:h.id,children:h.name},h.id))}),C.account[0]&&e.jsx(Ue,{children:C.account[1]})]})}),e.jsx(c,{size:{xs:12},children:e.jsx(G,{label:ne.amount,name:"amount",value:a.amount,onChange:n,required:!0,fullWidth:!0,error:C.amount[0],type:"number",slotProps:{htmlInput:{min:"0.01",step:"0.01"}}})}),e.jsx(c,{size:{xs:12},children:e.jsx(G,{label:"Descrizione",name:"description",value:a.description,onChange:n,fullWidth:!0,multiline:!0,rows:3})})]}),e.jsx(b,{mt:2,children:e.jsx(Z,{fullWidth:!0,variant:"contained",color:"primary",type:"submit",children:"Salva Modifiche"})})]})})})}const Wa={subscription:{label:ne.tran_type.subscription,color:"primary"},esncard:{label:ne.tran_type.esncard,color:"secondary"},deposit:{label:ne.tran_type.deposit,color:"success"},withdrawal:{label:ne.tran_type.withdrawal,color:"error"}},ga=[{value:"",label:"Tutti"},...Object.entries(Wa).map(([p,u])=>({value:p,label:u.label,color:u.color}))];function at(){const[p,u]=s.useState(!0),[t,o]=s.useState([]),[m,l]=s.useState([]),w=_e(),[y,x]=s.useState(null),[a,E]=s.useState(!1),[C,i]=s.useState(null),[n,I]=s.useState({pageIndex:0,pageSize:10}),[g,r]=s.useState(0),[h,v]=s.useState({account:[],type:[],dateFrom:null,dateTo:null}),[S,F]=s.useState(""),[M,J]=s.useState(""),A=s.useRef(null);s.useEffect(()=>{L().then()},[n.pageIndex,n.pageSize,h,M]);const L=async()=>{u(!0);try{const j=new URLSearchParams;j.append("page",n.pageIndex+1),j.append("page_size",n.pageSize),M&&j.append("search",M),h.account.length&&h.account.forEach(Q=>j.append("account",Q)),h.type.length&&h.type.forEach(Q=>j.append("type",Q)),h.dateFrom&&j.append("dateFrom",h.dateFrom.toISOString()),h.dateTo&&j.append("dateTo",h.dateTo.toISOString());const[W,ie]=await Promise.all([K("GET",`/transactions/?${j.toString()}`),K("GET","/accounts/")]),ee=W.ok?await W.json():{results:[]},O=ie.ok?await ie.json():{results:[]};r(ee.count||0),o(ee.results||[]),l(O.results||[])}finally{u(!1)}},N=s.useMemo(()=>[{accessorKey:"created_at",header:ne.date,size:120,Cell:({cell:j})=>{const W=new Date(j.getValue());return new Intl.DateTimeFormat("it-IT",{dateStyle:"medium",timeStyle:"short"}).format(W)}},{accessorKey:"type",header:ne.type,size:100,Cell:({cell:j})=>{const W=j.getValue(),ie=Wa[W]||{label:"Sconosciuto",color:"default"};return e.jsx(te,{label:ie.label,color:ie.color,variant:"outlined"})}},{accessorKey:"executor.name",header:ne.executor,size:150},{accessorKey:"account.name",header:ne.account,size:120,Cell:({cell:j})=>e.jsx(b,{component:"span",fontWeight:"bold",children:j.getValue()})},{accessorKey:"amount",header:ne.amount,size:100,Cell:({cell:j})=>e.jsx(b,{children:j.getValue()!==null?e.jsx(te,{label:`€${j.getValue()}`,color:"primary"}):e.jsx(te,{label:"N/A",color:"warning"})})},{accessorKey:"description",header:ne.description,size:200,Cell:({cell:j})=>e.jsx(b,{component:"span",fontStyle:"italic",children:j.getValue()})}],[]),_=Me({columns:N,data:t,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableExpandAll:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},sorting:[{id:"created_at",desc:!0}]},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",enableGlobalFilter:!1,muiPaginationProps:{color:"secondary",rowsPerPageOptions:[10,20,30],shape:"rounded",variant:"outlined"},manualPagination:!0,rowCount:g,onPaginationChange:I,state:{pagination:n},localization:Ae,muiTableBodyRowProps:({row:j})=>({onClick:()=>{i(j.original),E(!0)},sx:{cursor:"pointer"}})}),T=()=>{J(S),I(j=>({...j,pageIndex:0}))},D=()=>{F(""),J(""),I(j=>({...j,pageIndex:0})),A.current&&A.current.focus()},d=async j=>{j&&(x({message:"Transazione modificata con successo!",state:"success"}),await L()),i(null),E(!1)},z=(j,W)=>{v(ie=>{let ee={...ie,[j]:W};return j==="dateFrom"&&ee.dateTo&&W&&W>ee.dateTo&&(ee.dateTo=W),j==="dateTo"&&ee.dateFrom&&W&&W<ee.dateFrom&&(ee.dateFrom=W),ee})},f=j=>{const{name:W,value:ie}=j.target;v(ee=>{let O={...ee,[W]:ie};return(W==="account"||W==="type")&&(O[W]=typeof ie=="string"?ie.split(","):ie),O})},R=()=>{v(j=>({...j,dateFrom:null,dateTo:null}))};return e.jsxs(b,{children:[e.jsx(ke,{}),a&&e.jsx(et,{open:a,onClose:d,transaction:C}),e.jsxs(b,{sx:{mx:"5%"},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(U,{onClick:()=>w(-1),sx:{mr:2},children:e.jsx(Ze,{})}),e.jsx(P,{variant:"h4",children:"Lista Transazioni"})]}),e.jsxs(c,{container:!0,spacing:2,sx:{mb:2,mt:4},alignItems:"center",children:[e.jsx(c,{size:{xs:12,sm:2},children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(re,{id:"account-label",children:"Cassa"}),e.jsx(oe,{labelId:"account-label",name:"account",multiple:!0,value:h.account,onChange:f,input:e.jsx(Te,{label:"Cassa"}),variant:"outlined",renderValue:j=>m.filter(W=>j.includes(W.id)).map(W=>W.name).join(", "),children:m.map(j=>e.jsx(Y,{value:j.id,children:j.name},j.id))})]})}),e.jsx(c,{size:{xs:12,sm:2},children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(re,{id:"type-label",children:"Tipo"}),e.jsx(oe,{labelId:"type-label",name:"type",multiple:!0,value:h.type,onChange:f,input:e.jsx(Te,{label:"Tipo"}),variant:"outlined",renderValue:j=>ga.filter(W=>j.includes(W.value)&&W.value).map(W=>W.label).join(", "),children:ga.filter(j=>j.value).map(j=>e.jsx(Y,{value:j.value,children:j.label},j.value))})]})}),e.jsx(c,{size:{xs:12,sm:2},children:e.jsx(X,{fullWidth:!0,children:e.jsx(fe,{dateAdapter:He,adapterLocale:Ye,children:e.jsx(ve,{label:"Da",value:h.dateFrom,maxDate:h.dateTo||void 0,onChange:j=>z("dateFrom",j),format:"d MMM yyyy"})})})}),e.jsx(c,{size:{xs:12,sm:2},children:e.jsx(X,{fullWidth:!0,children:e.jsx(fe,{dateAdapter:He,adapterLocale:Ye,children:e.jsx(ve,{label:"A",value:h.dateTo,minDate:h.dateFrom||void 0,onChange:j=>z("dateTo",j),format:"d MMM yyyy"})})})}),(h.dateFrom||h.dateTo)&&e.jsx(c,{size:{xs:12,sm:2},sx:{display:"flex",alignItems:"center"},children:e.jsx(Z,{variant:"outlined",color:"secondary",startIcon:e.jsx($e,{}),onClick:R,sx:{height:"100%",minWidth:0,px:1},children:"Azzera date"})}),e.jsx(c,{size:{xs:12,sm:2},sx:{ml:"auto"},children:e.jsx(X,{fullWidth:!0,children:e.jsx(Te,{inputRef:A,size:"small",placeholder:"Cerca",value:S,onChange:j=>F(j.target.value),onKeyDown:j=>{j.key==="Enter"&&T()},endAdornment:S&&M===S?e.jsx(U,{"aria-label":"clear",onClick:D,edge:"end",children:e.jsx($e,{})}):e.jsx(U,{"aria-label":"search",onClick:T,edge:"end",children:e.jsx(oa,{})})})})})]}),p?e.jsx(be,{}):e.jsx(Re,{sx:{mt:2},table:_}),y&&e.jsx(Ce,{message:y.message,state:y.state})]})]})}const st=({onEdit:p,onCancel:u,onSave:t,saving:o})=>{const[m,l]=s.useState(!1),[w,y]=s.useState(!1),x=()=>{y(!0),p&&p()},a=()=>{o||(y(!1),u&&u())},E=async()=>{l(!0);try{t?await t()!==!1&&y(!1):y(!1)}catch(C){H(C)}finally{l(!1)}};return e.jsx("div",{children:w?e.jsxs(b,{sx:{display:"inline-flex"},children:[e.jsx(U,{onClick:a,"aria-label":"Cancel",disabled:o||m,children:e.jsx(bs,{})}),o||m?e.jsx(U,{disabled:!0,children:e.jsx(Be,{size:"1rem"})}):e.jsx(U,{onClick:E,"aria-label":"Save",sx:{color:"#0288d1"},children:e.jsx(js,{})})]}):e.jsx(U,{onClick:x,"aria-label":"Edit",children:e.jsx(Je,{})})})};function ba({cols:p,initialData:u,title:t,onSave:o,onDelete:m,onCreate:l,createText:w,canCreate:y,canDelete:x,canEdit:a,sortColumn:E}){const C=s.useMemo(()=>p,[p]),[i,n]=s.useState([]),r=a?e.jsx("span",{style:{color:"green"},children:"(Hai i permessi per eseguire modifiche)"}):e.jsx("span",{style:{color:"red"},children:"(Non hai i permessi per eseguire modifiche)"});s.useEffect(()=>{n(u)},[u]);const h=Me({columns:C,data:i,enableEditing:a,editDisplayMode:"row",createDisplayMode:"row",enableColumnFilters:!1,enableGlobalFilter:!1,enableSorting:E!=null,enableFullScreenToggle:!1,enableColumnOrdering:!1,enableColumnActions:!1,enableDensityToggle:!1,enableHiding:!1,enablePagination:!1,localization:Ae,initialState:{sorting:[{id:E,desc:!0}]},onCreatingRowSave:async({values:v,table:S})=>{let F=await l(v);F&&(n([...i,F]),S.setCreatingRow(!1))},onEditingRowSave:async({row:v,values:S})=>{if(await o(v.original,S)){const F=i.map((M,J)=>J===v.index?{...v.original,...S}:M);n(F),console.log(F),h.setEditingRow(null)}},getRowId:v=>v.id,renderRowActions:({row:v,table:S})=>e.jsxs(b,{sx:{display:"flex"},children:[e.jsx(qe,{title:"Modifica",children:e.jsx(U,{onClick:()=>S.setEditingRow(v),children:e.jsx(Je,{})})}),x&&e.jsx(qe,{title:"Elimina",children:e.jsxs(U,{onClick:async()=>{await m(v.original),n(i.filter(F=>F.id!==v.id))},children:[" ",e.jsx(Pa,{})]})})]}),renderTopToolbarCustomActions:({table:v})=>e.jsxs(b,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsxs(b,{sx:{ml:3},children:[e.jsx("h3",{children:t}),e.jsx("h5",{children:r})]}),w!=null?e.jsx(Z,{variant:"contained",color:"primary",onClick:l,sx:{ml:"auto",mr:2,visibility:y?"visible":"hidden"},children:w}):e.jsx(U,{sx:{ml:"auto",mr:2,visibility:y?"visible":"hidden"},onClick:()=>{v.setCreatingRow(!0)},children:e.jsx(ys,{})})]})});return e.jsx(Re,{table:h})}function tt({open:p,profile:u,onClose:t}){const[o,m]=s.useState(0),[l,w]=s.useState(null),[y,x]=s.useState({open:!1,action:null,message:""}),[a,E]=s.useState(!0),[C,i]=s.useState([]),[n,I]=s.useState({esncard_number:"",account_id:""}),[g,r]=s.useState({esncard_number:[!1,""],account_id:[!1,""]}),h=[{field:"esncard_number",value:n.esncard_number,message:"Inserire il numero di ESNcard"},{field:"account_id",value:n.account_id,message:"Selezionare una Cassa"}];s.useEffect(()=>{E(!0),S().then(),v().then()},[]);const v=async()=>{try{const L=await K("GET","/esncard_fees/"),N=await L.json();if(L.ok)console.log("ESNcard fees:",N),u.latest_esncard&&u.latest_esncard?.is_valid?m(parseFloat(N.esncard_lost_fee.replace("€",""))):m(parseFloat(N.esncard_release_fee.replace("€","")));else{const _=await se(N,L.status);w({message:`Errore fees ESNcard: ${_}`,state:"error"})}}catch(L){H(L),w({message:`Errore generale: ${L}`,state:"error"})}finally{E(!1)}},S=async()=>{try{const L=await K("GET","/accounts/"),N=await L.json();if(L.ok)i(N.results);else{const _=await se(N,L.status);w({message:`Errore durante il recupero delle casse: ${_}`,state:"error"})}}catch(L){H(L),w({message:`Errore generale: ${L}`,state:"error"})}},F=()=>{const L={};return Object.keys(g).forEach(N=>{L[N]=[!1,""]}),r(L),L},M=async()=>{let L=!1;const N=F();if(h.forEach(T=>{T.value||(N[T.field]=[!0,T.message],L=!0)}),L){r(N);return}let _="Confermi un pagamento di "+o+"€ per l'emissione della ESNcard?";x({open:!0,action:()=>J(),message:_})},J=async()=>{x({open:!1,action:null,message:""});try{const L=await K("POST","/esncard_emission/",{profile_id:u.id,account_id:n.account_id,esncard_number:n.esncard_number,amount:o});if(L.ok)t(!0);else{const N=await L.json(),_=await se(N,L.status);w({message:`Errore durante l'emissione della ESNcard: ${_}`,state:"error"})}}catch(L){H(L),w({message:`Errore generale: ${L}`,state:"error"})}},A=L=>{I({...n,[L.target.name]:L.target.value})};return e.jsx(Le,{open:p,onClose:()=>{t(!1)},"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsx(b,{sx:Oe,children:a?e.jsx(be,{}):e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(U,{onClick:()=>t(!1),sx:{minWidth:0},children:e.jsx(Se,{})})}),e.jsx(P,{variant:"h4",component:"h2",gutterBottom:!0,children:"Emissione ESNcard"}),e.jsx(We,{sx:{mb:2}}),e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"A:"})," ",u.name," ",u.surname]}),e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Importo:"})," ",o,"€"]}),e.jsxs(c,{container:!0,spacing:2,direction:"column",children:[e.jsx(c,{size:{xs:12},sx:{mt:2},children:e.jsx(G,{required:!0,label:"Numero ESNcard",name:"esncard_number",value:n.esncard_number,error:g.esncard_number[0],helperText:g.esncard_number[1],onChange:A,fullWidth:!0})}),e.jsx(c,{size:{xs:12},sx:{mt:0},children:e.jsxs(X,{fullWidth:!0,required:!0,error:g.account_id[0],children:[e.jsx(re,{htmlFor:"account-selector",sx:{mb:2},children:"Seleziona Cassa"}),e.jsx(oe,{variant:"outlined",label:"Seleziona Cassa",labelId:"account-selector-label",id:"account-selector",name:"account_id",value:n.account_id,error:g.account_id[0],onChange:A,children:C.map(L=>e.jsxs(Y,{value:L.id,disabled:L.status==="closed",style:{color:L.status==="closed"?"grey":"inherit"},children:[L.name," ",L.status==="closed"?"(Chiusa)":""]},L.id))}),g.account_id[0]&&e.jsx(Ue,{children:g.account_id[1]})]})})]}),e.jsx(Z,{variant:"contained",fullWidth:!0,sx:{mt:2},onClick:M,children:"Conferma"}),l&&e.jsx(Ce,{message:l.message,state:l.state}),e.jsx(ca,{open:y.open,message:y.message,onConfirm:y.action,onClose:()=>x({open:!1,action:null,message:""})})]})})})}const nt={ESNer:{hideFields:["course","matricola_expiration","whatsapp_prefix","whatsapp_number"]},Erasmus:{hideFields:["group"]}};function rt(){const{user:p}=Fe(),{id:u}=Qe(),[t,o]=s.useState(!1),[m,l]=s.useState(!0),[w,y]=s.useState(null),[x,a]=s.useState(null),[E,C]=s.useState(!1),[i,n]=s.useState({}),[I,g]=s.useState({}),[r,h]=s.useState([]),[v,S]=s.useState(null),F=_e(),[M,J]=s.useState({email:"",name:"",surname:"",birthdate:"",country:"",phone_prefix:"",phone_number:"",whatsapp_prefix:"",whatsapp_number:"",person_code:"",domicile:"",course:"",matricola_number:"",matricola_expiration:"",documents:[],esncards:[],group:""}),[A,L]=s.useState({email:"",name:"",surname:"",birthdate:"",country:"",phone_prefix:"",phone_number:"",whatsapp_prefix:"",whatsapp_number:"",person_code:"",domicile:"",course:"",matricola_number:"",matricola_expiration:"",group:""}),[N,_]=s.useState({email:[!1,""],name:[!1,""],surname:[!1,""],birthdate:[!1,""],country:[!1,""],phone_prefix:[!1,""],phone_number:[!1,""],whatsapp_prefix:[!1,""],whatsapp_number:[!1,""],person_code:[!1,""],domicile:[!1,""],course:[!1,""],matricola_number:[!1,""],matricola_expiration:[!1,""],group:[!1,""]}),[T,D]=s.useState({email:!0,name:!0,surname:!0,birthdate:!0,country:!0,phone_prefix:!0,phone_number:!0,whatsapp_prefix:!0,whatsapp_number:!0,person_code:!0,domicile:!0,course:!0,matricola_number:!0,matricola_expiration:!0,group:!0});s.useEffect(()=>{l(!0),(async()=>{try{const $=await K("GET",`/profile/${u}/`),q=await $.json();if($.ok){const de={};Object.keys(M).map(me=>{de[me]=q[me]}),J(de),L(de),y(q),S(q.is_esner?"ESNer":"Erasmus")}else{const de=await se(q,$.status);a({message:`Errore: ${de}`,state:"error"})}}catch($){H($),a({message:`Errore generale: ${$}`,state:"error"})}finally{l(!1)}})().then()},[]),s.useEffect(()=>{(async()=>{try{const $=await K("GET","/groups/"),q=await $.json();$.ok?h(q):a({message:`Errore nel recupero dei gruppi: ${await se(q,$.status)}`,state:"error"})}catch($){H($),a({message:`Errore generale: ${$}`,state:"error"})}})().then()},[]);const d=nt[v]||{hideFields:[]},z=k=>d.hideFields.includes(k),f=async()=>{try{const k=await K("GET",`/profile/${w.id.toString()}/`),$=await k.json();if(k.ok)J($),L($),y($);else{const q=await se($,k.status);a({message:`Errore: ${q}`,state:"error"})}}catch(k){H(k),a({message:`Errore generale: ${k}`,state:"error"})}},R=()=>{C(!0)},j=async k=>{k&&(a({message:"ESNcard emessa con successo!",state:"success"}),await f()),C(!1)},W=s.useMemo(()=>[{accessorKey:"number",header:"Numero",size:100,muiEditTextFieldProps:{required:!0,helperText:i?.number,error:!!i?.number}},{accessorKey:"created_at",enableEditing:!1,header:"Rilascio",size:100,Cell:({cell:k})=>{const $=new Date(k.getValue());return $==null?"Null":$.toISOString().split("T")[0]}},{accessorKey:"expiration",enableEditing:!1,header:"Scadenza",size:100,Cell:({cell:k})=>{const de=new Date(k.getValue())<new Date;return e.jsx("span",{style:{color:de?"orange":"green"},children:k.getValue()})}}],[]),ie=async(k,$)=>{try{const q=await K("PATCH",`/esncard/${k.id}/`,$);if(q.ok)return n({}),a({message:"ESNcard aggiornata con successo!",state:"success"}),await f(),!0;{const de=await q.json(),me=await se(de,q.status);return a({message:`Errore: ${me}`,state:"error"}),!1}}catch(q){H(q),a({message:`Errore generale: ${q}`,state:"error"})}},ee=s.useMemo(()=>[{accessorKey:"type",header:"Tipo",size:100,editVariant:"select",editSelectOptions:["Passport","ID Card","Driving License","Residency Permit","Other"],muiEditTextFieldProps:{select:!0,helperText:I?.type,error:!!I?.type}},{accessorKey:"number",header:"Numero",size:60,muiEditTextFieldProps:{required:!0,helperText:I?.number,error:!!I?.number}},{accessorKey:"expiration",header:"Scadenza",size:60,muiEditTextFieldProps:{required:!0,helperText:I?.expiration,error:!!I?.expiration,type:"date"},Cell:({cell:k})=>{const de=new Date(k.getValue())<new Date;return e.jsx("span",{style:{color:de?"orange":"green"},children:k.getValue()})}}],[]),O=async k=>{try{const $=await K("DELETE",`/document/${k.id}/`);if($.ok)return g({}),a({message:"Documento eliminato con successo!",state:"success"}),await f(),!0;{$.json().then(me=>g(me));const q=await $.json(),de=await se(q,$.status);a({message:`Errore: ${de}`,state:"error"})}}catch($){H($),a({message:`Errore generale: ${$}`,state:"error"})}},Q=async k=>{let $={...k,profile:w.id};try{const q=await K("POST","/document/",$);if(q.ok)return g({}),a({message:"Documento aggiunto con successo!",state:"success"}),await f(),!0;{q.json().then(ea=>g(ea));const de=await q.json(),me=await se(de,q.status);return a({message:`Errore: ${me}`,state:"error"}),!1}}catch(q){return H(q),a({message:`Errore generale: ${q}`,state:"error"}),!1}},le=async(k,$)=>{try{const q=await K("PATCH",`/document/${k.id}/`,$);if(q.ok)return g({}),a({message:"Documento aggiornato con successo!",state:"success"}),await f(),!0;{q.json().then(ea=>g(ea));const de=await q.json(),me=await se(de,q.status);return a({message:`Errore: ${me}`,state:"error"}),!1}}catch(q){return H(q),a({message:`Errore generale: ${q}`,state:"error"}),!1}},ce=k=>k?V(k).format("YYYY-MM-DD"):null,ae=k=>{L({...A,[k.target.name]:k.target.value})},ue=(k,$)=>{L({...A,[k]:$})},je=()=>{const k={};Object.keys(N).forEach($=>{k[$]=[!1,""]}),_(k)},De=k=>{D(Object.fromEntries(Object.keys(T).map($=>[$,!k]))),je()},Xe=async()=>{if(o(!0),A.matricola_number&&!/^\d{6}$/.test(A.matricola_number))return _(k=>({...k,matricola_number:[!0,"La Matricola deve essere composta da 6 cifre"]})),o(!1),!1;try{const k={...A,birthdate:ce(A.birthdate),matricola_expiration:ce(A.matricola_expiration)},$=await K("PATCH",`/profile/${w.id.toString()}/`,k);if($.ok)await f(),M&&(je(),a({message:"Profilo aggiornato con successo!",state:"success"}),De(!1));else{const q=await $.json(),de=Object.fromEntries(Object.keys(N).map(me=>me in q?[me,[!0,q[me]]]:[me,[!1,""]]));_(de)}}catch(k){H(k),L(M),a({message:`Errore generale: ${k}`,state:"error"}),De(!1)}finally{o(!1)}};return e.jsxs(b,{children:[e.jsx(ke,{}),m?e.jsx(be,{}):e.jsx(e.Fragment,{children:e.jsxs(b,{sx:{mx:"5%"},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(U,{onClick:()=>F(-1),sx:{mr:2},children:e.jsx(Ze,{})}),e.jsxs(P,{variant:"h4",children:["Profilo ",v]})]}),e.jsx(Ve,{sx:{p:"20px"},children:e.jsxs(c,{container:!0,spacing:2,children:[e.jsxs(c,{container:!0,size:{xs:12},alignItems:"center",children:[e.jsx(na,{}),e.jsx(P,{variant:"h6",sx:{m:0},children:"Informazioni Personali"}),e.jsx(c,{sx:{marginLeft:"auto"},children:e.jsx(st,{onEdit:()=>De(!0),onCancel:()=>{De(!1),L(M)},saving:t,onSave:Xe})})]}),!z("name")&&e.jsx(c,{size:{xs:12,md:3},children:e.jsx(G,{label:B.name,name:"name",value:A.name,error:N.name[0],helperText:N.name[1],slotProps:{input:{readOnly:T.name}},onChange:ae,sx:{backgroundColor:T.name?"grey.200":"white"},fullWidth:!0})}),!z("surname")&&e.jsx(c,{size:{xs:12,md:3},children:e.jsx(G,{label:B.surname,name:"surname",value:A.surname,error:N.surname[0],helperText:N.surname[1],onChange:ae,slotProps:{input:{readOnly:T.surname}},sx:{backgroundColor:T.surname?"grey.200":"white"},fullWidth:!0})}),!z("email")&&e.jsx(c,{size:{xs:12,md:3},children:e.jsx(G,{label:B.email,name:"email",type:"email",value:A.email,error:N.email[0],helperText:N.email[1],slotProps:{input:{readOnly:!0}},sx:{backgroundColor:"grey.200"},onChange:ae,fullWidth:!0})}),!z("birthdate")&&e.jsx(c,{size:{xs:12,md:3},children:e.jsx(fe,{dateAdapter:Ee,adapterLocale:"en-gb",children:e.jsx(ve,{label:B.birthdate,value:A.birthdate?V(A.birthdate,"YYYY-MM-DD"):null,readOnly:T.birthdate,onChange:k=>ue("birthdate",k),sx:{backgroundColor:T.birthdate?"grey.200":"white"},slotProps:{textField:{variant:"outlined"}}})})}),!z("country")&&e.jsx(c,{size:{xs:12,md:2},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(re,{id:"country-label",children:B.country}),e.jsxs(oe,{variant:"outlined",labelId:"country-label",name:"country",label:B.country,value:A.country,error:N.country[0],onChange:ae,slotProps:{input:{readOnly:T.country}},sx:{backgroundColor:T.country?"grey.200":"white"},children:[e.jsx(Y,{value:"",children:e.jsx("em",{children:"None"})}),ze.map(k=>e.jsx(Y,{value:k.code,children:k.name},k.code))]})]})}),!z("domicile")&&e.jsx(c,{size:{xs:12,md:4},children:e.jsx(G,{label:B.domicile,name:"domicile",value:A.domicile,error:N.domicile[0],helperText:N.domicile[1],onChange:ae,slotProps:{input:{readOnly:T.domicile}},sx:{backgroundColor:T.domicile?"grey.200":"white"},fullWidth:!0})}),!z("phone_prefix")&&!z("phone_number")&&e.jsxs(c,{size:{xs:12},container:!0,spacing:2,children:[e.jsx(c,{size:{xs:12,md:1},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(re,{id:"phone-prefix-label",children:B.phone_prefix}),e.jsx(oe,{variant:"outlined",labelId:"phone-prefix-label",id:"phone-prefix",name:"phone_prefix",value:A.phone_prefix||"",onChange:ae,slotProps:{input:{readOnly:T.phone_number}},sx:{backgroundColor:T.phone_number?"grey.200":"white"},label:B.phone_prefix,renderValue:k=>k,children:ze.map(k=>e.jsxs(Y,{value:k.dial,children:[k.dial," (",k.name,")"]},k.code))})]})}),e.jsx(c,{size:{xs:12,md:2},children:e.jsx(G,{label:B.phone_number,name:"phone_number",value:A.phone_number||"",error:N.phone_number[0],helperText:N.phone_number[1],onChange:ae,slotProps:{input:{readOnly:T.phone_number}},sx:{backgroundColor:T.phone_number?"grey.200":"white"},fullWidth:!0})})]}),!z("whatsapp_prefix")&&!z("whatsapp_number")&&e.jsxs(c,{size:{xs:12},container:!0,spacing:2,children:[e.jsx(c,{size:{xs:12,md:1},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(re,{id:"whatsapp-prefix-label",children:B.whatsapp_prefix}),e.jsx(oe,{variant:"outlined",labelId:"whatsapp-prefix-label",id:"whatsapp-prefix",name:"whatsapp_prefix",value:A.whatsapp_prefix||"",onChange:ae,slotProps:{input:{readOnly:T.whatsapp_prefix}},sx:{backgroundColor:T.whatsapp_prefix?"grey.200":"white"},label:B.whatsapp_prefix,renderValue:k=>k,children:ze.map(k=>e.jsxs(Y,{value:k.dial,children:[k.dial," (",k.name,")"]},k.code))})]})}),e.jsx(c,{size:{xs:12,md:2},children:e.jsx(G,{label:B.whatsapp_number,name:"whatsapp_number",value:A.whatsapp_number||"",error:N.whatsapp_number[0],helperText:N.whatsapp_number[1],onChange:ae,slotProps:{input:{readOnly:T.whatsapp_number}},sx:{backgroundColor:T.whatsapp_number?"grey.200":"white"},fullWidth:!0})})]}),e.jsxs(c,{container:!0,size:{xs:12},sx:{mt:2},alignItems:"center",children:[e.jsx(vs,{}),e.jsx(P,{variant:"h6",sx:{m:0},children:"Dati Studente"})]}),!z("person_code")&&e.jsx(c,{size:{xs:12,md:3},children:e.jsx(G,{label:B.person_code,name:"person_code",value:A.person_code||"",error:N.person_code[0],helperText:N.person_code[1],onChange:ae,slotProps:{input:{readOnly:T.person_code}},sx:{backgroundColor:T.person_code?"grey.200":"white"},fullWidth:!0})}),!z("course")&&e.jsx(c,{size:{xs:12,md:3},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(re,{id:"course-label",children:B.course}),e.jsxs(oe,{variant:"outlined",labelId:"course-label",name:"course",label:B.course,value:A.course||"",onChange:ae,slotProps:{input:{readOnly:T.course}},sx:{backgroundColor:T.course?"grey.200":"white"},children:[e.jsx(Y,{value:"Engineering",children:"Ingegneria"}),e.jsx(Y,{value:"Design",children:"Design"}),e.jsx(Y,{value:"Architecture",children:"Architettura"})]})]})}),!z("matricola_number")&&e.jsx(c,{size:{xs:12,md:3},children:e.jsx(G,{label:B.matricola_number,name:"matricola_number",value:A.matricola_number||"",error:N.matricola_number[0],helperText:N.matricola_number[1],onChange:ae,sx:{backgroundColor:T.matricola_number?"grey.200":"white"},type:"number",slotProps:{input:{readOnly:T.matricola_number}},fullWidth:!0})}),!z("matricola_expiration")&&e.jsx(c,{size:{xs:12,md:3},children:e.jsx(fe,{dateAdapter:Ee,adapterLocale:"en-gb",children:e.jsx(ve,{label:B.matricola_expiration,value:A.matricola_expiration?V(A.matricola_expiration,"YYYY-MM-DD"):null,readOnly:T.matricola_expiration,onChange:k=>ue("matricola_expiration",k),sx:{backgroundColor:T.matricola_expiration?"grey.200":"white"},slotProps:{textField:{variant:"outlined"}}})})}),!z("group")&&e.jsxs(c,{container:!0,alignItems:"center",spacing:1,sx:{width:"100%",mt:2},children:[e.jsx(_s,{}),e.jsx(c,{size:{xs:12,md:2},children:e.jsxs(X,{fullWidth:!0,required:!0,children:[e.jsx(re,{id:"group-label",children:B.group}),e.jsx(oe,{variant:"outlined",labelId:"group-label",label:B.group,name:"group",value:A.group||"",onChange:ae,slotProps:{input:{readOnly:T.group}},sx:{backgroundColor:T.group?"grey.200":"white"},children:r.map(k=>e.jsx(Y,{value:k.name,children:k.name},k.name))})]})})]})]})}),e.jsxs(Ve,{sx:{p:1,mt:2,mb:2,minHeight:"80px",display:"flex",alignItems:"center"},children:[e.jsxs(Ss,{sx:{justifyContent:"space-between",width:"100%",p:0},children:[e.jsx(P,{variant:"h6",children:"Azioni"}),e.jsx(Z,{variant:"contained",color:"primary",children:"Esporta Profilo"})]}),E&&e.jsx(tt,{open:E,profile:w,onClose:j})]}),e.jsxs(c,{container:!0,sx:{width:"100%",mb:5},spacing:2,children:[e.jsx(c,{size:{xs:12,md:6},children:e.jsx(ba,{cols:ee,canCreate:p.permissions.includes("add_document"),canEdit:p.permissions.includes("change_document"),canDelete:p.permissions.includes("delete_document"),onCreate:Q,onSave:le,onDelete:O,initialData:M.documents,title:"Documenti",sortColumn:"expiration"})}),e.jsx(c,{size:{xs:12,md:6},children:e.jsx(ba,{cols:W,canCreate:p.permissions.includes("add_esncard"),onCreate:R,createText:w.latest_esncard?w.latest_esncard.is_valid?"Card Smarrita":"Rinnova":"Rilascia",canEdit:p.permissions.includes("change_esncard"),onSave:ie,initialData:M.esncards,title:"ESNcards",sortColumn:"expiration"})})]}),x&&e.jsx(Ce,{message:x.message,state:x.state})]})})]})}function ot(){return e.jsx(Ps,{children:e.jsx(ks,{children:e.jsx(Ts,{children:e.jsxs(zs,{children:[e.jsx(pe,{path:"/verify-email/:uid/:token",element:e.jsx(Qs,{})}),e.jsx(pe,{path:"/reset-password/:uid/:token",element:e.jsx(Xs,{})}),e.jsx(pe,{path:"/login",element:e.jsx(Ms,{})}),e.jsx(pe,{path:"/",element:e.jsx(Ie,{children:e.jsx($s,{})})}),e.jsx(pe,{path:"/profiles/erasmus",element:e.jsx(Ie,{children:e.jsx(Rs,{})})}),e.jsx(pe,{path:"/profiles/esners",element:e.jsx(Ie,{children:e.jsx(Ns,{})})}),e.jsx(pe,{path:"/profile/:id",element:e.jsx(Ie,{children:e.jsx(rt,{})})}),e.jsx(pe,{path:"/erasmus_form",element:e.jsx(As,{})}),e.jsx(pe,{path:"/esner_form",element:e.jsx(Ls,{})}),e.jsx(pe,{path:"/treasury",element:e.jsx(Ie,{requiredPermission:"change_account",children:e.jsx(Vs,{})})}),e.jsx(pe,{path:"/treasury/accounts_list",element:e.jsx(Ie,{requiredPermission:"change_account",children:e.jsx(Hs,{})})}),e.jsx(pe,{path:"/treasury/transactions_list",element:e.jsx(Ie,{requiredPermission:"change_account",children:e.jsx(at,{})})}),e.jsx(pe,{path:"/events",element:e.jsx(Ie,{children:e.jsx(Ys,{})})}),e.jsx(pe,{path:"/event/:id",element:e.jsx(Ie,{children:e.jsx(Zs,{})})})]})})})})}$a({dsn:"https://f7ee9b97bae2c35e767d8e156eb7b116@o4509581352828928.ingest.de.sentry.io/4509581461487696",sendDefaultPii:!0,environment:"production"});const it=ka({typography:{fontFamily:"Roboto, Arial, sans-serif",h1:{fontFamily:"Lato, Arial, sans-serif"},h2:{fontFamily:"Lato, Arial, sans-serif"},h3:{fontFamily:"Lato, Arial, sans-serif"},h4:{fontFamily:"Lato, Arial, sans-serif"},h5:{fontFamily:"Lato, Arial, sans-serif"}},palette:{primary:{main:"#1976d2"},secondary:{main:"#dc004e"},cyan:{main:"#00aeef",contrastText:"#ffffff"},magenta:{main:"#ec008c",contrastText:"#ffffff"},gray:{main:"#999999",contrastText:"#ffffff"}}}),lt=ja.createRoot(document.getElementById("root"));lt.render(e.jsx(xe.StrictMode,{children:e.jsx(Ba,{fallback:e.jsx("p",{children:"An unexpected error occurred."}),children:e.jsxs(Cs,{theme:ka(it,ws),children:[e.jsx(ya,{}),e.jsx(ot,{})]})})}));
//# sourceMappingURL=index-B778zkZ0.js.map
