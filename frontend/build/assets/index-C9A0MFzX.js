import{r as s,j as e,b as fe}from"./react-C_cg2vJ2.js";import{a as ba}from"./react-dom-D3GiQpVl.js";import{j as ea}from"./jwt-decode-VWaDGczM.js";import{Q as b,a1 as ca,H as P,aA as ra,aB as ja,a8 as O,_ as J,a4 as $e,aC as je,aD as ya,aE as va,aF as c,aG as he,aH as we,ax as ye,aI as Ge,q as _e,aJ as Q,aa as ne,ab as oe,ac as V,as as Ce,X as ze,aK as _a,aL as da,aM as Ee,U as Y,aN as We,d as na,l as Be,aO as Wa,aP as $a,aQ as Ba,aR as oa,aS as Sa,aT as Ca,aU as ta,aV as ua,am as aa,aW as sa,aX as Ga,aY as wa,E as Ea,a0 as Ta,aZ as Ka,a_ as qa,a$ as Va,$ as te,ag as Ha,ah as Ya,ai as Ua,aj as Ja,C as Za,b0 as Ae,z as Ke,b1 as qe,b2 as Ia,b3 as Qa,au as Ue,b4 as Je,b5 as Xa,b6 as es,y as Ve,aw as ma,b7 as as,b8 as za,b9 as He,ay as ss,ar as Oe,az as ts,ba as rs,bb as ns,bc as os,bd as is,af as ls,be as cs,bf as ds,bg as us,bh as ms,bi as ps,v as hs,e as xs,bj as fs,bk as gs,bl as bs,bm as js,bn as Pa,bo as ys,bp as vs}from"./@mui-D0_eY42r.js";import{u as ve,L as pa,a as Ze,b as _s,B as Ss,R as Cs,c as me}from"./react-router-BQSL4b-H.js";import{d as q}from"./dayjs-C-_GrJyW.js";import{u as De,M as Re,a as Me,b as ka}from"./material-react-table-Cd_KrOHN.js";import{Q as ws}from"./quill-NHzMMpWD.js";import{S as Ye}from"./date-fns-jgPrqPiU.js";import{e as Es}from"./@sentry-CS4zAH_a.js";import"./cookie-DhHe99HG.js";import"./scheduler-SPyfQU6S.js";import"./@emotion-Btd9ljfZ.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./@babel-BtohYyOd.js";import"./stylis-DDa9OTMq.js";import"./clsx-B-dksMZM.js";import"./react-transition-group-CZUuWARL.js";import"./dom-helpers-D0mFdbeO.js";import"./prop-types-DO4wCXId.js";import"./@popperjs-DC5wud4b.js";import"./react-is-BPJnJB5S.js";import"./@tanstack-BUN72RuI.js";import"./highlight-words-DCTHEhAM.js";import"./parchment-DI0xVRB_.js";import"./quill-delta-CmVyj_yU.js";import"./fast-diff-BGhgD5-Y.js";import"./lodash.clonedeep-CdAwFVkU.js";import"./lodash.isequal-CVqJ6bXo.js";import"./eventemitter3-DrmIJ5Tj.js";import"./lodash-es-GiBPWDzC.js";import"./@sentry-internal-Darjtl02.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))o(u);new MutationObserver(u=>{for(const l of u)if(l.type==="childList")for(const T of l.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&o(T)}).observe(document,{childList:!0,subtree:!0});function t(u){const l={};return u.integrity&&(l.integrity=u.integrity),u.referrerPolicy&&(l.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?l.credentials="include":u.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(u){if(u.ep)return;u.ep=!0;const l=t(u);fetch(u.href,l)}})();const K=async(p,m,t=null,o={},u=!0)=>{const l=localStorage.getItem("accessToken"),y=`https://mgmt.esnpolimi.it/backend${m}`;if(u&&!l)throw new Error("No access token available");const h={"Content-Type":"application/json",...u&&{Authorization:`Bearer ${l}`},...o.headers},a={method:p,headers:h,credentials:"include",...o};t&&(a.body=typeof t=="string"?t:JSON.stringify(t));const E=await fetch(y,a);if(E.status===401)throw new Error("Unauthorized: Access token may have expired");return E},se=(p,m)=>{if(!p)return`Server error (${m}) with empty response`;if(typeof p=="string")return p;if(p.detail)return p.detail;if(p.message)return p.message;if(p.non_field_errors)return p.non_field_errors.join(", ");if(p.lists?.non_field_errors)return`Error in lists format: ${p.lists.non_field_errors.join(", ")}`;for(const[t,o]of Object.entries(p))if(o)return Array.isArray(o)?o.join(", "):o.toString();return JSON.stringify(p)},Da=s.createContext(null),Ts=({children:p})=>{const m=s.useRef(null),[t,o]=s.useState(localStorage.getItem("accessToken")),[u,l]=s.useState(()=>JSON.parse(localStorage.getItem("user")||"null")),[T,y]=s.useState(!0),h=i=>{try{const{user:r}=ea(i);return r}catch(r){return console.error("Invalid JWT token",r),null}},a=async(i,r)=>{try{const z=await K("POST","/login/",{email:i,password:r},{},!1),S=await z.json();if(z.ok){const n=h(S.access);return console.log("Login successful"),o(S.access),console.log("Decoded access token:",n),l(n),localStorage.setItem("accessToken",S.access),localStorage.setItem("user",JSON.stringify(n)),!0}else return console.error("Login error"),await se(S,z.status)}catch(z){return console.error("Login error:",z),z}},E=s.useCallback(async({skipApiCall:i=!1}={})=>{console.log("Logout function called"),m.current&&(console.log("Aborting refresh timer..."),clearTimeout(m.current),m.current=null),i||await K("POST","/logout/"),localStorage.removeItem("accessToken"),localStorage.removeItem("user"),o(null),l(null),console.log("Logged out successfully")},[]),w=s.useCallback(async()=>{if(t)try{const i=u?.profile?.email,r=await K("POST","/api/token/refresh/",{email:i},{},!1);if(r.ok){const z=await r.json(),S=h(z.access);return o(z.access),l(S),localStorage.setItem("accessToken",z.access),localStorage.setItem("user",JSON.stringify(S)),!0}else return console.warn("Token refresh failed. Logging out..."),await E(),!1}catch(i){return console.error("Refresh token error:",i),await E(),!1}else return console.log("Skipping token refresh, user is not logged in"),!1},[u,t,E]);return s.useEffect(()=>{const i=()=>{m.current&&(clearTimeout(m.current),m.current=null)};if(!t){console.log("No access token found, skipping refresh scheduling");return}const{exp:r}=ea(t),z=Math.floor(Date.now()/1e3),S=(r-z-30)*1e3,n=new Date(r*1e3),d=new Date(z*1e3);if(console.log(`Token expires at: ${n.getHours()}:${n.getMinutes()}, current time: ${d.getHours()}:${d.getMinutes()}, refresh time in s: ${S/1e3}`),S<=0){console.log("Refresh time is not valid, no timer set"),o(null);return}return i(),m.current=setTimeout(()=>{console.log("Refreshing access token..."),w().then()},S),()=>{console.log("Clearing refresh timer"),i()}},[t,w]),s.useEffect(()=>{(async()=>{const r=localStorage.getItem("accessToken"),z=localStorage.getItem("user");if(r&&z)try{const S=ea(r),n=Math.floor(Date.now()/1e3);S.exp>n?(o(r),l(JSON.parse(z))):await E({skipApiCall:!0})}catch(S){console.error("Token decode error",S),await E({skipApiCall:!0})}y(!1)})().then()},[E]),e.jsx(Da.Provider,{value:{user:u,accessToken:t,refreshAccessToken:w,logout:E,login:a,loading:T},children:p})},Le=()=>s.useContext(Da),Ma=s.createContext(void 0);function Is({children:p}){const[m,t]=s.useState(!1),[o,u]=s.useState(null);s.useEffect(()=>{const h=localStorage.getItem("sidebarDrawerState");h&&t(JSON.parse(h))},[]),s.useEffect(()=>{localStorage.setItem("sidebarDrawerState",JSON.stringify(m))},[m]);const l=h=>a=>{a&&a.type==="keydown"&&(a.key==="Tab"||a.key==="Shift")||t(h)},T=h=>{u(a=>a===h?null:h)},y=()=>t(!1);return e.jsx(Ma.Provider,{value:{isDrawerOpen:m,toggleDrawer:l,closeDrawer:y,expandedSection:o,handleExpand:T},children:p})}function zs(){return s.useContext(Ma)}const ia="/assets/esnpolimi-logo-BJJf0P2z.png",Fe=({message:p,state:m,successText:t,errorText:o})=>e.jsxs(b,{sx:{mt:2,mb:2,display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",p:2,borderRadius:5,boxShadow:3,bgcolor:"background.paper"},children:[m==="success"&&e.jsxs(e.Fragment,{children:[e.jsx(ca,{severity:"success",sx:{width:"100%",mb:1},children:p||"Success!"}),t&&e.jsx(P,{children:t})]}),m==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(ca,{severity:"error",sx:{width:"100%",mb:1},children:p||"An error occurred"}),o&&e.jsx(P,{children:o})]})]});function Ps(){const[p,m]=s.useState(""),[t,o]=s.useState(""),[u,l]=s.useState(!1),{login:T}=Le(),y=ve(),[h,a]=s.useState(null),[E,w]=s.useState(!1),[i,r]=s.useState(!1),z=async()=>{r(!0);try{console.log("Sending forgot password request for:",p);const n=await K("POST","/api/forgot-password/",{email:p},{},!1);if(n.ok)w(!0),a({message:`Se il profilo è registrato, l'email è stata inviata con successo a "`+p+'". Controlla la tua casella di posta.',state:"success"});else{const d=await n.json(),v=await se(d,n.status);a({message:`Errore durante l'invio dell'email: ${v}`,state:"error"})}}catch(n){a({message:`Errore generale: ${n}`,state:"error"})}finally{r(!1)}},S=async()=>{r(!0),a(null);const n=await T(p,t);if(r(!1),n===!0)y("/");else if(typeof n=="string"&&(n.trim().startsWith("<!DOCTYPE html")||n.trim().startsWith("<html"))){const d=window.open();d?(d.document.open(),d.document.write(n),d.document.close()):a({message:"Impossibile aprire la pagina di errore in una nuova scheda.",state:"error"})}else a({message:`Errore durante il login: ${n}`,state:"error"})};return e.jsxs(ra,{component:"main",maxWidth:"xs",children:[e.jsx(ja,{}),e.jsxs(b,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("img",{alt:"",src:ia,style:{height:"25vh"}}),e.jsxs(b,{children:[!E&&e.jsx(O,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email",name:"email",autoComplete:"email",autoFocus:!0,onChange:n=>m(n.target.value),onKeyDown:n=>n.key==="Enter"&&(u?z():S())}),!u&&e.jsx(O,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",onChange:n=>o(n.target.value),onKeyDown:n=>n.key==="Enter"&&S()}),!E&&e.jsx(J,{fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,backgroundColor:"black"},onClick:u?z:S,disabled:i,children:i?e.jsx($e,{size:24,color:"inherit"}):u?"Invia Email di Reset":"Log In"}),e.jsxs(b,{sx:{display:"flex",justifyContent:"center",width:"100%"},children:[e.jsx(je,{component:"button",variant:"body2",onClick:()=>{l(!u),w(!1),a(null)},sx:{textAlign:"center"},children:u?"Torna al Login":"Password dimenticata?"}),e.jsx(je,{component:"button",variant:"body2",onClick:()=>y("/esner_form"),sx:{textAlign:"center",marginLeft:2},children:"Non hai un account? Registrati"})]})]}),h&&e.jsx(Fe,{message:h.message,state:h.state})]})]})}const Te=JSON.parse(`[{"name":"Afghanistan","dial":"+93","code":"AF"},{"name":"Aland Islands","dial":"+358","code":"AX"},{"name":"Albania","dial":"+355","code":"AL"},{"name":"Algeria","dial":"+213","code":"DZ"},{"name":"AmericanSamoa","dial":"+1684","code":"AS"},{"name":"Andorra","dial":"+376","code":"AD"},{"name":"Angola","dial":"+244","code":"AO"},{"name":"Anguilla","dial":"+1264","code":"AI"},{"name":"Antarctica","dial":"+672","code":"AQ"},{"name":"Antigua and Barbuda","dial":"+1268","code":"AG"},{"name":"Argentina","dial":"+54","code":"AR"},{"name":"Armenia","dial":"+374","code":"AM"},{"name":"Aruba","dial":"+297","code":"AW"},{"name":"Australia","dial":"+61","code":"AU"},{"name":"Austria","dial":"+43","code":"AT"},{"name":"Azerbaijan","dial":"+994","code":"AZ"},{"name":"Bahamas","dial":"+1242","code":"BS"},{"name":"Bahrain","dial":"+973","code":"BH"},{"name":"Bangladesh","dial":"+880","code":"BD"},{"name":"Barbados","dial":"+1246","code":"BB"},{"name":"Belarus","dial":"+375","code":"BY"},{"name":"Belgium","dial":"+32","code":"BE"},{"name":"Belize","dial":"+501","code":"BZ"},{"name":"Benin","dial":"+229","code":"BJ"},{"name":"Bermuda","dial":"+1441","code":"BM"},{"name":"Bhutan","dial":"+975","code":"BT"},{"name":"Bolivia, Plurinational State of","dial":"+591","code":"BO"},{"name":"Bosnia and Herzegovina","dial":"+387","code":"BA"},{"name":"Botswana","dial":"+267","code":"BW"},{"name":"Brazil","dial":"+55","code":"BR"},{"name":"British Indian Ocean Territory","dial":"+246","code":"IO"},{"name":"Brunei Darussalam","dial":"+673","code":"BN"},{"name":"Bulgaria","dial":"+359","code":"BG"},{"name":"Burkina Faso","dial":"+226","code":"BF"},{"name":"Burundi","dial":"+257","code":"BI"},{"name":"Cambodia","dial":"+855","code":"KH"},{"name":"Cameroon","dial":"+237","code":"CM"},{"name":"Canada","dial":"+1","code":"CA"},{"name":"Cape Verde","dial":"+238","code":"CV"},{"name":"Cayman Islands","dial":"+ 345","code":"KY"},{"name":"Central African Republic","dial":"+236","code":"CF"},{"name":"Chad","dial":"+235","code":"TD"},{"name":"Chile","dial":"+56","code":"CL"},{"name":"China","dial":"+86","code":"CN"},{"name":"Christmas Island","dial":"+61","code":"CX"},{"name":"Cocos (Keeling) Islands","dial":"+61","code":"CC"},{"name":"Colombia","dial":"+57","code":"CO"},{"name":"Comoros","dial":"+269","code":"KM"},{"name":"Congo","dial":"+242","code":"CG"},{"name":"Congo, The Democratic Republic of the Congo","dial":"+243","code":"CD"},{"name":"Cook Islands","dial":"+682","code":"CK"},{"name":"Costa Rica","dial":"+506","code":"CR"},{"name":"Cote d'Ivoire","dial":"+225","code":"CI"},{"name":"Croatia","dial":"+385","code":"HR"},{"name":"Cuba","dial":"+53","code":"CU"},{"name":"Cyprus","dial":"+357","code":"CY"},{"name":"Czech Republic","dial":"+420","code":"CZ"},{"name":"Denmark","dial":"+45","code":"DK"},{"name":"Djibouti","dial":"+253","code":"DJ"},{"name":"Dominica","dial":"+1767","code":"DM"},{"name":"Dominican Republic","dial":"+1849","code":"DO"},{"name":"Ecuador","dial":"+593","code":"EC"},{"name":"Egypt","dial":"+20","code":"EG"},{"name":"El Salvador","dial":"+503","code":"SV"},{"name":"Equatorial Guinea","dial":"+240","code":"GQ"},{"name":"Eritrea","dial":"+291","code":"ER"},{"name":"Estonia","dial":"+372","code":"EE"},{"name":"Ethiopia","dial":"+251","code":"ET"},{"name":"Falkland Islands (Malvinas)","dial":"+500","code":"FK"},{"name":"Faroe Islands","dial":"+298","code":"FO"},{"name":"Fiji","dial":"+679","code":"FJ"},{"name":"Finland","dial":"+358","code":"FI"},{"name":"France","dial":"+33","code":"FR"},{"name":"French Guiana","dial":"+594","code":"GF"},{"name":"French Polynesia","dial":"+689","code":"PF"},{"name":"Gabon","dial":"+241","code":"GA"},{"name":"Gambia","dial":"+220","code":"GM"},{"name":"Georgia","dial":"+995","code":"GE"},{"name":"Germany","dial":"+49","code":"DE"},{"name":"Ghana","dial":"+233","code":"GH"},{"name":"Gibraltar","dial":"+350","code":"GI"},{"name":"Greece","dial":"+30","code":"GR"},{"name":"Greenland","dial":"+299","code":"GL"},{"name":"Grenada","dial":"+1473","code":"GD"},{"name":"Guadeloupe","dial":"+590","code":"GP"},{"name":"Guam","dial":"+1671","code":"GU"},{"name":"Guatemala","dial":"+502","code":"GT"},{"name":"Guernsey","dial":"+44","code":"GG"},{"name":"Guinea","dial":"+224","code":"GN"},{"name":"Guinea-Bissau","dial":"+245","code":"GW"},{"name":"Guyana","dial":"+595","code":"GY"},{"name":"Haiti","dial":"+509","code":"HT"},{"name":"Holy See (Vatican City State)","dial":"+379","code":"VA"},{"name":"Honduras","dial":"+504","code":"HN"},{"name":"Hong Kong","dial":"+852","code":"HK"},{"name":"Hungary","dial":"+36","code":"HU"},{"name":"Iceland","dial":"+354","code":"IS"},{"name":"India","dial":"+91","code":"IN"},{"name":"Indonesia","dial":"+62","code":"ID"},{"name":"Iran, Islamic Republic of Persian Gulf","dial":"+98","code":"IR"},{"name":"Iraq","dial":"+964","code":"IQ"},{"name":"Ireland","dial":"+353","code":"IE"},{"name":"Isle of Man","dial":"+44","code":"IM"},{"name":"Israel","dial":"+972","code":"IL"},{"name":"Italy","dial":"+39","code":"IT"},{"name":"Jamaica","dial":"+1876","code":"JM"},{"name":"Japan","dial":"+81","code":"JP"},{"name":"Jersey","dial":"+44","code":"JE"},{"name":"Jordan","dial":"+962","code":"JO"},{"name":"Kazakhstan","dial":"+77","code":"KZ"},{"name":"Kenya","dial":"+254","code":"KE"},{"name":"Kiribati","dial":"+686","code":"KI"},{"name":"Korea, Democratic People's Republic of Korea","dial":"+850","code":"KP"},{"name":"Korea, Republic of South Korea","dial":"+82","code":"KR"},{"name":"Kuwait","dial":"+965","code":"KW"},{"name":"Kyrgyzstan","dial":"+996","code":"KG"},{"name":"Laos","dial":"+856","code":"LA"},{"name":"Latvia","dial":"+371","code":"LV"},{"name":"Lebanon","dial":"+961","code":"LB"},{"name":"Lesotho","dial":"+266","code":"LS"},{"name":"Liberia","dial":"+231","code":"LR"},{"name":"Libyan Arab Jamahiriya","dial":"+218","code":"LY"},{"name":"Liechtenstein","dial":"+423","code":"LI"},{"name":"Lithuania","dial":"+370","code":"LT"},{"name":"Luxembourg","dial":"+352","code":"LU"},{"name":"Macao","dial":"+853","code":"MO"},{"name":"Macedonia","dial":"+389","code":"MK"},{"name":"Madagascar","dial":"+261","code":"MG"},{"name":"Malawi","dial":"+265","code":"MW"},{"name":"Malaysia","dial":"+60","code":"MY"},{"name":"Maldives","dial":"+960","code":"MV"},{"name":"Mali","dial":"+223","code":"ML"},{"name":"Malta","dial":"+356","code":"MT"},{"name":"Marshall Islands","dial":"+692","code":"MH"},{"name":"Martinique","dial":"+596","code":"MQ"},{"name":"Mauritania","dial":"+222","code":"MR"},{"name":"Mauritius","dial":"+230","code":"MU"},{"name":"Mayotte","dial":"+262","code":"YT"},{"name":"Mexico","dial":"+52","code":"MX"},{"name":"Micronesia, Federated States of Micronesia","dial":"+691","code":"FM"},{"name":"Moldova","dial":"+373","code":"MD"},{"name":"Monaco","dial":"+377","code":"MC"},{"name":"Mongolia","dial":"+976","code":"MN"},{"name":"Montenegro","dial":"+382","code":"ME"},{"name":"Montserrat","dial":"+1664","code":"MS"},{"name":"Morocco","dial":"+212","code":"MA"},{"name":"Mozambique","dial":"+258","code":"MZ"},{"name":"Myanmar","dial":"+95","code":"MM"},{"name":"Namibia","dial":"+264","code":"NA"},{"name":"Nauru","dial":"+674","code":"NR"},{"name":"Nepal","dial":"+977","code":"NP"},{"name":"Netherlands","dial":"+31","code":"NL"},{"name":"Netherlands Antilles","dial":"+599","code":"AN"},{"name":"New Caledonia","dial":"+687","code":"NC"},{"name":"New Zealand","dial":"+64","code":"NZ"},{"name":"Nicaragua","dial":"+505","code":"NI"},{"name":"Niger","dial":"+227","code":"NE"},{"name":"Nigeria","dial":"+234","code":"NG"},{"name":"Niue","dial":"+683","code":"NU"},{"name":"Norfolk Island","dial":"+672","code":"NF"},{"name":"Northern Mariana Islands","dial":"+1670","code":"MP"},{"name":"Norway","dial":"+47","code":"NO"},{"name":"Oman","dial":"+968","code":"OM"},{"name":"Pakistan","dial":"+92","code":"PK"},{"name":"Palau","dial":"+680","code":"PW"},{"name":"Palestinian Territory, Occupied","dial":"+970","code":"PS"},{"name":"Panama","dial":"+507","code":"PA"},{"name":"Papua New Guinea","dial":"+675","code":"PG"},{"name":"Paraguay","dial":"+595","code":"PY"},{"name":"Peru","dial":"+51","code":"PE"},{"name":"Philippines","dial":"+63","code":"PH"},{"name":"Pitcairn","dial":"+872","code":"PN"},{"name":"Poland","dial":"+48","code":"PL"},{"name":"Portugal","dial":"+351","code":"PT"},{"name":"Puerto Rico","dial":"+1939","code":"PR"},{"name":"Qatar","dial":"+974","code":"QA"},{"name":"Romania","dial":"+40","code":"RO"},{"name":"Russia","dial":"+7","code":"RU"},{"name":"Rwanda","dial":"+250","code":"RW"},{"name":"Reunion","dial":"+262","code":"RE"},{"name":"Saint Barthelemy","dial":"+590","code":"BL"},{"name":"Saint Helena, Ascension and Tristan Da Cunha","dial":"+290","code":"SH"},{"name":"Saint Kitts and Nevis","dial":"+1869","code":"KN"},{"name":"Saint Lucia","dial":"+1758","code":"LC"},{"name":"Saint Martin","dial":"+590","code":"MF"},{"name":"Saint Pierre and Miquelon","dial":"+508","code":"PM"},{"name":"Saint Vincent and the Grenadines","dial":"+1784","code":"VC"},{"name":"Samoa","dial":"+685","code":"WS"},{"name":"San Marino","dial":"+378","code":"SM"},{"name":"Sao Tome and Principe","dial":"+239","code":"ST"},{"name":"Saudi Arabia","dial":"+966","code":"SA"},{"name":"Senegal","dial":"+221","code":"SN"},{"name":"Serbia","dial":"+381","code":"RS"},{"name":"Seychelles","dial":"+248","code":"SC"},{"name":"Sierra Leone","dial":"+232","code":"SL"},{"name":"Singapore","dial":"+65","code":"SG"},{"name":"Slovakia","dial":"+421","code":"SK"},{"name":"Slovenia","dial":"+386","code":"SI"},{"name":"Solomon Islands","dial":"+677","code":"SB"},{"name":"Somalia","dial":"+252","code":"SO"},{"name":"South Africa","dial":"+27","code":"ZA"},{"name":"South Sudan","dial":"+211","code":"SS"},{"name":"South Georgia and the South Sandwich Islands","dial":"+500","code":"GS"},{"name":"Spain","dial":"+34","code":"ES"},{"name":"Sri Lanka","dial":"+94","code":"LK"},{"name":"Sudan","dial":"+249","code":"SD"},{"name":"Suriname","dial":"+597","code":"SR"},{"name":"Svalbard and Jan Mayen","dial":"+47","code":"SJ"},{"name":"Swaziland","dial":"+268","code":"SZ"},{"name":"Sweden","dial":"+46","code":"SE"},{"name":"Switzerland","dial":"+41","code":"CH"},{"name":"Syrian Arab Republic","dial":"+963","code":"SY"},{"name":"Taiwan","dial":"+886","code":"TW"},{"name":"Tajikistan","dial":"+992","code":"TJ"},{"name":"Tanzania, United Republic of Tanzania","dial":"+255","code":"TZ"},{"name":"Thailand","dial":"+66","code":"TH"},{"name":"Timor-Leste","dial":"+670","code":"TL"},{"name":"Togo","dial":"+228","code":"TG"},{"name":"Tokelau","dial":"+690","code":"TK"},{"name":"Tonga","dial":"+676","code":"TO"},{"name":"Trinidad and Tobago","dial":"+1868","code":"TT"},{"name":"Tunisia","dial":"+216","code":"TN"},{"name":"Turkey","dial":"+90","code":"TR"},{"name":"Turkmenistan","dial":"+993","code":"TM"},{"name":"Turks and Caicos Islands","dial":"+1649","code":"TC"},{"name":"Tuvalu","dial":"+688","code":"TV"},{"name":"Uganda","dial":"+256","code":"UG"},{"name":"Ukraine","dial":"+380","code":"UA"},{"name":"United Arab Emirates","dial":"+971","code":"AE"},{"name":"United Kingdom","dial":"+44","code":"GB"},{"name":"United States","dial":"+1","code":"US"},{"name":"Uruguay","dial":"+598","code":"UY"},{"name":"Uzbekistan","dial":"+998","code":"UZ"},{"name":"Vanuatu","dial":"+678","code":"VU"},{"name":"Venezuela, Bolivarian Republic of Venezuela","dial":"+58","code":"VE"},{"name":"Vietnam","dial":"+84","code":"VN"},{"name":"Virgin Islands, British","dial":"+1284","code":"VG"},{"name":"Virgin Islands, U.S.","dial":"+1340","code":"VI"},{"name":"Wallis and Futuna","dial":"+681","code":"WF"},{"name":"Yemen","dial":"+967","code":"YE"},{"name":"Zambia","dial":"+260","code":"ZM"},{"name":"Zimbabwe","dial":"+263","code":"ZW"}]`);function ks(){const[p,m]=fe.useState(!1),[t,o]=fe.useState(!0),[u,l]=s.useState(null),[T,y]=s.useState(!1),[h,a]=s.useState({acceptStatute:!1,acceptPurposes:!1,acceptRegulation:!1,acceptPrivacy:!1}),[E,w]=s.useState({acceptStatute:!1,acceptPurposes:!1,acceptRegulation:!1,acceptPrivacy:!1}),i={statute:"https://drive.google.com/file/d/1b0gpA3x9yRuAcdEWQyc9KvrnZzm0l-dB/view?usp=sharing",regulation:"https://drive.google.com/file/d/1_s0uBvqfOLRz5rQp1EEeNgtxRjs7Pgxy/view?usp=sharing",privacy:"https://drive.google.com/file/d/12LY0y49cCyjqdF0RotsO6srHrGkinNln/view?usp=sharing"},[r,z]=fe.useState({name:"",surname:"",email:"",email_confirm:"",birthdate:q(),country:"",phone_prefix:"+39",phone_number:"",whatsapp_prefix:"+39",whatsapp_number:"",person_code:"",domicile:"",course:"",document_type:"ID Card",document_number:"",document_expiration:q(),matricola_number:"",matricola_expiration:q(),is_esner:!1}),S={email:[!1,""],email_confirm:[!1,""],name:[!1,""],surname:[!1,""],birthdate:[!1,""],country:[!1,""],phone_prefix:[!1,""],phone_number:[!1,""],whatsapp_prefix:[!1,""],whatsapp_number:[!1,""],person_code:[!1,""],domicile:[!1,""],course:[!1,""],document_type:[!1,""],document_number:[!1,""],document_expiration:[!1,""],matricola_number:[!1,""],matricola_expiration:[!1,""],is_esner:[!1,""]},[n,d]=fe.useState(S),v=()=>{let j=!0;const I={...n},D={...E};["email","email_confirm","name","surname","birthdate","country","phone_prefix","phone_number","person_code","domicile","course","document_type","document_number","document_expiration","matricola_number","matricola_expiration"].forEach(x=>{!r[x]||typeof r[x]=="string"&&r[x].trim()===""?(I[x]=[!0,"This field is required"],j=!1):I[x]=[!1,""]}),/^\d{6}$/.test(r.matricola_number)?I.matricola_number=[!1,""]:(I.matricola_number=[!0,"Matricola must be exactly 6 digits"],j=!1),/^\d{8}$/.test(r.person_code)?I.person_code=[!1,""]:(I.person_code=[!0,"Person Code must be exactly 8 digits"],j=!1);const F=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return r.email&&!F.test(r.email)&&(I.email=[!0,"Invalid email format"],j=!1),r.email!==r.email_confirm?(I.email_confirm=[!0,"Emails do not match"],j=!1):I.email_confirm=[!1,""],Object.entries(h).forEach(([x,W])=>{W?D[x]=!1:(D[x]=!0,j=!1)}),d(I),w(D),j||l({message:"Error in form submission, check the errors below",state:"error"}),j},C=()=>{window.scrollTo({top:0,behavior:"smooth"})},R=j=>q(j).format("YYYY-MM-DD"),M=j=>{z({...r,[j.target.name]:j.target.value}),n[j.target.name]&&d({...n,[j.target.name]:[!1,""]})},U=(j,I)=>{z({...r,[j]:I})},A=j=>{const{name:I,checked:D}=j.target;a({...h,[I]:D}),D&&w({...E,[I]:!1})},L=j=>{if(j.preventDefault(),!v()){C();return}l(null),y(!0);let I={...r,whatsapp_prefix:t?r.phone_prefix:r.whatsapp_prefix,whatsapp_number:t?r.phone_number:r.whatsapp_number,birthdate:R(r.birthdate),document_expiration:R(r.document_expiration),matricola_expiration:R(r.matricola_expiration)};(async()=>{try{const _=await K("POST","/profile/initiate-creation/",I,{},!1),g=await _.json();if(d(S),_.ok)m(!0);else{l({message:"Failed to submit application: see errors below",state:"error"});const f={...n};Object.entries(g).forEach(([F,x])=>{f[F]&&(f[F]=[!0,x])}),d(f)}}catch(_){l({message:"Internal error (please contact us): "+_.message,state:"error"})}finally{y(!1)}})().then()},N=j=>{o(j.target.checked),j.target.checked&&z({...r,whatsapp_prefix:r.phone_prefix,whatsapp_number:r.phone_number})};return p?e.jsxs(b,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",bgcolor:"#fff",children:[e.jsx(ya,{style:{fontSize:100,color:va[500]}}),e.jsx(P,{variant:"h4",align:"center",gutterBottom:!0,children:"Your response has been sent."}),e.jsx(P,{variant:"subtitle1",align:"center",children:"Check your inbox to verify your e-mail."}),e.jsxs(P,{variant:"body2",align:"center",sx:{mt:2},children:["In case you do not receive an email, please check your spam folder or contact us at ",e.jsx(je,{href:"mailto: informatica@esnpolimi.it",children:"informatica@esnpolimi.it"})]})]}):e.jsxs(b,{component:"form",noValidate:!0,sx:{maxWidth:800,margin:"auto",mt:5,mb:5,px:4},onSubmit:L,children:[e.jsx(P,{variant:"h4",align:"center",gutterBottom:!0,mb:5,children:"ESN Polimi Registration - International Student"}),u&&e.jsx(Fe,{message:u.message,state:u.state}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,sx:{my:4},children:"Personal Information"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(O,{label:"Name",variant:"outlined",name:"name",value:r.name,onChange:M,fullWidth:!0,required:!0,error:n.name[0],helperText:n.name[1]})}),e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(O,{label:"Surname",variant:"outlined",name:"surname",value:r.surname,onChange:M,fullWidth:!0,required:!0,error:n.surname[0],helperText:n.surname[1]})}),e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(he,{dateAdapter:we,adapterLocale:"en-gb",children:e.jsx(ye,{label:"Birthdate",value:r.birthdate,onChange:j=>U("birthdate",j),maxDate:q(),renderInput:j=>e.jsx(O,{...j,fullWidth:!0,required:!0})})})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(O,{label:"Email",variant:"outlined",name:"email",type:"email",value:r.email,onChange:M,fullWidth:!0,required:!0,error:n.email[0],helperText:n.email[1]})}),e.jsxs(c,{size:{xs:12,sm:6},children:[e.jsx(O,{label:"Confirm Email",variant:"outlined",name:"email_confirm",type:"email",value:r.email_confirm,onChange:M,fullWidth:!0,required:!0,error:n.email_confirm[0],helperText:n.email_confirm[1]}),e.jsx(b,{sx:{mt:1},children:r.email_confirm&&e.jsxs(P,{variant:"caption",sx:{display:"flex",alignItems:"center",color:r.email===r.email_confirm?"green":"grey"},children:[r.email===r.email_confirm?e.jsx(Ge,{fontSize:"small",sx:{mr:.5}}):e.jsx(_e,{fontSize:"small",sx:{mr:.5}}),r.email===r.email_confirm?"The emails match":"The emails do not match"]})})]}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsxs(Q,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"country-label",children:"Home University Country"}),e.jsx(oe,{variant:"outlined",labelId:"country-label",name:"country",value:r.country,onChange:M,label:"Home University Country",error:n.country[0],children:Te.map(j=>e.jsx(V,{value:j.code,children:j.name},j.code))})]})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(O,{label:"Home Domicile",variant:"outlined",name:"domicile",value:r.domicile,onChange:M,fullWidth:!0,required:!0,error:n.domicile[0],helperText:n.domicile[1]})}),e.jsx(c,{size:{xs:4,sm:2},children:e.jsxs(Q,{fullWidth:!0,children:[e.jsx(ne,{id:"phone-prefix-label",children:"Prefix"}),e.jsx(oe,{variant:"outlined",labelId:"phone-prefix-label",id:"phone-prefix",name:"phone_prefix",value:r.phone_prefix,onChange:M,label:"Prefix",renderValue:j=>j,error:n.phone_prefix[0],children:Te.map(j=>e.jsxs(V,{value:j.dial,children:[j.dial," (",j.name,")"]},j.code))})]})}),e.jsx(c,{size:{xs:8,sm:4},children:e.jsx(O,{label:"Phone Number",variant:"outlined",name:"phone_number",type:"number",value:r.phone_number,onChange:M,fullWidth:!0,required:!0,error:n.phone_number[0],helperText:n.phone_number[1]})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(Ce,{control:e.jsx(ze,{checked:t,onChange:N,name:"sameAsPhone",color:"primary"}),label:"Same number for WhatsApp"})}),!t&&e.jsxs(e.Fragment,{children:[e.jsx(c,{size:{xs:4,sm:2},children:e.jsxs(Q,{fullWidth:!0,children:[e.jsx(ne,{id:"whatsapp-prefix-label",children:"Prefix"}),e.jsx(oe,{variant:"outlined",labelId:"whatsapp-prefix-label",id:"whatsapp-prefix",name:"whatsapp_prefix",value:r.whatsapp_prefix,onChange:M,label:"Prefix",renderValue:j=>j,error:n.whatsapp_prefix[0],children:Te.map(j=>e.jsxs(V,{value:j.dial,children:[j.dial," (",j.name,")"]},j.code))})]})}),e.jsx(c,{size:{xs:8,sm:4},children:e.jsx(O,{label:"Whatsapp Number",variant:"outlined",name:"whatsapp_number",type:"number",value:r.whatsapp_number,onChange:M,fullWidth:!0,required:!0,error:n.whatsapp_number[0],helperText:n.whatsapp_number[1]})})]})]}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Document Information"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{size:{xs:12,sm:4},children:e.jsxs(Q,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"idType-label",children:"Type"}),e.jsxs(oe,{variant:"outlined",labelId:"document-type-label",name:"document_type",value:r.document_type,onChange:M,label:"Type",required:!0,error:n.document_type[0],children:[e.jsx(V,{value:"Passport",children:"Passport"}),e.jsx(V,{value:"ID Card",children:"ID Card"}),e.jsx(V,{value:"Driving License",children:"Driving License"}),e.jsx(V,{value:"Residency Permit",children:"Residency Permit"}),e.jsx(V,{value:"Other",children:"Other"})]})]})}),e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(O,{label:"Number",variant:"outlined",name:"document_number",value:r.document_number,onChange:M,fullWidth:!0,required:!0,error:n.document_number[0],helperText:n.document_number[1]})}),e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(he,{dateAdapter:we,adapterLocale:"en-gb",children:e.jsx(ye,{label:"Expiration Date",value:r.document_expiration,onChange:j=>U("document_expiration",j),renderInput:j=>e.jsx(O,{...j,fullWidth:!0,required:!0})})})})]}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Exchange Information"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{size:{xs:12,sm:6},children:e.jsxs(Q,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"course-label",children:"Field of Study"}),e.jsxs(oe,{variant:"outlined",labelId:"course-label",name:"course",value:r.course,onChange:M,label:"Field of Study",error:n.course[0],children:[e.jsx(V,{value:"Engineering",children:"Engineering"}),e.jsx(V,{value:"Design",children:"Design"}),e.jsx(V,{value:"Architecture",children:"Architecture"})]})]})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(he,{dateAdapter:we,adapterLocale:"en-gb",children:e.jsx(ye,{label:"Exchange End Date",value:r.matricola_expiration,onChange:j=>U("matricola_expiration",j),renderInput:j=>e.jsx(O,{...j,fullWidth:!0,required:!0})})})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(O,{label:"Person Code (8 digits)",variant:"outlined",name:"person_code",type:"number",value:r.person_code,onChange:M,fullWidth:!0,required:!0,error:n.person_code[0],helperText:n.person_code[1]})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(O,{label:"Matricola (6 digits)",variant:"outlined",name:"matricola_number",type:"number",value:r.matricola_number,onChange:M,fullWidth:!0,required:!0,error:n.matricola_number[0],helperText:n.matricola_number[1]})}),e.jsx(c,{size:{xs:12},children:e.jsxs(P,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["You can find your Person Code and Matricola in the Polimi App under your profile section, or from the Online Services.",e.jsx("br",{})," In case the university has not provided you a Matricola yet, you can fill the field with 6 '0's."]})})]}),e.jsxs(c,{container:!0,spacing:3,mt:3,children:[e.jsx(c,{size:{xs:12},children:e.jsx(Ce,{control:e.jsx(ze,{name:"acceptStatute",checked:h.acceptStatute,onChange:A,required:!0,sx:{color:E.acceptStatute?"red":void 0,"&.Mui-checked":{color:E.acceptStatute?"red":void 0}}}),label:e.jsxs("span",{children:["I declare that I have read and accepted the"," ",e.jsx(je,{href:i.statute,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"ESN Politecnico Milano Charter"})]})})}),e.jsx(c,{size:{xs:12},children:e.jsx(Ce,{control:e.jsx(ze,{name:"acceptPurposes",checked:h.acceptPurposes,onChange:A,required:!0,sx:{color:E.acceptPurposes?"red":void 0,"&.Mui-checked":{color:E.acceptPurposes?"red":void 0}}}),label:"I declare that I fully share the aims of the Association (ref. Article 2 of the Charter)"})}),e.jsx(c,{size:{xs:12},children:e.jsx(Ce,{control:e.jsx(ze,{name:"acceptRegulation",checked:h.acceptRegulation,onChange:A,required:!0,sx:{color:E.acceptRegulation?"red":void 0,"&.Mui-checked":{color:E.acceptRegulation?"red":void 0}}}),label:e.jsxs("span",{children:["I declare that I accept all the terms stated in the"," ",e.jsx(je,{href:i.regulation,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Internal Rules"})," ","and all subsequent changes and additions"]})})}),e.jsx(c,{size:{xs:12},children:e.jsx(Ce,{control:e.jsx(ze,{name:"acceptPrivacy",checked:h.acceptPrivacy,onChange:A,required:!0,sx:{color:E.acceptPrivacy?"red":void 0,"&.Mui-checked":{color:E.acceptPrivacy?"red":void 0}}}),label:e.jsxs("span",{children:["I declare that I have read the attached"," ",e.jsx(je,{href:i.privacy,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Privacy Disclaimer"})," ","and that I agree to the usage of my personal data according to the Regulation EU 2016/679 (GDPR) and to be aware of my guaranteed rights by the afore-mentioned law"]})})})]}),e.jsx(J,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:4},startIcon:!T&&e.jsx(_a,{}),disabled:T,children:T?e.jsx($e,{size:24,color:"inherit"}):"Submit"})]})}const B={id:"Id",name:"Nome",surname:"Cognome",group:"Gruppo",email:"Email",phone_prefix:"Prefisso Tel",phone_number:"Numero Telefono",whatsapp_prefix:"Prefisso WA",whatsapp_number:"Numero WhatsApp",country:"Paese",birthdate:"Data di Nascita",latest_esncard:"ESNcard",latest_document:"Documento",matricola_number:"Matricola",matricola_expiration:"Scadenza Matricola",course:"Corso di Studi",person_code:"Codice Persona",domicile:"Domicilio"},xe={id:"Id",name:"Nome Evento",date:"Data Evento",description:"Descrizione",cost:"Costo (€)",subscription_start_date:"Data Apertura Iscrizioni",subscription_end_date:"Data Chiusura Iscrizioni",subscription_date_status:"Stato Iscrizioni",list_name:"Nome Lista",list_capacity:"Capacità Lista"},pe={id:"Id",name:"Nome",status:"Stato",balance:"Saldo",changed_by:"Ultima Modifica",visible_to_groups:"Gruppi di Visibilità"},re={date:"Data",type:"Tipo",description:"Descrizione",amount:"Importo",executor:"Eseguito da",account:"Cassa",tran_type:{event:"Evento",esncard:"ESNcard",deposit:"Deposito",withdrawal:"Prelievo",subscription:"Iscrizione"}};function Ds(){const[p,m]=fe.useState(!1),[t,o]=s.useState(null),[u,l]=s.useState(!1),[T,y]=s.useState({password:!1,password_confirm:!1}),h=B,[a,E]=fe.useState({email:"",email_confirm:"",password:"",password_confirm:"",name:"",surname:"",birthdate:q(),country:"IT",phone_prefix:"+39",phone_number:"",person_code:"",domicile:"",document_type:"ID Card",document_number:"",document_expiration:q(),matricola_number:"",is_esner:!0}),w={email:[!1,""],email_confirm:[!1,""],password:[!1,""],password_confirm:[!1,""],name:[!1,""],surname:[!1,""],birthdate:[!1,""],country:[!1,""],phone_prefix:[!1,""],phone_number:[!1,""],person_code:[!1,""],domicile:[!1,""],document_type:[!1,""],document_number:[!1,""],document_expiration:[!1,""],matricola_number:[!1,""],is_esner:[!1,""]},[i,r]=fe.useState(w),[z,S]=s.useState({acceptStatute:!1,acceptPurposes:!1,acceptRegulation:!1,acceptPrivacy:!1}),[n,d]=s.useState({acceptStatute:!1,acceptPurposes:!1,acceptRegulation:!1,acceptPrivacy:!1}),v={statute:"https://drive.google.com/file/d/1rYtF01hrvQDIYHPebn1nNTDUOazS0kK2/view?usp=sharing",regulation:"https://drive.google.com/file/d/1ZuPfEshihDJ3lvoKyiQ_1L1BpsxBuZdq/view?usp=sharing",privacy:"https://drive.google.com/file/d/12LY0y49cCyjqdF0RotsO6srHrGkinNln/view?usp=sharing"},C=[{label:"Almeno 10 caratteri",test:_=>_.length>=10},{label:"Almeno 1 numero",test:_=>/\d/.test(_)},{label:"Almeno 1 lettera maiuscola",test:_=>/[A-Z]/.test(_)}],R=()=>{let _=!0;const g={...i},f={...n};["email","email_confirm","password","password_confirm","name","surname","birthdate","country","phone_prefix","phone_number","person_code","domicile","document_type","document_number","document_expiration","matricola_number"].forEach(ee=>{!a[ee]||typeof a[ee]=="string"&&a[ee].trim()===""?(g[ee]=[!0,"Questo campo è obbligatorio"],_=!1):g[ee]=[!1,""]}),/^\d{6}$/.test(a.matricola_number)?g.matricola_number=[!1,""]:(g.matricola_number=[!0,"La Matricola deve essere di 6 cifre"],_=!1),/^\d{8}$/.test(a.person_code)?g.person_code=[!1,""]:(g.person_code=[!0,"Il Codice Persona deve essere di 8 cifre"],_=!1);const Z=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return a.email&&!Z.test(a.email)&&(g.email=[!0,"Formato email non valido"],_=!1),a.email!==a.email_confirm?(g.email_confirm=[!0,"Le email non corrispondono"],_=!1):g.email_confirm=[!1,""],a.password!==a.password_confirm?(g.password_confirm=[!0,"Le password non corrispondono"],_=!1):g.password_confirm=[!1,""],Object.entries(z).forEach(([ee,$])=>{$?f[ee]=!1:(f[ee]=!0,_=!1)}),r(g),d(f),_||o({message:"Errore nella compilazione del form, controlla i campi evidenziati.",state:"error"}),_},M=()=>{window.scrollTo({top:0,behavior:"smooth"})},U=_=>q(_).format("YYYY-MM-DD"),A=_=>{E({...a,[_.target.name]:_.target.value}),i[_.target.name]&&r({...i,[_.target.name]:[!1,""]})},L=(_,g)=>{E({...a,[_]:g})},N=_=>{const{name:g,checked:f}=_.target;S({...z,[g]:f}),f&&d({...n,[g]:!1})},j=_=>g=>{y(f=>({...f,[_]:g.getModifierState&&g.getModifierState("CapsLock")}))},I=_=>g=>{y(f=>({...f,[_]:g.getModifierState&&g.getModifierState("CapsLock")}))},D=_=>{if(_.preventDefault(),!R()){M();return}o(null),l(!0);let g={...a,birthdate:U(a.birthdate),document_expiration:U(a.document_expiration),matricola_expiration:U(a.matricola_expiration)};(async()=>{try{const F=await K("POST","/profile/initiate-creation/",g,{},!1),x=await F.json();if(r(w),F.ok)m(!0);else{o({message:"Errore nell'invio dati, guarda gli errori sotto",state:"error"});const W={...i};Object.entries(x).forEach(([Z,ee])=>{W[Z]&&(W[Z]=[!0,ee])}),r(W)}}catch(F){o({message:"Internal error (please contact us): "+F.message,state:"error"})}finally{l(!1)}})().then()};return p?e.jsxs(b,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",bgcolor:"#fff",children:[e.jsx(ya,{style:{fontSize:100,color:va[500]}}),e.jsx(P,{variant:"h4",align:"center",gutterBottom:!0,children:"La tua richiesta di registrazione è stata inviata con successo!"}),e.jsx(P,{variant:"subtitle1",align:"center",children:"Controlla la tua email per ulteriori istruzioni."}),e.jsxs(P,{variant:"body2",align:"center",sx:{mt:2},children:["In caso non avessi ricevuto nulla, controlla la cartella spam o contattaci all'indirizzo ",e.jsx(je,{href:"mailto: informatica@esnpolimi.it",children:"informatica@esnpolimi.it"})]}),e.jsx(je,{href:"/login",underline:"always",sx:{mt:3},children:"Torna al Login"})]}):e.jsxs(b,{component:"form",noValidate:!0,sx:{maxWidth:800,margin:"auto",mt:5,mb:5,px:4},onSubmit:D,children:[e.jsx(P,{variant:"h4",align:"center",gutterBottom:!0,mb:5,children:"ESN Polimi - Registrazione ESNer"}),t&&e.jsx(Fe,{message:t.message,state:t.state}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,sx:{my:4},children:"Informazioni Personali"}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(O,{label:h.name,variant:"outlined",name:"name",value:a.name,onChange:A,fullWidth:!0,required:!0,error:i.name[0],helperText:i.name[1]})}),e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(O,{label:h.surname,variant:"outlined",name:"surname",value:a.surname,onChange:A,fullWidth:!0,required:!0,error:i.surname[0],helperText:i.surname[1]})}),e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(he,{dateAdapter:we,adapterLocale:"en-gb",children:e.jsx(ye,{label:h.birthdate,value:a.birthdate,onChange:_=>L("birthdate",_),maxDate:q(),required:!0,renderInput:_=>e.jsx(O,{..._,fullWidth:!0,required:!0})})})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(O,{label:h.email,variant:"outlined",name:"email",type:"email",value:a.email,onChange:A,fullWidth:!0,required:!0,error:i.email[0],helperText:i.email[1]})}),e.jsxs(c,{size:{xs:12,sm:6},children:[e.jsx(O,{label:"Conferma Email",variant:"outlined",name:"email_confirm",type:"email",value:a.email_confirm,onChange:A,fullWidth:!0,required:!0,error:i.email_confirm[0],helperText:i.email_confirm[1]}),e.jsx(b,{sx:{mt:1},children:a.email_confirm&&e.jsxs(P,{variant:"caption",sx:{display:"flex",alignItems:"center",color:a.email===a.email_confirm?"green":"grey"},children:[a.email===a.email_confirm?e.jsx(Ge,{fontSize:"small",sx:{mr:.5}}):e.jsx(_e,{fontSize:"small",sx:{mr:.5}}),a.email===a.email_confirm?"Le due email coincidono":"Le email non corrispondono"]})})]}),e.jsxs(c,{size:{xs:12,sm:6},children:[e.jsx(O,{type:"password",label:"Password",variant:"outlined",name:"password",value:a.password,onChange:A,onKeyDown:j("password"),onKeyUp:I("password"),fullWidth:!0,required:!0,error:i.password[0],helperText:i.password[1]}),T.password&&e.jsxs(b,{sx:{display:"flex",alignItems:"center",color:"orange",mt:.5},children:[e.jsx(da,{fontSize:"small",sx:{mr:.5}}),e.jsx(P,{variant:"caption",children:"Attenzione: il tasto Bloc Maiusc è attivo"})]}),e.jsxs(b,{sx:{mt:1,mb:2},children:[e.jsx(P,{variant:"caption",color:"text.secondary",children:"La password deve contenere:"}),e.jsx("ul",{style:{margin:0,paddingLeft:20},children:C.map((_,g)=>{const f=_.test(a.password);return e.jsxs("li",{style:{color:f?"green":"grey",display:"flex",alignItems:"center",marginBottom:2},children:[f?e.jsx(Ge,{fontSize:"small",sx:{mr:.5}}):e.jsx(_e,{fontSize:"small",sx:{mr:.5}}),e.jsx("span",{children:_.label})]},g)})})]})]}),e.jsxs(c,{size:{xs:12,sm:6},children:[e.jsx(O,{type:"password",label:"Conferma Password",variant:"outlined",name:"password_confirm",value:a.password_confirm,onChange:A,onKeyDown:j("password_confirm"),onKeyUp:I("password_confirm"),fullWidth:!0,required:!0,error:i.password_confirm[0],helperText:i.password_confirm[1]}),T.password_confirm&&e.jsxs(b,{sx:{display:"flex",alignItems:"center",color:"orange",mt:.5},children:[e.jsx(da,{fontSize:"small",sx:{mr:.5}}),e.jsx(P,{variant:"caption",children:"Attenzione: il tasto Bloc Maiusc è attivo"})]}),e.jsx(b,{sx:{mt:1},children:a.password_confirm&&e.jsxs(P,{variant:"caption",sx:{display:"flex",alignItems:"center",color:a.password===a.password_confirm?"green":"grey"},children:[a.password===a.password_confirm?e.jsx(Ge,{fontSize:"small",sx:{mr:.5}}):e.jsx(_e,{fontSize:"small",sx:{mr:.5}}),a.password===a.password_confirm?"Le password corrispondono":"Le password non corrispondono"]})})]}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsxs(Q,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"country-label",children:h.country}),e.jsx(oe,{variant:"outlined",labelId:"country-label",name:"country",value:a.country,onChange:A,label:h.country,error:i.country[0],children:Te.map(_=>e.jsx(V,{value:_.code,children:_.name},_.code))})]})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(O,{label:h.domicile,variant:"outlined",name:"domicile",value:a.domicile,onChange:A,fullWidth:!0,required:!0,error:i.domicile[0],helperText:i.domicile[1]})}),e.jsx(c,{size:{xs:4,sm:2},children:e.jsxs(Q,{fullWidth:!0,children:[e.jsx(ne,{id:"phone-prefix-label",children:h.phone_prefix}),e.jsx(oe,{variant:"outlined",labelId:"phone-prefix-label",id:"phone-prefix",name:"phone_prefix",value:a.phone_prefix,onChange:A,label:h.phone_prefix,renderValue:_=>_,error:i.phone_prefix[0],children:Te.map(_=>e.jsxs(V,{value:_.dial,children:[_.dial," (",_.name,")"]},_.code))})]})}),e.jsx(c,{size:{xs:8,sm:4},children:e.jsx(O,{label:h.phone_number,variant:"outlined",name:"phone_number",type:"number",value:a.phone_number,onChange:A,fullWidth:!0,required:!0,error:i.phone_number[0],helperText:i.phone_number[1]})})]}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Informazioni Documento"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{size:{xs:12,sm:4},children:e.jsxs(Q,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"idType-label",children:"Tipo"}),e.jsxs(oe,{variant:"outlined",labelId:"document-type-label",name:"document_type",value:a.document_type,onChange:A,label:"Tipo",required:!0,error:i.document_type[0],children:[e.jsx(V,{value:"Passport",children:"Passport"}),e.jsx(V,{value:"ID Card",children:"ID Card"}),e.jsx(V,{value:"Driving License",children:"Driving License"}),e.jsx(V,{value:"Residency Permit",children:"Residency Permit"}),e.jsx(V,{value:"Other",children:"Other"})]})]})}),e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(O,{label:"Numero",variant:"outlined",name:"document_number",value:a.document_number,onChange:A,fullWidth:!0,required:!0,error:i.document_number[0],helperText:i.document_number[1]})}),e.jsx(c,{size:{xs:12,sm:4},children:e.jsx(he,{dateAdapter:we,adapterLocale:"en-gb",children:e.jsx(ye,{label:"Data di Scadenza",value:a.document_expiration,onChange:_=>L("document_expiration",_),renderInput:_=>e.jsx(O,{..._,fullWidth:!0,required:!0})})})})]}),e.jsx(P,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Informazioni Studente"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(O,{label:h.person_code,variant:"outlined",name:"person_code",type:"number",value:a.person_code,onChange:A,fullWidth:!0,required:!0,error:i.person_code[0],helperText:i.person_code[1]})}),e.jsx(c,{size:{xs:12,sm:6},children:e.jsx(O,{label:h.matricola_number,variant:"outlined",name:"matricola_number",type:"number",value:a.matricola_number,onChange:A,fullWidth:!0,required:!0,error:i.matricola_number[0],helperText:i.matricola_number[1]})})]}),e.jsxs(c,{container:!0,spacing:2,mt:3,children:[e.jsx(c,{size:{xs:12},children:e.jsx(Ce,{control:e.jsx(ze,{name:"acceptStatute",checked:z.acceptStatute,onChange:N,required:!0,sx:{color:n.acceptStatute?"red":void 0,"&.Mui-checked":{color:n.acceptStatute?"red":void 0}}}),label:e.jsxs("span",{children:["Dichiaro di aver letto e accettato lo"," ",e.jsx(je,{href:v.statute,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Statuto di ESN Politecnico Milano"})]})})}),e.jsx(c,{size:{xs:12},children:e.jsx(Ce,{control:e.jsx(ze,{name:"acceptPurposes",checked:z.acceptPurposes,onChange:N,required:!0,sx:{color:n.acceptPurposes?"red":void 0,"&.Mui-checked":{color:n.acceptPurposes?"red":void 0}}}),label:"Dichiaro di condividere pienamente gli scopi dell'Associazione (rif. Articolo 2 dello Statuto)"})}),e.jsx(c,{size:{xs:12},children:e.jsx(Ce,{control:e.jsx(ze,{name:"acceptRegulation",checked:z.acceptRegulation,onChange:N,required:!0,sx:{color:n.acceptRegulation?"red":void 0,"&.Mui-checked":{color:n.acceptRegulation?"red":void 0}}}),label:e.jsxs("span",{children:["Dichiaro di accettare tutti i termini indicati nello"," ",e.jsx(je,{href:v.regulation,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Regolamento Interno"})," ","e tutte le successive modifiche e integrazioni"]})})}),e.jsx(c,{size:{xs:12},children:e.jsx(Ce,{control:e.jsx(ze,{name:"acceptPrivacy",checked:z.acceptPrivacy,onChange:N,required:!0,sx:{color:n.acceptPrivacy?"red":void 0,"&.Mui-checked":{color:n.acceptPrivacy?"red":void 0}}}),label:e.jsxs("span",{children:["Dichiaro di aver letto l'",e.jsx(je,{href:v.privacy,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Informativa sulla Privacy"})," ","e di acconsentire al trattamento dei miei dati personali secondo il Regolamento UE 2016/679 (GDPR) e di essere consapevole dei miei diritti garantiti dalla suddetta legge"]})})})]}),e.jsx(J,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:4},startIcon:!u&&e.jsx(_a,{}),disabled:u,children:u?e.jsx($e,{size:24,color:"inherit"}):"Conferma Dati"})]})}function ge({size:p=40,fullScreen:m=!1}){return e.jsx(b,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:m?"100vh":"100%",width:"100%",position:m?"fixed":"relative",top:0,left:0,zIndex:m?1300:1,backgroundColor:m?"rgba(255, 255, 255, 0.7)":"transparent"},children:e.jsx($e,{size:p})})}const ha=[{value:"valid",label:"Valida"},{value:"expired",label:"Scaduta"},{value:"absent",label:"Assente"}];function Aa({apiEndpoint:p,columns:m,columnVisibility:t,profileType:o}){const[u,l]=s.useState([]),[T,y]=s.useState({pageIndex:0,pageSize:10}),[h,a]=s.useState(0),[E,w]=s.useState([]),[i,r]=s.useState({esncardValidity:[],group:[]}),[z,S]=s.useState(""),[n,d]=s.useState(""),[v,C]=s.useState(!0),R=s.useRef(null),M=ve();s.useEffect(()=>{C(!0),(async()=>{try{const I=new URLSearchParams;I.append("page",T.pageIndex+1),I.append("page_size",T.pageSize),n&&I.append("search",n),i.esncardValidity.length&&I.append("esncardValidity",i.esncardValidity.join(",")),i.group.length&&I.append("group",i.group.join(","));const _=await(await K("GET",`${p}?${I.toString()}`)).json();a(_.count||0),l(_.results)}catch(I){console.error("Error fetching data:",I)}finally{C(!1)}})().then(),o==="ESNer"&&K("GET","/groups/").then(I=>{I.ok&&I.json().then(D=>w(D))})},[p,T.pageIndex,T.pageSize,o,i,n]);const U=()=>{d(z),y(j=>({...j,pageIndex:0}))},A=()=>{S(""),d(""),y(j=>({...j,pageIndex:0})),R.current&&R.current.focus()},L=De({columns:m,data:u,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableColumnPinning:!0,enableFacetedValues:!0,enableRowActions:!0,enableRowSelection:!1,enableRowPinning:!1,enableExpandAll:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},columnVisibility:t},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",enableGlobalFilter:!1,muiPaginationProps:{color:"secondary",rowsPerPageOptions:[10,20,50],shape:"rounded",variant:"outlined"},manualPagination:!0,rowCount:h,onPaginationChange:y,state:{pagination:T},localization:Me,muiTableBodyRowProps:()=>({}),renderRowActions:({row:j})=>e.jsx(Y,{"aria-label":"Modifica profilo",onClick:I=>{I.stopPropagation(),M(`/profile/${j.original.id.toString()}`)},children:e.jsx(Be,{})})}),N=j=>{const{name:I,value:D}=j.target;r(_=>({..._,[I]:typeof D=="string"?D.split(","):D}))};return e.jsxs(b,{sx:{mx:"5%"},children:[e.jsxs(c,{container:!0,spacing:2,sx:{mb:2,mt:2},alignItems:"center",justifyContent:"flex-end",children:[e.jsx(c,{size:{xs:12,sm:2},children:e.jsxs(Q,{fullWidth:!0,children:[e.jsx(ne,{id:"esncard-validity-label",children:"Validità ESNcard"}),e.jsx(oe,{labelId:"esncard-validity-label",name:"esncardValidity",variant:"outlined",multiple:!0,value:i.esncardValidity,onChange:N,input:e.jsx(Ee,{label:"Validità ESNcard"}),renderValue:j=>ha.filter(I=>j.includes(I.value)).map(I=>I.label).join(", "),children:ha.map(j=>e.jsx(V,{value:j.value,children:j.label},j.value))})]})}),o==="ESNer"&&E.length>0&&e.jsx(c,{size:{xs:12,sm:2},children:e.jsxs(Q,{fullWidth:!0,children:[e.jsx(ne,{id:"group-label",children:"Gruppo"}),e.jsx(oe,{labelId:"group-label",name:"group",variant:"outlined",multiple:!0,value:i.group,onChange:N,input:e.jsx(Ee,{label:"Gruppo"}),renderValue:j=>E.filter(I=>j.includes(I.name)).map(I=>I.name).join(", "),children:E.map(j=>e.jsx(V,{value:j.name,children:j.name},j.name))})]})}),e.jsx(c,{size:{xs:12,sm:2},sm:"auto",children:e.jsx(Ee,{inputRef:R,size:"small",placeholder:"Cerca",value:z,onChange:j=>S(j.target.value),onKeyDown:j=>{j.key==="Enter"&&U()},endAdornment:z&&n===z?e.jsx(Y,{"aria-label":"clear",onClick:A,edge:"end",children:e.jsx(We,{})}):e.jsx(Y,{"aria-label":"search",onClick:U,edge:"end",children:e.jsx(na,{})})})})]}),v?e.jsx(ge,{}):e.jsx(Re,{table:L})]})}const Ms=()=>{const{logout:p}=Le(),m=ve(),t=()=>{p(),m("/login")};return e.jsx(Y,{variant:"contained",sx:{backgroundColor:"black",color:"white"},onClick:t,children:e.jsx(Wa,{})})};function Pe(){const{isDrawerOpen:p,toggleDrawer:m,closeDrawer:t,expandedSection:o,handleExpand:u}=zs(),{user:l}=Le(),T=ve(),y=i=>l?.permissions?.includes(i)||!1,h=[{text:"Home",icon:e.jsx($a,{}),path:"/"},{text:"Tesoreria",icon:e.jsx(Ba,{}),path:"/treasury",requiredPermission:"change_account"},{text:"Eventi",icon:e.jsx(oa,{}),path:"/events"},{text:"Profili",icon:e.jsx(ta,{}),children:[{text:"Erasmus",icon:e.jsx(Sa,{}),path:"/profiles/erasmus"},{text:"ESNers",icon:e.jsx(Ca,{}),path:"/profiles/esners"}]}].filter(i=>!i.requiredPermission||y(i.requiredPermission)),a=s.useCallback(()=>{T(`/profile/${l.profile.id.toString()}`)},[T,l?.profile?.id]),E=i=>{(i.button===0||i.button===1)&&t()},w=e.jsxs(b,{sx:{width:250,display:"flex",flexDirection:"column",height:"100%"},role:"presentation",onClick:m(!1),onKeyDown:m(!1),children:[e.jsx(b,{sx:{flexGrow:1},children:h.map(i=>e.jsx(fe.Fragment,{children:i.children?e.jsxs(fe.Fragment,{children:[e.jsxs(Ga,{onClick:r=>{r.stopPropagation(),u(i.text)},children:[e.jsx(aa,{children:i.icon}),e.jsx(sa,{primary:i.text,slotProps:{primary:{style:{color:"black"}}}}),o===i.text?e.jsx(wa,{}):e.jsx(Ea,{})]}),e.jsx(Ta,{in:o===i.text,timeout:"auto",unmountOnExit:!0,children:e.jsx(Ka,{component:"div",disablePadding:!0,children:i.children?.map(r=>e.jsxs(ua,{component:pa,to:r.path,onClick:E,onAuxClick:E,sx:{pl:4},children:[e.jsx(aa,{children:r.icon}),e.jsx(sa,{primary:r.text,slotProps:{primary:{style:{color:"black"}}}})]},r.text))||[]})})]},i.text):e.jsxs(ua,{component:pa,to:i.path,onClick:E,onAuxClick:E,children:[e.jsx(aa,{children:i.icon}),e.jsx(sa,{primary:i.text,slotProps:{primary:{style:{color:"black"}}}})]},i.text)},i.text))}),l&&e.jsxs(b,{sx:{mt:"auto",mb:2,ml:.5,mr:.5,px:2,py:1.5,display:"flex",alignItems:"center",borderRadius:2,background:"#f5f5f5",boxShadow:1,gap:1},children:[e.jsx(Y,{onClick:a,"aria-label":"Profile",sx:{background:"#e0e0e0",mr:.5,width:44,height:44,"&:hover":{background:"#d1c4e9"}},children:e.jsx(ta,{sx:{fontSize:28}})}),e.jsx(b,{sx:{flexGrow:1,minWidth:0},children:e.jsx(P,{variant:"title",sx:{fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:l.profile.name.length>10?l.profile.name.slice(0,10)+"...":l.profile.name})}),e.jsx(Ms,{})]})]});return e.jsxs(b,{sx:{display:"flex"},children:[e.jsx(Y,{edge:"start",color:"inherit","aria-label":"menu",onClick:m(!0),sx:{margin:"10px"},children:e.jsx(qa,{})}),e.jsx(Va,{anchor:"left",open:p,onClose:m(!1),children:w})]})}function As(){const p=s.useMemo(()=>[{accessorKey:"id",header:B.id,size:50},{accessorKey:"name",header:B.name,size:150},{accessorKey:"surname",header:B.surname,size:150},{accessorKey:"email",header:B.email,size:150},{accessorKey:"latest_esncard",header:B.latest_esncard,size:50,Cell:({cell:t})=>e.jsx(b,{sx:{},children:t.getValue()!==null?e.jsx(te,{label:t.getValue().number,color:t.getValue().is_valid?"success":"warning"}):e.jsx(te,{label:"Nessuna ESNcard",color:"error"})})},{accessorKey:"country",header:B.country,size:150,Cell:({row:t})=>{const o=t.original.country,u=Te.find(l=>l.code===o);return u?u.name:o||"(vuoto)"}},{accessorKey:"birthdate",header:B.birthdate,size:100},{accessorKey:"course",header:B.course,size:100},{accessorKey:"phone_prefix",header:"Prefisso Telefono",size:60},{accessorKey:"phone_number",header:"Numero Telefono (no prefisso)",size:120},{id:"fullPhoneNumber",header:B.phone_number,size:150,accessorFn:t=>`(${t.phone_prefix||"vuoto"}) ${t.phone_number||"(vuoto)"}`,Cell:({row:t})=>e.jsxs("span",{children:["(",t.original.phone_prefix||"vuoto",") ",t.original.phone_number||"(vuoto)"]})},{accessorKey:"whatsapp_prefix",header:"Prefisso WhatsApp",size:60},{accessorKey:"whatsapp_number",header:"Numero WhatsApp (no prefisso)",size:120},{id:"fullWANumber",header:B.whatsapp_number,size:150,accessorFn:t=>`(${t.whatsapp_prefix||"vuoto"}) ${t.whatsapp_number||"(vuoto)"}`,Cell:({row:t})=>e.jsxs("span",{children:["(",t.original.whatsapp_prefix||"vuoto",") ",t.original.whatsapp_number||"(vuoto)"]})},{accessorKey:"domicile",header:B.domicile,size:200},{accessorKey:"matricola_number",header:B.matricola_number,size:50},{accessorKey:"matricola_expiration",header:B.matricola_expiration,size:50},{accessorKey:"latest_document.number",header:B.latest_document,size:50}],[]),m={id:!0,name:!0,surname:!0,email:!0,country:!1,birthdate:!1,course:!1,fullPhoneNumber:!0,fullWANumber:!0,person_code:!1,domicile:!1,matricola_number:!1,matricola_expiration:!1,"latest_document.number":!1,phone_prefix:!1,phone_number:!1,whatsapp_prefix:!1,whatsapp_number:!1};return e.jsxs(b,{children:[e.jsx(Pe,{}),e.jsx(b,{sx:{mx:"5%"},children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(Sa,{sx:{marginRight:"10px"}}),e.jsx(P,{variant:"h4",children:"Profili Erasmus"})]})}),e.jsx(Aa,{apiEndpoint:"/erasmus_profiles/",columns:p,columnVisibility:m,profileType:"Erasmus"})]})}function Ls(){const p=s.useMemo(()=>[{accessorKey:"id",header:B.id,size:50},{accessorKey:"name",header:B.name,size:150},{accessorKey:"surname",header:B.surname,size:150},{accessorKey:"group",header:B.group,size:150,Cell:({cell:t})=>{const o=t.getValue();let u="default";return o==="Aspiranti"?u="info":o==="Attivi"?u="success":o==="Board"&&(u="warning"),e.jsx(te,{label:o,color:u})}},{accessorKey:"email",header:B.email,size:150},{accessorKey:"latest_esncard",header:B.latest_esncard,size:50,Cell:({cell:t})=>e.jsx(b,{sx:{},children:t.getValue()!==null?e.jsx(te,{label:t.getValue().number,color:t.getValue().is_valid?"success":"warning"}):e.jsx(te,{label:"Nessuna ESNcard",color:"error"})})},{accessorKey:"country",header:B.country,size:150,Cell:({row:t})=>{const o=t.original.country,u=Te.find(l=>l.code===o);return u?u.name:o||"(vuoto)"}},{accessorKey:"birthdate",header:B.birthdate,size:100},{accessorKey:"phone_prefix",header:"Prefisso Telefono",size:60},{accessorKey:"phone_number",header:"Numero Telefono (no prefisso)",size:120},{id:"fullPhoneNumber",header:B.phone_number,size:150,accessorFn:t=>`(${t.phone_prefix||"vuoto"}) ${t.phone_number||"(vuoto)"}`,Cell:({row:t})=>e.jsxs("span",{children:["(",t.original.phone_prefix||"vuoto",") ",t.original.phone_number||"(vuoto)"]})},{accessorKey:"person_code",header:B.person_code,size:150},{accessorKey:"domicile",header:B.domicile,size:200},{accessorKey:"matricola_number",header:B.matricola_number,size:50},{accessorKey:"latest_document.number",header:B.latest_document,size:50}],[]),m={id:!0,name:!0,surname:!0,groups:!0,email:!0,country:!0,birthdate:!1,fullPhoneNumber:!0,person_code:!1,domicile:!1,matricola_number:!1,"latest_document.number":!1,phone_prefix:!1,phone_number:!1};return e.jsxs(b,{children:[e.jsx(Pe,{}),e.jsx(b,{sx:{mx:"5%"},children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(Ca,{sx:{marginRight:"10px"}}),e.jsx(P,{variant:"h4",children:"Profili ESNers"})]})}),e.jsx(Aa,{apiEndpoint:"/esner_profiles/",columns:p,columnVisibility:m,profileType:"ESNer"})]})}function la({open:p,message:m,onConfirm:t,onClose:o}){return e.jsxs(Ha,{open:p,onClose:o,children:[e.jsx(Ya,{children:"Conferma Azione"}),e.jsx(Ua,{children:e.jsx(P,{children:m})}),e.jsxs(Ja,{children:[e.jsx(J,{onClick:o,color:"secondary",children:"Annulla"}),e.jsx(J,{onClick:t,color:"primary",autoFocus:!0,children:"Conferma"})]})]})}const Se=({message:p,state:m,duration:t=2e3})=>(s.useEffect(()=>{const o=document.createElement("div"),u=document.createElement("button");if(m==="error"){u.style.marginRight="10px",u.style.cursor="pointer",u.style.border="none",u.style.color="white",u.style.backgroundColor="transparent",ba.createRoot(u).render(e.jsx(Za,{}));const w=document.createElement("span");w.innerText=p,o.appendChild(u),o.appendChild(w)}else o.innerText=p;o.style.display="flex",o.style.alignItems="center",o.style.position="fixed",o.style.top="-100px",o.style.left="50%",o.style.transform="translateX(-50%)",o.style.backgroundColor=m==="success"?"green":"red",o.style.color="white",o.style.padding="10px",o.style.borderRadius="5px",o.style.cursor="pointer",o.style.zIndex="9999",o.style.transition="opacity 0.5s ease-in-out, top 0.5s ease-in-out",document.body.appendChild(o);const l=()=>{navigator.clipboard.writeText(p).then()};m==="error"&&u.addEventListener("click",l);let T;requestAnimationFrame(()=>{o.style.top="20px"});const y=()=>{o.style.top="-100px",setTimeout(()=>{o.removeEventListener("mouseenter",h),o.removeEventListener("mouseleave",a),u.removeEventListener("click",l),document.body.contains(o)&&document.body.removeChild(o)},t/4)},h=()=>{clearTimeout(T)},a=()=>{T=setTimeout(y,t)};o.addEventListener("mouseenter",h),o.addEventListener("mouseleave",a),a()},[p,m,t]),null),Rs={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80%",maxWidth:1200,maxHeight:"90vh",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,overflow:"auto"},Ne={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",boxShadow:24,p:4,outline:"none",display:"flex",flexDirection:"column"};function La({open:p,onClose:m,account:t,onSuccess:o}){const{user:u}=Le(),[l,T]=s.useState({amount:"",type:"deposit",description:""}),y=async a=>{a.preventDefault();try{const E=await K("POST","/transaction/",{account:t.id,amount:l.type==="deposit"?Math.abs(l.amount):-Math.abs(l.amount),description:l.description,type:l.type,executor:u.profile.email});if(E.ok)o("Transazione registrata con successo"),m();else{const w=await E.json();o("Errore durante la registrazione: "+JSON.stringify(w),"error")}}catch(E){o("Errore durante la registrazione: "+E.message,"error")}},h=()=>m(!1);return e.jsx(Ae,{open:p,onClose:h,children:e.jsxs(b,{sx:Ne,component:"form",onSubmit:y,noValidate:!0,children:[e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsxs(Y,{onClick:h,sx:{minWidth:0},children:[" ",e.jsx(_e,{})," "]})}),e.jsxs(P,{variant:"h5",gutterBottom:!0,align:"center",sx:{mt:2},children:["Transazione Manuale - Cassa ",t?.name]}),e.jsxs(c,{container:!0,spacing:2,sx:{mt:2},children:[e.jsxs(Q,{fullWidth:!0,children:[e.jsx(ne,{children:"Tipo"}),e.jsxs(oe,{variant:"outlined",value:l.type,label:"Tipo",onChange:a=>T({...l,type:a.target.value}),children:[e.jsx(V,{value:"deposit",children:"Deposito"}),e.jsx(V,{value:"withdrawal",children:"Prelievo"})]})]}),e.jsx(O,{margin:"dense",label:"Importo",type:"number",fullWidth:!0,value:l.amount,slotProps:{htmlInput:{min:"0.01",step:"0.01"}},onChange:a=>T({...l,amount:a.target.value})}),e.jsx(O,{margin:"dense",label:"Descrizione",type:"text",fullWidth:!0,multiline:!0,rows:2,value:l.description,onChange:a=>T({...l,description:a.target.value})})]}),e.jsxs(b,{mt:2,children:[e.jsx(J,{fullWidth:!0,onClick:m,children:"Annulla"}),e.jsx(J,{fullWidth:!0,variant:"contained",color:"primary",type:"submit",disabled:!l.amount||l.amount<=0,children:"Conferma"})]})]})})}const Fs={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"top",mt:4,minHeight:"100vh"};function Ns(){const{user:p}=Le(),[m,t]=s.useState([]),[o,u]=s.useState(null),[l,T]=s.useState(!1),[y,h]=s.useState(""),[a,E]=s.useState(!1),[w,i]=s.useState(null),[r,z]=s.useState(!1),S=p?.permissions.includes("change_account");s.useEffect(()=>{n().then()},[p]);const n=async()=>{try{const C=await K("GET","/accounts/"),R=await C.json();if(C.ok)t(R.results);else{const M=await se(R,C.status);i({message:`Errore durante il recupero delle casse: ${M}`,state:"error"})}}catch(C){i({message:`Errore generale: ${C}`,state:"error"})}},d=(C,R)=>{u(C),h(R),T(!0)},v=async()=>{try{const C=await K("PATCH",`/account/${o.id}/`,{status:y==="open"?"open":"closed"});C.ok?(console.log(`Account ${y}ed successfully.`),n().then(),i({message:`Cassa ${y==="open"?"aperta":"chiusa"} con successo!`,state:"success"})):(console.error(`Failed to ${y} account.`),i({message:`Errore account: ${C.statusText}`,state:"error"}))}catch(C){console.error(`Error ${y}ing account:`,C),i({message:`Errore generale: ${C}`,state:"error"})}finally{T(!1)}};return e.jsxs(b,{children:[e.jsx(Pe,{}),e.jsx(b,{sx:{width:"100%",maxWidth:"90%",mx:"auto",mt:0},children:e.jsxs(Ke,{elevation:3,sx:{p:2,mb:0,borderRadius:5},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>E(C=>!C),children:[e.jsx(P,{variant:"h5",sx:{flexGrow:1,fontWeight:600},children:"Casse"}),e.jsx(Y,{children:a?e.jsx(wa,{}):e.jsx(Ea,{})})]}),e.jsx(Ta,{in:a,timeout:"auto",unmountOnExit:!0,children:e.jsx(b,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:2,justifyContent:"center"},children:m.map(C=>e.jsxs(qe,{sx:{flex:"1 1 320px",minWidth:320,maxWidth:400,display:"flex",alignItems:"center",boxShadow:4,borderRadius:2,m:1},children:[e.jsxs(Ia,{sx:{flex:1},children:[e.jsx(P,{variant:"h6",sx:{fontWeight:700,color:"#2d3a4b"},children:C.name}),S&&e.jsxs(e.Fragment,{children:[e.jsxs(P,{variant:"body1",sx:{color:"#3e5060"},children:[pe.balance,": ",e.jsxs("b",{children:["€",C.balance]})]}),e.jsxs(P,{variant:"body2",sx:{color:"#607d8b"},children:[pe.changed_by,": ",C.changed_by.name||"N/A"]})]})]}),S?e.jsxs(Qa,{sx:{pr:2,flexDirection:"column",alignItems:"flex-end"},children:[C.status==="closed"&&e.jsx(J,{variant:"contained",color:"success",onClick:()=>d(C,"open"),sx:{minWidth:120,fontWeight:600},children:"Apri Cassa"}),C.status==="open"&&e.jsxs(e.Fragment,{children:[e.jsx(J,{variant:"contained",color:"error",onClick:()=>d(C,"close"),sx:{minWidth:120,fontWeight:600,mb:1},children:"Chiudi Cassa"}),e.jsx(J,{variant:"contained",color:"primary",onClick:()=>{u(C),z(!0)},sx:{minWidth:120,fontWeight:600},children:"Deposita/Preleva"})]})]}):e.jsx(P,{variant:"h7",style:{color:C.status==="closed"?"red":"green",fontWeight:"bold",padding:"20px"},children:C.status==="closed"?"Cassa Chiusa":"Cassa Aperta"})]},C.id))})})]})}),e.jsxs(b,{sx:Fs,children:[e.jsx(P,{variant:"h3",gutterBottom:!0,children:"Sistema di Gestione"}),e.jsx("img",{src:ia,alt:"ESN Polimi Logo",style:{height:"25vh",marginTop:"2px"}}),e.jsxs("h1",{children:["Benvenuto, ",p?p.profile.name:"Sir","!"]})]}),e.jsx(la,{open:l,message:`Confermi la presenza di €${o?.balance} nella cassa "${o?.name}" prima di ${y==="open"?"aprirla":"chiuderla"}?`,onConfirm:v,onClose:()=>T(!1)}),e.jsx(La,{open:r,onClose:()=>z(!1),account:o,onSuccess:(C,R)=>i({message:C,state:R||"success"})}),w&&e.jsx(Se,{message:w.message,state:w.state})]})}function Os({limit:p=5}){const[m,t]=s.useState([]),[o,u]=s.useState(!0);s.useEffect(()=>{(async()=>{u(!0);try{const h=await K("GET","/accounts/");if(h.ok){const a=await h.json();t(a.results)}}catch{}finally{u(!1)}})().then()},[]);const l=s.useMemo(()=>[{accessorKey:"name",header:pe.name,size:100},{accessorKey:"balance",header:pe.balance,size:100,Cell:({cell:y})=>e.jsx(b,{children:y.getValue()!==null?e.jsx(te,{label:`€${y.getValue()}`,color:"primary"}):e.jsx(te,{label:"N/A",color:"warning"})})},{accessorKey:"status",header:pe.status,size:100,Cell:({cell:y})=>e.jsx(b,{children:y.getValue()!==null?e.jsx(te,{label:y.getValue()==="open"?"Aperta":"Chiusa",color:y.getValue()==="open"?"success":"error"}):e.jsx(te,{label:"Stato ignoto",color:"warning"})})}],[]),T=De({columns:l,data:m.slice(0,p),enableKeyboardShortcuts:!1,enableColumnActions:!1,enableColumnFilters:!1,enablePagination:!1,enableSorting:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!1},paginationDisplayMode:"default",muiTableBodyRowProps:{hover:!1},localization:Me});return o?e.jsx(ge,{}):e.jsx(ka,{table:T})}const Ws={subscription:{label:re.tran_type.subscription,color:"primary"},esncard:{label:re.tran_type.esncard,color:"secondary"},deposit:{label:re.tran_type.deposit,color:"success"},withdrawal:{label:re.tran_type.withdrawal,color:"error"}};function $s({limit:p=5}){const[m,t]=s.useState([]),[o,u]=s.useState(!0);s.useEffect(()=>{(async()=>{u(!0);try{const h=await K("GET","/transactions/");if(h.ok){const a=await h.json();t(a.results),console.log("Transactions data:",a.results)}}catch{}finally{u(!1)}})().then()},[]);const l=s.useMemo(()=>[{accessorKey:"created_at",header:re.date,size:100,Cell:({cell:y})=>{const h=new Date(y.getValue());return e.jsx(b,{children:new Intl.DateTimeFormat("it-IT",{dateStyle:"medium",timeStyle:"short"}).format(h)})}},{accessorKey:"type",header:re.type,size:100,Cell:({cell:y})=>{const h=y.getValue(),a=Ws[h]||{label:"Sconosciuto",color:"default"};return e.jsx(te,{label:a.label,color:a.color,variant:"outlined"})}},{accessorKey:"executor.name",header:re.executor,size:150},{accessorKey:"account.name",header:re.account,size:100,Cell:({cell:y})=>e.jsx(b,{component:"span",fontWeight:"bold",children:y.getValue()})},{accessorKey:"amount",header:re.amount,size:100,Cell:({cell:y})=>e.jsx(b,{children:y.getValue()!==null?e.jsx(te,{label:`€${y.getValue()}`,color:"primary"}):e.jsx(te,{label:"N/A",color:"warning"})})}],[]),T=De({columns:l,data:m.slice(0,p),enableKeyboardShortcuts:!1,enableColumnActions:!1,enableColumnFilters:!1,enablePagination:!1,enableSorting:!0,initialState:{showColumnFilters:!1,showGlobalFilter:!1,sorting:[{id:"created_at",desc:!0}]},paginationDisplayMode:"default",muiTableBodyRowProps:{hover:!1},localization:Me});return o?e.jsx(ge,{}):e.jsx(ka,{table:T})}function Bs(){const p=ve();return e.jsxs(b,{children:[e.jsx(Pe,{}),e.jsxs(b,{sx:{mx:"5%",mt:0},children:[e.jsx(P,{variant:"h4",sx:{mb:3},children:"Dashboard Tesoreria"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{size:{xs:12,md:4},children:e.jsxs(Ke,{elevation:3,sx:{p:2},children:[e.jsx(P,{variant:"h6",sx:{mb:2},children:"Casse"}),e.jsx(Os,{limit:5}),e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(J,{variant:"outlined",size:"small",onClick:()=>p("/treasury/accounts_list/"),children:"Gestisci Casse"})})]})}),e.jsx(c,{size:{xs:12,md:8},children:e.jsxs(Ke,{elevation:3,sx:{p:2},children:[e.jsx(P,{variant:"h6",sx:{mb:2},children:"Ultime Transazioni"}),e.jsx($s,{limit:3}),e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(J,{variant:"outlined",size:"small",onClick:()=>p("/treasury/transactions_list/"),children:"Gestisci Movimenti"})})]})})]})]})]})}function Gs({open:p,onClose:m,account:t=null}){const o=t!==null,[u,l]=s.useState(!0),[T,y]=s.useState(null),[h,a]=s.useState({name:"",visible_to_groups:[]}),[E,w]=s.useState({name:[!1,""],visible_to_groups:[!1,""]}),[i,r]=s.useState([]);s.useEffect(()=>{(async()=>{try{const C=await K("GET","/groups/"),R=await C.json();if(C.ok)r(R);else{const M=await se(R,C.status);y({message:`Errore nel recupero dei gruppi: ${M}`,state:"error"})}}catch(C){y({message:`Errore nel recupero dei gruppi: ${C}`,state:"error"})}})().then()},[]),s.useEffect(()=>{a(o&&t?{name:t.name||"",visible_to_groups:t.visible_to_groups?.map(v=>v.id)||[]}:{name:"",visible_to_groups:[]}),l(!1)},[o,t]);const z=v=>{const{name:C,value:R}=v.target;a({...h,[C]:R})},S=v=>{a({...h,visible_to_groups:v.target.value})},n=async v=>{v.preventDefault();const C={...E};if(h.name.trim()?C.name=[!1,""]:C.name=[!0,"Il nome è obbligatorio"],h.visible_to_groups.length===0?C.visible_to_groups=[!0,"Seleziona almeno un gruppo"]:C.visible_to_groups=[!1,""],w(C),!(C.name[0]||C.visible_to_groups[0])){l(!0);try{const R={name:h.name,visible_to_groups:h.visible_to_groups};let M;if(o&&t?M=await K("PATCH",`/account/${t.id}/`,R):M=await K("POST","/account/",R),M.ok)m(!0);else{const U=await M.json(),A=await se(U,M.status);y({message:`Errore ${o?"modifica":"creazione"} cassa: ${A}`,state:"error"})}}catch(R){y({message:`Errore generale: ${R}`,state:"error"})}finally{l(!1)}}},d=()=>{m(!1)};return e.jsx(Ae,{open:p,onClose:d,children:e.jsx(b,{sx:Ne,component:"form",onSubmit:n,noValidate:!0,children:u?e.jsx(ge,{}):e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(Y,{onClick:d,sx:{minWidth:0},children:e.jsx(_e,{})})}),e.jsx(P,{variant:"h5",gutterBottom:!0,align:"center",sx:{mb:2},children:o?`Modifica Cassa - ${t?.name}`:"Crea Cassa"}),T&&e.jsx(Se,{message:T.message,state:T.state}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{size:{xs:12},children:e.jsx(O,{fullWidth:!0,label:pe.name,name:"name",value:h.name,onChange:z,required:!0,error:E.name[0],helperText:E.name[0]?E.name[1]:""})}),e.jsx(c,{size:{xs:12},children:e.jsxs(Q,{fullWidth:!0,error:E.visible_to_groups[0],children:[e.jsx(ne,{id:"groups-label",children:pe.visible_to_groups}),e.jsx(oe,{variant:"outlined",labelId:"groups-label",multiple:!0,value:h.visible_to_groups,onChange:S,input:e.jsx(Ee,{label:pe.visible_to_groups}),renderValue:v=>e.jsx(b,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:v.map(C=>{const R=i.find(M=>M.id===C);return e.jsx(te,{label:R?R.name:C},C)})}),children:i.map(v=>e.jsx(V,{value:v.id,children:v.name},v.id))}),E.visible_to_groups[0]&&e.jsx(Ue,{children:E.visible_to_groups[1]})]})})]}),e.jsx(b,{mt:2,children:e.jsx(J,{fullWidth:!0,variant:"contained",color:"primary",type:"submit",children:o?"Salva Modifiche":"Crea"})})]})})})}function Ks(){const[p,m]=s.useState([]),[t,o]=s.useState(!0),[u,l]=s.useState(!1),T=ve(),[y,h]=s.useState(null),[a,E]=s.useState(null),[w,i]=s.useState(!1);s.useEffect(()=>{r().then()},[]);const r=async()=>{o(!0);try{const d=await K("GET","/accounts/"),v=await d.json();if(d.ok)m(v.results),console.log("Account List Data: ",v.results);else{const C=await se(v,d.status);h({message:`Errore: ${C}`,state:"error"})}}catch(d){h({message:`Errore generale: ${d}`,state:"error"})}finally{o(!1)}},z=s.useMemo(()=>[{accessorKey:"id",header:pe.id,size:50},{accessorKey:"name",header:pe.name,size:150},{accessorKey:"changed_by.name",header:pe.changed_by,size:150},{accessorKey:"balance",header:pe.balance,size:100,Cell:({cell:d})=>e.jsx(b,{children:d.getValue()!==null?e.jsx(te,{label:`€${d.getValue()}`,color:"primary"}):e.jsx(te,{label:"N/A",color:"warning"})})},{accessorKey:"status",header:pe.status,size:150,Cell:({cell:d})=>e.jsx(b,{sx:{},children:d.getValue()!==null?e.jsx(te,{label:d.getValue()==="open"?"Aperta":"Chiusa",color:d.getValue()==="open"?"success":"error"}):e.jsx(te,{label:"N/A",color:"warning"})})},{accessorKey:"visible_to_groups",header:pe.visible_to_groups,size:150,Cell:({cell:d})=>e.jsx(b,{sx:{},children:d.getValue()!==null?d.getValue().map(v=>e.jsx(te,{label:v.name,color:"grey",sx:{mr:1}},v.id)):e.jsx(te,{label:"N/A",color:"warning"})})},{header:"Azioni",size:150,Cell:({row:d})=>e.jsxs(b,{sx:{display:"flex",gap:1},children:[e.jsx(Y,{color:"primary",onClick:()=>{E(d.original),l(!0)},children:e.jsx(Be,{})}),e.jsx(J,{variant:"contained",color:"primary",onClick:()=>{E(d.original),i(!0)},children:"Deposita/Preleva"})]})}],[]),S=De({columns:z,data:p,enablePagination:!1,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableColumnPinning:!1,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableRowPinning:!1,enableExpandAll:!1,initialState:{showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},columnVisibility:{id:!1,name:!0,changed_by:!0,status:!0,balance:!0}},positionToolbarAlertBanner:"bottom",localization:Me,muiTableBodyRowProps:()=>({sx:{cursor:"default"}}),renderTopToolbarCustomActions:()=>e.jsx(b,{sx:{display:"flex",flexDirection:"row"},children:e.jsx(J,{variant:"contained",onClick:()=>l(!0),sx:{width:"150px"},children:"Nuova Cassa"})})}),n=async d=>{d&&(h({message:"Cassa creata con successo!",state:"success"}),await r()),E(null),l(!1)};return e.jsxs(b,{children:[e.jsx(Pe,{}),u&&e.jsx(Gs,{open:u,onClose:n,account:a}),e.jsx(La,{open:w,onClose:()=>i(!1),account:a,onSuccess:(d,v)=>h({message:d,state:v||"success"})}),e.jsx(b,{sx:{mx:"5%"},children:t?e.jsx(ge,{}):e.jsxs(e.Fragment,{children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(Y,{onClick:()=>{T(-1)},sx:{mr:2},children:e.jsx(Je,{})}),e.jsx(Xa,{sx:{marginRight:"10px"}}),e.jsx(P,{variant:"h4",children:"Lista Casse"})]}),e.jsx(Re,{table:S})]})}),y&&e.jsx(Se,{message:y.message,state:y.state})]})}function Ra({value:p,onChange:m,readOnly:t=!1}){const o=s.useRef(null),u=s.useRef(null);return s.useEffect(()=>{if(o.current&&!u.current){const l=t?{toolbar:!1}:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["link"],["clean"]]};u.current=new ws(o.current,{theme:"snow",readOnly:t,modules:l}),u.current.on("text-change",()=>{m&&m(u.current.root.innerHTML)}),p&&(u.current.root.innerHTML=p)}},[p,m,t]),e.jsx("div",{ref:o})}function Fa({open:p,event:m,isEdit:t,onClose:o}){const[u,l]=s.useState(!0),T=t?"Modifica Evento - "+m.name:"Crea Evento",[y,h]=s.useState(null),[a,E]=s.useState(!1),[w,i]=s.useState({id:"",name:"",date:q(),description:`<h3>Descrizione</h3>    <p>Ecco un <a href="https://www.italia.it" target="_blank">link all'Italia</a>.</p>    <blockquote>Citazione elegante.</blockquote>    <p style="text-align: center;">Adios.</p>`,cost:"",subscription_start_date:q().hour(12).minute(0),subscription_end_date:q().hour(24).minute(0),lists:[{id:"",name:"Main List",capacity:""}]}),[r,z]=fe.useState({name:[!1,""],date:[!1,""],description:[!1,""],cost:[!1,""],subscription_start_date:[!1,""],subscription_end_date:[!1,""],lists:[!1,""],listItems:[]});s.useEffect(()=>{t&&(console.log("Setting form data: ",m),i(m),console.log("#Subsciptions: ",m.subscriptions.length),E(m.subscriptions.length>0)),l(!1)},[]);const S=D=>q(D).format("YYYY-MM-DD"),n=D=>q(D).toISOString(),d=D=>{D&&q(D).isBefore(q(),"day")||i({...w,date:D})},v=D=>{w.subscription_end_date&&q(D).isAfter(q(w.subscription_end_date))?i({...w,subscription_start_date:D,subscription_end_date:q(D).add(1,"day")}):i({...w,subscription_start_date:D})},C=D=>{if(D){const _=q(w.subscription_start_date),g=q(D),f=q();g.isBefore(_)?D=_:g.isBefore(f)&&(D=f)}i({...w,subscription_end_date:D})},R=D=>({name:D.name,date:S(D.date),description:D.description,subscription_start_date:n(D.subscription_start_date),subscription_end_date:n(D.subscription_end_date),cost:Number(D.cost).toFixed(2),lists:D.lists.map(_=>({id:_.id,name:_.name,capacity:Math.floor(Number(_.capacity))}))}),M=()=>{window.scrollTo({top:0,behavior:"smooth"})},U=D=>{const{name:_,value:g,type:f,checked:F}=D.target;i({...w,[_]:f==="checkbox"?F:g})},A=()=>{i({...w,lists:[...w.lists,{id:"",name:"",capacity:""}]})},L=(D,_)=>{const{name:g,value:f}=_.target,F=w.lists.map((x,W)=>W===D?{...x,[g]:f}:x);i({...w,lists:F})},N=D=>{i({...w,lists:w.lists.filter((_,g)=>g!==D)})},j=async D=>{D.preventDefault();const _=w.lists.map(f=>({name:!f.name.trim(),capacity:f.capacity===""})),g=_.some(f=>f.name||f.capacity);if(z({...r,listItems:_,lists:[g]}),g){h({message:"Errore campi Liste",state:"error"}),M();return}try{const f=t?await K("PATCH",`/event/${w.id}/`,R(w)):await K("POST","/event/",R(w));if(f.ok)o(!0);else{const F=await f.json(),x=await se(F,f.status);h({message:`Errore ${t?"modifica":"creazione"} evento: ${x}`,state:"error"}),M()}}catch(f){h({message:`Errore generale: ${f}`,state:"error"}),M()}},I=()=>{o(!1)};return e.jsx(Ae,{open:p,onClose:I,children:e.jsx(b,{sx:Rs,component:"form",onSubmit:j,noValidate:!1,children:u?e.jsx(ge,{}):e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(Y,{onClick:()=>o(!1),sx:{minWidth:0},children:e.jsx(_e,{})})}),e.jsx(P,{variant:"h5",gutterBottom:!0,sx:{mb:2},align:"center",children:T}),y&&e.jsx(Fe,{message:y.message,state:y.state}),t&&a&&e.jsx(b,{sx:{mb:2,p:1,bgcolor:"#fff3e0",borderRadius:1},children:e.jsxs(P,{variant:"body2",color:"warning.main",children:[e.jsx(es,{fontSize:"small",sx:{verticalAlign:"middle",mr:1}}),"Alcuni campi non sono modificabili perché ci sono già iscrizioni. Rimuovi tutte le iscrizioni per abilitare la modifica."]})}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{size:{xs:12,md:6},children:e.jsx(O,{fullWidth:!0,label:xe.name,name:"name",value:w.name,onChange:U,required:!0,error:r.name[0]})}),e.jsx(c,{size:{xs:12,md:6},children:e.jsx(he,{dateAdapter:we,adapterLocale:"en-gb",children:e.jsx(ye,{label:xe.date,value:w.date,onChange:d,minDate:t?null:q(),renderInput:D=>e.jsx(O,{...D,fullWidth:!0,required:!0}),required:!0,error:r.date[0]})})}),e.jsx(c,{size:{xs:12,md:3},children:e.jsx(Ve,{title:t&&a?"Non modificabile con iscrizioni esistenti":"",children:e.jsxs("div",{children:[" ",e.jsx(he,{dateAdapter:we,adapterLocale:"en-gb",children:e.jsx(ma,{label:xe.subscription_start_date,value:w.subscription_start_date||null,onChange:v,minDate:t?null:q(),slotProps:{textField:{fullWidth:!0,required:!0}},disabled:t&&a,required:!0,error:r.subscription_start_date[0]})})]})})}),e.jsx(c,{size:{xs:12,md:3},children:e.jsx(he,{dateAdapter:we,adapterLocale:"en-gb",children:e.jsx(ma,{label:xe.subscription_end_date,value:w.subscription_end_date||null,onChange:C,minDate:q().isAfter(w.subscription_start_date)?q():w.subscription_start_date||q(),slotProps:{textField:{fullWidth:!0,required:!0}},required:!0,error:r.subscription_start_date[0]})})}),e.jsx(c,{size:{xs:12,md:3},children:e.jsx(Ve,{title:t&&a?"Non modificabile con iscrizioni esistenti":"",children:e.jsxs("div",{children:[" ",e.jsx(O,{fullWidth:!0,label:xe.cost,name:"cost",type:"number",slotProps:{htmlInput:{min:"0",step:"0.01"}},value:w.cost,onChange:U,placeholder:"Inserisci 0 se gratuito",required:!0,error:r.cost[0],disabled:t&&a})]})})})]}),e.jsxs(c,{size:{xs:12},"data-color-mode":"light",children:[e.jsx(P,{variant:"h6",component:"div",children:xe.description}),e.jsx(Ra,{value:w.description,onChange:D=>{i({...w,description:D})}})]}),e.jsxs(b,{my:2,children:[e.jsxs(c,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(c,{children:e.jsx(P,{variant:"h6",gutterBottom:!0,children:"Liste"})}),e.jsx(c,{children:e.jsx(Y,{onClick:A,children:e.jsx(as,{})})})]}),w.lists.map((D,_)=>e.jsxs(c,{container:!0,spacing:2,alignItems:"center",mb:2,children:[e.jsx(c,{children:e.jsx(O,{label:xe.list_name,name:"name",value:D.name,onChange:g=>L(_,g),required:!0,error:r.listItems[_]?.name,helperText:r.listItems[_]?.name?"Il nome è obbligatorio":""})}),e.jsx(c,{children:e.jsx(O,{label:xe.list_capacity,name:"capacity",type:"number",value:D.capacity,slotProps:{htmlInput:{min:"0",step:"1"}},onChange:g=>L(_,g),placeholder:"Inserisci 0 se illimitata",required:!0,error:r.listItems[_]?.capacity,helperText:r.listItems[_]?.capacity?"La capacità è obbligatoria":""})}),e.jsx(c,{size:{xs:2},children:e.jsx(Y,{onClick:()=>N(_),children:e.jsx(za,{})})})]},_))]}),e.jsx(b,{mt:2,children:e.jsx(J,{variant:"contained",color:"primary",type:"submit",children:t?"Salva Modifiche":"Crea"})})]})})})}const xa=[{value:"open",label:"Iscrizioni aperte"},{value:"not_yet",label:"Non ancora aperte"},{value:"closed",label:"Iscrizioni chiuse"}];function qs(){const[p,m]=s.useState([]),[t,o]=s.useState(!0),[u,l]=s.useState(!1),T=ve(),[y,h]=s.useState(null),[a,E]=s.useState({pageIndex:0,pageSize:10}),[w,i]=s.useState(0),[r,z]=s.useState(""),[S,n]=s.useState(""),[d,v]=s.useState({subscriptionStatus:[],dateFrom:null,dateTo:null}),[C,R]=s.useState(!1),M=s.useRef(null);s.useEffect(()=>{let g=!1;return(async()=>{R(!0);try{const F=new URLSearchParams;F.append("page",a.pageIndex+1),F.append("page_size",a.pageSize),S&&F.append("search",S),d.subscriptionStatus.length&&d.subscriptionStatus.forEach(Z=>F.append("subscription_status",Z)),d.dateFrom&&F.append("dateFrom",d.dateFrom.toISOString()),d.dateTo&&F.append("dateTo",d.dateTo.toISOString());const x=await K("GET",`/events/?${F.toString()}`),W=await x.json();if(x.ok)g||(i(W.count||0),m(W.results));else{const Z=await se(W,x.status);h({message:`Errore: ${Z}`,state:"error"})}}catch(F){h({message:`Errore generale: ${F}`,state:"error"})}finally{R(!1)}})().then(),()=>{g=!0}},[a.pageIndex,a.pageSize,d,S]);const U=s.useMemo(()=>[{accessorKey:"id",header:xe.id,size:50},{accessorKey:"name",header:xe.name,size:150},{accessorKey:"date",header:xe.date,size:150},{accessorKey:"cost",header:xe.cost,size:150},{accessorKey:"subscription_start_date",header:xe.subscription_date_status,size:150,Cell:({row:g})=>{const f=q(),F=g.original.subscription_start_date?q(g.original.subscription_start_date):null,x=g.original.subscription_end_date?q(g.original.subscription_end_date):null;let W="Non disponibile",Z="error";return F&&x&&(f.isAfter(F)&&f.isBefore(x)?(W="Iscrizioni aperte",Z="success"):f.isBefore(F)?(W="Iscrizioni non ancora aperte",Z="warning"):f.isAfter(x)&&(W="Iscrizioni chiuse",Z="error")),e.jsx(te,{label:W,color:Z})}}],[]),A=De({columns:U,data:p,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableColumnPinning:!0,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableRowPinning:!0,enableExpandAll:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},columnVisibility:{id:!0,name:!0,date:!0,cost:!0}},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",enableGlobalFilter:!1,muiPaginationProps:{color:"secondary",rowsPerPageOptions:[10,20,30],shape:"rounded",variant:"outlined"},manualPagination:!0,rowCount:w,onPaginationChange:E,state:{pagination:a},localization:Me,muiTableBodyRowProps:({row:g})=>({onClick:()=>{T("/event/"+g.original.id,{state:{event:g.original}})}}),renderTopToolbarCustomActions:()=>e.jsx(b,{sx:{display:"flex",flexDirection:"row"},children:e.jsx(J,{variant:"contained",onClick:()=>l(!0),sx:{width:"150px"},children:"Crea"})})}),L=()=>{n(r),E(g=>({...g,pageIndex:0}))},N=()=>{z(""),n(""),E(g=>({...g,pageIndex:0})),M.current&&M.current.focus()},j=g=>{const{name:f,value:F}=g.target;v(x=>({...x,[f]:typeof F=="string"?F.split(","):F}))},I=(g,f)=>{v(F=>{let x={...F,[g]:f};return g==="dateFrom"&&x.dateTo&&f&&f>x.dateTo&&(x.dateTo=f),g==="dateTo"&&x.dateFrom&&f&&f<x.dateFrom&&(x.dateFrom=f),x})},D=()=>{v(g=>({...g,dateFrom:null,dateTo:null}))},_=async g=>{g&&(h({message:"Evento creato con successo!",state:"success"}),setAppliedFilters(d)),l(!1)};return e.jsxs(b,{children:[e.jsx(Pe,{}),u&&e.jsx(Fa,{open:u,onClose:_,isEdit:!1}),e.jsxs(b,{sx:{mx:"5%"},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(oa,{sx:{marginRight:"10px"}}),e.jsx(P,{variant:"h4",children:"Lista Eventi"})]}),e.jsxs(c,{container:!0,spacing:2,sx:{mb:2},alignItems:"center",justifyContent:"flex-end",children:[e.jsx(c,{size:{xs:12,sm:2},children:e.jsxs(Q,{fullWidth:!0,children:[e.jsx(ne,{id:"subscription-status-label",children:"Stato iscrizione"}),e.jsx(oe,{labelId:"subscription-status-label",name:"subscriptionStatus",multiple:!0,value:d.subscriptionStatus,onChange:j,input:e.jsx(Ee,{label:"Stato iscrizione"}),variant:"outlined",renderValue:g=>xa.filter(f=>g.includes(f.value)).map(f=>f.label).join(", "),children:xa.map(g=>e.jsx(V,{value:g.value,children:g.label},g.value))})]})}),e.jsx(c,{size:{xs:12,sm:2},children:e.jsx(Q,{fullWidth:!0,children:e.jsx(he,{dateAdapter:He,adapterLocale:Ye,children:e.jsx(ye,{label:"Inizio Iscrizioni",value:d.dateFrom,maxDate:d.dateTo||void 0,onChange:g=>I("dateFrom",g),format:"d MMM yyyy"})})})}),e.jsx(c,{size:{xs:12,sm:2},children:e.jsx(Q,{fullWidth:!0,children:e.jsx(he,{dateAdapter:He,adapterLocale:Ye,children:e.jsx(ye,{label:"Fine Iscrizioni",value:d.dateTo,minDate:d.dateFrom||void 0,onChange:g=>I("dateTo",g),format:"d MMM yyyy"})})})}),(d.dateFrom||d.dateTo)&&e.jsx(c,{size:{xs:12,sm:2},sx:{display:"flex",alignItems:"center"},children:e.jsx(J,{variant:"outlined",color:"secondary",startIcon:e.jsx(We,{}),onClick:D,sx:{height:"100%",minWidth:0,px:1,mr:1},children:"Azzera date"})}),e.jsx(c,{size:{xs:12,sm:2},sx:{ml:"auto"},children:e.jsx(Ee,{inputRef:M,size:"small",placeholder:"Cerca",value:r,onChange:g=>z(g.target.value),onKeyDown:g=>{g.key==="Enter"&&L()},endAdornment:r&&S===r?e.jsx(Y,{"aria-label":"clear",onClick:N,edge:"end",children:e.jsx(We,{})}):e.jsx(Y,{"aria-label":"search",onClick:L,edge:"end",children:e.jsx(na,{})})})})]}),C?e.jsx(ge,{}):e.jsx(Re,{table:A}),y&&e.jsx(Se,{message:y.message,state:y.state})]})]})}function Na({value:p,onChange:m,error:t,helperText:o,label:u="Cerca profilo",required:l=!1,disabled:T=!1,valid_only:y=!0,esner_only:h=!1}){const[a,E]=s.useState([]),[w,i]=s.useState(""),[r,z]=s.useState(!1);s.useEffect(()=>{if(w.length<3){E([]);return}z(!0);const n=setTimeout(async()=>{try{const d=await K("GET",`/profiles/search/?q=${encodeURIComponent(w)}&valid_only=${y}&esner_only=${h}`);if(d.ok){const v=await d.json();E(v.results||[])}}finally{z(!1)}},300);return()=>clearTimeout(n)},[w]);const S=(n,d)=>{const{key:v,...C}=n,R=d.latest_esncard&&d.latest_esncard.number,M=R&&!d.latest_esncard.is_valid;return e.jsx("li",{...C,children:e.jsxs(c,{container:!0,spacing:1,sx:{width:"100%"},children:[e.jsx(c,{size:{xs:4},children:e.jsxs(P,{children:[d.name," ",d.surname]})}),e.jsx(c,{size:{xs:4},children:e.jsx(P,{component:"span",sx:{color:R?M?"error.main":"text.primary":"error.main"},children:R?M?`${d.latest_esncard.number} (Scaduta)`:d.latest_esncard.number:"No ESNcard"})}),e.jsx(c,{size:{xs:4},children:e.jsx(P,{component:"span",sx:{color:d.is_esner?"primary.main":"success.main",fontWeight:"bold",textAlign:"right",display:"block"},children:d.is_esner?"ESNer":"Erasmus"})})]})},v)};return e.jsx(ss,{options:a,loading:r,getOptionLabel:n=>`${n.name}${n.surname?` ${n.surname}`:""}${n.latest_esncard?` (${n.latest_esncard.number})`:""}`,renderOption:S,value:p,onChange:m,onInputChange:(n,d)=>i(d),renderInput:n=>e.jsx(O,{...n,label:u,required:l,error:t,helperText:o}),noOptionsText:"Nessun profilo trovato",loadingText:"Caricamento...",disabled:T})}function Vs({open:p,onClose:m,event:t,listId:o,subscription:u,isEdit:l}){const[T,y]=s.useState(!0),[h,a]=s.useState(null),[E,w]=s.useState([]),[i,r]=s.useState({open:!1,action:null,message:""}),z=l?"Modifica Iscrizione":"Iscrizione Evento",S=l&&u.account_id||null,[n,d]=s.useState({id:"",account_id:"",account_name:"",profile_id:"",profile_name:"",status:"pending",list_id:o||"",list_name:t.lists.find(f=>f.id===o)?.name||"Lista non trovata",notes:""}),[v,C]=s.useState({account_id:[!1,""],account_name:[!1,""],profile_id:[!1,""],profile_name:[!1,""],status:[!1,""],list_id:[!1,""],list_name:[!1,""],notes:[!1,""]}),R=s.useMemo(()=>[{field:"profile_id",value:n?.profile_id,message:"Selezionare un Profilo"},...n?.status==="paid"?[{field:"account_id",value:n?.account_id,message:"Selezionare una Cassa"}]:[]],[n]),[M,U]=s.useState(l?u.status:"pending");s.useEffect(()=>{l&&(console.log("Setting Subscription:",u),d(u),U(u.status)),y(!1),A().then()},[l]);const A=async()=>{try{const f=await K("GET","/accounts/"),F=await f.json();if(f.ok)w(F.results);else{const x=await se(F,f.status);a({message:`Errore durante il recupero delle casse: ${x}`,state:"error"})}}catch(f){a({message:`Errore generale: ${f}`,state:"error"})}},L=()=>{const f={};return Object.keys(v).forEach(F=>{f[F]=[!1,""]}),C(f),f},N=async()=>{let f=!1;const F=L();if(R.forEach(x=>{x.value||(F[x.field]=[!0,x.message],f=!0)}),f){C(F);return}if(n.status==="paid"&&(!l||M!=="paid")||l&&M==="paid"&&n.status!=="paid"){let x="";n.status==="paid"&&(!l||M!=="paid")?x="Confermi di registrare un pagamento di €"+t.cost+" per questa iscrizione?":l&&M==="paid"&&n.status!=="paid"&&(x="Confermi di annullare un pagamento di €"+t.cost+" per questa iscrizione?"),r({open:!0,action:()=>j(),message:x});return}if(n.status==="paid"&&l&&M==="paid"&&n.account_id!==S){r({open:!0,action:()=>j(),message:"Confermi di voler cambiare la cassa associata a questo pagamento? Verranno spostati €"+t.cost+" da "+n.account_name+" a "+E.find(x=>x.id===n.account_id)?.name+"."});return}await j()},j=async()=>{r({open:!1,action:null,message:""});try{const f=await K(l?"PATCH":"POST",`/subscription/${l?n.id+"/":""}`,{profile:n.profile_id,event:t.id,list:n.list_id,account_id:n.account_id||S,notes:n.notes,status:n.status});if(f.ok)m(!0,(l?"Modifica Iscrizione":"Iscrizione")+" completata con successo!");else{const F=await f.json(),x=await se(F,f.status);a({message:`Errore: ${x}`,state:"error"})}}catch(f){a({message:`Errore generale: ${f}`,state:"error"})}},I=async()=>{if(n.status==="paid"){r({open:!0,action:()=>D(),message:"Confermi di voler eliminare un pagamento di €"+t.cost+" per questa iscrizione?"});return}await D()},D=async()=>{if(r({open:!1,action:null,message:""}),!(!l||!n.id))try{const f=await K("DELETE",`/subscription/${n.id}/`);if(f.ok)m(!0,"Eliminazione avvenuta con successo");else{const F=await f.json(),x=await se(F,f.status);a({message:`Errore eliminazione: ${x}`,state:"error"})}}catch(f){a({message:`Errore generale: ${f}`,state:"error"})}},_=f=>{d({...n,[f.target.name]:f.target.value})},g=()=>{d({...n,status:n.status==="paid"?"pending":"paid",...n.status==="paid"?{account_id:""}:{}})};return e.jsx(Ae,{open:p,onClose:()=>{m(!1)},"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(b,{sx:Ne,children:[T?e.jsx(ge,{}):e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(Y,{onClick:()=>m(!1),sx:{minWidth:0},children:e.jsx(_e,{})})}),e.jsx(P,{variant:"h4",component:"h2",gutterBottom:!0,children:z}),e.jsx(Oe,{sx:{mb:2}}),e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Nome Evento:"})," ",t.name]}),e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Lista:"})," ",n.list_name]}),e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Importo:"})," ",t.cost,"€"]}),e.jsxs(c,{container:!0,spacing:2,direction:"column",children:[e.jsx(c,{size:{xs:12},sx:{mt:2},children:e.jsx(Na,{value:n.profile_id?{id:n.profile_id,name:n.profile_name}:null,onChange:(f,F)=>{d({...n,profile_id:F?.id,profile_name:F?`${F.name} ${F.surname}`:""})},error:v.profile_id&&v.profile_id[0],helperText:v.profile_id&&v.profile_id[1]||"Cerca per nome o numero ESNcard",label:l?n.profile_name:"Cerca profilo",required:!0,disabled:l})}),e.jsx(c,{size:{xs:12},children:e.jsxs(Ke,{elevation:1,sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",bgcolor:n.status==="paid"?"#e3f2fd":"inherit",transition:"background-color 0.3s"},children:[e.jsx(P,{variant:"subtitle1",children:"Stato Pagamento"}),e.jsx(Ce,{control:e.jsx(ts,{checked:n.status==="paid",onChange:g,color:"primary"}),label:n.status==="paid"?"Pagato":"In attesa",labelPlacement:"start"})]})}),n.status==="paid"&&e.jsx(c,{size:{xs:12},children:e.jsxs(Q,{fullWidth:!0,required:!0,error:v.account_id&&v.account_id[0],children:[e.jsx(ne,{htmlFor:"account-selector",sx:{mb:2},children:"Seleziona Cassa"}),e.jsx(oe,{variant:"outlined",label:"Seleziona Cassa",labelId:"account-selector-label",id:"account-selector",name:"account_id",value:n.account_id||"",error:v.account_id&&v.account_id[0],onChange:_,children:E.map(f=>e.jsxs(V,{value:f.id,disabled:f.status==="closed",style:{color:f.status==="closed"?"grey":"inherit"},children:[f.name," ",f.status==="closed"?"(Chiusa)":""]},f.id))}),v.account_id&&v.account_id[0]&&e.jsx(Ue,{children:v.account_id[1]})]})}),e.jsx(c,{size:{xs:12},children:e.jsx(O,{label:"Note",name:"notes",value:n.notes,onChange:_,multiline:!0,rows:2,fullWidth:!0})})]}),e.jsx(J,{variant:"contained",fullWidth:!0,sx:{mt:2,bgcolor:n.profile_id?"#1976d2":"#9e9e9e","&:hover":{bgcolor:n.profile_id?"#1565c0":"#757575"}},onClick:N,children:l?"Salva Modifiche":"Conferma"}),l&&e.jsx(J,{variant:"contained",fullWidth:!0,sx:{mt:1,bgcolor:"#d32f2f","&:hover":{bgcolor:"#b71c1c"}},onClick:I,children:"Elimina Iscrizione"}),h&&e.jsx(Se,{message:h.message,state:h.state})]}),e.jsx(la,{open:i.open,message:i.message,onConfirm:i.action,onClose:()=>r({open:!1,action:null,message:""})})]})})}function Hs({open:p,onClose:m,selectedRows:t,event:o,listId:u}){const[l,T]=s.useState(null),[y,h]=s.useState([]),[a,E]=s.useState(""),w=o.lists.find(r=>r.id===u)?.name||"Lista non trovata";s.useEffect(()=>{if(o?.lists){const r=o.lists.filter(z=>z.id!==u);h(r)}},[o,u]);const i=async()=>{if(a)try{const r=await K("POST","/move-subscriptions/",{subscriptionIds:t.map(z=>z.original.id),targetListId:a});if(r.ok)m(!0);else{const z=await r.json(),S=await se(z,r.status);T({message:`Errore: ${S}`,state:"error"})}}catch(r){T({message:`Errore generale: ${r}`,state:"error"})}};return e.jsx(Ae,{open:p,onClose:()=>m(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(b,{sx:Ne,children:[e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(Y,{onClick:()=>m(!1),sx:{minWidth:0},children:e.jsx(_e,{})})}),e.jsxs(P,{variant:"h4",component:"h3",gutterBottom:!0,children:["Sposta ",t.length," ",t.length===1?"iscrizione":"iscrizioni"]}),e.jsxs(P,{variant:"body1",id:"modal-modal-description",gutterBottom:!0,children:["Lista di origine: ",w]}),e.jsxs(Q,{fullWidth:!0,sx:{mt:1},children:[e.jsx(ne,{id:"list-select-label",children:"Lista di destinazione"}),e.jsx(oe,{labelId:"list-select-label",label:"Lista di destinazione",value:a,onChange:r=>E(r.target.value),variant:"outlined",children:y.map(r=>e.jsx(V,{value:r.id,children:r.name},r.id))})]}),e.jsx(J,{variant:"contained",fullWidth:!0,sx:{mt:2,bgcolor:a?"#1976d2":"#9e9e9e","&:hover":{bgcolor:a?"#1565c0":"#757575"}},onClick:i,disabled:!a,children:"Conferma"}),l&&e.jsx(Se,{message:l.message,state:l.state})]})})}function Ys(){const{id:p}=Ze(),m=_s(),t=ve(),[o,u]=s.useState(!1),[l,T]=s.useState(!1),[y,h]=s.useState(!1),[a,E]=s.useState([]),[w,i]=s.useState(!0),[r,z]=s.useState(null),[S,n]=s.useState(null),d=m.state?.event,[v,C]=s.useState(null),[R,M]=s.useState(null),[U,A]=s.useState(null);s.useEffect(()=>{i(!0),(async()=>{try{const X=p||d?.id,ie=await K("GET",`/event/${X}/`),le=await ie.json();if(ie.ok)n(le),console.log("Event Data: ",le);else{const ae=await se(le,ie.status);z({message:`Errore: ${ae}`,state:"error"})}}catch(X){z({message:`Errore generale: ${X}`,state:"error"})}finally{i(!1)}})().then()},[p,d]);const L=async()=>{i(!0);try{const $=await K("GET",`/event/${S.id}/`),X=await $.json();if($.ok)n(X),i(!1);else{const ie=await se(X,$.status);z({message:`Errore: ${ie}`,state:"error"})}}catch($){z({message:`Errore generale: ${$}`,state:"error"})}finally{i(!1)}},N=()=>{u(!0)},j=async $=>{$&&(z({message:"Evento modificato con successo!",state:"success"}),await L()),u(!1)},I=$=>{C($),A(!1),T(!0)},D=async($,X)=>{$&&(z({message:X,state:"success"}),await L()),T(!1),C(null)},_=()=>{if(!S)return{chip:e.jsx(te,{label:"Loading...",variant:"outlined",size:"medium"}),isActive:!1};const $=q(),X=S.subscription_start_date?q(S.subscription_start_date):null,ie=S.subscription_end_date?q(S.subscription_end_date):null;let le="error",ae=!1;X&&ie&&($.isAfter(X)&&$.isBefore(ie)?(le="success",ae=!0):$.isBefore(X)&&(le="warning"));let de=S.subscription_start_date?q(S.subscription_start_date).format("DD/MM/YYYY HH:mm"):"Inizio non specificato",be=S.subscription_end_date?q(S.subscription_end_date).format("DD/MM/YYYY HH:mm"):"Fine non specificata";return{chip:e.jsx(te,{label:de+" - "+be,color:le,variant:"outlined",size:"medium"}),isActive:ae}},g=$=>{console.log("Editing subscription:",$),C(null),M(S.subscriptions.find(X=>X.id===$)||null),A(!0),T(!0)},f=fe.useMemo(()=>S?.lists?S.lists.map($=>{const X=S.subscriptions?.filter(le=>le.list_id===$.id)||[],ie=[{accessorKey:"id",header:"ID",size:50},{accessorKey:"profile_name",header:"Profilo",size:150},{accessorKey:"status",header:"Stato",size:100,Cell:({cell:le})=>{const ae=le.getValue();let de,be;switch(ae){case"paid":de="success",be="PAGATO";break;case"pending":de="warning",be="IN ATTESA";break;case"cancelled":de="error",be="CANCELLATO";break;default:de="default",be=ae}return e.jsx(te,{label:be,color:de,size:"small"})}},{accessorKey:"notes",header:"Note",size:200}];return{listId:$.id,listName:$.name,capacity:$.capacity,subscriptions:X,columns:ie}}):[],[S]),F=fe.useMemo(()=>f.map($=>({...$,tableOptions:{columns:$.columns,data:$.subscriptions,enableStickyHeader:!0,enablePagination:!0,enableRowSelection:!0,display:!1,initialState:{pagination:{pageSize:10,pageIndex:0}},paginationDisplayMode:"pages",localization:Me,renderEmptyRowsFallback:()=>e.jsx(b,{sx:{textAlign:"center",p:2},children:e.jsx(P,{variant:"body1",children:"Nessuna iscrizione presente"})}),muiTablePaginationProps:{labelRowsPerPage:"Righe per pagina:"},renderTopToolbarCustomActions:({table:X})=>{const ie=X.getSelectedRowModel().rows,le=ie.length;return e.jsxs(b,{sx:{display:"flex",gap:1},children:[le>=1&&e.jsxs(e.Fragment,{children:[e.jsx(J,{variant:"outlined",color:"primary",onClick:()=>W(ie,$.listId),children:"Sposta in Altra Lista"}),e.jsx(J,{variant:"outlined",color:"secondary",onClick:()=>ee(ie),children:"Esporta"})]}),le===1&&e.jsx(e.Fragment,{children:e.jsx(J,{variant:"contained",color:"primary",onClick:()=>g(ie[0].original.id),children:"Modifica Iscrizione"})})]})}}})),[f]),x=fe.memo(()=>{if(!F||F.length===0)return e.jsx(P,{children:"Nessuna lista disponibile (aggiungine una per poter iscrivere)"});const{isActive:$}=_();return F.map(X=>{const{listId:ie,listName:le,capacity:ae,subscriptions:de,tableOptions:be}=X,ke=Math.round(de.length/ae*100)||0,Qe=ke>=90?"error":ke>=60?"warning":"success",k={...be,paginationDisplayMode:"pages"},G=De(k);return e.jsxs(rs,{sx:{mt:2},children:[e.jsx(ns,{children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(os,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",sx:{flexGrow:1},children:le}),e.jsxs(b,{sx:{display:"flex",alignItems:"center",cursor:de.length<ae&&$?"pointer":"not-allowed",opacity:de.length<ae&&$?1:.5,px:2,py:1,borderRadius:1,bgcolor:"primary.main",color:"white",ml:2},onClick:de.length<ae&&$?()=>I(ie):void 0,children:[e.jsx(is,{sx:{mr:1}})," ISCRIVI"]}),e.jsxs(b,{sx:{width:"200px",ml:2},children:[e.jsx(b,{sx:{display:"flex",justifyContent:"space-between"},children:e.jsxs(P,{variant:"body2",children:[de.length,"/",ae]})}),e.jsx(ls,{variant:"determinate",value:ke,color:Qe,sx:{height:8,borderRadius:5}})]})]})}),e.jsx(cs,{children:e.jsx(Re,{table:G})})]},ie)})}),W=($,X)=>{console.log("Moving selected rows to another list:",$),E($),C(X),h(!0)},Z=$=>{$&&(z({message:"Spostamento effettuato con successo!",state:"success"}),L().then()),h(!1)},ee=$=>{console.log("Exporting selected rows:",$)};return e.jsxs(b,{children:[e.jsx(Pe,{}),o&&e.jsx(Fa,{open:o,onClose:j,event:{...S,date:S.date?q(S.date):null,subscription_start_date:S.subscription_start_date?q(S.subscription_start_date):null,subscription_end_date:S.subscription_end_date?q(S.subscription_end_date):null},isEdit:!0}),l&&e.jsx(Vs,{open:l,onClose:D,event:S,listId:v,subscription:R,isEdit:U}),y&&e.jsx(Hs,{open:y,onClose:Z,selectedRows:a,event:S,listId:v}),e.jsxs(b,{sx:{mx:"5%"},children:[w?e.jsx(ge,{}):e.jsxs(e.Fragment,{children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(Y,{onClick:()=>{t(-1)},sx:{mr:2},children:e.jsx(Je,{})}),e.jsx(oa,{sx:{marginRight:"10px"}}),e.jsxs(P,{variant:"h4",children:["Evento - ",S.name]})]}),e.jsx(qe,{elevation:3,sx:{mt:5,mb:4,borderRadius:2,overflow:"hidden"},children:e.jsx(Ia,{children:e.jsxs(c,{container:!0,spacing:3,children:[e.jsxs(c,{size:{xs:12,md:4},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ds,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",children:"Data"})]}),e.jsx(P,{variant:"body1",color:"text.secondary",sx:{mt:2},children:S.date?q(S.date).format("DD/MM/YYYY"):"Data non specificata"})]}),e.jsxs(c,{size:{xs:12,md:4},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(us,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",children:"Costo"})]}),e.jsx(P,{variant:"body1",color:"text.secondary",sx:{mt:2},children:S.cost!==0?`€ ${S.cost}`:"Gratuito"})]}),e.jsxs(c,{size:{xs:12,md:4},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ms,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",children:"Periodo Iscrizioni"})]}),e.jsx(b,{sx:{display:"flex",alignItems:"center",mt:2},children:_().chip})]}),e.jsxs(c,{size:{xs:12},children:[e.jsx(Oe,{sx:{my:1}}),e.jsxs(b,{sx:{display:"flex",alignItems:"center",mt:2},children:[e.jsx(ps,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",children:"Descrizione"})]}),e.jsx("div",{"data-color-mode":"light",style:{marginTop:10},children:e.jsx(Ra,{value:S.description||"Nessuna descrizione disponibile",readOnly:!0})})]}),e.jsxs(c,{size:{xs:12},children:[e.jsx(Oe,{sx:{my:1}}),e.jsxs(b,{sx:{display:"flex",alignItems:"center",mt:2},children:[e.jsx(Be,{sx:{color:"primary.main",mr:1}}),e.jsx(P,{variant:"h6",component:"div",children:"Azioni"})]}),e.jsx(J,{sx:{mt:2},variant:"contained",color:"primary",onClick:N,children:"Modifica Evento"})]}),e.jsxs(c,{size:{xs:12},children:[e.jsx(Oe,{sx:{my:1}}),e.jsxs(b,{sx:{mt:2},children:[e.jsx(P,{variant:"h6",component:"div",sx:{mb:2},children:"Liste"}),e.jsx(x,{})]})]})]})})})]}),r&&e.jsx(Se,{message:r.message,state:r.state})]})]})}function Ie({children:p,requiredPermission:m}){const{accessToken:t,user:o,loading:u}=Le(),l=ve();return s.useEffect(()=>{!u&&(!t||m&&!o?.permissions.includes(m))&&(console.log("Redirecting to login..."),l("/login",{replace:!0}))},[u,t,o,m,l]),u?e.jsx("div",{children:"Loading..."}):!t||m&&!o?.permissions.includes(m)?null:p}function Us(){const{uid:p,token:m}=Ze(),[t,o]=s.useState({message:"",state:"loading"});return s.useEffect(()=>{p&&m?(async()=>{try{const l=await K("GET",`/api/profile/verify-email/${p}/${m}/`,null,{},!1),T=await l.json();if(l.ok)o({message:T.message,state:"success"});else{const y=se(T,l.status);o({message:y,state:"error"})}}catch(l){o({message:`General error: ${l}`,state:"error"})}})().then():o({message:"Invalid verification link",state:"error"})},[p,m]),e.jsx(ra,{maxWidth:"sm",children:e.jsxs(b,{sx:{mt:8,display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",p:3,borderRadius:2,boxShadow:3,bgcolor:"background.paper"},children:[e.jsx(P,{variant:"h4",component:"h1",gutterBottom:!0,children:"Email Verification"}),e.jsx(Fe,{message:t.message,state:t.state,loadingText:"Verifying your email address..."})]})})}function Js(){const{uid:p,token:m}=Ze(),t=ve(),[o,u]=s.useState(""),[l,T]=s.useState(""),[y,h]=s.useState(null),[a,E]=s.useState(!1),w=async()=>{if(o!==l){h({message:"Le password non coincidono.",state:"error"});return}try{const i=await K("POST",`/api/reset-password/${p}/${m}/`,{password:o,confirm_password:l},{},!1);if(i.ok)E(!0),h({message:"Password reimpostata con successo!",state:"success"});else{const r=await i.json(),z=await se(r,i.status);h({message:`Errore durante il reset della password: ${z}`,state:"error"})}}catch(i){h({message:`Errore generale: ${i}`,state:"error"})}};return e.jsx(ra,{maxWidth:"xs",children:e.jsxs(b,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("img",{alt:"",src:ia,style:{height:"25vh"}}),e.jsx(P,{style:{marginTop:10},variant:"h5",children:"Reimposta Password"}),y&&e.jsx(Fe,{message:y.message,state:y.state}),!a&&e.jsxs(e.Fragment,{children:[e.jsx(O,{margin:"normal",required:!0,fullWidth:!0,label:"Nuova Password",type:"password",onChange:i=>u(i.target.value)}),e.jsx(O,{margin:"normal",required:!0,fullWidth:!0,label:"Conferma Password",type:"password",onChange:i=>T(i.target.value)}),e.jsx(J,{fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},onClick:w,children:"Reimposta Password"})]}),a&&e.jsx(je,{component:"button",variant:"body2",sx:{textAlign:"center"},onClick:()=>t("/login"),children:"Vai al Login"})]})})}function Zs({open:p,onClose:m,transaction:t}){const[o,u]=s.useState(!0),[l,T]=s.useState([]),[y,h]=s.useState(null),[a,E]=s.useState({executor:null,account:"",amount:"",description:"",type:""}),[w,i]=s.useState({executor:[!1,""],account:[!1,""],amount:[!1,""],description:[!1,""]});s.useEffect(()=>{console.log("TransactionModal useEffect",t),u(!0),Promise.all([K("GET","/accounts/")]).then(async([d])=>{const v=d.ok?await d.json():{results:[]};T(v.results||[]),t&&E({executor:t.executor||null,account:t.account?.id||"",amount:t.amount||"",description:t.description||"",type:t.type||""})}).finally(()=>u(!1))},[p,t]);const r=d=>{const{name:v,value:C}=d.target;E(R=>({...R,[v]:C}))},z=()=>{let d=!1;const v={...w};return a.executor?v.executor=[!1,""]:(v.executor=[!0,"Seleziona un Esecutore"],d=!0),a.account?v.account=[!1,""]:(v.account=[!0,"Seleziona una Cassa"],d=!0),!a.amount||isNaN(Number(a.amount))?(v.amount=[!0,"Inserisci un importo valido"],d=!0):v.amount=[!1,""],i(v),!d},S=async d=>{if(d.preventDefault(),!!z()){u(!0);try{const v={executor:a.executor.id||a.executor.email,account:a.account,amount:parseFloat(a.amount),description:a.description},C=await K("PATCH",`/transaction/${t.id}/`,v);if(C.ok)m(!0);else{const R=await C.json(),M=await se(R,C.status);h({message:`Errore: ${M}`,state:"error"})}}catch(v){h({message:`Errore generale: ${v}`,state:"error"})}finally{u(!1)}}},n=()=>m(!1);return e.jsx(Ae,{open:p,onClose:n,children:e.jsx(b,{sx:Ne,component:"form",onSubmit:S,noValidate:!0,children:o?e.jsx(ge,{}):e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(Y,{onClick:n,sx:{minWidth:0},children:e.jsx(_e,{})})}),e.jsx(P,{variant:"h5",gutterBottom:!0,align:"center",sx:{mb:2},children:"Modifica Transazione"}),y&&e.jsx(Se,{message:y.message,state:y.state}),e.jsxs(c,{container:!0,spacing:2,sx:{mt:2},children:[e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Tipo:"})," ",re.tran_type[a.type]||"Non specificato"]}),e.jsx(c,{size:{xs:12},children:e.jsx(Na,{value:a.executor,onChange:(d,v)=>{E({...a,executor:v})},error:w.executor[0],helperText:w.executor[0]?w.executor[1]:"Cerca per nome o numero ESNcard",label:re.executor,esner_only:!0,required:!0})}),e.jsx(c,{size:{xs:12},children:e.jsxs(Q,{fullWidth:!0,required:!0,error:w.account[0],children:[e.jsx(ne,{id:"account-label",children:re.account}),e.jsx(oe,{labelId:"account-label",name:"account",variant:"outlined",value:a.account,onChange:r,input:e.jsx(Ee,{label:re.account}),children:l.map(d=>e.jsx(V,{value:d.id,children:d.name},d.id))}),w.account[0]&&e.jsx(Ue,{children:w.account[1]})]})}),e.jsx(c,{size:{xs:12},children:e.jsx(O,{label:re.amount,name:"amount",value:a.amount,onChange:r,required:!0,fullWidth:!0,error:w.amount[0],type:"number",slotProps:{htmlInput:{min:"0.01",step:"0.01"}}})}),e.jsx(c,{size:{xs:12},children:e.jsx(O,{label:"Descrizione",name:"description",value:a.description,onChange:r,fullWidth:!0,multiline:!0,rows:3})})]}),e.jsx(b,{mt:2,children:e.jsx(J,{fullWidth:!0,variant:"contained",color:"primary",type:"submit",children:"Salva Modifiche"})})]})})})}const Oa={subscription:{label:re.tran_type.subscription,color:"primary"},esncard:{label:re.tran_type.esncard,color:"secondary"},deposit:{label:re.tran_type.deposit,color:"success"},withdrawal:{label:re.tran_type.withdrawal,color:"error"}},fa=[{value:"",label:"Tutti"},...Object.entries(Oa).map(([p,m])=>({value:p,label:m.label,color:m.color}))];function Qs(){const[p,m]=s.useState(!0),[t,o]=s.useState([]),[u,l]=s.useState([]),T=ve(),[y,h]=s.useState(null),[a,E]=s.useState(!1),[w,i]=s.useState(null),[r,z]=s.useState({pageIndex:0,pageSize:10}),[S,n]=s.useState(0),[d,v]=s.useState({account:[],type:[],dateFrom:null,dateTo:null}),[C,R]=s.useState(""),[M,U]=s.useState(""),A=s.useRef(null);s.useEffect(()=>{L().then()},[r.pageIndex,r.pageSize,d,M]);const L=async()=>{m(!0);try{const x=new URLSearchParams;x.append("page",r.pageIndex+1),x.append("page_size",r.pageSize),M&&x.append("search",M),d.account.length&&d.account.forEach(X=>x.append("account",X)),d.type.length&&d.type.forEach(X=>x.append("type",X)),d.dateFrom&&x.append("dateFrom",d.dateFrom.toISOString()),d.dateTo&&x.append("dateTo",d.dateTo.toISOString());const[W,Z]=await Promise.all([K("GET",`/transactions/?${x.toString()}`),K("GET","/accounts/")]),ee=W.ok?await W.json():{results:[]},$=Z.ok?await Z.json():{results:[]};n(ee.count||0),o(ee.results||[]),l($.results||[])}finally{m(!1)}},N=s.useMemo(()=>[{accessorKey:"created_at",header:re.date,size:120,Cell:({cell:x})=>{const W=new Date(x.getValue());return new Intl.DateTimeFormat("it-IT",{dateStyle:"medium",timeStyle:"short"}).format(W)}},{accessorKey:"type",header:re.type,size:100,Cell:({cell:x})=>{const W=x.getValue(),Z=Oa[W]||{label:"Sconosciuto",color:"default"};return e.jsx(te,{label:Z.label,color:Z.color,variant:"outlined"})}},{accessorKey:"executor.name",header:re.executor,size:150},{accessorKey:"account.name",header:re.account,size:120,Cell:({cell:x})=>e.jsx(b,{component:"span",fontWeight:"bold",children:x.getValue()})},{accessorKey:"amount",header:re.amount,size:100,Cell:({cell:x})=>e.jsx(b,{children:x.getValue()!==null?e.jsx(te,{label:`€${x.getValue()}`,color:"primary"}):e.jsx(te,{label:"N/A",color:"warning"})})},{accessorKey:"description",header:re.description,size:200,Cell:({cell:x})=>e.jsx(b,{component:"span",fontStyle:"italic",children:x.getValue()})}],[]),j=De({columns:N,data:t,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableExpandAll:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},sorting:[{id:"created_at",desc:!0}]},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",enableGlobalFilter:!1,muiPaginationProps:{color:"secondary",rowsPerPageOptions:[10,20,30],shape:"rounded",variant:"outlined"},manualPagination:!0,rowCount:S,onPaginationChange:z,state:{pagination:r},localization:Me,muiTableBodyRowProps:({row:x})=>({onClick:()=>{i(x.original),E(!0)},sx:{cursor:"pointer"}})}),I=()=>{U(C),z(x=>({...x,pageIndex:0}))},D=()=>{R(""),U(""),z(x=>({...x,pageIndex:0})),A.current&&A.current.focus()},_=async x=>{x&&(h({message:"Transazione modificata con successo!",state:"success"}),await L()),i(null),E(!1)},g=(x,W)=>{v(Z=>{let ee={...Z,[x]:W};return x==="dateFrom"&&ee.dateTo&&W&&W>ee.dateTo&&(ee.dateTo=W),x==="dateTo"&&ee.dateFrom&&W&&W<ee.dateFrom&&(ee.dateFrom=W),ee})},f=x=>{const{name:W,value:Z}=x.target;v(ee=>{let $={...ee,[W]:Z};return(W==="account"||W==="type")&&($[W]=typeof Z=="string"?Z.split(","):Z),$})},F=()=>{v(x=>({...x,dateFrom:null,dateTo:null}))};return e.jsxs(b,{children:[e.jsx(Pe,{}),a&&e.jsx(Zs,{open:a,onClose:_,transaction:w}),e.jsxs(b,{sx:{mx:"5%"},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(Y,{onClick:()=>T(-1),sx:{mr:2},children:e.jsx(Je,{})}),e.jsx(P,{variant:"h4",children:"Lista Transazioni"})]}),e.jsxs(c,{container:!0,spacing:2,sx:{mb:2,mt:4},alignItems:"center",children:[e.jsx(c,{size:{xs:12,sm:2},children:e.jsxs(Q,{fullWidth:!0,children:[e.jsx(ne,{id:"account-label",children:"Cassa"}),e.jsx(oe,{labelId:"account-label",name:"account",multiple:!0,value:d.account,onChange:f,input:e.jsx(Ee,{label:"Cassa"}),variant:"outlined",renderValue:x=>u.filter(W=>x.includes(W.id)).map(W=>W.name).join(", "),children:u.map(x=>e.jsx(V,{value:x.id,children:x.name},x.id))})]})}),e.jsx(c,{size:{xs:12,sm:2},children:e.jsxs(Q,{fullWidth:!0,children:[e.jsx(ne,{id:"type-label",children:"Tipo"}),e.jsx(oe,{labelId:"type-label",name:"type",multiple:!0,value:d.type,onChange:f,input:e.jsx(Ee,{label:"Tipo"}),variant:"outlined",renderValue:x=>fa.filter(W=>x.includes(W.value)&&W.value).map(W=>W.label).join(", "),children:fa.filter(x=>x.value).map(x=>e.jsx(V,{value:x.value,children:x.label},x.value))})]})}),e.jsx(c,{size:{xs:12,sm:2},children:e.jsx(Q,{fullWidth:!0,children:e.jsx(he,{dateAdapter:He,adapterLocale:Ye,children:e.jsx(ye,{label:"Da",value:d.dateFrom,maxDate:d.dateTo||void 0,onChange:x=>g("dateFrom",x),format:"d MMM yyyy"})})})}),e.jsx(c,{size:{xs:12,sm:2},children:e.jsx(Q,{fullWidth:!0,children:e.jsx(he,{dateAdapter:He,adapterLocale:Ye,children:e.jsx(ye,{label:"A",value:d.dateTo,minDate:d.dateFrom||void 0,onChange:x=>g("dateTo",x),format:"d MMM yyyy"})})})}),(d.dateFrom||d.dateTo)&&e.jsx(c,{size:{xs:12,sm:2},sx:{display:"flex",alignItems:"center"},children:e.jsx(J,{variant:"outlined",color:"secondary",startIcon:e.jsx(We,{}),onClick:F,sx:{height:"100%",minWidth:0,px:1},children:"Azzera date"})}),e.jsx(c,{size:{xs:12,sm:2},sx:{ml:"auto"},children:e.jsx(Q,{fullWidth:!0,children:e.jsx(Ee,{inputRef:A,size:"small",placeholder:"Cerca",value:C,onChange:x=>R(x.target.value),onKeyDown:x=>{x.key==="Enter"&&I()},endAdornment:C&&M===C?e.jsx(Y,{"aria-label":"clear",onClick:D,edge:"end",children:e.jsx(We,{})}):e.jsx(Y,{"aria-label":"search",onClick:I,edge:"end",children:e.jsx(na,{})})})})})]}),p?e.jsx(ge,{}):e.jsx(Re,{sx:{mt:2},table:j}),y&&e.jsx(Se,{message:y.message,state:y.state})]})]})}const Xs=({onEdit:p,onCancel:m,onSave:t,saving:o})=>{const[u,l]=s.useState(!1),[T,y]=s.useState(!1),h=()=>{y(!0),p&&p()},a=()=>{o||(y(!1),m&&m())},E=async()=>{l(!0);try{t?await t()!==!1&&y(!1):y(!1)}catch(w){console.error("Error during save:",w)}finally{l(!1)}};return e.jsx("div",{children:T?e.jsxs(b,{sx:{display:"inline-flex"},children:[e.jsx(Y,{onClick:a,"aria-label":"Cancel",disabled:o||u,children:e.jsx(hs,{})}),o||u?e.jsx(Y,{disabled:!0,children:e.jsx($e,{size:"1rem"})}):e.jsx(Y,{onClick:E,"aria-label":"Save",sx:{color:"#0288d1"},children:e.jsx(xs,{})})]}):e.jsx(Y,{onClick:h,"aria-label":"Edit",children:e.jsx(Be,{})})})};function ga({cols:p,initialData:m,title:t,onSave:o,onDelete:u,onCreate:l,createText:T,canCreate:y,canDelete:h,canEdit:a,sortColumn:E}){const w=s.useMemo(()=>p,[p]),[i,r]=s.useState([]),n=a?e.jsx("span",{style:{color:"green"},children:"(Hai i permessi per eseguire modifiche)"}):e.jsx("span",{style:{color:"red"},children:"(Non hai i permessi per eseguire modifiche)"});s.useEffect(()=>{r(m)},[m]);const d=De({columns:w,data:i,enableEditing:a,editDisplayMode:"row",createDisplayMode:"row",enableColumnFilters:!1,enableGlobalFilter:!1,enableSorting:E!=null,enableFullScreenToggle:!1,enableColumnOrdering:!1,enableColumnActions:!1,enableDensityToggle:!1,enableHiding:!1,enablePagination:!1,localization:Me,initialState:{sorting:[{id:E,desc:!0}]},onCreatingRowSave:async({values:v,table:C})=>{let R=await l(v);R&&(r([...i,R]),C.setCreatingRow(!1))},onEditingRowSave:async({row:v,values:C})=>{if(await o(v.original,C)){const R=i.map((M,U)=>U===v.index?{...v.original,...C}:M);r(R),console.log(R),d.setEditingRow(null)}},getRowId:v=>v.id,renderRowActions:({row:v,table:C})=>e.jsxs(b,{sx:{display:"flex"},children:[e.jsx(Ve,{title:"Modifica",children:e.jsx(Y,{onClick:()=>C.setEditingRow(v),children:e.jsx(Be,{})})}),h&&e.jsx(Ve,{title:"Elimina",children:e.jsxs(Y,{onClick:async()=>{await u(v.original),r(i.filter(R=>R.id!==v.id))},children:[" ",e.jsx(za,{})]})})]}),renderTopToolbarCustomActions:({table:v})=>e.jsxs(b,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsxs(b,{sx:{ml:3},children:[e.jsx("h3",{children:t}),e.jsx("h5",{children:n})]}),T!=null?e.jsx(J,{variant:"contained",color:"primary",onClick:l,sx:{ml:"auto",mr:2,visibility:y?"visible":"hidden"},children:T}):e.jsx(Y,{sx:{ml:"auto",mr:2,visibility:y?"visible":"hidden"},onClick:()=>{v.setCreatingRow(!0)},children:e.jsx(fs,{})})]})});return e.jsx(Re,{table:d})}function et({open:p,profile:m,onClose:t}){const[o,u]=s.useState(0),[l,T]=s.useState(null),[y,h]=s.useState({open:!1,action:null,message:""}),[a,E]=s.useState(!0),[w,i]=s.useState([]),[r,z]=s.useState({esncard_number:"",account_id:""}),[S,n]=s.useState({esncard_number:[!1,""],account_id:[!1,""]}),d=[{field:"esncard_number",value:r.esncard_number,message:"Inserire il numero di ESNcard"},{field:"account_id",value:r.account_id,message:"Selezionare una Cassa"}];s.useEffect(()=>{E(!0),C().then(),v().then()},[]);const v=async()=>{try{const L=await K("GET","/esncard_fees/"),N=await L.json();if(L.ok)console.log("ESNcard fees:",N),m.latest_esncard&&m.latest_esncard?.is_valid?u(parseFloat(N.esncard_lost_fee.replace("€",""))):u(parseFloat(N.esncard_release_fee.replace("€","")));else{const j=await se(N,L.status);T({message:`Errore fees ESNcard: ${j}`,state:"error"})}}catch(L){T({message:`Errore generale: ${L}`,state:"error"})}finally{E(!1)}},C=async()=>{try{const L=await K("GET","/accounts/"),N=await L.json();if(L.ok)i(N.results);else{const j=await se(N,L.status);T({message:`Errore durante il recupero delle casse: ${j}`,state:"error"})}}catch(L){T({message:`Errore generale: ${L}`,state:"error"})}},R=()=>{const L={};return Object.keys(S).forEach(N=>{L[N]=[!1,""]}),n(L),L},M=async()=>{let L=!1;const N=R();if(d.forEach(I=>{I.value||(N[I.field]=[!0,I.message],L=!0)}),L){n(N);return}let j="Confermi un pagamento di "+o+"€ per l'emissione della ESNcard?";h({open:!0,action:()=>U(),message:j})},U=async()=>{h({open:!1,action:null,message:""});try{const L=await K("POST","/esncard_emission/",{profile_id:m.id,account_id:r.account_id,esncard_number:r.esncard_number,amount:o});if(L.ok)t(!0);else{const N=await L.json(),j=await se(N,L.status);T({message:`Errore durante l'emissione della ESNcard: ${j}`,state:"error"})}}catch(L){T({message:`Errore generale: ${L}`,state:"error"})}},A=L=>{z({...r,[L.target.name]:L.target.value})};return e.jsx(Ae,{open:p,onClose:()=>{t(!1)},"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsx(b,{sx:Ne,children:a?e.jsx(ge,{}):e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(Y,{onClick:()=>t(!1),sx:{minWidth:0},children:e.jsx(_e,{})})}),e.jsx(P,{variant:"h4",component:"h2",gutterBottom:!0,children:"Emissione ESNcard"}),e.jsx(Oe,{sx:{mb:2}}),e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"A:"})," ",m.name," ",m.surname]}),e.jsxs(P,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Importo:"})," ",o,"€"]}),e.jsxs(c,{container:!0,spacing:2,direction:"column",children:[e.jsx(c,{size:{xs:12},sx:{mt:2},children:e.jsx(O,{required:!0,label:"Numero ESNcard",name:"esncard_number",value:r.esncard_number,error:S.esncard_number[0],helperText:S.esncard_number[1],onChange:A,fullWidth:!0})}),e.jsx(c,{size:{xs:12},sx:{mt:0},children:e.jsxs(Q,{fullWidth:!0,required:!0,error:S.account_id[0],children:[e.jsx(ne,{htmlFor:"account-selector",sx:{mb:2},children:"Seleziona Cassa"}),e.jsx(oe,{variant:"outlined",label:"Seleziona Cassa",labelId:"account-selector-label",id:"account-selector",name:"account_id",value:r.account_id,error:S.account_id[0],onChange:A,children:w.map(L=>e.jsxs(V,{value:L.id,disabled:L.status==="closed",style:{color:L.status==="closed"?"grey":"inherit"},children:[L.name," ",L.status==="closed"?"(Chiusa)":""]},L.id))}),S.account_id[0]&&e.jsx(Ue,{children:S.account_id[1]})]})})]}),e.jsx(J,{variant:"contained",fullWidth:!0,sx:{mt:2},onClick:M,children:"Conferma"}),l&&e.jsx(Se,{message:l.message,state:l.state}),e.jsx(la,{open:y.open,message:y.message,onConfirm:y.action,onClose:()=>h({open:!1,action:null,message:""})})]})})})}const at={ESNer:{hideFields:["course","matricola_expiration","whatsapp_prefix","whatsapp_number"]},Erasmus:{hideFields:["group"]}};function st(){const{user:p}=Le(),{id:m}=Ze(),[t,o]=s.useState(!1),[u,l]=s.useState(!0),[T,y]=s.useState(null),[h,a]=s.useState(null),[E,w]=s.useState(!1),[i,r]=s.useState({}),[z,S]=s.useState({}),[n,d]=s.useState([]),[v,C]=s.useState(null),R=ve(),[M,U]=s.useState({email:"",name:"",surname:"",birthdate:"",country:"",phone_prefix:"",phone_number:"",whatsapp_prefix:"",whatsapp_number:"",person_code:"",domicile:"",course:"",matricola_number:"",matricola_expiration:"",documents:[],esncards:[],group:""}),[A,L]=s.useState({email:"",name:"",surname:"",birthdate:"",country:"",phone_prefix:"",phone_number:"",whatsapp_prefix:"",whatsapp_number:"",person_code:"",domicile:"",course:"",matricola_number:"",matricola_expiration:"",group:""}),[N,j]=s.useState({email:[!1,""],name:[!1,""],surname:[!1,""],birthdate:[!1,""],country:[!1,""],phone_prefix:[!1,""],phone_number:[!1,""],whatsapp_prefix:[!1,""],whatsapp_number:[!1,""],person_code:[!1,""],domicile:[!1,""],course:[!1,""],matricola_number:[!1,""],matricola_expiration:[!1,""],group:[!1,""]}),[I,D]=s.useState({email:!0,name:!0,surname:!0,birthdate:!0,country:!0,phone_prefix:!0,phone_number:!0,whatsapp_prefix:!0,whatsapp_number:!0,person_code:!0,domicile:!0,course:!0,matricola_number:!0,matricola_expiration:!0,group:!0});s.useEffect(()=>{l(!0),(async()=>{try{const G=await K("GET",`/profile/${m}/`),H=await G.json();if(G.ok){const ce={};Object.keys(M).map(ue=>{ce[ue]=H[ue]}),U(ce),L(ce),y(H),C(H.is_esner?"ESNer":"Erasmus")}else{const ce=await se(H,G.status);a({message:`Errore: ${ce}`,state:"error"})}}catch(G){a({message:`Errore generale: ${G}`,state:"error"})}finally{l(!1)}})().then()},[]),s.useEffect(()=>{(async()=>{try{const G=await K("GET","/groups/"),H=await G.json();G.ok?d(H):a({message:`Errore nel recupero dei gruppi: ${await se(H,G.status)}`,state:"error"})}catch(G){console.error("Error fetching groups:",G),a({message:`Errore generale: ${G}`,state:"error"})}})().then()},[]);const _=at[v]||{hideFields:[]},g=k=>_.hideFields.includes(k),f=async()=>{try{const k=await K("GET",`/profile/${T.id.toString()}/`),G=await k.json();if(k.ok)U(G),L(G),y(G);else{const H=await se(G,k.status);a({message:`Errore: ${H}`,state:"error"})}}catch(k){a({message:`Errore generale: ${k}`,state:"error"})}},F=()=>{w(!0)},x=async k=>{k&&(a({message:"ESNcard emessa con successo!",state:"success"}),await f()),w(!1)},W=s.useMemo(()=>[{accessorKey:"number",header:"Numero",size:100,muiEditTextFieldProps:{required:!0,helperText:i?.number,error:!!i?.number}},{accessorKey:"created_at",enableEditing:!1,header:"Rilascio",size:100,Cell:({cell:k})=>{const G=new Date(k.getValue());return G==null?"Null":G.toISOString().split("T")[0]}},{accessorKey:"expiration",enableEditing:!1,header:"Scadenza",size:100,Cell:({cell:k})=>{const ce=new Date(k.getValue())<new Date;return e.jsx("span",{style:{color:ce?"orange":"green"},children:k.getValue()})}}],[]),Z=async(k,G)=>{try{const H=await K("PATCH",`/esncard/${k.id}/`,G);if(H.ok)return r({}),a({message:"ESNcard aggiornata con successo!",state:"success"}),await f(),!0;{const ce=await H.json(),ue=await se(ce,H.status);return a({message:`Errore: ${ue}`,state:"error"}),!1}}catch(H){a({message:`Errore generale: ${H}`,state:"error"})}},ee=s.useMemo(()=>[{accessorKey:"type",header:"Tipo",size:100,editVariant:"select",editSelectOptions:["Passport","ID Card","Driving License","Residency Permit","Other"],muiEditTextFieldProps:{select:!0,helperText:z?.type,error:!!z?.type}},{accessorKey:"number",header:"Numero",size:60,muiEditTextFieldProps:{required:!0,helperText:z?.number,error:!!z?.number}},{accessorKey:"expiration",header:"Scadenza",size:60,muiEditTextFieldProps:{required:!0,helperText:z?.expiration,error:!!z?.expiration,type:"date"},Cell:({cell:k})=>{const ce=new Date(k.getValue())<new Date;return e.jsx("span",{style:{color:ce?"orange":"green"},children:k.getValue()})}}],[]),$=async k=>{try{const G=await K("DELETE",`/document/${k.id}/`);if(G.ok)return S({}),a({message:"Documento eliminato con successo!",state:"success"}),await f(),!0;{G.json().then(ue=>S(ue));const H=await G.json(),ce=await se(H,G.status);a({message:`Errore: ${ce}`,state:"error"})}}catch(G){a({message:`Errore generale: ${G}`,state:"error"})}},X=async k=>{let G={...k,profile:T.id};try{const H=await K("POST","/document/",G);if(H.ok)return S({}),a({message:"Documento aggiunto con successo!",state:"success"}),await f(),!0;{H.json().then(Xe=>S(Xe));const ce=await H.json(),ue=await se(ce,H.status);return a({message:`Errore: ${ue}`,state:"error"}),!1}}catch(H){return a({message:`Errore generale: ${H}`,state:"error"}),!1}},ie=async(k,G)=>{try{const H=await K("PATCH",`/document/${k.id}/`,G);if(H.ok)return S({}),a({message:"Documento aggiornato con successo!",state:"success"}),await f(),!0;{H.json().then(Xe=>S(Xe));const ce=await H.json(),ue=await se(ce,H.status);return a({message:`Errore: ${ue}`,state:"error"}),!1}}catch(H){return a({message:`Errore generale: ${H}`,state:"error"}),!1}},le=k=>k?q(k).format("YYYY-MM-DD"):null,ae=k=>{L({...A,[k.target.name]:k.target.value})},de=(k,G)=>{L({...A,[k]:G})},be=()=>{const k={};Object.keys(N).forEach(G=>{k[G]=[!1,""]}),j(k)},ke=k=>{D(Object.fromEntries(Object.keys(I).map(G=>[G,!k]))),be()},Qe=async()=>{if(o(!0),A.matricola_number&&!/^\d{6}$/.test(A.matricola_number))return j(k=>({...k,matricola_number:[!0,"La Matricola deve essere composta da 6 cifre"]})),o(!1),!1;try{const k={...A,birthdate:le(A.birthdate),matricola_expiration:le(A.matricola_expiration)},G=await K("PATCH",`/profile/${T.id.toString()}/`,k);if(G.ok)await f(),M&&(be(),a({message:"Profilo aggiornato con successo!",state:"success"}),ke(!1));else{const H=await G.json(),ce=Object.fromEntries(Object.keys(N).map(ue=>ue in H?[ue,[!0,H[ue]]]:[ue,[!1,""]]));j(ce)}}catch(k){L(M),a({message:`Errore generale: ${k}`,state:"error"}),ke(!1)}finally{o(!1)}};return e.jsxs(b,{children:[e.jsx(Pe,{}),u?e.jsx(ge,{}):e.jsx(e.Fragment,{children:e.jsxs(b,{sx:{mx:"5%"},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(Y,{onClick:()=>R(-1),sx:{mr:2},children:e.jsx(Je,{})}),e.jsxs(P,{variant:"h4",children:["Profilo ",v]})]}),e.jsx(qe,{sx:{p:"20px"},children:e.jsxs(c,{container:!0,spacing:2,children:[e.jsxs(c,{container:!0,size:{xs:12},alignItems:"center",children:[e.jsx(ta,{}),e.jsx(P,{variant:"h6",sx:{m:0},children:"Informazioni Personali"}),e.jsx(c,{sx:{marginLeft:"auto"},children:e.jsx(Xs,{onEdit:()=>ke(!0),onCancel:()=>{ke(!1),L(M)},saving:t,onSave:Qe})})]}),!g("name")&&e.jsx(c,{size:{xs:12,md:3},children:e.jsx(O,{label:B.name,name:"name",value:A.name,error:N.name[0],helperText:N.name[1],slotProps:{input:{readOnly:I.name}},onChange:ae,sx:{backgroundColor:I.name?"grey.200":"white"},fullWidth:!0})}),!g("surname")&&e.jsx(c,{size:{xs:12,md:3},children:e.jsx(O,{label:B.surname,name:"surname",value:A.surname,error:N.surname[0],helperText:N.surname[1],onChange:ae,slotProps:{input:{readOnly:I.surname}},sx:{backgroundColor:I.surname?"grey.200":"white"},fullWidth:!0})}),!g("email")&&e.jsx(c,{size:{xs:12,md:3},children:e.jsx(O,{label:B.email,name:"email",type:"email",value:A.email,error:N.email[0],helperText:N.email[1],slotProps:{input:{readOnly:!0}},sx:{backgroundColor:"grey.200"},onChange:ae,fullWidth:!0})}),!g("birthdate")&&e.jsx(c,{size:{xs:12,md:3},children:e.jsx(he,{dateAdapter:we,adapterLocale:"en-gb",children:e.jsx(ye,{label:B.birthdate,value:A.birthdate?q(A.birthdate,"YYYY-MM-DD"):null,readOnly:I.birthdate,onChange:k=>de("birthdate",k),sx:{backgroundColor:I.birthdate?"grey.200":"white"},renderInput:k=>e.jsx(O,{...k,fullWidth:!0,required:!0})})})}),!g("country")&&e.jsx(c,{size:{xs:12,md:2},children:e.jsxs(Q,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"country-label",children:B.country}),e.jsxs(oe,{variant:"outlined",labelId:"country-label",name:"country",label:B.country,value:A.country,error:N.country[0],onChange:ae,slotProps:{input:{readOnly:I.country}},sx:{backgroundColor:I.country?"grey.200":"white"},children:[e.jsx(V,{value:"",children:e.jsx("em",{children:"None"})}),Te.map(k=>e.jsx(V,{value:k.code,children:k.name},k.code))]})]})}),!g("domicile")&&e.jsx(c,{size:{xs:12,md:4},children:e.jsx(O,{label:B.domicile,name:"domicile",value:A.domicile,error:N.domicile[0],helperText:N.domicile[1],onChange:ae,slotProps:{input:{readOnly:I.domicile}},sx:{backgroundColor:I.domicile?"grey.200":"white"},fullWidth:!0})}),!g("phone_prefix")&&!g("phone_number")&&e.jsxs(c,{size:{xs:12},container:!0,spacing:2,children:[e.jsx(c,{size:{xs:12,md:1},children:e.jsxs(Q,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"phone-prefix-label",children:B.phone_prefix}),e.jsx(oe,{variant:"outlined",labelId:"phone-prefix-label",id:"phone-prefix",name:"phone_prefix",value:A.phone_prefix||"",onChange:ae,slotProps:{input:{readOnly:I.phone_number}},sx:{backgroundColor:I.phone_number?"grey.200":"white"},label:B.phone_prefix,renderValue:k=>k,children:Te.map(k=>e.jsxs(V,{value:k.dial,children:[k.dial," (",k.name,")"]},k.code))})]})}),e.jsx(c,{size:{xs:12,md:2},children:e.jsx(O,{label:B.phone_number,name:"phone_number",value:A.phone_number||"",error:N.phone_number[0],helperText:N.phone_number[1],onChange:ae,slotProps:{input:{readOnly:I.phone_number}},sx:{backgroundColor:I.phone_number?"grey.200":"white"},fullWidth:!0})})]}),!g("whatsapp_prefix")&&!g("whatsapp_number")&&e.jsxs(c,{size:{xs:12},container:!0,spacing:2,children:[e.jsx(c,{size:{xs:12,md:1},children:e.jsxs(Q,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"whatsapp-prefix-label",children:B.whatsapp_prefix}),e.jsx(oe,{variant:"outlined",labelId:"whatsapp-prefix-label",id:"whatsapp-prefix",name:"whatsapp_prefix",value:A.whatsapp_prefix||"",onChange:ae,slotProps:{input:{readOnly:I.whatsapp_prefix}},sx:{backgroundColor:I.whatsapp_prefix?"grey.200":"white"},label:B.whatsapp_prefix,renderValue:k=>k,children:Te.map(k=>e.jsxs(V,{value:k.dial,children:[k.dial," (",k.name,")"]},k.code))})]})}),e.jsx(c,{size:{xs:12,md:2},children:e.jsx(O,{label:B.whatsapp_number,name:"whatsapp_number",value:A.whatsapp_number||"",error:N.whatsapp_number[0],helperText:N.whatsapp_number[1],onChange:ae,slotProps:{input:{readOnly:I.whatsapp_number}},sx:{backgroundColor:I.whatsapp_number?"grey.200":"white"},fullWidth:!0})})]}),e.jsxs(c,{container:!0,size:{xs:12},sx:{mt:2},alignItems:"center",children:[e.jsx(gs,{}),e.jsx(P,{variant:"h6",sx:{m:0},children:"Dati Studente"})]}),!g("person_code")&&e.jsx(c,{size:{xs:12,md:3},children:e.jsx(O,{label:B.person_code,name:"person_code",value:A.person_code||"",error:N.person_code[0],helperText:N.person_code[1],onChange:ae,slotProps:{input:{readOnly:I.person_code}},sx:{backgroundColor:I.person_code?"grey.200":"white"},fullWidth:!0})}),!g("course")&&e.jsx(c,{size:{xs:12,md:3},children:e.jsxs(Q,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"course-label",children:B.course}),e.jsxs(oe,{variant:"outlined",labelId:"course-label",name:"course",label:B.course,value:A.course||"",onChange:ae,slotProps:{input:{readOnly:I.course}},sx:{backgroundColor:I.course?"grey.200":"white"},children:[e.jsx(V,{value:"Engineering",children:"Ingegneria"}),e.jsx(V,{value:"Design",children:"Design"}),e.jsx(V,{value:"Architecture",children:"Architettura"})]})]})}),!g("matricola_number")&&e.jsx(c,{size:{xs:12,md:3},children:e.jsx(O,{label:B.matricola_number,name:"matricola_number",value:A.matricola_number||"",error:N.matricola_number[0],helperText:N.matricola_number[1],onChange:ae,sx:{backgroundColor:I.matricola_number?"grey.200":"white"},type:"number",slotProps:{input:{readOnly:I.matricola_number}},fullWidth:!0})}),!g("matricola_expiration")&&e.jsx(c,{size:{xs:12,md:3},children:e.jsx(he,{dateAdapter:we,adapterLocale:"en-gb",children:e.jsx(ye,{label:B.matricola_expiration,value:A.matricola_expiration?q(A.matricola_expiration,"YYYY-MM-DD"):null,readOnly:I.matricola_expiration,onChange:k=>de("matricola_expiration",k),sx:{backgroundColor:I.matricola_expiration?"grey.200":"white"},renderInput:k=>e.jsx(O,{...k,fullWidth:!0,required:!0})})})}),!g("group")&&e.jsxs(c,{container:!0,alignItems:"center",spacing:1,sx:{width:"100%",mt:2},children:[e.jsx(bs,{}),e.jsx(c,{size:{xs:12,md:2},children:e.jsxs(Q,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"group-label",children:B.group}),e.jsx(oe,{variant:"outlined",labelId:"group-label",label:B.group,name:"group",value:A.group||"",onChange:ae,slotProps:{input:{readOnly:I.group}},sx:{backgroundColor:I.group?"grey.200":"white"},children:n.map(k=>e.jsx(V,{value:k.name,children:k.name},k.name))})]})})]})]})}),e.jsxs(qe,{sx:{p:1,mt:2,mb:2,minHeight:"80px",display:"flex",alignItems:"center"},children:[e.jsxs(js,{sx:{justifyContent:"space-between",width:"100%",p:0},children:[e.jsx(P,{variant:"h6",children:"Azioni"}),e.jsx(J,{variant:"contained",color:"primary",children:"Esporta Profilo"})]}),E&&e.jsx(et,{open:E,profile:T,onClose:x})]}),e.jsxs(c,{container:!0,sx:{width:"100%",mb:5},spacing:2,children:[e.jsx(c,{size:{xs:12,md:6},children:e.jsx(ga,{cols:ee,canCreate:p.permissions.includes("add_document"),canEdit:p.permissions.includes("change_document"),canDelete:p.permissions.includes("delete_document"),onCreate:X,onSave:ie,onDelete:$,initialData:M.documents,title:"Documenti",sortColumn:"expiration"})}),e.jsx(c,{size:{xs:12,md:6},children:e.jsx(ga,{cols:W,canCreate:p.permissions.includes("add_esncard"),onCreate:F,createText:T.latest_esncard?T.latest_esncard.is_valid?"Card Smarrita":"Rinnova":"Rilascia",canEdit:p.permissions.includes("change_esncard"),onSave:Z,initialData:M.esncards,title:"ESNcards",sortColumn:"expiration"})})]}),h&&e.jsx(Se,{message:h.message,state:h.state})]})})]})}function tt(){return e.jsx(Ts,{children:e.jsx(Is,{children:e.jsx(Ss,{children:e.jsxs(Cs,{children:[e.jsx(me,{path:"/verify-email/:uid/:token",element:e.jsx(Us,{})}),e.jsx(me,{path:"/reset-password/:uid/:token",element:e.jsx(Js,{})}),e.jsx(me,{path:"/login",element:e.jsx(Ps,{})}),e.jsx(me,{path:"/",element:e.jsx(Ie,{children:e.jsx(Ns,{})})}),e.jsx(me,{path:"/profiles/erasmus",element:e.jsx(Ie,{children:e.jsx(As,{})})}),e.jsx(me,{path:"/profiles/esners",element:e.jsx(Ie,{children:e.jsx(Ls,{})})}),e.jsx(me,{path:"/profile/:id",element:e.jsx(Ie,{children:e.jsx(st,{})})}),e.jsx(me,{path:"/erasmus_form",element:e.jsx(ks,{})}),e.jsx(me,{path:"/esner_form",element:e.jsx(Ds,{})}),e.jsx(me,{path:"/treasury",element:e.jsx(Ie,{requiredPermission:"change_account",children:e.jsx(Bs,{})})}),e.jsx(me,{path:"/treasury/accounts_list",element:e.jsx(Ie,{requiredPermission:"change_account",children:e.jsx(Ks,{})})}),e.jsx(me,{path:"/treasury/transactions_list",element:e.jsx(Ie,{requiredPermission:"change_account",children:e.jsx(Qs,{})})}),e.jsx(me,{path:"/events",element:e.jsx(Ie,{children:e.jsx(qs,{})})}),e.jsx(me,{path:"/event/:id",element:e.jsx(Ie,{children:e.jsx(Ys,{})})})]})})})})}const rt=Pa({typography:{fontFamily:"Roboto, Arial, sans-serif",h1:{fontFamily:"Lato, Arial, sans-serif"},h2:{fontFamily:"Lato, Arial, sans-serif"},h3:{fontFamily:"Lato, Arial, sans-serif"},h4:{fontFamily:"Lato, Arial, sans-serif"},h5:{fontFamily:"Lato, Arial, sans-serif"}},palette:{primary:{main:"#1976d2"},secondary:{main:"#dc004e"},cyan:{main:"#00aeef",contrastText:"#ffffff"},magenta:{main:"#ec008c",contrastText:"#ffffff"},gray:{main:"#999999",contrastText:"#ffffff"}}});Es({dsn:"https://f7ee9b97bae2c35e767d8e156eb7b116@o4509581352828928.ingest.de.sentry.io/4509581461487696",sendDefaultPii:!0});const nt=ba.createRoot(document.getElementById("root"));nt.render(e.jsxs(ys,{theme:Pa(rt,vs),children:[e.jsx(ja,{}),e.jsx(tt,{})]}));
