import{r as a,j as e,b as fe}from"./react-C_cg2vJ2.js";import{a as ba}from"./react-dom-D3GiQpVl.js";import{j as Qe}from"./jwt-decode-VWaDGczM.js";import{Q as y,a1 as ca,H as M,aA as aa,aB as ja,a8 as R,_ as U,a4 as Be,aC as je,aD as ya,aE as va,aF as i,aG as pe,aH as Se,ax as ye,aI as Z,aa as ne,ab as re,ac as q,as as _e,X as Te,aJ as _a,aK as da,q as Ee,U as J,v as Ba,e as Ga,l as Ye,aL as Ka,y as Ge,aM as Sa,C as qa,ag as Va,ah as Ha,ai as Ya,aj as Ua,aN as Pe,ar as We,au as Ue,aO as Ke,aP as sa,aQ as Ja,aR as Za,aS as Qa,aT as Ce,aU as $e,d as ta,aV as Xa,aW as es,aX as na,aY as Ca,aZ as wa,a_ as ua,am as Xe,a$ as ea,b0 as as,b1 as Ea,E as Ta,a0 as Ia,b2 as ss,b3 as ts,b4 as ns,$ as ae,z as qe,b5 as za,b6 as rs,b7 as ra,b8 as os,b9 as is,aw as ma,ba as ls,bb as Ve,ay as cs,az as ds,bc as us,bd as ms,be as ps,bf as hs,af as xs,bg as fs,bh as gs,bi as bs,bj as js,bk as ys,bl as Pa,bm as vs,bn as _s}from"./@mui-Ckrn4amK.js";import{u as Ie,L as pa,a as oa,b as Ss,B as Cs,R as ws,c as he}from"./react-router-BQSL4b-H.js";import{d as K}from"./dayjs-C-_GrJyW.js";import{u as ke,M as Fe,a as De,b as ka}from"./material-react-table-B2dxZAny.js";import{Q as Es}from"./quill-NHzMMpWD.js";import{S as He}from"./date-fns-jgPrqPiU.js";import"./cookie-DhHe99HG.js";import"./scheduler-SPyfQU6S.js";import"./@emotion-Btd9ljfZ.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./@babel-BtohYyOd.js";import"./stylis-DDa9OTMq.js";import"./clsx-B-dksMZM.js";import"./react-transition-group-CZUuWARL.js";import"./dom-helpers-D0mFdbeO.js";import"./prop-types-DO4wCXId.js";import"./@popperjs-DC5wud4b.js";import"./react-is-BPJnJB5S.js";import"./@tanstack-BUN72RuI.js";import"./highlight-words-DCTHEhAM.js";import"./parchment-DI0xVRB_.js";import"./quill-delta-CmVyj_yU.js";import"./fast-diff-BGhgD5-Y.js";import"./lodash.clonedeep-CdAwFVkU.js";import"./lodash.isequal-CVqJ6bXo.js";import"./eventemitter3-DrmIJ5Tj.js";import"./lodash-es-GiBPWDzC.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const _ of d.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&r(_)}).observe(document,{childList:!0,subtree:!0});function s(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(l){if(l.ep)return;l.ep=!0;const d=s(l);fetch(l.href,d)}})();const G=async(x,u,s=null,r={},l=!0)=>{const d=localStorage.getItem("accessToken"),o=`https://mgmt.esnpolimi.it/backend${u}`;if(l&&!d)throw new Error("No access token available");const g={"Content-Type":"application/json",...l&&{Authorization:`Bearer ${d}`},...r.headers},h={method:x,headers:g,credentials:"include",...r};s&&(h.body=typeof s=="string"?s:JSON.stringify(s));const f=await fetch(o,h);if(f.status===401)throw new Error("Unauthorized: Access token may have expired");return f},ee=(x,u)=>{if(!x)return`Server error (${u}) with empty response`;if(typeof x=="string")return x;if(x.detail)return x.detail;if(x.message)return x.message;if(x.non_field_errors)return x.non_field_errors.join(", ");if(x.lists?.non_field_errors)return`Error in lists format: ${x.lists.non_field_errors.join(", ")}`;for(const[s,r]of Object.entries(x))if(r)return Array.isArray(r)?r.join(", "):r.toString();return JSON.stringify(x)},Da=a.createContext(null),Ts=({children:x})=>{const u=a.useRef(null),[s,r]=a.useState(localStorage.getItem("accessToken")),[l,d]=a.useState(()=>JSON.parse(localStorage.getItem("user")||"null")),[_,o]=a.useState(!0),g=C=>{try{const{user:t}=Qe(C);return t}catch(t){return console.error("Invalid JWT token",t),null}},h=async(C,t)=>{try{const z=await G("POST","/login/",{email:C,password:t},{},!1),w=await z.json();if(z.ok){const n=g(w.access);return console.log("Login successful"),r(w.access),console.log("Decoded access token:",n),d(n),localStorage.setItem("accessToken",w.access),localStorage.setItem("user",JSON.stringify(n)),!0}else return console.error("Login error"),await ee(w,z.status)}catch(z){return console.error("Login error:",z),z}},f=a.useCallback(async({skipApiCall:C=!1}={})=>{console.log("Logout function called"),u.current&&(console.log("Aborting refresh timer..."),clearTimeout(u.current),u.current=null),C||await G("POST","/logout/"),localStorage.removeItem("accessToken"),localStorage.removeItem("user"),r(null),d(null),console.log("Logged out successfully")},[]),T=a.useCallback(async()=>{if(s)try{const C=l?.profile?.email,t=await G("POST","/api/token/refresh/",{email:C},{},!1);if(t.ok){const z=await t.json(),w=g(z.access);return r(z.access),d(w),localStorage.setItem("accessToken",z.access),localStorage.setItem("user",JSON.stringify(w)),!0}else return console.warn("Token refresh failed. Logging out..."),await f(),!1}catch(C){return console.error("Refresh token error:",C),await f(),!1}else return console.log("Skipping token refresh, user is not logged in"),!1},[l,s,f]);return a.useEffect(()=>{const C=()=>{u.current&&(clearTimeout(u.current),u.current=null)};if(!s){console.log("No access token found, skipping refresh scheduling");return}const{exp:t}=Qe(s),z=Math.floor(Date.now()/1e3),w=(t-z-30)*1e3,n=new Date(t*1e3),m=new Date(z*1e3);if(console.log(`Token expires at: ${n.getHours()}:${n.getMinutes()}, current time: ${m.getHours()}:${m.getMinutes()}, refresh time in s: ${w/1e3}`),w<=0){console.log("Refresh time is not valid, no timer set"),r(null);return}return C(),u.current=setTimeout(()=>{console.log("Refreshing access token..."),T().then()},w),()=>{console.log("Clearing refresh timer"),C()}},[s,T]),a.useEffect(()=>{(async()=>{const t=localStorage.getItem("accessToken"),z=localStorage.getItem("user");if(t&&z)try{const w=Qe(t),n=Math.floor(Date.now()/1e3);w.exp>n?(r(t),d(JSON.parse(z))):await f({skipApiCall:!0})}catch(w){console.error("Token decode error",w),await f({skipApiCall:!0})}o(!1)})().then()},[f]),e.jsx(Da.Provider,{value:{user:l,accessToken:s,refreshAccessToken:T,logout:f,login:h,loading:_},children:x})},Ae=()=>a.useContext(Da),Ma=a.createContext(void 0);function Is({children:x}){const[u,s]=a.useState(!1),[r,l]=a.useState(null);a.useEffect(()=>{const o=localStorage.getItem("sidebarDrawerState");o&&s(JSON.parse(o))},[]),a.useEffect(()=>{localStorage.setItem("sidebarDrawerState",JSON.stringify(u))},[u]);const d=o=>g=>{g&&g.type==="keydown"&&(g.key==="Tab"||g.key==="Shift")||s(o)},_=o=>{l(g=>g===o?null:o)};return e.jsx(Ma.Provider,{value:{isDrawerOpen:u,toggleDrawer:d,expandedSection:r,handleExpand:_},children:x})}function zs(){return a.useContext(Ma)}const ia="/assets/esnpolimi-logo-BJJf0P2z.png",Ne=({message:x,state:u,successText:s,errorText:r})=>e.jsxs(y,{sx:{mt:2,mb:2,display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",p:2,borderRadius:5,boxShadow:3,bgcolor:"background.paper"},children:[u==="success"&&e.jsxs(e.Fragment,{children:[e.jsx(ca,{severity:"success",sx:{width:"100%",mb:1},children:x||"Success!"}),s&&e.jsx(M,{children:s})]}),u==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(ca,{severity:"error",sx:{width:"100%",mb:1},children:x||"An error occurred"}),r&&e.jsx(M,{children:r})]})]});function Ps(){const[x,u]=a.useState(""),[s,r]=a.useState(""),[l,d]=a.useState(!1),{login:_}=Ae(),o=Ie(),[g,h]=a.useState(null),[f,T]=a.useState(!1),[C,t]=a.useState(!1),z=async()=>{t(!0);try{console.log("Sending forgot password request for:",x);const n=await G("POST","/api/forgot-password/",{email:x},{},!1);if(n.ok)T(!0),h({message:`Se il profilo è registrato, l'email è stata inviata con successo a "`+x+'". Controlla la tua casella di posta.',state:"success"});else{const m=await n.json(),j=await ee(m,n.status);h({message:`Errore durante l'invio dell'email: ${j}`,state:"error"})}}catch(n){h({message:`Errore generale: ${n}`,state:"error"})}finally{t(!1)}},w=async()=>{t(!0),h(null);const n=await _(x,s);if(t(!1),n===!0)o("/");else if(typeof n=="string"&&(n.trim().startsWith("<!DOCTYPE html")||n.trim().startsWith("<html"))){const m=window.open();m?(m.document.open(),m.document.write(n),m.document.close()):h({message:"Impossibile aprire la pagina di errore in una nuova scheda.",state:"error"})}else h({message:`Errore durante il login: ${n}`,state:"error"})};return e.jsxs(aa,{component:"main",maxWidth:"xs",children:[e.jsx(ja,{}),e.jsxs(y,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("img",{alt:"",src:ia,style:{height:"25vh"}}),e.jsxs(y,{children:[!f&&e.jsx(R,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email",name:"email",autoComplete:"email",autoFocus:!0,onChange:n=>u(n.target.value),onKeyDown:n=>n.key==="Enter"&&(l?z():w())}),!l&&e.jsx(R,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",onChange:n=>r(n.target.value),onKeyDown:n=>n.key==="Enter"&&w()}),!f&&e.jsx(U,{fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,backgroundColor:"black"},onClick:l?z:w,disabled:C,children:C?e.jsx(Be,{size:24,color:"inherit"}):l?"Invia Email di Reset":"Log In"}),e.jsxs(y,{sx:{display:"flex",justifyContent:"center",width:"100%"},children:[e.jsx(je,{component:"button",variant:"body2",onClick:()=>{d(!l),T(!1),h(null)},sx:{textAlign:"center"},children:l?"Torna al Login":"Password dimenticata?"}),e.jsx(je,{component:"button",variant:"body2",onClick:()=>o("/esner_form"),sx:{textAlign:"center",marginLeft:2},children:"Non hai un account? Registrati"})]})]}),g&&e.jsx(Ne,{message:g.message,state:g.state})]})]})}const we=JSON.parse(`[{"name":"Afghanistan","dial":"+93","code":"AF"},{"name":"Aland Islands","dial":"+358","code":"AX"},{"name":"Albania","dial":"+355","code":"AL"},{"name":"Algeria","dial":"+213","code":"DZ"},{"name":"AmericanSamoa","dial":"+1684","code":"AS"},{"name":"Andorra","dial":"+376","code":"AD"},{"name":"Angola","dial":"+244","code":"AO"},{"name":"Anguilla","dial":"+1264","code":"AI"},{"name":"Antarctica","dial":"+672","code":"AQ"},{"name":"Antigua and Barbuda","dial":"+1268","code":"AG"},{"name":"Argentina","dial":"+54","code":"AR"},{"name":"Armenia","dial":"+374","code":"AM"},{"name":"Aruba","dial":"+297","code":"AW"},{"name":"Australia","dial":"+61","code":"AU"},{"name":"Austria","dial":"+43","code":"AT"},{"name":"Azerbaijan","dial":"+994","code":"AZ"},{"name":"Bahamas","dial":"+1242","code":"BS"},{"name":"Bahrain","dial":"+973","code":"BH"},{"name":"Bangladesh","dial":"+880","code":"BD"},{"name":"Barbados","dial":"+1246","code":"BB"},{"name":"Belarus","dial":"+375","code":"BY"},{"name":"Belgium","dial":"+32","code":"BE"},{"name":"Belize","dial":"+501","code":"BZ"},{"name":"Benin","dial":"+229","code":"BJ"},{"name":"Bermuda","dial":"+1441","code":"BM"},{"name":"Bhutan","dial":"+975","code":"BT"},{"name":"Bolivia, Plurinational State of","dial":"+591","code":"BO"},{"name":"Bosnia and Herzegovina","dial":"+387","code":"BA"},{"name":"Botswana","dial":"+267","code":"BW"},{"name":"Brazil","dial":"+55","code":"BR"},{"name":"British Indian Ocean Territory","dial":"+246","code":"IO"},{"name":"Brunei Darussalam","dial":"+673","code":"BN"},{"name":"Bulgaria","dial":"+359","code":"BG"},{"name":"Burkina Faso","dial":"+226","code":"BF"},{"name":"Burundi","dial":"+257","code":"BI"},{"name":"Cambodia","dial":"+855","code":"KH"},{"name":"Cameroon","dial":"+237","code":"CM"},{"name":"Canada","dial":"+1","code":"CA"},{"name":"Cape Verde","dial":"+238","code":"CV"},{"name":"Cayman Islands","dial":"+ 345","code":"KY"},{"name":"Central African Republic","dial":"+236","code":"CF"},{"name":"Chad","dial":"+235","code":"TD"},{"name":"Chile","dial":"+56","code":"CL"},{"name":"China","dial":"+86","code":"CN"},{"name":"Christmas Island","dial":"+61","code":"CX"},{"name":"Cocos (Keeling) Islands","dial":"+61","code":"CC"},{"name":"Colombia","dial":"+57","code":"CO"},{"name":"Comoros","dial":"+269","code":"KM"},{"name":"Congo","dial":"+242","code":"CG"},{"name":"Congo, The Democratic Republic of the Congo","dial":"+243","code":"CD"},{"name":"Cook Islands","dial":"+682","code":"CK"},{"name":"Costa Rica","dial":"+506","code":"CR"},{"name":"Cote d'Ivoire","dial":"+225","code":"CI"},{"name":"Croatia","dial":"+385","code":"HR"},{"name":"Cuba","dial":"+53","code":"CU"},{"name":"Cyprus","dial":"+357","code":"CY"},{"name":"Czech Republic","dial":"+420","code":"CZ"},{"name":"Denmark","dial":"+45","code":"DK"},{"name":"Djibouti","dial":"+253","code":"DJ"},{"name":"Dominica","dial":"+1767","code":"DM"},{"name":"Dominican Republic","dial":"+1849","code":"DO"},{"name":"Ecuador","dial":"+593","code":"EC"},{"name":"Egypt","dial":"+20","code":"EG"},{"name":"El Salvador","dial":"+503","code":"SV"},{"name":"Equatorial Guinea","dial":"+240","code":"GQ"},{"name":"Eritrea","dial":"+291","code":"ER"},{"name":"Estonia","dial":"+372","code":"EE"},{"name":"Ethiopia","dial":"+251","code":"ET"},{"name":"Falkland Islands (Malvinas)","dial":"+500","code":"FK"},{"name":"Faroe Islands","dial":"+298","code":"FO"},{"name":"Fiji","dial":"+679","code":"FJ"},{"name":"Finland","dial":"+358","code":"FI"},{"name":"France","dial":"+33","code":"FR"},{"name":"French Guiana","dial":"+594","code":"GF"},{"name":"French Polynesia","dial":"+689","code":"PF"},{"name":"Gabon","dial":"+241","code":"GA"},{"name":"Gambia","dial":"+220","code":"GM"},{"name":"Georgia","dial":"+995","code":"GE"},{"name":"Germany","dial":"+49","code":"DE"},{"name":"Ghana","dial":"+233","code":"GH"},{"name":"Gibraltar","dial":"+350","code":"GI"},{"name":"Greece","dial":"+30","code":"GR"},{"name":"Greenland","dial":"+299","code":"GL"},{"name":"Grenada","dial":"+1473","code":"GD"},{"name":"Guadeloupe","dial":"+590","code":"GP"},{"name":"Guam","dial":"+1671","code":"GU"},{"name":"Guatemala","dial":"+502","code":"GT"},{"name":"Guernsey","dial":"+44","code":"GG"},{"name":"Guinea","dial":"+224","code":"GN"},{"name":"Guinea-Bissau","dial":"+245","code":"GW"},{"name":"Guyana","dial":"+595","code":"GY"},{"name":"Haiti","dial":"+509","code":"HT"},{"name":"Holy See (Vatican City State)","dial":"+379","code":"VA"},{"name":"Honduras","dial":"+504","code":"HN"},{"name":"Hong Kong","dial":"+852","code":"HK"},{"name":"Hungary","dial":"+36","code":"HU"},{"name":"Iceland","dial":"+354","code":"IS"},{"name":"India","dial":"+91","code":"IN"},{"name":"Indonesia","dial":"+62","code":"ID"},{"name":"Iran, Islamic Republic of Persian Gulf","dial":"+98","code":"IR"},{"name":"Iraq","dial":"+964","code":"IQ"},{"name":"Ireland","dial":"+353","code":"IE"},{"name":"Isle of Man","dial":"+44","code":"IM"},{"name":"Israel","dial":"+972","code":"IL"},{"name":"Italy","dial":"+39","code":"IT"},{"name":"Jamaica","dial":"+1876","code":"JM"},{"name":"Japan","dial":"+81","code":"JP"},{"name":"Jersey","dial":"+44","code":"JE"},{"name":"Jordan","dial":"+962","code":"JO"},{"name":"Kazakhstan","dial":"+77","code":"KZ"},{"name":"Kenya","dial":"+254","code":"KE"},{"name":"Kiribati","dial":"+686","code":"KI"},{"name":"Korea, Democratic People's Republic of Korea","dial":"+850","code":"KP"},{"name":"Korea, Republic of South Korea","dial":"+82","code":"KR"},{"name":"Kuwait","dial":"+965","code":"KW"},{"name":"Kyrgyzstan","dial":"+996","code":"KG"},{"name":"Laos","dial":"+856","code":"LA"},{"name":"Latvia","dial":"+371","code":"LV"},{"name":"Lebanon","dial":"+961","code":"LB"},{"name":"Lesotho","dial":"+266","code":"LS"},{"name":"Liberia","dial":"+231","code":"LR"},{"name":"Libyan Arab Jamahiriya","dial":"+218","code":"LY"},{"name":"Liechtenstein","dial":"+423","code":"LI"},{"name":"Lithuania","dial":"+370","code":"LT"},{"name":"Luxembourg","dial":"+352","code":"LU"},{"name":"Macao","dial":"+853","code":"MO"},{"name":"Macedonia","dial":"+389","code":"MK"},{"name":"Madagascar","dial":"+261","code":"MG"},{"name":"Malawi","dial":"+265","code":"MW"},{"name":"Malaysia","dial":"+60","code":"MY"},{"name":"Maldives","dial":"+960","code":"MV"},{"name":"Mali","dial":"+223","code":"ML"},{"name":"Malta","dial":"+356","code":"MT"},{"name":"Marshall Islands","dial":"+692","code":"MH"},{"name":"Martinique","dial":"+596","code":"MQ"},{"name":"Mauritania","dial":"+222","code":"MR"},{"name":"Mauritius","dial":"+230","code":"MU"},{"name":"Mayotte","dial":"+262","code":"YT"},{"name":"Mexico","dial":"+52","code":"MX"},{"name":"Micronesia, Federated States of Micronesia","dial":"+691","code":"FM"},{"name":"Moldova","dial":"+373","code":"MD"},{"name":"Monaco","dial":"+377","code":"MC"},{"name":"Mongolia","dial":"+976","code":"MN"},{"name":"Montenegro","dial":"+382","code":"ME"},{"name":"Montserrat","dial":"+1664","code":"MS"},{"name":"Morocco","dial":"+212","code":"MA"},{"name":"Mozambique","dial":"+258","code":"MZ"},{"name":"Myanmar","dial":"+95","code":"MM"},{"name":"Namibia","dial":"+264","code":"NA"},{"name":"Nauru","dial":"+674","code":"NR"},{"name":"Nepal","dial":"+977","code":"NP"},{"name":"Netherlands","dial":"+31","code":"NL"},{"name":"Netherlands Antilles","dial":"+599","code":"AN"},{"name":"New Caledonia","dial":"+687","code":"NC"},{"name":"New Zealand","dial":"+64","code":"NZ"},{"name":"Nicaragua","dial":"+505","code":"NI"},{"name":"Niger","dial":"+227","code":"NE"},{"name":"Nigeria","dial":"+234","code":"NG"},{"name":"Niue","dial":"+683","code":"NU"},{"name":"Norfolk Island","dial":"+672","code":"NF"},{"name":"Northern Mariana Islands","dial":"+1670","code":"MP"},{"name":"Norway","dial":"+47","code":"NO"},{"name":"Oman","dial":"+968","code":"OM"},{"name":"Pakistan","dial":"+92","code":"PK"},{"name":"Palau","dial":"+680","code":"PW"},{"name":"Palestinian Territory, Occupied","dial":"+970","code":"PS"},{"name":"Panama","dial":"+507","code":"PA"},{"name":"Papua New Guinea","dial":"+675","code":"PG"},{"name":"Paraguay","dial":"+595","code":"PY"},{"name":"Peru","dial":"+51","code":"PE"},{"name":"Philippines","dial":"+63","code":"PH"},{"name":"Pitcairn","dial":"+872","code":"PN"},{"name":"Poland","dial":"+48","code":"PL"},{"name":"Portugal","dial":"+351","code":"PT"},{"name":"Puerto Rico","dial":"+1939","code":"PR"},{"name":"Qatar","dial":"+974","code":"QA"},{"name":"Romania","dial":"+40","code":"RO"},{"name":"Russia","dial":"+7","code":"RU"},{"name":"Rwanda","dial":"+250","code":"RW"},{"name":"Reunion","dial":"+262","code":"RE"},{"name":"Saint Barthelemy","dial":"+590","code":"BL"},{"name":"Saint Helena, Ascension and Tristan Da Cunha","dial":"+290","code":"SH"},{"name":"Saint Kitts and Nevis","dial":"+1869","code":"KN"},{"name":"Saint Lucia","dial":"+1758","code":"LC"},{"name":"Saint Martin","dial":"+590","code":"MF"},{"name":"Saint Pierre and Miquelon","dial":"+508","code":"PM"},{"name":"Saint Vincent and the Grenadines","dial":"+1784","code":"VC"},{"name":"Samoa","dial":"+685","code":"WS"},{"name":"San Marino","dial":"+378","code":"SM"},{"name":"Sao Tome and Principe","dial":"+239","code":"ST"},{"name":"Saudi Arabia","dial":"+966","code":"SA"},{"name":"Senegal","dial":"+221","code":"SN"},{"name":"Serbia","dial":"+381","code":"RS"},{"name":"Seychelles","dial":"+248","code":"SC"},{"name":"Sierra Leone","dial":"+232","code":"SL"},{"name":"Singapore","dial":"+65","code":"SG"},{"name":"Slovakia","dial":"+421","code":"SK"},{"name":"Slovenia","dial":"+386","code":"SI"},{"name":"Solomon Islands","dial":"+677","code":"SB"},{"name":"Somalia","dial":"+252","code":"SO"},{"name":"South Africa","dial":"+27","code":"ZA"},{"name":"South Sudan","dial":"+211","code":"SS"},{"name":"South Georgia and the South Sandwich Islands","dial":"+500","code":"GS"},{"name":"Spain","dial":"+34","code":"ES"},{"name":"Sri Lanka","dial":"+94","code":"LK"},{"name":"Sudan","dial":"+249","code":"SD"},{"name":"Suriname","dial":"+597","code":"SR"},{"name":"Svalbard and Jan Mayen","dial":"+47","code":"SJ"},{"name":"Swaziland","dial":"+268","code":"SZ"},{"name":"Sweden","dial":"+46","code":"SE"},{"name":"Switzerland","dial":"+41","code":"CH"},{"name":"Syrian Arab Republic","dial":"+963","code":"SY"},{"name":"Taiwan","dial":"+886","code":"TW"},{"name":"Tajikistan","dial":"+992","code":"TJ"},{"name":"Tanzania, United Republic of Tanzania","dial":"+255","code":"TZ"},{"name":"Thailand","dial":"+66","code":"TH"},{"name":"Timor-Leste","dial":"+670","code":"TL"},{"name":"Togo","dial":"+228","code":"TG"},{"name":"Tokelau","dial":"+690","code":"TK"},{"name":"Tonga","dial":"+676","code":"TO"},{"name":"Trinidad and Tobago","dial":"+1868","code":"TT"},{"name":"Tunisia","dial":"+216","code":"TN"},{"name":"Turkey","dial":"+90","code":"TR"},{"name":"Turkmenistan","dial":"+993","code":"TM"},{"name":"Turks and Caicos Islands","dial":"+1649","code":"TC"},{"name":"Tuvalu","dial":"+688","code":"TV"},{"name":"Uganda","dial":"+256","code":"UG"},{"name":"Ukraine","dial":"+380","code":"UA"},{"name":"United Arab Emirates","dial":"+971","code":"AE"},{"name":"United Kingdom","dial":"+44","code":"GB"},{"name":"United States","dial":"+1","code":"US"},{"name":"Uruguay","dial":"+598","code":"UY"},{"name":"Uzbekistan","dial":"+998","code":"UZ"},{"name":"Vanuatu","dial":"+678","code":"VU"},{"name":"Venezuela, Bolivarian Republic of Venezuela","dial":"+58","code":"VE"},{"name":"Vietnam","dial":"+84","code":"VN"},{"name":"Virgin Islands, British","dial":"+1284","code":"VG"},{"name":"Virgin Islands, U.S.","dial":"+1340","code":"VI"},{"name":"Wallis and Futuna","dial":"+681","code":"WF"},{"name":"Yemen","dial":"+967","code":"YE"},{"name":"Zambia","dial":"+260","code":"ZM"},{"name":"Zimbabwe","dial":"+263","code":"ZW"}]`);function ks(){const[x,u]=fe.useState(!1),[s,r]=fe.useState(!0),[l,d]=a.useState(null),[_,o]=a.useState(!1),[g,h]=a.useState({acceptStatute:!1,acceptPurposes:!1,acceptRegulation:!1,acceptPrivacy:!1}),[f,T]=a.useState({acceptStatute:!1,acceptPurposes:!1,acceptRegulation:!1,acceptPrivacy:!1}),C={statute:"https://drive.google.com/file/d/1b0gpA3x9yRuAcdEWQyc9KvrnZzm0l-dB/view?usp=sharing",regulation:"https://drive.google.com/file/d/1_s0uBvqfOLRz5rQp1EEeNgtxRjs7Pgxy/view?usp=sharing",privacy:"https://drive.google.com/file/d/12LY0y49cCyjqdF0RotsO6srHrGkinNln/view?usp=sharing"},[t,z]=fe.useState({name:"",surname:"",email:"",email_confirm:"",birthdate:K(),country:"",phone_prefix:"+39",phone_number:"",whatsapp_prefix:"+39",whatsapp_number:"",person_code:"",domicile:"",course:"",document_type:"ID Card",document_number:"",document_expiration:K(),matricola_number:"",matricola_expiration:K(),is_esner:!1}),w={email:[!1,""],email_confirm:[!1,""],name:[!1,""],surname:[!1,""],birthdate:[!1,""],country:[!1,""],phone_prefix:[!1,""],phone_number:[!1,""],whatsapp_prefix:[!1,""],whatsapp_number:[!1,""],person_code:[!1,""],domicile:[!1,""],course:[!1,""],document_type:[!1,""],document_number:[!1,""],document_expiration:[!1,""],matricola_number:[!1,""],matricola_expiration:[!1,""],is_esner:[!1,""]},[n,m]=fe.useState(w),j=()=>{let b=!0;const F={...n},S={...f};["email","email_confirm","name","surname","birthdate","country","phone_prefix","phone_number","person_code","domicile","course","document_type","document_number","document_expiration","matricola_number","matricola_expiration"].forEach(p=>{!t[p]||typeof t[p]=="string"&&t[p].trim()===""?(F[p]=[!0,"This field is required"],b=!1):F[p]=[!1,""]}),/^\d{6}$/.test(t.matricola_number)?F.matricola_number=[!1,""]:(F.matricola_number=[!0,"Matricola must be exactly 6 digits"],b=!1),/^\d{8}$/.test(t.person_code)?F.person_code=[!1,""]:(F.person_code=[!0,"Person Code must be exactly 8 digits"],b=!1);const E=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.email&&!E.test(t.email)&&(F.email=[!0,"Invalid email format"],b=!1),t.email!==t.email_confirm?(F.email_confirm=[!0,"Emails do not match"],b=!1):F.email_confirm=[!1,""],Object.entries(g).forEach(([p,N])=>{N?S[p]=!1:(S[p]=!0,b=!1)}),m(F),T(S),b},v=()=>{window.scrollTo({top:0,behavior:"smooth"})},L=b=>K(b).format("YYYY-MM-DD"),D=b=>{z({...t,[b.target.name]:b.target.value}),n[b.target.name]&&m({...n,[b.target.name]:[!1,""]})},H=(b,F)=>{z({...t,[b]:F})},Y=b=>{const{name:F,checked:S}=b.target;h({...g,[F]:S}),S&&T({...f,[F]:!1})},P=b=>{if(b.preventDefault(),!j()){v();return}o(!0);let F={...t,whatsapp_prefix:s?t.phone_prefix:t.whatsapp_prefix,whatsapp_number:s?t.phone_number:t.whatsapp_number,birthdate:L(t.birthdate),document_expiration:L(t.document_expiration),matricola_expiration:L(t.matricola_expiration)};(async()=>{try{const $=await G("POST","/profile/initiate-creation/",F,{},!1),A=await $.json();if(m(w),$.ok)u(!0);else{d({message:"Failed to submit application: see errors below",state:"error"});const c={...n};Object.entries(A).forEach(([E,p])=>{c[E]&&(c[E]=[!0,p])}),m(c)}}catch($){d({message:"Internal error (please contact us): "+$.message,state:"error"})}finally{o(!1)}})().then()},I=b=>{r(b.target.checked),b.target.checked&&z({...t,whatsapp_prefix:t.phone_prefix,whatsapp_number:t.phone_number})};return x?e.jsxs(y,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",bgcolor:"#fff",children:[e.jsx(ya,{style:{fontSize:100,color:va[500]}}),e.jsx(M,{variant:"h4",align:"center",gutterBottom:!0,children:"Your response has been sent."}),e.jsx(M,{variant:"subtitle1",align:"center",children:"Check your inbox to verify your e-mail."}),e.jsxs(M,{variant:"body2",align:"center",sx:{mt:2},children:["In case you do not receive an email, please check your spam folder or contact us at ",e.jsx(je,{href:"mailto: informatica@esnpolimi.it",children:"informatica@esnpolimi.it"})]})]}):e.jsxs(y,{component:"form",noValidate:!0,sx:{maxWidth:800,margin:"auto",mt:5,mb:5,px:4},onSubmit:P,children:[e.jsx(M,{variant:"h4",align:"center",gutterBottom:!0,mb:5,children:"ESN Polimi Registration - International Student"}),l&&e.jsx(Ne,{message:l.message,state:l.state}),e.jsx(M,{variant:"h5",align:"center",gutterBottom:!0,sx:{my:4},children:"Personal Information"}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(R,{label:"Name",variant:"outlined",name:"name",value:t.name,onChange:D,fullWidth:!0,required:!0,error:n.name[0],helperText:n.name[1]})}),e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(R,{label:"Surname",variant:"outlined",name:"surname",value:t.surname,onChange:D,fullWidth:!0,required:!0,error:n.surname[0],helperText:n.surname[1]})}),e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(pe,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(ye,{label:"Birthdate",value:t.birthdate,onChange:b=>H("birthdate",b),maxDate:K(),renderInput:b=>e.jsx(R,{...b,fullWidth:!0,required:!0})})})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(R,{label:"Email",variant:"outlined",name:"email",type:"email",value:t.email,onChange:D,fullWidth:!0,required:!0,error:n.email[0],helperText:n.email[1]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(R,{label:"Confirm Email",variant:"outlined",name:"email_confirm",type:"email",value:t.email_confirm,onChange:D,fullWidth:!0,required:!0,error:n.email_confirm[0],helperText:n.email_confirm[1]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"country-label",children:"Home University Country"}),e.jsx(re,{variant:"outlined",labelId:"country-label",name:"country",value:t.country,onChange:D,label:"Home University Country",error:n.country[0],children:we.map(b=>e.jsx(q,{value:b.code,children:b.name},b.code))})]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(R,{label:"Home Domicile",variant:"outlined",name:"domicile",value:t.domicile,onChange:D,fullWidth:!0,required:!0,error:n.domicile[0],helperText:n.domicile[1]})}),e.jsx(i,{size:{xs:4,sm:2},children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(ne,{id:"phone-prefix-label",children:"Prefix"}),e.jsx(re,{variant:"outlined",labelId:"phone-prefix-label",id:"phone-prefix",name:"phone_prefix",value:t.phone_prefix,onChange:D,label:"Prefix",renderValue:b=>b,error:n.phone_prefix[0],children:we.map(b=>e.jsxs(q,{value:b.dial,children:[b.dial," (",b.name,")"]},b.code))})]})}),e.jsx(i,{size:{xs:8,sm:4},children:e.jsx(R,{label:"Phone Number",variant:"outlined",name:"phone_number",type:"number",value:t.phone_number,onChange:D,fullWidth:!0,required:!0,error:n.phone_number[0],helperText:n.phone_number[1]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(_e,{control:e.jsx(Te,{checked:s,onChange:I,name:"sameAsPhone",color:"primary"}),label:"Same number for WhatsApp"})}),!s&&e.jsxs(e.Fragment,{children:[e.jsx(i,{size:{xs:4,sm:2},children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(ne,{id:"whatsapp-prefix-label",children:"Prefix"}),e.jsx(re,{variant:"outlined",labelId:"whatsapp-prefix-label",id:"whatsapp-prefix",name:"whatsapp_prefix",value:t.whatsapp_prefix,onChange:D,label:"Prefix",renderValue:b=>b,error:n.whatsapp_prefix[0],children:we.map(b=>e.jsxs(q,{value:b.dial,children:[b.dial," (",b.name,")"]},b.code))})]})}),e.jsx(i,{size:{xs:8,sm:4},children:e.jsx(R,{label:"Whatsapp Number",variant:"outlined",name:"whatsapp_number",type:"number",value:t.whatsapp_number,onChange:D,fullWidth:!0,required:!0,error:n.whatsapp_number[0],helperText:n.whatsapp_number[1]})})]})]}),e.jsx(M,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Document Information"}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{size:{xs:12,sm:4},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"idType-label",children:"Type"}),e.jsxs(re,{variant:"outlined",labelId:"document-type-label",name:"document_type",value:t.document_type,onChange:D,label:"Type",required:!0,error:n.document_type[0],children:[e.jsx(q,{value:"Passport",children:"Passport"}),e.jsx(q,{value:"ID Card",children:"ID Card"}),e.jsx(q,{value:"Driving License",children:"Driving License"}),e.jsx(q,{value:"Residency Permit",children:"Residency Permit"}),e.jsx(q,{value:"Other",children:"Other"})]})]})}),e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(R,{label:"Number",variant:"outlined",name:"document_number",value:t.document_number,onChange:D,fullWidth:!0,required:!0,error:n.document_number[0],helperText:n.document_number[1]})}),e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(pe,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(ye,{label:"Expiration Date",value:t.document_expiration,onChange:b=>H("document_expiration",b),renderInput:b=>e.jsx(R,{...b,fullWidth:!0,required:!0})})})})]}),e.jsx(M,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Exchange Information"}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{size:{xs:12,sm:6},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"course-label",children:"Field of Study"}),e.jsxs(re,{variant:"outlined",labelId:"course-label",name:"course",value:t.course,onChange:D,label:"Field of Study",error:n.course[0],children:[e.jsx(q,{value:"Engineering",children:"Engineering"}),e.jsx(q,{value:"Design",children:"Design"}),e.jsx(q,{value:"Architecture",children:"Architecture"})]})]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(pe,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(ye,{label:"Exchange End Date",value:t.matricola_expiration,onChange:b=>H("matricola_expiration",b),renderInput:b=>e.jsx(R,{...b,fullWidth:!0,required:!0})})})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(R,{label:"Person Code (8 digits)",variant:"outlined",name:"person_code",type:"number",value:t.person_code,onChange:D,fullWidth:!0,required:!0,error:n.person_code[0],helperText:n.person_code[1]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(R,{label:"Matricola (6 digits)",variant:"outlined",name:"matricola_number",type:"number",value:t.matricola_number,onChange:D,fullWidth:!0,required:!0,error:n.matricola_number[0],helperText:n.matricola_number[1]})}),e.jsx(i,{size:{xs:12},children:e.jsxs(M,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["You can find your Person Code and Matricola in the Polimi App under your profile section, or from the Online Services.",e.jsx("br",{})," In case the university has not provided you a Matricola yet, you can fill the field with 6 '0's."]})})]}),e.jsxs(i,{container:!0,spacing:3,mt:3,children:[e.jsx(i,{size:{xs:12},children:e.jsx(_e,{control:e.jsx(Te,{name:"acceptStatute",checked:g.acceptStatute,onChange:Y,required:!0,sx:{color:f.acceptStatute?"red":void 0,"&.Mui-checked":{color:f.acceptStatute?"red":void 0}}}),label:e.jsxs("span",{children:["I declare that I have read and accepted the"," ",e.jsx(je,{href:C.statute,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"ESN Politecnico Milano Charter"})]})})}),e.jsx(i,{size:{xs:12},children:e.jsx(_e,{control:e.jsx(Te,{name:"acceptPurposes",checked:g.acceptPurposes,onChange:Y,required:!0,sx:{color:f.acceptPurposes?"red":void 0,"&.Mui-checked":{color:f.acceptPurposes?"red":void 0}}}),label:"I declare that I fully share the aims of the Association (ref. Article 2 of the Charter)"})}),e.jsx(i,{size:{xs:12},children:e.jsx(_e,{control:e.jsx(Te,{name:"acceptRegulation",checked:g.acceptRegulation,onChange:Y,required:!0,sx:{color:f.acceptRegulation?"red":void 0,"&.Mui-checked":{color:f.acceptRegulation?"red":void 0}}}),label:e.jsxs("span",{children:["I declare that I accept all the terms stated in the"," ",e.jsx(je,{href:C.regulation,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Internal Rules"})," ","and all subsequent changes and additions"]})})}),e.jsx(i,{size:{xs:12},children:e.jsx(_e,{control:e.jsx(Te,{name:"acceptPrivacy",checked:g.acceptPrivacy,onChange:Y,required:!0,sx:{color:f.acceptPrivacy?"red":void 0,"&.Mui-checked":{color:f.acceptPrivacy?"red":void 0}}}),label:e.jsxs("span",{children:["I declare that I have read the attached"," ",e.jsx(je,{href:C.privacy,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Privacy Disclaimer"})," ","and that I agree to the usage of my personal data according to the Regulation EU 2016/679 (GDPR) and to be aware of my guaranteed rights by the afore-mentioned law"]})})})]}),e.jsx(U,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:4},startIcon:!_&&e.jsx(_a,{}),disabled:_,children:_?e.jsx(Be,{size:24,color:"inherit"}):"Submit"})]})}const O={id:"Id",name:"Nome",surname:"Cognome",group:"Gruppo",email:"Email",phone_prefix:"Prefisso Tel",phone_number:"Numero Telefono",whatsapp_prefix:"Prefisso WA",whatsapp_number:"Numero WhatsApp",country:"Paese",birthdate:"Data di Nascita",latest_esncard:"ESNcard",latest_document:"Documento",matricola_number:"Matricola",matricola_expiration:"Scadenza Matricola",course:"Corso di Studi",person_code:"Codice Persona",domicile:"Domicilio"},xe={id:"Id",name:"Nome Evento",date:"Data Evento",description:"Descrizione",cost:"Costo (€)",subscription_start_date:"Data Apertura Iscrizioni",subscription_end_date:"Data Chiusura Iscrizioni",subscription_date_status:"Stato Iscrizioni",list_name:"Nome Lista",list_capacity:"Capacità Lista"},me={id:"Id",name:"Nome",status:"Stato",balance:"Saldo",changed_by:"Ultima Modifica",visible_to_groups:"Gruppi di Visibilità"},te={date:"Data",type:"Tipo",description:"Descrizione",amount:"Importo",executor:"Eseguito da",account:"Cassa",tran_type:{event:"Evento",esncard:"ESNcard",deposit:"Deposito",withdrawal:"Prelievo",subscription:"Iscrizione"}};function Ds(){const[x,u]=fe.useState(!1),[s,r]=a.useState(null),[l,d]=a.useState(!1),_=O,[o,g]=fe.useState({email:"teopompil@gmail.com",email_confirm:"teopompil@gmail.com",password:"1Unoduetrequattro",password_confirm:"1Unoduetrequattro",name:"Giampiero",surname:"Bassini",birthdate:K(),country:"IT",phone_prefix:"+39",phone_number:"11111111",person_code:"11223344",domicile:"via bassini 1, Milano",document_type:"ID Card",document_number:"343536gffgdg",document_expiration:K(),matricola_number:"263544",is_esner:!0}),h={email:[!1,""],email_confirm:[!1,""],password:[!1,""],password_confirm:[!1,""],name:[!1,""],surname:[!1,""],birthdate:[!1,""],country:[!1,""],phone_prefix:[!1,""],phone_number:[!1,""],person_code:[!1,""],domicile:[!1,""],document_type:[!1,""],document_number:[!1,""],document_expiration:[!1,""],matricola_number:[!1,""],is_esner:[!1,""]},[f,T]=fe.useState(h),[C,t]=a.useState({acceptStatute:!1,acceptPurposes:!1,acceptRegulation:!1,acceptPrivacy:!1}),[z,w]=a.useState({acceptStatute:!1,acceptPurposes:!1,acceptRegulation:!1,acceptPrivacy:!1}),n={statute:"https://drive.google.com/file/d/1rYtF01hrvQDIYHPebn1nNTDUOazS0kK2/view?usp=sharing",regulation:"https://drive.google.com/file/d/1ZuPfEshihDJ3lvoKyiQ_1L1BpsxBuZdq/view?usp=sharing",privacy:"https://drive.google.com/file/d/12LY0y49cCyjqdF0RotsO6srHrGkinNln/view?usp=sharing"},m=[{label:"Almeno 10 caratteri",test:I=>I.length>=10},{label:"Almeno 1 numero",test:I=>/\d/.test(I)},{label:"Almeno 1 lettera maiuscola",test:I=>/[A-Z]/.test(I)}],j=()=>{let I=!0;const b={...f},F={...z};["email","email_confirm","password","password_confirm","name","surname","birthdate","country","phone_prefix","phone_number","person_code","domicile","document_type","document_number","document_expiration","matricola_number"].forEach(E=>{!o[E]||typeof o[E]=="string"&&o[E].trim()===""?(b[E]=[!0,"Questo campo è obbligatorio"],I=!1):b[E]=[!1,""]}),/^\d{6}$/.test(o.matricola_number)?b.matricola_number=[!1,""]:(b.matricola_number=[!0,"La Matricola deve essere di 6 cifre"],I=!1),/^\d{8}$/.test(o.person_code)?b.person_code=[!1,""]:(b.person_code=[!0,"Il Codice Persona deve essere di 8 cifre"],I=!1);const c=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return o.email&&!c.test(o.email)&&(b.email=[!0,"Formato email non valido"],I=!1),o.email!==o.email_confirm?(b.email_confirm=[!0,"Le email non corrispondono"],I=!1):b.email_confirm=[!1,""],o.password!==o.password_confirm?(b.password_confirm=[!0,"Le password non corrispondono"],I=!1):b.password_confirm=[!1,""],Object.entries(C).forEach(([E,p])=>{p?F[E]=!1:(F[E]=!0,I=!1)}),T(b),w(F),I},v=()=>{window.scrollTo({top:0,behavior:"smooth"})},L=I=>K(I).format("YYYY-MM-DD"),D=I=>{g({...o,[I.target.name]:I.target.value}),f[I.target.name]&&T({...f,[I.target.name]:[!1,""]})},H=(I,b)=>{g({...o,[I]:b})},Y=I=>{const{name:b,checked:F}=I.target;t({...C,[b]:F}),F&&w({...z,[b]:!1})},P=I=>{if(I.preventDefault(),!j()){v();return}d(!0);let b={...o,birthdate:L(o.birthdate),document_expiration:L(o.document_expiration),matricola_expiration:L(o.matricola_expiration)};(async()=>{try{const S=await G("POST","/profile/initiate-creation/",b,{},!1),$=await S.json();if(T(h),S.ok)u(!0);else{r({message:"Errore nell'invio dati, guarda gli errori sotto",state:"error"});const A={...f};Object.entries($).forEach(([c,E])=>{A[c]&&(A[c]=[!0,E])}),T(A)}}catch(S){r({message:"Internal error (please contact us): "+S.message,state:"error"})}finally{d(!1)}})().then()};return x?e.jsxs(y,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",bgcolor:"#fff",children:[e.jsx(ya,{style:{fontSize:100,color:va[500]}}),e.jsx(M,{variant:"h4",align:"center",gutterBottom:!0,children:"La tua richiesta di registrazione è stata inviata con successo!"}),e.jsx(M,{variant:"subtitle1",align:"center",children:"Controlla la tua email per ulteriori istruzioni."}),e.jsxs(M,{variant:"body2",align:"center",sx:{mt:2},children:["In caso non avessi ricevuto nulla, controlla la cartella spam o contattaci all'indirizzo ",e.jsx(je,{href:"mailto: informatica@esnpolimi.it",children:"informatica@esnpolimi.it"})]}),e.jsx(je,{href:"/login",underline:"always",sx:{mt:3},children:"Torna al Login"})]}):e.jsxs(y,{component:"form",noValidate:!0,sx:{maxWidth:800,margin:"auto",mt:5,mb:5,px:4},onSubmit:P,children:[e.jsx(M,{variant:"h4",align:"center",gutterBottom:!0,mb:5,children:"ESN Polimi - Registrazione ESNer"}),s&&e.jsx(Ne,{message:s.message,state:s.state}),e.jsx(M,{variant:"h5",align:"center",gutterBottom:!0,sx:{my:4},children:"Informazioni Personali"}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(R,{label:_.name,variant:"outlined",name:"name",value:o.name,onChange:D,fullWidth:!0,required:!0,error:f.name[0],helperText:f.name[1]})}),e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(R,{label:_.surname,variant:"outlined",name:"surname",value:o.surname,onChange:D,fullWidth:!0,required:!0,error:f.surname[0],helperText:f.surname[1]})}),e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(pe,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(ye,{label:_.birthdate,value:o.birthdate,onChange:I=>H("birthdate",I),maxDate:K(),required:!0,renderInput:I=>e.jsx(R,{...I,fullWidth:!0,required:!0})})})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(R,{label:_.email,variant:"outlined",name:"email",type:"email",value:o.email,onChange:D,fullWidth:!0,required:!0,error:f.email[0],helperText:f.email[1]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(R,{label:"Conferma Email",variant:"outlined",name:"email_confirm",type:"email",value:o.email_confirm,onChange:D,fullWidth:!0,required:!0,error:f.email_confirm[0],helperText:f.email_confirm[1]})}),e.jsxs(i,{size:{xs:12,sm:6},children:[e.jsx(R,{type:"password",label:"Password",variant:"outlined",name:"password",value:o.password,onChange:D,fullWidth:!0,required:!0,error:f.password[0],helperText:f.password[1]}),e.jsxs(y,{sx:{mt:1,mb:2},children:[e.jsx(M,{variant:"caption",color:"text.secondary",children:"La password deve contenere:"}),e.jsx("ul",{style:{margin:0,paddingLeft:20},children:m.map((I,b)=>{const F=I.test(o.password);return e.jsxs("li",{style:{color:F?"green":"grey",display:"flex",alignItems:"center",marginBottom:2},children:[F?e.jsx(da,{fontSize:"small",sx:{mr:.5}}):e.jsx(Ee,{fontSize:"small",sx:{mr:.5}}),e.jsx("span",{children:I.label})]},b)})})]})]}),e.jsxs(i,{size:{xs:12,sm:6},children:[e.jsx(R,{type:"password",label:"Conferma Password",variant:"outlined",name:"password_confirm",value:o.password_confirm,onChange:D,fullWidth:!0,required:!0,error:f.password_confirm[0],helperText:f.password_confirm[1]}),e.jsx(y,{sx:{mt:1},children:o.password_confirm&&e.jsxs(M,{variant:"caption",sx:{display:"flex",alignItems:"center",color:o.password===o.password_confirm?"green":"grey"},children:[o.password===o.password_confirm?e.jsx(da,{fontSize:"small",sx:{mr:.5}}):e.jsx(Ee,{fontSize:"small",sx:{mr:.5}}),o.password===o.password_confirm?"Le password corrispondono":"Le password non corrispondono"]})})]}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"country-label",children:_.country}),e.jsx(re,{variant:"outlined",labelId:"country-label",name:"country",value:o.country,onChange:D,label:_.country,error:f.country[0],children:we.map(I=>e.jsx(q,{value:I.code,children:I.name},I.code))})]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(R,{label:_.domicile,variant:"outlined",name:"domicile",value:o.domicile,onChange:D,fullWidth:!0,required:!0,error:f.domicile[0],helperText:f.domicile[1]})}),e.jsx(i,{size:{xs:4,sm:2},children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(ne,{id:"phone-prefix-label",children:_.phone_prefix}),e.jsx(re,{variant:"outlined",labelId:"phone-prefix-label",id:"phone-prefix",name:"phone_prefix",value:o.phone_prefix,onChange:D,label:_.phone_prefix,renderValue:I=>I,error:f.phone_prefix[0],children:we.map(I=>e.jsxs(q,{value:I.dial,children:[I.dial," (",I.name,")"]},I.code))})]})}),e.jsx(i,{size:{xs:8,sm:4},children:e.jsx(R,{label:_.phone_number,variant:"outlined",name:"phone_number",type:"number",value:o.phone_number,onChange:D,fullWidth:!0,required:!0,error:f.phone_number[0],helperText:f.phone_number[1]})})]}),e.jsx(M,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Informazioni Documento"}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{size:{xs:12,sm:4},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"idType-label",children:"Tipo"}),e.jsxs(re,{variant:"outlined",labelId:"document-type-label",name:"document_type",value:o.document_type,onChange:D,label:"Tipo",required:!0,error:f.document_type[0],children:[e.jsx(q,{value:"Passport",children:"Passport"}),e.jsx(q,{value:"ID Card",children:"ID Card"}),e.jsx(q,{value:"Driving License",children:"Driving License"}),e.jsx(q,{value:"Residency Permit",children:"Residency Permit"}),e.jsx(q,{value:"Other",children:"Other"})]})]})}),e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(R,{label:"Numero",variant:"outlined",name:"document_number",value:o.document_number,onChange:D,fullWidth:!0,required:!0,error:f.document_number[0],helperText:f.document_number[1]})}),e.jsx(i,{size:{xs:12,sm:4},children:e.jsx(pe,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(ye,{label:"Data di Scadenza",value:o.document_expiration,onChange:I=>H("document_expiration",I),renderInput:I=>e.jsx(R,{...I,fullWidth:!0,required:!0})})})})]}),e.jsx(M,{variant:"h5",align:"center",gutterBottom:!0,my:4,children:"Informazioni Studente"}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(R,{label:_.person_code,variant:"outlined",name:"person_code",type:"number",value:o.person_code,onChange:D,fullWidth:!0,required:!0,error:f.person_code[0],helperText:f.person_code[1]})}),e.jsx(i,{size:{xs:12,sm:6},children:e.jsx(R,{label:_.matricola_number,variant:"outlined",name:"matricola_number",type:"number",value:o.matricola_number,onChange:D,fullWidth:!0,required:!0,error:f.matricola_number[0],helperText:f.matricola_number[1]})})]}),e.jsxs(i,{container:!0,spacing:2,mt:3,children:[e.jsx(i,{size:{xs:12},children:e.jsx(_e,{control:e.jsx(Te,{name:"acceptStatute",checked:C.acceptStatute,onChange:Y,required:!0,sx:{color:z.acceptStatute?"red":void 0,"&.Mui-checked":{color:z.acceptStatute?"red":void 0}}}),label:e.jsxs("span",{children:["Dichiaro di aver letto e accettato lo"," ",e.jsx(je,{href:n.statute,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Statuto di ESN Politecnico Milano"})]})})}),e.jsx(i,{size:{xs:12},children:e.jsx(_e,{control:e.jsx(Te,{name:"acceptPurposes",checked:C.acceptPurposes,onChange:Y,required:!0,sx:{color:z.acceptPurposes?"red":void 0,"&.Mui-checked":{color:z.acceptPurposes?"red":void 0}}}),label:"Dichiaro di condividere pienamente gli scopi dell'Associazione (rif. Articolo 2 dello Statuto)"})}),e.jsx(i,{size:{xs:12},children:e.jsx(_e,{control:e.jsx(Te,{name:"acceptRegulation",checked:C.acceptRegulation,onChange:Y,required:!0,sx:{color:z.acceptRegulation?"red":void 0,"&.Mui-checked":{color:z.acceptRegulation?"red":void 0}}}),label:e.jsxs("span",{children:["Dichiaro di accettare tutti i termini indicati nello"," ",e.jsx(je,{href:n.regulation,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Regolamento Interno"})," ","e tutte le successive modifiche e integrazioni"]})})}),e.jsx(i,{size:{xs:12},children:e.jsx(_e,{control:e.jsx(Te,{name:"acceptPrivacy",checked:C.acceptPrivacy,onChange:Y,required:!0,sx:{color:z.acceptPrivacy?"red":void 0,"&.Mui-checked":{color:z.acceptPrivacy?"red":void 0}}}),label:e.jsxs("span",{children:["Dichiaro di aver letto l'",e.jsx(je,{href:n.privacy,target:"_blank",rel:"noopener noreferrer",underline:"always",children:"Informativa sulla Privacy"})," ","e di acconsentire al trattamento dei miei dati personali secondo il Regolamento UE 2016/679 (GDPR) e di essere consapevole dei miei diritti garantiti dalla suddetta legge"]})})})]}),e.jsx(U,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:4},startIcon:!l&&e.jsx(_a,{}),disabled:l,children:l?e.jsx(Be,{size:24,color:"inherit"}):"Conferma Dati"})]})}const Ms=({onEdit:x,onCancel:u,onSave:s,saving:r})=>{const[l,d]=a.useState(!1),[_,o]=a.useState(!1),g=()=>{o(!0),x&&x()},h=()=>{r||(o(!1),u&&u())},f=async()=>{d(!0);try{s?await s()!==!1&&o(!1):o(!1)}catch(T){console.error("Error during save:",T)}finally{d(!1)}};return e.jsx("div",{children:_?e.jsxs(y,{sx:{display:"inline-flex"},children:[e.jsx(J,{onClick:h,"aria-label":"Cancel",disabled:r||l,children:e.jsx(Ba,{})}),r||l?e.jsx(J,{disabled:!0,children:e.jsx(Be,{size:"1rem"})}):e.jsx(J,{onClick:f,"aria-label":"Save",sx:{color:"#0288d1"},children:e.jsx(Ga,{})})]}):e.jsx(J,{onClick:g,"aria-label":"Edit",children:e.jsx(Ye,{})})})};function ha({cols:x,initialData:u,title:s,onSave:r,onDelete:l,onCreate:d,createText:_,canCreate:o,canDelete:g,canEdit:h,sortColumn:f}){const T=a.useMemo(()=>x,[x]),[C,t]=a.useState([]),n=h?e.jsx("span",{style:{color:"green"},children:"(Hai i permessi per eseguire modifiche)"}):e.jsx("span",{style:{color:"red"},children:"(Non hai i permessi per eseguire modifiche)"});a.useEffect(()=>{t(u)},[u]);const m=ke({columns:T,data:C,enableEditing:h,editDisplayMode:"row",createDisplayMode:"row",enableColumnFilters:!1,enableGlobalFilter:!1,enableSorting:f!=null,enableFullScreenToggle:!1,enableColumnOrdering:!1,enableColumnActions:!1,enableDensityToggle:!1,enableHiding:!1,enablePagination:!1,localization:De,initialState:{sorting:[{id:f,desc:!0}]},onCreatingRowSave:async({values:j,table:v})=>{let L=await d(j);L&&(t([...C,L]),v.setCreatingRow(!1))},onEditingRowSave:async({row:j,values:v})=>{if(await r(j.original,v)){const L=C.map((D,H)=>H===j.index?{...j.original,...v}:D);t(L),console.log(L),m.setEditingRow(null)}},getRowId:j=>j.id,renderRowActions:({row:j,table:v})=>e.jsxs(y,{sx:{display:"flex"},children:[e.jsx(Ge,{title:"Modifica",children:e.jsx(J,{onClick:()=>v.setEditingRow(j),children:e.jsx(Ye,{})})}),g&&e.jsx(Ge,{title:"Elimina",children:e.jsxs(J,{onClick:async()=>{await l(j.original),t(C.filter(L=>L.id!==j.id))},children:[" ",e.jsx(Sa,{})]})})]}),renderTopToolbarCustomActions:({table:j})=>e.jsxs(y,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsxs(y,{sx:{ml:3},children:[e.jsx("h3",{children:s}),e.jsx("h5",{children:n})]}),_!=null?e.jsx(U,{variant:"contained",color:"primary",onClick:d,sx:{ml:"auto",mr:2,visibility:o?"visible":"hidden"},children:_}):e.jsx(J,{sx:{ml:"auto",mr:2,visibility:o?"visible":"hidden"},onClick:()=>{j.setCreatingRow(!0)},children:e.jsx(Ka,{})})]})});return e.jsx(Fe,{table:m})}const Aa={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80%",maxWidth:1200,maxHeight:"90vh",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,overflow:"auto"},Oe={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",boxShadow:24,p:4,outline:"none",display:"flex",flexDirection:"column"},ve=({message:x,state:u,duration:s=2e3})=>(a.useEffect(()=>{const r=document.createElement("div"),l=document.createElement("button");if(u==="error"){l.style.marginRight="10px",l.style.cursor="pointer",l.style.border="none",l.style.color="white",l.style.backgroundColor="transparent",ba.createRoot(l).render(e.jsx(qa,{}));const T=document.createElement("span");T.innerText=x,r.appendChild(l),r.appendChild(T)}else r.innerText=x;r.style.display="flex",r.style.alignItems="center",r.style.position="fixed",r.style.top="-100px",r.style.left="50%",r.style.transform="translateX(-50%)",r.style.backgroundColor=u==="success"?"green":"red",r.style.color="white",r.style.padding="10px",r.style.borderRadius="5px",r.style.cursor="pointer",r.style.zIndex="9999",r.style.transition="opacity 0.5s ease-in-out, top 0.5s ease-in-out",document.body.appendChild(r);const d=()=>{navigator.clipboard.writeText(x).then()};u==="error"&&l.addEventListener("click",d);let _;requestAnimationFrame(()=>{r.style.top="20px"});const o=()=>{r.style.top="-100px",setTimeout(()=>{r.removeEventListener("mouseenter",g),r.removeEventListener("mouseleave",h),l.removeEventListener("click",d),document.body.contains(r)&&document.body.removeChild(r)},s/4)},g=()=>{clearTimeout(_)},h=()=>{_=setTimeout(o,s)};r.addEventListener("mouseenter",g),r.addEventListener("mouseleave",h),h()},[x,u,s]),null);function la({open:x,message:u,onConfirm:s,onClose:r}){return e.jsxs(Va,{open:x,onClose:r,children:[e.jsx(Ha,{children:"Conferma Azione"}),e.jsx(Ya,{children:e.jsx(M,{children:u})}),e.jsxs(Ua,{children:[e.jsx(U,{onClick:r,color:"secondary",children:"Annulla"}),e.jsx(U,{onClick:s,color:"primary",autoFocus:!0,children:"Conferma"})]})]})}function ge({size:x=40,fullScreen:u=!1}){return e.jsx(y,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:u?"100vh":"100%",width:"100%",position:u?"fixed":"relative",top:0,left:0,zIndex:u?1300:1,backgroundColor:u?"rgba(255, 255, 255, 0.7)":"transparent"},children:e.jsx(Be,{size:x})})}function As({open:x,profile:u,onClose:s}){const[r,l]=a.useState(0),[d,_]=a.useState(null),[o,g]=a.useState({open:!1,action:null,message:""}),[h,f]=a.useState(!0),[T,C]=a.useState([]),[t,z]=a.useState({esncard_number:"",account_id:""}),[w,n]=a.useState({esncard_number:[!1,""],account_id:[!1,""]}),m=[{field:"esncard_number",value:t.esncard_number,message:"Inserire il numero di ESNcard"},{field:"account_id",value:t.account_id,message:"Selezionare una Cassa"}];a.useEffect(()=>{f(!0),v().then(),j().then()},[]);const j=async()=>{try{const P=await G("GET","/esncard_fees/"),I=await P.json();if(P.ok)console.log("ESNcard fees:",I),u.latest_esncard&&u.latest_esncard?.is_valid?l(parseFloat(I.esncard_lost_fee.replace("€",""))):l(parseFloat(I.esncard_release_fee.replace("€","")));else{const b=await ee(I,P.status);_({message:`Errore fees ESNcard: ${b}`,state:"error"})}}catch(P){_({message:`Errore generale: ${P}`,state:"error"})}finally{f(!1)}},v=async()=>{try{const P=await G("GET","/accounts/"),I=await P.json();if(P.ok)C(I.results);else{const b=await ee(I,P.status);_({message:`Errore durante il recupero delle casse: ${b}`,state:"error"})}}catch(P){_({message:`Errore generale: ${P}`,state:"error"})}},L=()=>{const P={};return Object.keys(w).forEach(I=>{P[I]=[!1,""]}),n(P),P},D=async()=>{let P=!1;const I=L();if(m.forEach(F=>{F.value||(I[F.field]=[!0,F.message],P=!0)}),P){n(I);return}let b="Confermi un pagamento di "+r+"€ per l'emissione della ESNcard?";g({open:!0,action:()=>H(),message:b})},H=async()=>{g({open:!1,action:null,message:""});try{const P=await G("POST","/esncard_emission/",{profile_id:u.id,account_id:t.account_id,esncard_number:t.esncard_number,amount:r});if(P.ok)s(!0);else{const I=await P.json(),b=await ee(I,P.status);_({message:`Errore durante l'emissione della ESNcard: ${b}`,state:"error"})}}catch(P){_({message:`Errore generale: ${P}`,state:"error"})}},Y=P=>{z({...t,[P.target.name]:P.target.value})};return e.jsx(Pe,{open:x,onClose:()=>{s(!1)},"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsx(y,{sx:Oe,children:h?e.jsx(ge,{}):e.jsxs(e.Fragment,{children:[e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(J,{onClick:()=>s(!1),sx:{minWidth:0},children:e.jsx(Ee,{})})}),e.jsx(M,{variant:"h4",component:"h2",gutterBottom:!0,children:"Emissione ESNcard"}),e.jsx(We,{sx:{mb:2}}),e.jsxs(M,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"A:"})," ",u.name," ",u.surname]}),e.jsxs(M,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Importo:"})," ",r,"€"]}),e.jsxs(i,{container:!0,spacing:2,direction:"column",children:[e.jsx(i,{size:{xs:12},sx:{mt:2},children:e.jsx(R,{required:!0,label:"Numero ESNcard",name:"esncard_number",value:t.esncard_number,error:w.esncard_number[0],helperText:w.esncard_number[1],onChange:Y,fullWidth:!0})}),e.jsx(i,{size:{xs:12},sx:{mt:0},children:e.jsxs(Z,{fullWidth:!0,required:!0,error:w.account_id[0],children:[e.jsx(ne,{htmlFor:"account-selector",sx:{mb:2},children:"Seleziona Cassa"}),e.jsx(re,{variant:"outlined",label:"Seleziona Cassa",labelId:"account-selector-label",id:"account-selector",name:"account_id",value:t.account_id,error:w.account_id[0],onChange:Y,children:T.map(P=>e.jsxs(q,{value:P.id,disabled:P.status==="closed",style:{color:P.status==="closed"?"grey":"inherit"},children:[P.name," ",P.status==="closed"?"(Chiusa)":""]},P.id))}),w.account_id[0]&&e.jsx(Ue,{children:w.account_id[1]})]})})]}),e.jsx(U,{variant:"contained",fullWidth:!0,sx:{mt:2},onClick:D,children:"Conferma"}),d&&e.jsx(ve,{message:d.message,state:d.state}),e.jsx(la,{open:o.open,message:o.message,onConfirm:o.action,onClose:()=>g({open:!1,action:null,message:""})})]})})})}const Ls={ESNer:{hideFields:["course","matricola_expiration","whatsapp_prefix","whatsapp_number"]},Erasmus:{hideFields:["group"]}};function La({open:x,onClose:u,inProfile:s,profileType:r,updateProfile:l}){const[d,_]=a.useState(!1),[o,g]=a.useState(!0),{user:h}=Ae(),[f,T]=a.useState(s),[C,t]=a.useState(null),[z,w]=a.useState(!1),[n,m]=a.useState({}),[j,v]=a.useState({}),[L,D]=a.useState([]),[H,Y]=a.useState({email:"",name:"",surname:"",birthdate:"",country:"",phone_prefix:"",phone_number:"",whatsapp_prefix:"",whatsapp_number:"",person_code:"",domicile:"",course:"",matricola_number:"",matricola_expiration:"",documents:[],esncards:[],group:""}),[P,I]=a.useState({email:"",name:"",surname:"",birthdate:"",country:"",phone_prefix:"",phone_number:"",whatsapp_prefix:"",whatsapp_number:"",person_code:"",domicile:"",course:"",matricola_number:"",matricola_expiration:"",group:""}),[b,F]=a.useState({email:[!1,""],name:[!1,""],surname:[!1,""],birthdate:[!1,""],country:[!1,""],phone_prefix:[!1,""],phone_number:[!1,""],whatsapp_prefix:[!1,""],whatsapp_number:[!1,""],person_code:[!1,""],domicile:[!1,""],course:[!1,""],matricola_number:[!1,""],matricola_expiration:[!1,""],group:[!1,""]}),[S,$]=a.useState({email:!0,name:!0,surname:!0,birthdate:!0,country:!0,phone_prefix:!0,phone_number:!0,whatsapp_prefix:!0,whatsapp_number:!0,person_code:!0,domicile:!0,course:!0,matricola_number:!0,matricola_expiration:!0,group:!0});a.useEffect(()=>{g(!0),(async()=>{try{const B=await G("GET",`/profile/${f.id.toString()}/`),V=await B.json();if(B.ok){const ie={};Object.keys(H).map(ue=>{ie[ue]=V[ue]}),Y(ie),I(ie)}else{const ie=await ee(V,B.status);t({message:`Errore: ${ie}`,state:"error"})}}catch(B){t({message:`Errore generale: ${B}`,state:"error"})}finally{g(!1)}})().then()},[]),a.useEffect(()=>{(async()=>{try{const B=await G("GET","/groups/"),V=await B.json();B.ok?D(V):t({message:`Errore nel recupero dei gruppi: ${await ee(V,B.status)}`,state:"error"})}catch(B){console.error("Error fetching groups:",B),t({message:`Errore generale: ${B}`,state:"error"})}})().then()},[]);const A=Ls[r]||{hideFields:[]},c=k=>A.hideFields.includes(k),E=async()=>{try{const k=await G("GET",`/profile/${f.id.toString()}/`),B=await k.json();if(k.ok)Y(B),I(B),l&&l(B),T(B);else{const V=await ee(B,k.status);t({message:`Errore: ${V}`,state:"error"})}}catch(k){t({message:`Errore generale: ${k}`,state:"error"})}},p=()=>{w(!0)},N=async k=>{k&&(t({message:"ESNcard emessa con successo!",state:"success"}),await E()),w(!1)},se=a.useMemo(()=>[{accessorKey:"number",header:"Numero",size:100,muiEditTextFieldProps:{required:!0,helperText:n?.number,error:!!n?.number}},{accessorKey:"created_at",enableEditing:!1,header:"Rilascio",size:100,Cell:({cell:k})=>{const B=new Date(k.getValue());return B==null?"Null":B.toISOString().split("T")[0]}},{accessorKey:"expiration",enableEditing:!1,header:"Scadenza",size:100,Cell:({cell:k})=>{const ie=new Date(k.getValue())<new Date;return e.jsx("span",{style:{color:ie?"orange":"green"},children:k.getValue()})}}],[]),ce=async(k,B)=>{try{const V=await G("PATCH",`/esncard/${k.id}/`,B);if(V.ok)return m({}),t({message:"ESNcard aggiornata con successo!",state:"success"}),await E(),!0;{const ie=await V.json(),ue=await ee(ie,V.status);return t({message:`Errore: ${ue}`,state:"error"}),!1}}catch(V){t({message:`Errore generale: ${V}`,state:"error"})}},W=a.useMemo(()=>[{accessorKey:"type",header:"Tipo",size:100,editVariant:"select",editSelectOptions:["Passport","ID Card","Driving License","Residency Permit","Other"],muiEditTextFieldProps:{select:!0,helperText:j?.type,error:!!j?.type}},{accessorKey:"number",header:"Numero",size:60,muiEditTextFieldProps:{required:!0,helperText:j?.number,error:!!j?.number}},{accessorKey:"expiration",header:"Scadenza",size:60,muiEditTextFieldProps:{required:!0,helperText:j?.expiration,error:!!j?.expiration,type:"date"},Cell:({cell:k})=>{const ie=new Date(k.getValue())<new Date;return e.jsx("span",{style:{color:ie?"orange":"green"},children:k.getValue()})}}],[]),Q=async k=>{try{const B=await G("DELETE",`/document/${k.id}/`);if(B.ok)return v({}),t({message:"Documento eliminato con successo!",state:"success"}),await E(),!0;{B.json().then(ue=>v(ue));const V=await B.json(),ie=await ee(V,B.status);t({message:`Errore: ${ie}`,state:"error"})}}catch(B){t({message:`Errore generale: ${B}`,state:"error"})}},oe=async k=>{let B={...k,profile:f.id};try{const V=await G("POST","/document/",B);if(V.ok)return v({}),t({message:"Documento aggiunto con successo!",state:"success"}),await E(),!0;{V.json().then(Ze=>v(Ze));const ie=await V.json(),ue=await ee(ie,V.status);return t({message:`Errore: ${ue}`,state:"error"}),!1}}catch(V){return t({message:`Errore generale: ${V}`,state:"error"}),!1}},le=async(k,B)=>{try{const V=await G("PATCH",`/document/${k.id}/`,B);if(V.ok)return v({}),t({message:"Documento aggiornato con successo!",state:"success"}),await E(),!0;{V.json().then(Ze=>v(Ze));const ie=await V.json(),ue=await ee(ie,V.status);return t({message:`Errore: ${ue}`,state:"error"}),!1}}catch(V){return t({message:`Errore generale: ${V}`,state:"error"}),!1}},de=k=>k?K(k).format("YYYY-MM-DD"):null,X=k=>{I({...P,[k.target.name]:k.target.value})},be=(k,B)=>{I({...P,[k]:B})},Le=()=>{const k={};Object.keys(b).forEach(B=>{k[B]=[!1,""]}),F(k)},Re=k=>{$(Object.fromEntries(Object.keys(S).map(B=>[B,!k]))),Le()},Je=async()=>{if(_(!0),P.matricola_number&&!/^\d{6}$/.test(P.matricola_number))return F(k=>({...k,matricola_number:[!0,"La Matricola deve essere composta da 6 cifre"]})),_(!1),!1;try{const k={...P,birthdate:de(P.birthdate),matricola_expiration:de(P.matricola_expiration)},B=await G("PATCH",`/profile/${f.id.toString()}/`,k);if(B.ok)await E(),H&&(Le(),t({message:"Profilo aggiornato con successo!",state:"success"}),Re(!1));else{const V=await B.json(),ie=Object.fromEntries(Object.keys(b).map(ue=>ue in V?[ue,[!0,V[ue]]]:[ue,[!1,""]]));F(ie)}}catch(k){I(H),t({message:`Errore generale: ${k}`,state:"error"}),Re(!1)}finally{_(!1)}};return e.jsx(Pe,{open:x,onClose:u,children:e.jsxs(y,{sx:Aa,onKeyDown:k=>k.stopPropagation(),children:[e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(J,{onClick:()=>u(!1),sx:{minWidth:0},children:e.jsx(Ee,{})})}),e.jsxs(M,{variant:"h5",gutterBottom:!0,align:"center",children:["Profilo ",r]}),o?e.jsx(ge,{}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{sx:{p:"20px"},children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{container:!0,size:{xs:12},alignItems:"center",children:[e.jsx(sa,{}),e.jsx(M,{variant:"h6",sx:{m:0},children:"Informazioni Personali"}),e.jsx(i,{sx:{marginLeft:"auto"},children:e.jsx(Ms,{onEdit:()=>Re(!0),onCancel:()=>{Re(!1),I(H)},saving:d,onSave:Je})})]}),!c("name")&&e.jsx(i,{size:{xs:12,md:4,lg:4},children:e.jsx(R,{label:O.name,name:"name",value:P.name,error:b.name[0],helperText:b.name[1],slotProps:{input:{readOnly:S.name}},onChange:X,sx:{backgroundColor:S.name?"grey.200":"white"},fullWidth:!0})}),!c("surname")&&e.jsx(i,{size:{xs:12,md:4,lg:4},children:e.jsx(R,{label:O.surname,name:"surname",value:P.surname,error:b.surname[0],helperText:b.surname[1],onChange:X,slotProps:{input:{readOnly:S.surname}},sx:{backgroundColor:S.surname?"grey.200":"white"},fullWidth:!0})}),!c("email")&&e.jsx(i,{size:{xs:12,md:4,lg:4},children:e.jsx(R,{label:O.email,name:"email",type:"email",value:P.email,error:b.email[0],helperText:b.email[1],slotProps:{input:{readOnly:!0}},sx:{backgroundColor:"grey.200"},onChange:X,fullWidth:!0})}),!c("country")&&e.jsx(i,{size:{xs:12,md:4,lg:4},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"country-label",children:O.country}),e.jsxs(re,{variant:"outlined",labelId:"country-label",name:"country",label:O.country,value:P.country,error:b.country[0],onChange:X,slotProps:{input:{readOnly:S.country}},sx:{backgroundColor:S.country?"grey.200":"white"},children:[e.jsx(q,{value:"",children:e.jsx("em",{children:"None"})}),we.map(k=>e.jsx(q,{value:k.code,children:k.name},k.code))]})]})}),!c("domicile")&&e.jsx(i,{size:{xs:12,md:4,lg:5},children:e.jsx(R,{label:O.domicile,name:"domicile",value:P.domicile,error:b.domicile[0],helperText:b.domicile[1],onChange:X,slotProps:{input:{readOnly:S.domicile}},sx:{backgroundColor:S.domicile?"grey.200":"white"},fullWidth:!0})}),!c("birthdate")&&e.jsx(i,{size:{xs:12,md:4,lg:3},children:e.jsx(pe,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(ye,{label:O.birthdate,value:P.birthdate?K(P.birthdate,"YYYY-MM-DD"):null,readOnly:S.birthdate,onChange:k=>be("birthdate",k),sx:{backgroundColor:S.birthdate?"grey.200":"white"},renderInput:k=>e.jsx(R,{...k,fullWidth:!0,required:!0})})})}),!c("phone_prefix")&&!c("phone_number")&&e.jsxs(i,{size:{xs:12},container:!0,spacing:2,children:[e.jsx(i,{size:{xs:1.5},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"phone-prefix-label",children:O.phone_prefix}),e.jsx(re,{variant:"outlined",labelId:"phone-prefix-label",id:"phone-prefix",name:"phone_prefix",value:P.phone_prefix||"",onChange:X,slotProps:{input:{readOnly:S.phone_number}},sx:{backgroundColor:S.phone_number?"grey.200":"white"},label:O.phone_prefix,renderValue:k=>k,children:we.map(k=>e.jsxs(q,{value:k.dial,children:[k.dial," (",k.name,")"]},k.code))})]})}),e.jsx(i,{size:{xs:3},children:e.jsx(R,{label:O.phone_number,name:"phone_number",value:P.phone_number||"",error:b.phone_number[0],helperText:b.phone_number[1],onChange:X,slotProps:{input:{readOnly:S.phone_number}},sx:{backgroundColor:S.phone_number?"grey.200":"white"},fullWidth:!0})})]}),!c("whatsapp_prefix")&&!c("whatsapp_number")&&e.jsxs(i,{size:{xs:12},container:!0,spacing:2,children:[e.jsx(i,{size:{xs:1.5},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"whatsapp-prefix-label",children:O.whatsapp_prefix}),e.jsx(re,{variant:"outlined",labelId:"whatsapp-prefix-label",id:"whatsapp-prefix",name:"whatsapp_prefix",value:P.whatsapp_prefix||"",onChange:X,slotProps:{input:{readOnly:S.whatsapp_prefix}},sx:{backgroundColor:S.whatsapp_prefix?"grey.200":"white"},label:O.whatsapp_prefix,renderValue:k=>k,children:we.map(k=>e.jsxs(q,{value:k.dial,children:[k.dial," (",k.name,")"]},k.code))})]})}),e.jsx(i,{size:{xs:3},children:e.jsx(R,{label:O.whatsapp_number,name:"whatsapp_number",value:P.whatsapp_number||"",error:b.whatsapp_number[0],helperText:b.whatsapp_number[1],onChange:X,slotProps:{input:{readOnly:S.whatsapp_number}},sx:{backgroundColor:S.whatsapp_number?"grey.200":"white"},fullWidth:!0})})]}),e.jsxs(i,{container:!0,size:{xs:12},sx:{mt:2},alignItems:"center",children:[e.jsx(Ja,{}),e.jsx(M,{variant:"h6",sx:{m:0},children:"Dati Studente"})]}),!c("person_code")&&e.jsx(i,{size:{xs:12,md:4,lg:3},children:e.jsx(R,{label:O.person_code,name:"person_code",value:P.person_code||"",error:b.person_code[0],helperText:b.person_code[1],onChange:X,slotProps:{input:{readOnly:S.person_code}},sx:{backgroundColor:S.person_code?"grey.200":"white"},fullWidth:!0})}),!c("course")&&e.jsx(i,{size:{xs:12,md:4,lg:3},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"course-label",children:O.course}),e.jsxs(re,{variant:"outlined",labelId:"course-label",name:"course",label:O.course,value:P.course||"",onChange:X,slotProps:{input:{readOnly:S.course}},sx:{backgroundColor:S.course?"grey.200":"white"},children:[e.jsx(q,{value:"Engineering",children:"Ingegneria"}),e.jsx(q,{value:"Design",children:"Design"}),e.jsx(q,{value:"Architecture",children:"Architettura"})]})]})}),!c("matricola_number")&&e.jsx(i,{size:{xs:12,md:4,lg:3},children:e.jsx(R,{label:O.matricola_number,name:"matricola_number",value:P.matricola_number||"",error:b.matricola_number[0],helperText:b.matricola_number[1],onChange:X,sx:{backgroundColor:S.matricola_number?"grey.200":"white"},type:"number",slotProps:{input:{readOnly:S.matricola_number}},fullWidth:!0})}),!c("matricola_expiration")&&e.jsx(i,{size:{xs:12,md:4,lg:3},children:e.jsx(pe,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(ye,{label:O.matricola_expiration,value:P.matricola_expiration?K(P.matricola_expiration,"YYYY-MM-DD"):null,readOnly:S.matricola_expiration,onChange:k=>be("matricola_expiration",k),sx:{backgroundColor:S.matricola_expiration?"grey.200":"white"},renderInput:k=>e.jsx(R,{...k,fullWidth:!0,required:!0})})})}),!c("group")&&e.jsxs(i,{container:!0,alignItems:"center",spacing:1,sx:{width:"100%",mt:2},children:[e.jsx(Za,{}),e.jsx(i,{size:{xs:2},children:e.jsxs(Z,{fullWidth:!0,required:!0,children:[e.jsx(ne,{id:"group-label",children:O.group}),e.jsx(re,{variant:"outlined",labelId:"group-label",label:O.group,name:"group",value:P.group||"",onChange:X,slotProps:{input:{readOnly:S.group}},sx:{backgroundColor:S.group?"grey.200":"white"},children:L.map(k=>e.jsx(q,{value:k.name,children:k.name},k.name))})]})})]})]})}),e.jsxs(Ke,{sx:{p:1,mt:2,mb:2,minHeight:"80px",display:"flex",alignItems:"center"},children:[e.jsxs(Qa,{sx:{justifyContent:"space-between",width:"100%",p:0},children:[e.jsx(M,{variant:"h6",children:"Azioni"}),e.jsx(U,{variant:"contained",color:"primary",children:"Esporta Profilo"})]}),z&&e.jsx(As,{open:z,profile:f,onClose:N})]}),e.jsxs(i,{container:!0,sx:{width:"100%"},spacing:2,children:[e.jsx(i,{size:{xs:12,md:6},children:e.jsx(ha,{cols:W,canCreate:h.permissions.includes("add_document"),canEdit:h.permissions.includes("change_document"),canDelete:h.permissions.includes("delete_document"),onCreate:oe,onSave:le,onDelete:Q,initialData:H.documents,title:"Documenti",sortColumn:"expiration"})}),e.jsx(i,{size:{xs:12,md:6},children:e.jsx(ha,{cols:se,canCreate:h.permissions.includes("add_esncard"),onCreate:p,createText:f.latest_esncard?f.latest_esncard.is_valid?"Card Smarrita":"Rinnova":"Rilascia",canEdit:h.permissions.includes("change_esncard"),onSave:ce,initialData:H.esncards,title:"ESNcards",sortColumn:"expiration"})})]}),C&&e.jsx(ve,{message:C.message,state:C.state})]})]})})}const xa=[{value:"valid",label:"Valida"},{value:"expired",label:"Scaduta"},{value:"absent",label:"Assente"}];function Ra({apiEndpoint:x,columns:u,columnVisibility:s,profileType:r}){const[l,d]=a.useState([]),[_,o]=a.useState(!1),[g,h]=a.useState({}),[f,T]=a.useState({pageIndex:0,pageSize:10}),[C,t]=a.useState(0),[z,w]=a.useState([]),[n,m]=a.useState({esncardValidity:[],group:[]}),[j,v]=a.useState(""),[L,D]=a.useState(""),[H,Y]=a.useState(!0),P=a.useRef(null);a.useEffect(()=>{Y(!0),(async()=>{try{const E=new URLSearchParams;E.append("page",f.pageIndex+1),E.append("page_size",f.pageSize),L&&E.append("search",L),n.esncardValidity.length&&E.append("esncardValidity",n.esncardValidity.join(",")),n.group.length&&E.append("group",n.group.join(","));const N=await(await G("GET",`${x}?${E.toString()}`)).json();t(N.count||0),d(N.results)}catch(E){console.error("Error fetching data:",E)}finally{Y(!1)}})().then(),r==="ESNer"&&G("GET","/groups/").then(E=>{E.ok&&E.json().then(p=>w(p))})},[x,f.pageIndex,f.pageSize,r,n,L]);const I=()=>{D(j),T(c=>({...c,pageIndex:0}))},b=()=>{v(""),D(""),T(c=>({...c,pageIndex:0})),P.current&&P.current.focus()},F=ke({columns:u,data:l,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableColumnPinning:!0,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableRowPinning:!0,enableExpandAll:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},columnVisibility:s},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",enableGlobalFilter:!1,muiPaginationProps:{color:"secondary",rowsPerPageOptions:[10,20,50],shape:"rounded",variant:"outlined"},manualPagination:!0,rowCount:C,onPaginationChange:T,state:{pagination:f},localization:De,muiTableBodyRowProps:({row:c})=>({onClick:()=>{h(c.original),o(!0)}})}),S=c=>{d(E=>E.map(p=>p.id===c.id?c:p))},$=()=>{o(!1)},A=c=>{const{name:E,value:p}=c.target;m(N=>({...N,[E]:typeof p=="string"?p.split(","):p}))};return e.jsxs(y,{sx:{mx:"5%"},children:[e.jsxs(i,{container:!0,spacing:2,sx:{mb:2,mt:2},alignItems:"center",justifyContent:"flex-end",children:[e.jsx(i,{size:{xs:12,sm:2},children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(ne,{id:"esncard-validity-label",children:"Validità ESNcard"}),e.jsx(re,{labelId:"esncard-validity-label",name:"esncardValidity",variant:"outlined",multiple:!0,value:n.esncardValidity,onChange:A,input:e.jsx(Ce,{label:"Validità ESNcard"}),renderValue:c=>xa.filter(E=>c.includes(E.value)).map(E=>E.label).join(", "),children:xa.map(c=>e.jsx(q,{value:c.value,children:c.label},c.value))})]})}),r==="ESNer"&&z.length>0&&e.jsx(i,{size:{xs:12,sm:2},children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(ne,{id:"group-label",children:"Gruppo"}),e.jsx(re,{labelId:"group-label",name:"group",variant:"outlined",multiple:!0,value:n.group,onChange:A,input:e.jsx(Ce,{label:"Gruppo"}),renderValue:c=>z.filter(E=>c.includes(E.name)).map(E=>E.name).join(", "),children:z.map(c=>e.jsx(q,{value:c.name,children:c.name},c.name))})]})}),e.jsx(i,{size:{xs:12,sm:2},sm:"auto",children:e.jsx(Ce,{inputRef:P,size:"small",placeholder:"Cerca",value:j,onChange:c=>v(c.target.value),onKeyDown:c=>{c.key==="Enter"&&I()},endAdornment:j&&L===j?e.jsx(J,{"aria-label":"clear",onClick:b,edge:"end",children:e.jsx($e,{})}):e.jsx(J,{"aria-label":"search",onClick:I,edge:"end",children:e.jsx(ta,{})})})})]}),H?e.jsx(ge,{}):e.jsx(Fe,{table:F}),_&&e.jsx(La,{open:_,inProfile:g,profileType:r,onClose:$,updateProfile:S})]})}const Rs=()=>{const{logout:x}=Ae(),u=Ie(),s=()=>{x(),u("/login")};return e.jsx(U,{variant:"contained",sx:{backgroundColor:"black",color:"white",marginTop:2},onClick:s,children:"Logout"})};function Fs({user:x}){const[u,s]=a.useState(!1),r=a.useCallback(()=>{s(!0)},[]),l=a.useCallback(_=>{s(!1)},[]),d=a.useCallback(_=>{x={...x,profile:_}},[x]);return e.jsxs(y,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px"},children:[e.jsx(J,{onClick:r,"aria-label":"Profile",children:e.jsx(sa,{})}),e.jsxs(y,{sx:{flexGrow:1,marginLeft:"10px"},children:[e.jsxs(M,{variant:"body2",children:[x.profile.name," ",x.profile.surname," (",x.groups[0],")"]}),e.jsx(Rs,{})]}),e.jsx(La,{inProfile:x.profile,profileType:"ESNer - "+x.groups[0],open:u,handleClose:l,updateProfile:d})]})}function Me(){const{isDrawerOpen:x,toggleDrawer:u,expandedSection:s,handleExpand:r}=zs(),{user:l}=Ae(),d=g=>l?.permissions?.includes(g)||!1,_=[{text:"Home",icon:e.jsx(Xa,{}),path:"/"},{text:"Tesoreria",icon:e.jsx(es,{}),path:"/treasury",requiredPermission:"change_account"},{text:"Eventi",icon:e.jsx(na,{}),path:"/events"},{text:"Profili",icon:e.jsx(sa,{}),children:[{text:"Erasmus",icon:e.jsx(Ca,{}),path:"/profiles/erasmus"},{text:"ESNers",icon:e.jsx(wa,{}),path:"/profiles/esners"}]}].filter(g=>!g.requiredPermission||d(g.requiredPermission)),o=e.jsxs(y,{sx:{width:250,display:"flex",flexDirection:"column",height:"100%"},role:"presentation",onClick:u(!1),onKeyDown:u(!1),children:[e.jsx(y,{sx:{flexGrow:1},children:_.map(g=>e.jsx(fe.Fragment,{children:g.children?e.jsxs(fe.Fragment,{children:[e.jsxs(as,{onClick:h=>{h.stopPropagation(),r(g.text)},children:[e.jsx(Xe,{children:g.icon}),e.jsx(ea,{primary:g.text,slotProps:{primary:{style:{color:"black"}}}}),s===g.text?e.jsx(Ea,{}):e.jsx(Ta,{})]}),e.jsx(Ia,{in:s===g.text,timeout:"auto",unmountOnExit:!0,children:e.jsx(ss,{component:"div",disablePadding:!0,children:g.children?.map(h=>e.jsxs(ua,{component:pa,to:h.path,sx:{pl:4},children:[e.jsx(Xe,{children:h.icon}),e.jsx(ea,{primary:h.text,slotProps:{primary:{style:{color:"black"}}}})]},h.text))||[]})})]},g.text):e.jsxs(ua,{component:pa,to:g.path,children:[e.jsx(Xe,{children:g.icon}),e.jsx(ea,{primary:g.text,slotProps:{primary:{style:{color:"black"}}}})]},g.text)},g.text))}),l&&e.jsx(y,{sx:{mt:"auto",mb:2},children:e.jsx(Fs,{user:l})})]});return e.jsxs(y,{sx:{display:"flex"},children:[e.jsx(J,{edge:"start",color:"inherit","aria-label":"menu",onClick:u(!0),sx:{margin:"10px"},children:e.jsx(ts,{})}),e.jsx(ns,{anchor:"left",open:x,onClose:u(!1),children:o})]})}function Ns(){const x=a.useMemo(()=>[{accessorKey:"id",header:O.id,size:50},{accessorKey:"name",header:O.name,size:150},{accessorKey:"surname",header:O.surname,size:150},{accessorKey:"email",header:O.email,size:150},{accessorKey:"latest_esncard",header:O.latest_esncard,size:50,Cell:({cell:s})=>e.jsx(y,{sx:{},children:s.getValue()!==null?e.jsx(ae,{label:s.getValue().number,color:s.getValue().is_valid?"success":"warning"}):e.jsx(ae,{label:"Nessuna ESNcard",color:"error"})})},{accessorKey:"country",header:O.country,size:150,Cell:({row:s})=>{const r=s.original.country,l=we.find(d=>d.code===r);return l?l.name:r||"(vuoto)"}},{accessorKey:"birthdate",header:O.birthdate,size:100},{accessorKey:"course",header:O.course,size:100},{accessorKey:"phone_prefix",header:"Prefisso Telefono",size:60},{accessorKey:"phone_number",header:"Numero Telefono (no prefisso)",size:120},{id:"fullPhoneNumber",header:O.phone_number,size:150,accessorFn:s=>`(${s.phone_prefix||"vuoto"}) ${s.phone_number||"(vuoto)"}`,Cell:({row:s})=>e.jsxs("span",{children:["(",s.original.phone_prefix||"vuoto",") ",s.original.phone_number||"(vuoto)"]})},{accessorKey:"whatsapp_prefix",header:"Prefisso WhatsApp",size:60},{accessorKey:"whatsapp_number",header:"Numero WhatsApp (no prefisso)",size:120},{id:"fullWANumber",header:O.whatsapp_number,size:150,accessorFn:s=>`(${s.whatsapp_prefix||"vuoto"}) ${s.whatsapp_number||"(vuoto)"}`,Cell:({row:s})=>e.jsxs("span",{children:["(",s.original.whatsapp_prefix||"vuoto",") ",s.original.whatsapp_number||"(vuoto)"]})},{accessorKey:"domicile",header:O.domicile,size:200},{accessorKey:"matricola_number",header:O.matricola_number,size:50},{accessorKey:"matricola_expiration",header:O.matricola_expiration,size:50},{accessorKey:"latest_document.number",header:O.latest_document,size:50}],[]),u={id:!0,name:!0,surname:!0,email:!0,country:!1,birthdate:!1,course:!1,fullPhoneNumber:!0,fullWANumber:!0,person_code:!1,domicile:!1,matricola_number:!1,matricola_expiration:!1,"latest_document.number":!1,phone_prefix:!1,phone_number:!1,whatsapp_prefix:!1,whatsapp_number:!1};return e.jsxs(y,{children:[e.jsx(Me,{}),e.jsx(y,{sx:{mx:"5%"},children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(Ca,{sx:{marginRight:"10px"}}),e.jsx(M,{variant:"h4",children:"Profili Erasmus"})]})}),e.jsx(Ra,{apiEndpoint:"/erasmus_profiles/",columns:x,columnVisibility:u,profileType:"Erasmus"})]})}function Os(){const x=a.useMemo(()=>[{accessorKey:"id",header:O.id,size:50},{accessorKey:"name",header:O.name,size:150},{accessorKey:"surname",header:O.surname,size:150},{accessorKey:"group",header:O.group,size:150,Cell:({cell:s})=>{const r=s.getValue();let l="default";return r==="Aspiranti"?l="info":r==="Attivi"?l="success":r==="Board"&&(l="warning"),e.jsx(ae,{label:r,color:l})}},{accessorKey:"email",header:O.email,size:150},{accessorKey:"latest_esncard",header:O.latest_esncard,size:50,Cell:({cell:s})=>e.jsx(y,{sx:{},children:s.getValue()!==null?e.jsx(ae,{label:s.getValue().number,color:s.getValue().is_valid?"success":"warning"}):e.jsx(ae,{label:"Nessuna ESNcard",color:"error"})})},{accessorKey:"country",header:O.country,size:150,Cell:({row:s})=>{const r=s.original.country,l=we.find(d=>d.code===r);return l?l.name:r||"(vuoto)"}},{accessorKey:"birthdate",header:O.birthdate,size:100},{accessorKey:"phone_prefix",header:"Prefisso Telefono",size:60},{accessorKey:"phone_number",header:"Numero Telefono (no prefisso)",size:120},{id:"fullPhoneNumber",header:O.phone_number,size:150,accessorFn:s=>`(${s.phone_prefix||"vuoto"}) ${s.phone_number||"(vuoto)"}`,Cell:({row:s})=>e.jsxs("span",{children:["(",s.original.phone_prefix||"vuoto",") ",s.original.phone_number||"(vuoto)"]})},{accessorKey:"person_code",header:O.person_code,size:150},{accessorKey:"domicile",header:O.domicile,size:200},{accessorKey:"matricola_number",header:O.matricola_number,size:50},{accessorKey:"latest_document.number",header:O.latest_document,size:50}],[]),u={id:!0,name:!0,surname:!0,groups:!0,email:!0,country:!0,birthdate:!1,fullPhoneNumber:!0,person_code:!1,domicile:!1,matricola_number:!1,"latest_document.number":!1,phone_prefix:!1,phone_number:!1};return e.jsxs(y,{children:[e.jsx(Me,{}),e.jsx(y,{sx:{mx:"5%"},children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(wa,{sx:{marginRight:"10px"}}),e.jsx(M,{variant:"h4",children:"Profili ESNers"})]})}),e.jsx(Ra,{apiEndpoint:"/esner_profiles/",columns:x,columnVisibility:u,profileType:"ESNer"})]})}function Fa({open:x,onClose:u,account:s,onSuccess:r}){const{user:l}=Ae(),[d,_]=a.useState({amount:"",type:"deposit",description:""}),o=async h=>{h.preventDefault();try{const f=await G("POST","/transaction/",{account:s.id,amount:d.type==="deposit"?Math.abs(d.amount):-Math.abs(d.amount),description:d.description,type:d.type,executor:l.profile.email});if(f.ok)r("Transazione registrata con successo"),u();else{const T=await f.json();r("Errore durante la registrazione: "+JSON.stringify(T),"error")}}catch(f){r("Errore durante la registrazione: "+f.message,"error")}},g=()=>u(!1);return e.jsx(Pe,{open:x,onClose:g,children:e.jsxs(y,{sx:Oe,component:"form",onSubmit:o,noValidate:!0,children:[e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsxs(J,{onClick:g,sx:{minWidth:0},children:[" ",e.jsx(Ee,{})," "]})}),e.jsxs(M,{variant:"h5",gutterBottom:!0,align:"center",sx:{mt:2},children:["Transazione Manuale - Cassa ",s?.name]}),e.jsxs(i,{container:!0,spacing:2,sx:{mt:2},children:[e.jsxs(Z,{fullWidth:!0,children:[e.jsx(ne,{children:"Tipo"}),e.jsxs(re,{variant:"outlined",value:d.type,label:"Tipo",onChange:h=>_({...d,type:h.target.value}),children:[e.jsx(q,{value:"deposit",children:"Deposito"}),e.jsx(q,{value:"withdrawal",children:"Prelievo"})]})]}),e.jsx(R,{margin:"dense",label:"Importo",type:"number",fullWidth:!0,value:d.amount,slotProps:{htmlInput:{min:"0.01",step:"0.01"}},onChange:h=>_({...d,amount:h.target.value})}),e.jsx(R,{margin:"dense",label:"Descrizione",type:"text",fullWidth:!0,multiline:!0,rows:2,value:d.description,onChange:h=>_({...d,description:h.target.value})})]}),e.jsxs(y,{mt:2,children:[e.jsx(U,{fullWidth:!0,onClick:u,children:"Annulla"}),e.jsx(U,{fullWidth:!0,variant:"contained",color:"primary",type:"submit",disabled:!d.amount||d.amount<=0,children:"Conferma"})]})]})})}const Ws={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"top",mt:4,minHeight:"100vh"};function $s(){const{user:x}=Ae(),[u,s]=a.useState([]),[r,l]=a.useState(null),[d,_]=a.useState(!1),[o,g]=a.useState(""),[h,f]=a.useState(!1),[T,C]=a.useState(null),[t,z]=a.useState(!1),w=x?.permissions.includes("change_account");a.useEffect(()=>{n().then()},[x]);const n=async()=>{try{const v=await G("GET","/accounts/"),L=await v.json();if(v.ok)s(L.results);else{const D=await ee(L,v.status);C({message:`Errore durante il recupero delle casse: ${D}`,state:"error"})}}catch(v){C({message:`Errore generale: ${v}`,state:"error"})}},m=(v,L)=>{l(v),g(L),_(!0)},j=async()=>{try{const v=await G("PATCH",`/account/${r.id}/`,{status:o==="open"?"open":"closed"});v.ok?(console.log(`Account ${o}ed successfully.`),n().then(),C({message:`Cassa ${o==="open"?"aperta":"chiusa"} con successo!`,state:"success"})):(console.error(`Failed to ${o} account.`),C({message:`Errore account: ${v.statusText}`,state:"error"}))}catch(v){console.error(`Error ${o}ing account:`,v),C({message:`Errore generale: ${v}`,state:"error"})}finally{_(!1)}};return e.jsxs(y,{children:[e.jsx(Me,{}),e.jsx(y,{sx:{width:"100%",maxWidth:"90%",mx:"auto",mt:0},children:e.jsxs(qe,{elevation:3,sx:{p:2,mb:0,borderRadius:5},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>f(v=>!v),children:[e.jsx(M,{variant:"h5",sx:{flexGrow:1,fontWeight:600},children:"Casse"}),e.jsx(J,{children:h?e.jsx(Ea,{}):e.jsx(Ta,{})})]}),e.jsx(Ia,{in:h,timeout:"auto",unmountOnExit:!0,children:e.jsx(y,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:2,justifyContent:"center"},children:u.map(v=>e.jsxs(Ke,{sx:{flex:"1 1 320px",minWidth:320,maxWidth:400,display:"flex",alignItems:"center",boxShadow:4,borderRadius:2,m:1},children:[e.jsxs(za,{sx:{flex:1},children:[e.jsx(M,{variant:"h6",sx:{fontWeight:700,color:"#2d3a4b"},children:v.name}),w&&e.jsxs(e.Fragment,{children:[e.jsxs(M,{variant:"body1",sx:{color:"#3e5060"},children:[me.balance,": ",e.jsxs("b",{children:["€",v.balance]})]}),e.jsxs(M,{variant:"body2",sx:{color:"#607d8b"},children:[me.changed_by,": ",v.changed_by.name||"N/A"]})]})]}),w?e.jsxs(rs,{sx:{pr:2,flexDirection:"column",alignItems:"flex-end"},children:[v.status==="closed"&&e.jsx(U,{variant:"contained",color:"success",onClick:()=>m(v,"open"),sx:{minWidth:120,fontWeight:600},children:"Apri Cassa"}),v.status==="open"&&e.jsxs(e.Fragment,{children:[e.jsx(U,{variant:"contained",color:"error",onClick:()=>m(v,"close"),sx:{minWidth:120,fontWeight:600,mb:1},children:"Chiudi Cassa"}),e.jsx(U,{variant:"contained",color:"primary",onClick:()=>{l(v),z(!0)},sx:{minWidth:120,fontWeight:600},children:"Deposita/Preleva"})]})]}):e.jsx(M,{variant:"h7",style:{color:v.status==="closed"?"red":"green",fontWeight:"bold",padding:"20px"},children:v.status==="closed"?"Cassa Chiusa":"Cassa Aperta"})]},v.id))})})]})}),e.jsxs(y,{sx:Ws,children:[e.jsx(M,{variant:"h3",gutterBottom:!0,children:"Sistema di Gestione"}),e.jsx("img",{src:ia,alt:"ESN Polimi Logo",style:{height:"25vh",marginTop:"2px"}}),e.jsxs("h1",{children:["Benvenuto, ",x?x.profile.name:"Sir","!"]})]}),e.jsx(la,{open:d,message:`Confermi la presenza di €${r?.balance} nella cassa "${r?.name}" prima di ${o==="open"?"aprirla":"chiuderla"}?`,onConfirm:j,onClose:()=>_(!1)}),e.jsx(Fa,{open:t,onClose:()=>z(!1),account:r,onSuccess:(v,L)=>C({message:v,state:L||"success"})}),T&&e.jsx(ve,{message:T.message,state:T.state})]})}function Bs({limit:x=5}){const[u,s]=a.useState([]),[r,l]=a.useState(!0);a.useEffect(()=>{(async()=>{l(!0);try{const g=await G("GET","/accounts/");if(g.ok){const h=await g.json();s(h.results)}}catch{}finally{l(!1)}})().then()},[]);const d=a.useMemo(()=>[{accessorKey:"name",header:me.name,size:100},{accessorKey:"balance",header:me.balance,size:100,Cell:({cell:o})=>e.jsx(y,{children:o.getValue()!==null?e.jsx(ae,{label:`€${o.getValue()}`,color:"primary"}):e.jsx(ae,{label:"N/A",color:"warning"})})},{accessorKey:"status",header:me.status,size:100,Cell:({cell:o})=>e.jsx(y,{children:o.getValue()!==null?e.jsx(ae,{label:o.getValue()==="open"?"Aperta":"Chiusa",color:o.getValue()==="open"?"success":"error"}):e.jsx(ae,{label:"Stato ignoto",color:"warning"})})}],[]),_=ke({columns:d,data:u.slice(0,x),enableKeyboardShortcuts:!1,enableColumnActions:!1,enableColumnFilters:!1,enablePagination:!1,enableSorting:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!1},paginationDisplayMode:"default",muiTableBodyRowProps:{hover:!1},localization:De});return r?e.jsx(ge,{}):e.jsx(ka,{table:_})}const Gs={subscription:{label:te.tran_type.subscription,color:"primary"},esncard:{label:te.tran_type.esncard,color:"secondary"},deposit:{label:te.tran_type.deposit,color:"success"},withdrawal:{label:te.tran_type.withdrawal,color:"error"}};function Ks({limit:x=5}){const[u,s]=a.useState([]),[r,l]=a.useState(!0);a.useEffect(()=>{(async()=>{l(!0);try{const g=await G("GET","/transactions/");if(g.ok){const h=await g.json();s(h.results),console.log("Transactions data:",h.results)}}catch{}finally{l(!1)}})().then()},[]);const d=a.useMemo(()=>[{accessorKey:"created_at",header:te.date,size:100,Cell:({cell:o})=>{const g=new Date(o.getValue());return e.jsx(y,{children:new Intl.DateTimeFormat("it-IT",{dateStyle:"medium",timeStyle:"short"}).format(g)})}},{accessorKey:"type",header:te.type,size:100,Cell:({cell:o})=>{const g=o.getValue(),h=Gs[g]||{label:"Sconosciuto",color:"default"};return e.jsx(ae,{label:h.label,color:h.color,variant:"outlined"})}},{accessorKey:"executor.name",header:te.executor,size:150},{accessorKey:"account.name",header:te.account,size:100,Cell:({cell:o})=>e.jsx(y,{component:"span",fontWeight:"bold",children:o.getValue()})},{accessorKey:"amount",header:te.amount,size:100,Cell:({cell:o})=>e.jsx(y,{children:o.getValue()!==null?e.jsx(ae,{label:`€${o.getValue()}`,color:"primary"}):e.jsx(ae,{label:"N/A",color:"warning"})})}],[]),_=ke({columns:d,data:u.slice(0,x),enableKeyboardShortcuts:!1,enableColumnActions:!1,enableColumnFilters:!1,enablePagination:!1,enableSorting:!0,initialState:{showColumnFilters:!1,showGlobalFilter:!1,sorting:[{id:"created_at",desc:!0}]},paginationDisplayMode:"default",muiTableBodyRowProps:{hover:!1},localization:De});return r?e.jsx(ge,{}):e.jsx(ka,{table:_})}function qs(){const x=Ie();return e.jsxs(y,{children:[e.jsx(Me,{}),e.jsxs(y,{sx:{mx:"5%",mt:0},children:[e.jsx(M,{variant:"h4",sx:{mb:3},children:"Dashboard Tesoreria"}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{size:{xs:12,md:4},children:e.jsxs(qe,{elevation:3,sx:{p:2},children:[e.jsx(M,{variant:"h6",sx:{mb:2},children:"Casse"}),e.jsx(Bs,{limit:5}),e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(U,{variant:"outlined",size:"small",onClick:()=>x("/treasury/accounts_list/"),children:"Gestisci Casse"})})]})}),e.jsx(i,{size:{xs:12,md:8},children:e.jsxs(qe,{elevation:3,sx:{p:2},children:[e.jsx(M,{variant:"h6",sx:{mb:2},children:"Ultime Transazioni"}),e.jsx(Ks,{limit:3}),e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(U,{variant:"outlined",size:"small",onClick:()=>x("/treasury/transactions_list/"),children:"Gestisci Movimenti"})})]})})]})]})]})}function Vs({open:x,onClose:u,account:s=null}){const r=s!==null,[l,d]=a.useState(!0),[_,o]=a.useState(null),[g,h]=a.useState({name:"",visible_to_groups:[]}),[f,T]=a.useState({name:[!1,""],visible_to_groups:[!1,""]}),[C,t]=a.useState([]);a.useEffect(()=>{(async()=>{try{const v=await G("GET","/groups/"),L=await v.json();if(v.ok)t(L);else{const D=await ee(L,v.status);o({message:`Errore nel recupero dei gruppi: ${D}`,state:"error"})}}catch(v){o({message:`Errore nel recupero dei gruppi: ${v}`,state:"error"})}})().then()},[]),a.useEffect(()=>{h(r&&s?{name:s.name||"",visible_to_groups:s.visible_to_groups?.map(j=>j.id)||[]}:{name:"",visible_to_groups:[]}),d(!1)},[r,s]);const z=j=>{const{name:v,value:L}=j.target;h({...g,[v]:L})},w=j=>{h({...g,visible_to_groups:j.target.value})},n=async j=>{j.preventDefault();const v={...f};if(g.name.trim()?v.name=[!1,""]:v.name=[!0,"Il nome è obbligatorio"],g.visible_to_groups.length===0?v.visible_to_groups=[!0,"Seleziona almeno un gruppo"]:v.visible_to_groups=[!1,""],T(v),!(v.name[0]||v.visible_to_groups[0])){d(!0);try{const L={name:g.name,visible_to_groups:g.visible_to_groups};let D;if(r&&s?D=await G("PATCH",`/account/${s.id}/`,L):D=await G("POST","/account/",L),D.ok)u(!0);else{const H=await D.json(),Y=await ee(H,D.status);o({message:`Errore ${r?"modifica":"creazione"} cassa: ${Y}`,state:"error"})}}catch(L){o({message:`Errore generale: ${L}`,state:"error"})}finally{d(!1)}}},m=()=>{u(!1)};return e.jsx(Pe,{open:x,onClose:m,children:e.jsx(y,{sx:Oe,component:"form",onSubmit:n,noValidate:!0,children:l?e.jsx(ge,{}):e.jsxs(e.Fragment,{children:[e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(J,{onClick:m,sx:{minWidth:0},children:e.jsx(Ee,{})})}),e.jsx(M,{variant:"h5",gutterBottom:!0,align:"center",sx:{mb:2},children:r?`Modifica Cassa - ${s?.name}`:"Crea Cassa"}),_&&e.jsx(ve,{message:_.message,state:_.state}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{size:{xs:12},children:e.jsx(R,{fullWidth:!0,label:me.name,name:"name",value:g.name,onChange:z,required:!0,error:f.name[0],helperText:f.name[0]?f.name[1]:""})}),e.jsx(i,{size:{xs:12},children:e.jsxs(Z,{fullWidth:!0,error:f.visible_to_groups[0],children:[e.jsx(ne,{id:"groups-label",children:me.visible_to_groups}),e.jsx(re,{variant:"outlined",labelId:"groups-label",multiple:!0,value:g.visible_to_groups,onChange:w,input:e.jsx(Ce,{label:me.visible_to_groups}),renderValue:j=>e.jsx(y,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:j.map(v=>{const L=C.find(D=>D.id===v);return e.jsx(ae,{label:L?L.name:v},v)})}),children:C.map(j=>e.jsx(q,{value:j.id,children:j.name},j.id))}),f.visible_to_groups[0]&&e.jsx(Ue,{children:f.visible_to_groups[1]})]})})]}),e.jsx(y,{mt:2,children:e.jsx(U,{fullWidth:!0,variant:"contained",color:"primary",type:"submit",children:r?"Salva Modifiche":"Crea"})})]})})})}function Hs(){const[x,u]=a.useState([]),[s,r]=a.useState(!0),[l,d]=a.useState(!1),_=Ie(),[o,g]=a.useState(null),[h,f]=a.useState(null),[T,C]=a.useState(!1);a.useEffect(()=>{t().then()},[]);const t=async()=>{r(!0);try{const m=await G("GET","/accounts/"),j=await m.json();if(m.ok)u(j.results),console.log("Account List Data: ",j.results);else{const v=await ee(j,m.status);g({message:`Errore: ${v}`,state:"error"})}}catch(m){g({message:`Errore generale: ${m}`,state:"error"})}finally{r(!1)}},z=a.useMemo(()=>[{accessorKey:"id",header:me.id,size:50},{accessorKey:"name",header:me.name,size:150},{accessorKey:"changed_by.name",header:me.changed_by,size:150},{accessorKey:"balance",header:me.balance,size:100,Cell:({cell:m})=>e.jsx(y,{children:m.getValue()!==null?e.jsx(ae,{label:`€${m.getValue()}`,color:"primary"}):e.jsx(ae,{label:"N/A",color:"warning"})})},{accessorKey:"status",header:me.status,size:150,Cell:({cell:m})=>e.jsx(y,{sx:{},children:m.getValue()!==null?e.jsx(ae,{label:m.getValue()==="open"?"Aperta":"Chiusa",color:m.getValue()==="open"?"success":"error"}):e.jsx(ae,{label:"N/A",color:"warning"})})},{accessorKey:"visible_to_groups",header:me.visible_to_groups,size:150,Cell:({cell:m})=>e.jsx(y,{sx:{},children:m.getValue()!==null?m.getValue().map(j=>e.jsx(ae,{label:j.name,color:"grey",sx:{mr:1}},j.id)):e.jsx(ae,{label:"N/A",color:"warning"})})},{header:"Azioni",size:150,Cell:({row:m})=>e.jsxs(y,{sx:{display:"flex",gap:1},children:[e.jsx(J,{color:"primary",onClick:()=>{f(m.original),d(!0)},children:e.jsx(Ye,{})}),e.jsx(U,{variant:"contained",color:"primary",onClick:()=>{f(m.original),C(!0)},children:"Deposita/Preleva"})]})}],[]),w=ke({columns:z,data:x,enablePagination:!1,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableColumnPinning:!1,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableRowPinning:!1,enableExpandAll:!1,initialState:{showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},columnVisibility:{id:!1,name:!0,changed_by:!0,status:!0,balance:!0}},positionToolbarAlertBanner:"bottom",localization:De,muiTableBodyRowProps:()=>({sx:{cursor:"default"}}),renderTopToolbarCustomActions:()=>e.jsx(y,{sx:{display:"flex",flexDirection:"row"},children:e.jsx(U,{variant:"contained",onClick:()=>d(!0),sx:{width:"150px"},children:"Nuova Cassa"})})}),n=async m=>{m&&(g({message:"Cassa creata con successo!",state:"success"}),await t()),f(null),d(!1)};return e.jsxs(y,{children:[e.jsx(Me,{}),l&&e.jsx(Vs,{open:l,onClose:n,account:h}),e.jsx(Fa,{open:T,onClose:()=>C(!1),account:h,onSuccess:(m,j)=>g({message:m,state:j||"success"})}),e.jsx(y,{sx:{mx:"5%"},children:s?e.jsx(ge,{}):e.jsxs(e.Fragment,{children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(J,{onClick:()=>{_(-1)},sx:{mr:2},children:e.jsx(ra,{})}),e.jsx(os,{sx:{marginRight:"10px"}}),e.jsx(M,{variant:"h4",children:"Lista Casse"})]}),e.jsx(Fe,{table:w})]})}),o&&e.jsx(ve,{message:o.message,state:o.state})]})}function Na({value:x,onChange:u,readOnly:s=!1}){const r=a.useRef(null),l=a.useRef(null);return a.useEffect(()=>{if(r.current&&!l.current){const d=s?{toolbar:!1}:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["link"],["clean"]]};l.current=new Es(r.current,{theme:"snow",readOnly:s,modules:d}),l.current.on("text-change",()=>{u&&u(l.current.root.innerHTML)}),x&&(l.current.root.innerHTML=x)}},[x,u,s]),e.jsx("div",{ref:r})}function Oa({open:x,event:u,isEdit:s,onClose:r}){const[l,d]=a.useState(!0),_=s?"Modifica Evento - "+u.name:"Crea Evento",[o,g]=a.useState(null),[h,f]=a.useState(!1),[T,C]=a.useState({id:"",name:"",date:K(),description:`<h3>Descrizione</h3>    <p>Ecco un <a href="https://www.italia.it" target="_blank">link all'Italia</a>.</p>    <blockquote>Citazione elegante.</blockquote>    <p style="text-align: center;">Adios.</p>`,cost:"",subscription_start_date:K().hour(12).minute(0),subscription_end_date:K().hour(24).minute(0),lists:[{id:"",name:"Main List",capacity:""}]}),[t,z]=fe.useState({name:[!1,""],date:[!1,""],description:[!1,""],cost:[!1,""],subscription_start_date:[!1,""],subscription_end_date:[!1,""],lists:[!1,""],listItems:[]});a.useEffect(()=>{s&&(console.log("Setting form data: ",u),C(u),console.log("#Subsciptions: ",u.subscriptions.length),f(u.subscriptions.length>0)),d(!1)},[]);const w=S=>K(S).format("YYYY-MM-DD"),n=S=>K(S).toISOString(),m=S=>{S&&K(S).isBefore(K(),"day")||C({...T,date:S})},j=S=>{T.subscription_end_date&&K(S).isAfter(K(T.subscription_end_date))?C({...T,subscription_start_date:S,subscription_end_date:K(S).add(1,"day")}):C({...T,subscription_start_date:S})},v=S=>{if(S){const $=K(T.subscription_start_date),A=K(S),c=K();A.isBefore($)?S=$:A.isBefore(c)&&(S=c)}C({...T,subscription_end_date:S})},L=S=>({name:S.name,date:w(S.date),description:S.description,subscription_start_date:n(S.subscription_start_date),subscription_end_date:n(S.subscription_end_date),cost:Number(S.cost).toFixed(2),lists:S.lists.map($=>({id:$.id,name:$.name,capacity:Math.floor(Number($.capacity))}))}),D=()=>{window.scrollTo({top:0,behavior:"smooth"})},H=S=>{const{name:$,value:A,type:c,checked:E}=S.target;C({...T,[$]:c==="checkbox"?E:A})},Y=()=>{C({...T,lists:[...T.lists,{id:"",name:"",capacity:""}]})},P=(S,$)=>{const{name:A,value:c}=$.target,E=T.lists.map((p,N)=>N===S?{...p,[A]:c}:p);C({...T,lists:E})},I=S=>{C({...T,lists:T.lists.filter(($,A)=>A!==S)})},b=async S=>{S.preventDefault();const $=T.lists.map(c=>({name:!c.name.trim(),capacity:c.capacity===""})),A=$.some(c=>c.name||c.capacity);if(z({...t,listItems:$,lists:[A]}),A){g({message:"Errore campi Liste",state:"error"}),D();return}try{const c=s?await G("PATCH",`/event/${T.id}/`,L(T)):await G("POST","/event/",L(T));if(c.ok)r(!0);else{const E=await c.json(),p=await ee(E,c.status);g({message:`Errore ${s?"modifica":"creazione"} evento: ${p}`,state:"error"}),D()}}catch(c){g({message:`Errore generale: ${c}`,state:"error"}),D()}},F=()=>{r(!1)};return e.jsx(Pe,{open:x,onClose:F,children:e.jsx(y,{sx:Aa,component:"form",onSubmit:b,noValidate:!1,children:l?e.jsx(ge,{}):e.jsxs(e.Fragment,{children:[e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(J,{onClick:()=>r(!1),sx:{minWidth:0},children:e.jsx(Ee,{})})}),e.jsx(M,{variant:"h5",gutterBottom:!0,sx:{mb:2},align:"center",children:_}),o&&e.jsx(Ne,{message:o.message,state:o.state}),s&&h&&e.jsx(y,{sx:{mb:2,p:1,bgcolor:"#fff3e0",borderRadius:1},children:e.jsxs(M,{variant:"body2",color:"warning.main",children:[e.jsx(is,{fontSize:"small",sx:{verticalAlign:"middle",mr:1}}),"Alcuni campi non sono modificabili perché ci sono già iscrizioni. Rimuovi tutte le iscrizioni per abilitare la modifica."]})}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{size:{xs:12,md:6},children:e.jsx(R,{fullWidth:!0,label:xe.name,name:"name",value:T.name,onChange:H,required:!0,error:t.name[0]})}),e.jsx(i,{size:{xs:12,md:6},children:e.jsx(pe,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(ye,{label:xe.date,value:T.date,onChange:m,minDate:s?null:K(),renderInput:S=>e.jsx(R,{...S,fullWidth:!0,required:!0}),required:!0,error:t.date[0]})})}),e.jsx(i,{size:{xs:12,md:3},children:e.jsx(Ge,{title:s&&h?"Non modificabile con iscrizioni esistenti":"",children:e.jsxs("div",{children:[" ",e.jsx(pe,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(ma,{label:xe.subscription_start_date,value:T.subscription_start_date||null,onChange:j,minDate:s?null:K(),slotProps:{textField:{fullWidth:!0,required:!0}},disabled:s&&h,required:!0,error:t.subscription_start_date[0]})})]})})}),e.jsx(i,{size:{xs:12,md:3},children:e.jsx(pe,{dateAdapter:Se,adapterLocale:"en-gb",children:e.jsx(ma,{label:xe.subscription_end_date,value:T.subscription_end_date||null,onChange:v,minDate:K().isAfter(T.subscription_start_date)?K():T.subscription_start_date||K(),slotProps:{textField:{fullWidth:!0,required:!0}},required:!0,error:t.subscription_start_date[0]})})}),e.jsx(i,{size:{xs:12,md:3},children:e.jsx(Ge,{title:s&&h?"Non modificabile con iscrizioni esistenti":"",children:e.jsxs("div",{children:[" ",e.jsx(R,{fullWidth:!0,label:xe.cost,name:"cost",type:"number",slotProps:{htmlInput:{min:"0",step:"0.01"}},value:T.cost,onChange:H,placeholder:"Inserisci 0 se gratuito",required:!0,error:t.cost[0],disabled:s&&h})]})})})]}),e.jsxs(i,{size:{xs:12},"data-color-mode":"light",children:[e.jsx(M,{variant:"h6",component:"div",children:xe.description}),e.jsx(Na,{value:T.description,onChange:S=>{C({...T,description:S})}})]}),e.jsxs(y,{my:2,children:[e.jsxs(i,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(i,{children:e.jsx(M,{variant:"h6",gutterBottom:!0,children:"Liste"})}),e.jsx(i,{children:e.jsx(J,{onClick:Y,children:e.jsx(ls,{})})})]}),T.lists.map((S,$)=>e.jsxs(i,{container:!0,spacing:2,alignItems:"center",mb:2,children:[e.jsx(i,{children:e.jsx(R,{label:xe.list_name,name:"name",value:S.name,onChange:A=>P($,A),required:!0,error:t.listItems[$]?.name,helperText:t.listItems[$]?.name?"Il nome è obbligatorio":""})}),e.jsx(i,{children:e.jsx(R,{label:xe.list_capacity,name:"capacity",type:"number",value:S.capacity,slotProps:{htmlInput:{min:"0",step:"1"}},onChange:A=>P($,A),placeholder:"Inserisci 0 se illimitata",required:!0,error:t.listItems[$]?.capacity,helperText:t.listItems[$]?.capacity?"La capacità è obbligatoria":""})}),e.jsx(i,{size:{xs:2},children:e.jsx(J,{onClick:()=>I($),children:e.jsx(Sa,{})})})]},$))]}),e.jsx(y,{mt:2,children:e.jsx(U,{variant:"contained",color:"primary",type:"submit",children:s?"Salva Modifiche":"Crea"})})]})})})}const fa=[{value:"open",label:"Iscrizioni aperte"},{value:"not_yet",label:"Non ancora aperte"},{value:"closed",label:"Iscrizioni chiuse"}];function Ys(){const[x,u]=a.useState([]),[s,r]=a.useState(!0),[l,d]=a.useState(!1),_=Ie(),[o,g]=a.useState(null),[h,f]=a.useState({pageIndex:0,pageSize:10}),[T,C]=a.useState(0),[t,z]=a.useState(""),[w,n]=a.useState(""),[m,j]=a.useState({subscriptionStatus:[],dateFrom:null,dateTo:null}),[v,L]=a.useState(!1),D=a.useRef(null);a.useEffect(()=>{let A=!1;return(async()=>{L(!0);try{const E=new URLSearchParams;E.append("page",h.pageIndex+1),E.append("page_size",h.pageSize),w&&E.append("search",w),m.subscriptionStatus.length&&m.subscriptionStatus.forEach(se=>E.append("subscription_status",se)),m.dateFrom&&E.append("dateFrom",m.dateFrom.toISOString()),m.dateTo&&E.append("dateTo",m.dateTo.toISOString());const p=await G("GET",`/events/?${E.toString()}`),N=await p.json();if(p.ok)A||(C(N.count||0),u(N.results));else{const se=await ee(N,p.status);g({message:`Errore: ${se}`,state:"error"})}}catch(E){g({message:`Errore generale: ${E}`,state:"error"})}finally{L(!1)}})().then(),()=>{A=!0}},[h.pageIndex,h.pageSize,m,w]);const H=a.useMemo(()=>[{accessorKey:"id",header:xe.id,size:50},{accessorKey:"name",header:xe.name,size:150},{accessorKey:"date",header:xe.date,size:150},{accessorKey:"cost",header:xe.cost,size:150},{accessorKey:"subscription_start_date",header:xe.subscription_date_status,size:150,Cell:({row:A})=>{const c=K(),E=A.original.subscription_start_date?K(A.original.subscription_start_date):null,p=A.original.subscription_end_date?K(A.original.subscription_end_date):null;let N="Non disponibile",se="error";return E&&p&&(c.isAfter(E)&&c.isBefore(p)?(N="Iscrizioni aperte",se="success"):c.isBefore(E)?(N="Iscrizioni non ancora aperte",se="warning"):c.isAfter(p)&&(N="Iscrizioni chiuse",se="error")),e.jsx(ae,{label:N,color:se})}}],[]),Y=ke({columns:H,data:x,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableColumnPinning:!0,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableRowPinning:!0,enableExpandAll:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},columnVisibility:{id:!0,name:!0,date:!0,cost:!0}},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",enableGlobalFilter:!1,muiPaginationProps:{color:"secondary",rowsPerPageOptions:[10,20,30],shape:"rounded",variant:"outlined"},manualPagination:!0,rowCount:T,onPaginationChange:f,state:{pagination:h},localization:De,muiTableBodyRowProps:({row:A})=>({onClick:()=>{_("/event/"+A.original.id,{state:{event:A.original}})}}),renderTopToolbarCustomActions:()=>e.jsx(y,{sx:{display:"flex",flexDirection:"row"},children:e.jsx(U,{variant:"contained",onClick:()=>d(!0),sx:{width:"150px"},children:"Crea"})})}),P=()=>{n(t),f(A=>({...A,pageIndex:0}))},I=()=>{z(""),n(""),f(A=>({...A,pageIndex:0})),D.current&&D.current.focus()},b=A=>{const{name:c,value:E}=A.target;j(p=>({...p,[c]:typeof E=="string"?E.split(","):E}))},F=(A,c)=>{j(E=>{let p={...E,[A]:c};return A==="dateFrom"&&p.dateTo&&c&&c>p.dateTo&&(p.dateTo=c),A==="dateTo"&&p.dateFrom&&c&&c<p.dateFrom&&(p.dateFrom=c),p})},S=()=>{j(A=>({...A,dateFrom:null,dateTo:null}))},$=async A=>{A&&(g({message:"Evento creato con successo!",state:"success"}),setAppliedFilters(m)),d(!1)};return e.jsxs(y,{children:[e.jsx(Me,{}),l&&e.jsx(Oa,{open:l,onClose:$,isEdit:!1}),e.jsxs(y,{sx:{mx:"5%"},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(na,{sx:{marginRight:"10px"}}),e.jsx(M,{variant:"h4",children:"Lista Eventi"})]}),e.jsxs(i,{container:!0,spacing:2,sx:{mb:2},alignItems:"center",justifyContent:"flex-end",children:[e.jsx(i,{size:{xs:12,sm:2},children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(ne,{id:"subscription-status-label",children:"Stato iscrizione"}),e.jsx(re,{labelId:"subscription-status-label",name:"subscriptionStatus",multiple:!0,value:m.subscriptionStatus,onChange:b,input:e.jsx(Ce,{label:"Stato iscrizione"}),variant:"outlined",renderValue:A=>fa.filter(c=>A.includes(c.value)).map(c=>c.label).join(", "),children:fa.map(A=>e.jsx(q,{value:A.value,children:A.label},A.value))})]})}),e.jsx(i,{size:{xs:12,sm:2},children:e.jsx(Z,{fullWidth:!0,children:e.jsx(pe,{dateAdapter:Ve,adapterLocale:He,children:e.jsx(ye,{label:"Inizio Iscrizioni",value:m.dateFrom,maxDate:m.dateTo||void 0,onChange:A=>F("dateFrom",A),format:"d MMM yyyy"})})})}),e.jsx(i,{size:{xs:12,sm:2},children:e.jsx(Z,{fullWidth:!0,children:e.jsx(pe,{dateAdapter:Ve,adapterLocale:He,children:e.jsx(ye,{label:"Fine Iscrizioni",value:m.dateTo,minDate:m.dateFrom||void 0,onChange:A=>F("dateTo",A),format:"d MMM yyyy"})})})}),(m.dateFrom||m.dateTo)&&e.jsx(i,{size:{xs:12,sm:2},sx:{display:"flex",alignItems:"center"},children:e.jsx(U,{variant:"outlined",color:"secondary",startIcon:e.jsx($e,{}),onClick:S,sx:{height:"100%",minWidth:0,px:1,mr:1},children:"Azzera date"})}),e.jsx(i,{size:{xs:12,sm:2},sx:{ml:"auto"},children:e.jsx(Ce,{inputRef:D,size:"small",placeholder:"Cerca",value:t,onChange:A=>z(A.target.value),onKeyDown:A=>{A.key==="Enter"&&P()},endAdornment:t&&w===t?e.jsx(J,{"aria-label":"clear",onClick:I,edge:"end",children:e.jsx($e,{})}):e.jsx(J,{"aria-label":"search",onClick:P,edge:"end",children:e.jsx(ta,{})})})})]}),v?e.jsx(ge,{}):e.jsx(Fe,{table:Y}),o&&e.jsx(ve,{message:o.message,state:o.state})]})]})}function Wa({value:x,onChange:u,error:s,helperText:r,label:l="Cerca profilo",required:d=!1,disabled:_=!1,valid_only:o=!0,esner_only:g=!1}){const[h,f]=a.useState([]),[T,C]=a.useState(""),[t,z]=a.useState(!1);a.useEffect(()=>{if(T.length<3){f([]);return}z(!0);const n=setTimeout(async()=>{try{const m=await G("GET",`/profiles/search/?q=${encodeURIComponent(T)}&valid_only=${o}&esner_only=${g}`);if(m.ok){const j=await m.json();f(j.results||[])}}finally{z(!1)}},300);return()=>clearTimeout(n)},[T]);const w=(n,m)=>{const{key:j,...v}=n,L=m.latest_esncard&&m.latest_esncard.number,D=L&&!m.latest_esncard.is_valid;return e.jsx("li",{...v,children:e.jsxs(i,{container:!0,spacing:1,sx:{width:"100%"},children:[e.jsx(i,{size:{xs:4},children:e.jsxs(M,{children:[m.name," ",m.surname]})}),e.jsx(i,{size:{xs:4},children:e.jsx(M,{component:"span",sx:{color:L?D?"error.main":"text.primary":"error.main"},children:L?D?`${m.latest_esncard.number} (Scaduta)`:m.latest_esncard.number:"No ESNcard"})}),e.jsx(i,{size:{xs:4},children:e.jsx(M,{component:"span",sx:{color:m.is_esner?"primary.main":"success.main",fontWeight:"bold",textAlign:"right",display:"block"},children:m.is_esner?"ESNer":"Erasmus"})})]})},j)};return e.jsx(cs,{options:h,loading:t,getOptionLabel:n=>`${n.name}${n.surname?` ${n.surname}`:""}${n.latest_esncard?` (${n.latest_esncard.number})`:""}`,renderOption:w,value:x,onChange:u,onInputChange:(n,m)=>C(m),renderInput:n=>e.jsx(R,{...n,label:l,required:d,error:s,helperText:r}),noOptionsText:"Nessun profilo trovato",loadingText:"Caricamento...",disabled:_})}function Us({open:x,onClose:u,event:s,listId:r,subscription:l,isEdit:d}){const[_,o]=a.useState(!0),[g,h]=a.useState(null),[f,T]=a.useState([]),[C,t]=a.useState({open:!1,action:null,message:""}),z=d?"Modifica Iscrizione":"Iscrizione Evento",w=d&&l.account_id||null,[n,m]=a.useState({id:"",account_id:"",account_name:"",profile_id:"",profile_name:"",status:"pending",list_id:r||"",list_name:s.lists.find(c=>c.id===r)?.name||"Lista non trovata",notes:""}),[j,v]=a.useState({account_id:[!1,""],account_name:[!1,""],profile_id:[!1,""],profile_name:[!1,""],status:[!1,""],list_id:[!1,""],list_name:[!1,""],notes:[!1,""]}),L=a.useMemo(()=>[{field:"profile_id",value:n?.profile_id,message:"Selezionare un Profilo"},...n?.status==="paid"?[{field:"account_id",value:n?.account_id,message:"Selezionare una Cassa"}]:[]],[n]),[D,H]=a.useState(d?l.status:"pending");a.useEffect(()=>{d&&(console.log("Setting Subscription:",l),m(l),H(l.status)),o(!1),Y().then()},[d]);const Y=async()=>{try{const c=await G("GET","/accounts/"),E=await c.json();if(c.ok)T(E.results);else{const p=await ee(E,c.status);h({message:`Errore durante il recupero delle casse: ${p}`,state:"error"})}}catch(c){h({message:`Errore generale: ${c}`,state:"error"})}},P=()=>{const c={};return Object.keys(j).forEach(E=>{c[E]=[!1,""]}),v(c),c},I=async()=>{let c=!1;const E=P();if(L.forEach(p=>{p.value||(E[p.field]=[!0,p.message],c=!0)}),c){v(E);return}if(n.status==="paid"&&(!d||D!=="paid")||d&&D==="paid"&&n.status!=="paid"){let p="";n.status==="paid"&&(!d||D!=="paid")?p="Confermi di registrare un pagamento di €"+s.cost+" per questa iscrizione?":d&&D==="paid"&&n.status!=="paid"&&(p="Confermi di annullare un pagamento di €"+s.cost+" per questa iscrizione?"),t({open:!0,action:()=>b(),message:p});return}if(n.status==="paid"&&d&&D==="paid"&&n.account_id!==w){t({open:!0,action:()=>b(),message:"Confermi di voler cambiare la cassa associata a questo pagamento? Verranno spostati €"+s.cost+" da "+n.account_name+" a "+f.find(p=>p.id===n.account_id)?.name+"."});return}await b()},b=async()=>{t({open:!1,action:null,message:""});try{const c=await G(d?"PATCH":"POST",`/subscription/${d?n.id+"/":""}`,{profile:n.profile_id,event:s.id,list:n.list_id,account_id:n.account_id||w,notes:n.notes,status:n.status});if(c.ok)u(!0,(d?"Modifica Iscrizione":"Iscrizione")+" completata con successo!");else{const E=await c.json(),p=await ee(E,c.status);h({message:`Errore: ${p}`,state:"error"})}}catch(c){h({message:`Errore generale: ${c}`,state:"error"})}},F=async()=>{if(n.status==="paid"){t({open:!0,action:()=>S(),message:"Confermi di voler eliminare un pagamento di €"+s.cost+" per questa iscrizione?"});return}await S()},S=async()=>{if(t({open:!1,action:null,message:""}),!(!d||!n.id))try{const c=await G("DELETE",`/subscription/${n.id}/`);if(c.ok)u(!0,"Eliminazione avvenuta con successo");else{const E=await c.json(),p=await ee(E,c.status);h({message:`Errore eliminazione: ${p}`,state:"error"})}}catch(c){h({message:`Errore generale: ${c}`,state:"error"})}},$=c=>{m({...n,[c.target.name]:c.target.value})},A=()=>{m({...n,status:n.status==="paid"?"pending":"paid",...n.status==="paid"?{account_id:""}:{}})};return e.jsx(Pe,{open:x,onClose:()=>{u(!1)},"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(y,{sx:Oe,children:[_?e.jsx(ge,{}):e.jsxs(e.Fragment,{children:[e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(J,{onClick:()=>u(!1),sx:{minWidth:0},children:e.jsx(Ee,{})})}),e.jsx(M,{variant:"h4",component:"h2",gutterBottom:!0,children:z}),e.jsx(We,{sx:{mb:2}}),e.jsxs(M,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Nome Evento:"})," ",s.name]}),e.jsxs(M,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Lista:"})," ",n.list_name]}),e.jsxs(M,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Importo:"})," ",s.cost,"€"]}),e.jsxs(i,{container:!0,spacing:2,direction:"column",children:[e.jsx(i,{size:{xs:12},sx:{mt:2},children:e.jsx(Wa,{value:n.profile_id?{id:n.profile_id,name:n.profile_name}:null,onChange:(c,E)=>{m({...n,profile_id:E?.id,profile_name:E?`${E.name} ${E.surname}`:""})},error:j.profile_id&&j.profile_id[0],helperText:j.profile_id&&j.profile_id[1]||"Cerca per nome o numero ESNcard",label:d?n.profile_name:"Cerca profilo",required:!0,disabled:d})}),e.jsx(i,{size:{xs:12},children:e.jsxs(qe,{elevation:1,sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",bgcolor:n.status==="paid"?"#e3f2fd":"inherit",transition:"background-color 0.3s"},children:[e.jsx(M,{variant:"subtitle1",children:"Stato Pagamento"}),e.jsx(_e,{control:e.jsx(ds,{checked:n.status==="paid",onChange:A,color:"primary"}),label:n.status==="paid"?"Pagato":"In attesa",labelPlacement:"start"})]})}),n.status==="paid"&&e.jsx(i,{size:{xs:12},children:e.jsxs(Z,{fullWidth:!0,required:!0,error:j.account_id&&j.account_id[0],children:[e.jsx(ne,{htmlFor:"account-selector",sx:{mb:2},children:"Seleziona Cassa"}),e.jsx(re,{variant:"outlined",label:"Seleziona Cassa",labelId:"account-selector-label",id:"account-selector",name:"account_id",value:n.account_id||"",error:j.account_id&&j.account_id[0],onChange:$,children:f.map(c=>e.jsxs(q,{value:c.id,disabled:c.status==="closed",style:{color:c.status==="closed"?"grey":"inherit"},children:[c.name," ",c.status==="closed"?"(Chiusa)":""]},c.id))}),j.account_id&&j.account_id[0]&&e.jsx(Ue,{children:j.account_id[1]})]})}),e.jsx(i,{size:{xs:12},children:e.jsx(R,{label:"Note",name:"notes",value:n.notes,onChange:$,multiline:!0,rows:2,fullWidth:!0})})]}),e.jsx(U,{variant:"contained",fullWidth:!0,sx:{mt:2,bgcolor:n.profile_id?"#1976d2":"#9e9e9e","&:hover":{bgcolor:n.profile_id?"#1565c0":"#757575"}},onClick:I,children:d?"Salva Modifiche":"Conferma"}),d&&e.jsx(U,{variant:"contained",fullWidth:!0,sx:{mt:1,bgcolor:"#d32f2f","&:hover":{bgcolor:"#b71c1c"}},onClick:F,children:"Elimina Iscrizione"}),g&&e.jsx(ve,{message:g.message,state:g.state})]}),e.jsx(la,{open:C.open,message:C.message,onConfirm:C.action,onClose:()=>t({open:!1,action:null,message:""})})]})})}function Js({open:x,onClose:u,selectedRows:s,event:r,listId:l}){const[d,_]=a.useState(null),[o,g]=a.useState([]),[h,f]=a.useState(""),T=r.lists.find(t=>t.id===l)?.name||"Lista non trovata";a.useEffect(()=>{if(r?.lists){const t=r.lists.filter(z=>z.id!==l);g(t)}},[r,l]);const C=async()=>{if(h)try{const t=await G("POST","/move-subscriptions/",{subscriptionIds:s.map(z=>z.original.id),targetListId:h});if(t.ok)u(!0);else{const z=await t.json(),w=await ee(z,t.status);_({message:`Errore: ${w}`,state:"error"})}}catch(t){_({message:`Errore generale: ${t}`,state:"error"})}};return e.jsx(Pe,{open:x,onClose:()=>u(!1),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(y,{sx:Oe,children:[e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(J,{onClick:()=>u(!1),sx:{minWidth:0},children:e.jsx(Ee,{})})}),e.jsxs(M,{variant:"h4",component:"h3",gutterBottom:!0,children:["Sposta ",s.length," ",s.length===1?"iscrizione":"iscrizioni"]}),e.jsxs(M,{variant:"body1",id:"modal-modal-description",gutterBottom:!0,children:["Lista di origine: ",T]}),e.jsxs(Z,{fullWidth:!0,sx:{mt:1},children:[e.jsx(ne,{id:"list-select-label",children:"Lista di destinazione"}),e.jsx(re,{labelId:"list-select-label",label:"Lista di destinazione",value:h,onChange:t=>f(t.target.value),variant:"outlined",children:o.map(t=>e.jsx(q,{value:t.id,children:t.name},t.id))})]}),e.jsx(U,{variant:"contained",fullWidth:!0,sx:{mt:2,bgcolor:h?"#1976d2":"#9e9e9e","&:hover":{bgcolor:h?"#1565c0":"#757575"}},onClick:C,disabled:!h,children:"Conferma"}),d&&e.jsx(ve,{message:d.message,state:d.state})]})})}function Zs(){const{id:x}=oa(),u=Ss(),s=Ie(),[r,l]=a.useState(!1),[d,_]=a.useState(!1),[o,g]=a.useState(!1),[h,f]=a.useState([]),[T,C]=a.useState(!0),[t,z]=a.useState(null),[w,n]=a.useState(null),m=u.state?.event,[j,v]=a.useState(null),[L,D]=a.useState(null),[H,Y]=a.useState(null);a.useEffect(()=>{C(!0),(async()=>{try{const Q=x||m?.id,oe=await G("GET",`/event/${Q}/`),le=await oe.json();if(oe.ok)n(le),console.log("Event Data: ",le);else{const de=await ee(le,oe.status);z({message:`Errore: ${de}`,state:"error"})}}catch(Q){z({message:`Errore generale: ${Q}`,state:"error"})}finally{C(!1)}})().then()},[x,m]);const P=async()=>{C(!0);try{const W=await G("GET",`/event/${w.id}/`),Q=await W.json();if(W.ok)n(Q),C(!1);else{const oe=await ee(Q,W.status);z({message:`Errore: ${oe}`,state:"error"})}}catch(W){z({message:`Errore generale: ${W}`,state:"error"})}finally{C(!1)}},I=()=>{l(!0)},b=async W=>{W&&(z({message:"Evento modificato con successo!",state:"success"}),await P()),l(!1)},F=W=>{v(W),Y(!1),_(!0)},S=async(W,Q)=>{W&&(z({message:Q,state:"success"}),await P()),_(!1),v(null)},$=()=>{if(!w)return{chip:e.jsx(ae,{label:"Loading...",variant:"outlined",size:"medium"}),isActive:!1};const W=K(),Q=w.subscription_start_date?K(w.subscription_start_date):null,oe=w.subscription_end_date?K(w.subscription_end_date):null;let le="error",de=!1;Q&&oe&&(W.isAfter(Q)&&W.isBefore(oe)?(le="success",de=!0):W.isBefore(Q)&&(le="warning"));let X=w.subscription_start_date?K(w.subscription_start_date).format("DD/MM/YYYY HH:mm"):"Inizio non specificato",be=w.subscription_end_date?K(w.subscription_end_date).format("DD/MM/YYYY HH:mm"):"Fine non specificata";return{chip:e.jsx(ae,{label:X+" - "+be,color:le,variant:"outlined",size:"medium"}),isActive:de}},A=W=>{console.log("Editing subscription:",W),v(null),D(w.subscriptions.find(Q=>Q.id===W)||null),Y(!0),_(!0)},c=fe.useMemo(()=>w?.lists?w.lists.map(W=>{const Q=w.subscriptions?.filter(le=>le.list_id===W.id)||[],oe=[{accessorKey:"id",header:"ID",size:50},{accessorKey:"profile_name",header:"Profilo",size:150},{accessorKey:"status",header:"Stato",size:100,Cell:({cell:le})=>{const de=le.getValue();let X,be;switch(de){case"paid":X="success",be="PAGATO";break;case"pending":X="warning",be="IN ATTESA";break;case"cancelled":X="error",be="CANCELLATO";break;default:X="default",be=de}return e.jsx(ae,{label:be,color:X,size:"small"})}},{accessorKey:"notes",header:"Note",size:200}];return{listId:W.id,listName:W.name,capacity:W.capacity,subscriptions:Q,columns:oe}}):[],[w]),E=fe.useMemo(()=>c.map(W=>({...W,tableOptions:{columns:W.columns,data:W.subscriptions,enableStickyHeader:!0,enablePagination:!0,enableRowSelection:!0,display:!1,initialState:{pagination:{pageSize:10,pageIndex:0}},paginationDisplayMode:"pages",localization:De,renderEmptyRowsFallback:()=>e.jsx(y,{sx:{textAlign:"center",p:2},children:e.jsx(M,{variant:"body1",children:"Nessuna iscrizione presente"})}),muiTablePaginationProps:{labelRowsPerPage:"Righe per pagina:"},renderTopToolbarCustomActions:({table:Q})=>{const oe=Q.getSelectedRowModel().rows,le=oe.length;return e.jsxs(y,{sx:{display:"flex",gap:1},children:[le>=1&&e.jsxs(e.Fragment,{children:[e.jsx(U,{variant:"outlined",color:"primary",onClick:()=>N(oe,W.listId),children:"Sposta in Altra Lista"}),e.jsx(U,{variant:"outlined",color:"secondary",onClick:()=>ce(oe),children:"Esporta"})]}),le===1&&e.jsx(e.Fragment,{children:e.jsx(U,{variant:"contained",color:"primary",onClick:()=>A(oe[0].original.id),children:"Modifica Iscrizione"})})]})}}})),[c]),p=fe.memo(()=>{if(!E||E.length===0)return e.jsx(M,{children:"Nessuna lista disponibile (aggiungine una per poter iscrivere)"});const{isActive:W}=$();return E.map(Q=>{const{listId:oe,listName:le,capacity:de,subscriptions:X,tableOptions:be}=Q,Le=Math.round(X.length/de*100)||0,Re=Le>=90?"error":Le>=60?"warning":"success",Je={...be,paginationDisplayMode:"pages"},k=ke(Je);return e.jsxs(us,{sx:{mt:2},children:[e.jsx(ms,{children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(ps,{sx:{color:"primary.main",mr:1}}),e.jsx(M,{variant:"h6",component:"div",sx:{flexGrow:1},children:le}),e.jsxs(y,{sx:{display:"flex",alignItems:"center",cursor:X.length<de&&W?"pointer":"not-allowed",opacity:X.length<de&&W?1:.5,px:2,py:1,borderRadius:1,bgcolor:"primary.main",color:"white",ml:2},onClick:X.length<de&&W?()=>F(oe):void 0,children:[e.jsx(hs,{sx:{mr:1}})," ISCRIVI"]}),e.jsxs(y,{sx:{width:"200px",ml:2},children:[e.jsx(y,{sx:{display:"flex",justifyContent:"space-between"},children:e.jsxs(M,{variant:"body2",children:[X.length,"/",de]})}),e.jsx(xs,{variant:"determinate",value:Le,color:Re,sx:{height:8,borderRadius:5}})]})]})}),e.jsx(fs,{children:e.jsx(Fe,{table:k})})]},oe)})}),N=(W,Q)=>{console.log("Moving selected rows to another list:",W),f(W),v(Q),g(!0)},se=W=>{W&&(z({message:"Spostamento effettuato con successo!",state:"success"}),P().then()),g(!1)},ce=W=>{console.log("Exporting selected rows:",W)};return e.jsxs(y,{children:[e.jsx(Me,{}),r&&e.jsx(Oa,{open:r,onClose:b,event:{...w,date:w.date?K(w.date):null,subscription_start_date:w.subscription_start_date?K(w.subscription_start_date):null,subscription_end_date:w.subscription_end_date?K(w.subscription_end_date):null},isEdit:!0}),d&&e.jsx(Us,{open:d,onClose:S,event:w,listId:j,subscription:L,isEdit:H}),o&&e.jsx(Js,{open:o,onClose:se,selectedRows:h,event:w,listId:j}),e.jsxs(y,{sx:{mx:"5%"},children:[T?e.jsx(ge,{}):e.jsxs(e.Fragment,{children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(J,{onClick:()=>{s(-1)},sx:{mr:2},children:e.jsx(ra,{})}),e.jsx(na,{sx:{marginRight:"10px"}}),e.jsxs(M,{variant:"h4",children:["Evento - ",w.name]})]}),e.jsx(Ke,{elevation:3,sx:{mt:5,mb:4,borderRadius:2,overflow:"hidden"},children:e.jsx(za,{children:e.jsxs(i,{container:!0,spacing:3,children:[e.jsxs(i,{size:{xs:12,md:4},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(gs,{sx:{color:"primary.main",mr:1}}),e.jsx(M,{variant:"h6",component:"div",children:"Data"})]}),e.jsx(M,{variant:"body1",color:"text.secondary",sx:{mt:2},children:w.date?K(w.date).format("DD/MM/YYYY"):"Data non specificata"})]}),e.jsxs(i,{size:{xs:12,md:4},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(bs,{sx:{color:"primary.main",mr:1}}),e.jsx(M,{variant:"h6",component:"div",children:"Costo"})]}),e.jsx(M,{variant:"body1",color:"text.secondary",sx:{mt:2},children:w.cost!==0?`€ ${w.cost}`:"Gratuito"})]}),e.jsxs(i,{size:{xs:12,md:4},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(js,{sx:{color:"primary.main",mr:1}}),e.jsx(M,{variant:"h6",component:"div",children:"Periodo Iscrizioni"})]}),e.jsx(y,{sx:{display:"flex",alignItems:"center",mt:2},children:$().chip})]}),e.jsxs(i,{size:{xs:12},children:[e.jsx(We,{sx:{my:1}}),e.jsxs(y,{sx:{display:"flex",alignItems:"center",mt:2},children:[e.jsx(ys,{sx:{color:"primary.main",mr:1}}),e.jsx(M,{variant:"h6",component:"div",children:"Descrizione"})]}),e.jsx("div",{"data-color-mode":"light",style:{marginTop:10},children:e.jsx(Na,{value:w.description||"Nessuna descrizione disponibile",readOnly:!0})})]}),e.jsxs(i,{size:{xs:12},children:[e.jsx(We,{sx:{my:1}}),e.jsxs(y,{sx:{display:"flex",alignItems:"center",mt:2},children:[e.jsx(Ye,{sx:{color:"primary.main",mr:1}}),e.jsx(M,{variant:"h6",component:"div",children:"Azioni"})]}),e.jsx(U,{sx:{mt:2},variant:"contained",color:"primary",onClick:I,children:"Modifica Evento"})]}),e.jsxs(i,{size:{xs:12},children:[e.jsx(We,{sx:{my:1}}),e.jsxs(y,{sx:{mt:2},children:[e.jsx(M,{variant:"h6",component:"div",sx:{mb:2},children:"Liste"}),e.jsx(p,{})]})]})]})})})]}),t&&e.jsx(ve,{message:t.message,state:t.state})]})]})}function ze({children:x,requiredPermission:u}){const{accessToken:s,user:r,loading:l}=Ae(),d=Ie();return a.useEffect(()=>{!l&&(!s||u&&!r?.permissions.includes(u))&&(console.log("Redirecting to login..."),d("/login",{replace:!0}))},[l,s,r,u,d]),l?e.jsx("div",{children:"Loading..."}):!s||u&&!r?.permissions.includes(u)?null:x}function Qs(){const{uid:x,token:u}=oa(),[s,r]=a.useState({message:"",state:"loading"});return a.useEffect(()=>{x&&u?(async()=>{try{const d=await G("GET",`/api/profile/verify-email/${x}/${u}/`,null,{},!1),_=await d.json();if(d.ok)r({message:_.message,state:"success"});else{const o=ee(_,d.status);r({message:o,state:"error"})}}catch(d){r({message:`General error: ${d}`,state:"error"})}})().then():r({message:"Invalid verification link",state:"error"})},[x,u]),e.jsx(aa,{maxWidth:"sm",children:e.jsxs(y,{sx:{mt:8,display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",p:3,borderRadius:2,boxShadow:3,bgcolor:"background.paper"},children:[e.jsx(M,{variant:"h4",component:"h1",gutterBottom:!0,children:"Email Verification"}),e.jsx(Ne,{message:s.message,state:s.state,loadingText:"Verifying your email address..."})]})})}function Xs(){const{uid:x,token:u}=oa(),s=Ie(),[r,l]=a.useState(""),[d,_]=a.useState(""),[o,g]=a.useState(null),[h,f]=a.useState(!1),T=async()=>{if(r!==d){g({message:"Le password non coincidono.",state:"error"});return}try{const C=await G("POST",`/api/reset-password/${x}/${u}/`,{password:r,confirm_password:d},{},!1);if(C.ok)f(!0),g({message:"Password reimpostata con successo!",state:"success"});else{const t=await C.json(),z=await ee(t,C.status);g({message:`Errore durante il reset della password: ${z}`,state:"error"})}}catch(C){g({message:`Errore generale: ${C}`,state:"error"})}};return e.jsx(aa,{maxWidth:"xs",children:e.jsxs(y,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("img",{alt:"",src:ia,style:{height:"25vh"}}),e.jsx(M,{style:{marginTop:10},variant:"h5",children:"Reimposta Password"}),o&&e.jsx(Ne,{message:o.message,state:o.state}),!h&&e.jsxs(e.Fragment,{children:[e.jsx(R,{margin:"normal",required:!0,fullWidth:!0,label:"Nuova Password",type:"password",onChange:C=>l(C.target.value)}),e.jsx(R,{margin:"normal",required:!0,fullWidth:!0,label:"Conferma Password",type:"password",onChange:C=>_(C.target.value)}),e.jsx(U,{fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},onClick:T,children:"Reimposta Password"})]}),h&&e.jsx(je,{component:"button",variant:"body2",sx:{textAlign:"center"},onClick:()=>s("/login"),children:"Vai al Login"})]})})}function et({open:x,onClose:u,transaction:s}){const[r,l]=a.useState(!0),[d,_]=a.useState([]),[o,g]=a.useState(null),[h,f]=a.useState({executor:null,account:"",amount:"",description:"",type:""}),[T,C]=a.useState({executor:[!1,""],account:[!1,""],amount:[!1,""],description:[!1,""]});a.useEffect(()=>{console.log("TransactionModal useEffect",s),l(!0),Promise.all([G("GET","/accounts/")]).then(async([m])=>{const j=m.ok?await m.json():{results:[]};_(j.results||[]),s&&f({executor:s.executor||null,account:s.account?.id||"",amount:s.amount||"",description:s.description||"",type:s.type||""})}).finally(()=>l(!1))},[x,s]);const t=m=>{const{name:j,value:v}=m.target;f(L=>({...L,[j]:v}))},z=()=>{let m=!1;const j={...T};return h.executor?j.executor=[!1,""]:(j.executor=[!0,"Seleziona un Esecutore"],m=!0),h.account?j.account=[!1,""]:(j.account=[!0,"Seleziona una Cassa"],m=!0),!h.amount||isNaN(Number(h.amount))?(j.amount=[!0,"Inserisci un importo valido"],m=!0):j.amount=[!1,""],C(j),!m},w=async m=>{if(m.preventDefault(),!!z()){l(!0);try{const j={executor:h.executor.id||h.executor.email,account:h.account,amount:parseFloat(h.amount),description:h.description},v=await G("PATCH",`/transaction/${s.id}/`,j);if(v.ok)u(!0);else{const L=await v.json(),D=await ee(L,v.status);g({message:`Errore: ${D}`,state:"error"})}}catch(j){g({message:`Errore generale: ${j}`,state:"error"})}finally{l(!1)}}},n=()=>u(!1);return e.jsx(Pe,{open:x,onClose:n,children:e.jsx(y,{sx:Oe,component:"form",onSubmit:w,noValidate:!0,children:r?e.jsx(ge,{}):e.jsxs(e.Fragment,{children:[e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mb:-2},children:e.jsx(J,{onClick:n,sx:{minWidth:0},children:e.jsx(Ee,{})})}),e.jsx(M,{variant:"h5",gutterBottom:!0,align:"center",sx:{mb:2},children:"Modifica Transazione"}),o&&e.jsx(ve,{message:o.message,state:o.state}),e.jsxs(i,{container:!0,spacing:2,sx:{mt:2},children:[e.jsxs(M,{variant:"subtitle1",gutterBottom:!0,children:[e.jsx("b",{children:"Tipo:"})," ",te.tran_type[h.type]||"Non specificato"]}),e.jsx(i,{size:{xs:12},children:e.jsx(Wa,{value:h.executor,onChange:(m,j)=>{f({...h,executor:j})},error:T.executor[0],helperText:T.executor[0]?T.executor[1]:"Cerca per nome o numero ESNcard",label:te.executor,esner_only:!0,required:!0})}),e.jsx(i,{size:{xs:12},children:e.jsxs(Z,{fullWidth:!0,required:!0,error:T.account[0],children:[e.jsx(ne,{id:"account-label",children:te.account}),e.jsx(re,{labelId:"account-label",name:"account",variant:"outlined",value:h.account,onChange:t,input:e.jsx(Ce,{label:te.account}),children:d.map(m=>e.jsx(q,{value:m.id,children:m.name},m.id))}),T.account[0]&&e.jsx(Ue,{children:T.account[1]})]})}),e.jsx(i,{size:{xs:12},children:e.jsx(R,{label:te.amount,name:"amount",value:h.amount,onChange:t,required:!0,fullWidth:!0,error:T.amount[0],type:"number",slotProps:{htmlInput:{min:"0.01",step:"0.01"}}})}),e.jsx(i,{size:{xs:12},children:e.jsx(R,{label:"Descrizione",name:"description",value:h.description,onChange:t,fullWidth:!0,multiline:!0,rows:3})})]}),e.jsx(y,{mt:2,children:e.jsx(U,{fullWidth:!0,variant:"contained",color:"primary",type:"submit",children:"Salva Modifiche"})})]})})})}const $a={subscription:{label:te.tran_type.subscription,color:"primary"},esncard:{label:te.tran_type.esncard,color:"secondary"},deposit:{label:te.tran_type.deposit,color:"success"},withdrawal:{label:te.tran_type.withdrawal,color:"error"}},ga=[{value:"",label:"Tutti"},...Object.entries($a).map(([x,u])=>({value:x,label:u.label,color:u.color}))];function at(){const[x,u]=a.useState(!0),[s,r]=a.useState([]),[l,d]=a.useState([]),_=Ie(),[o,g]=a.useState(null),[h,f]=a.useState(!1),[T,C]=a.useState(null),[t,z]=a.useState({pageIndex:0,pageSize:10}),[w,n]=a.useState(0),[m,j]=a.useState({account:[],type:[],dateFrom:null,dateTo:null}),[v,L]=a.useState(""),[D,H]=a.useState(""),Y=a.useRef(null);a.useEffect(()=>{P().then()},[t.pageIndex,t.pageSize,m,D]);const P=async()=>{u(!0);try{const p=new URLSearchParams;p.append("page",t.pageIndex+1),p.append("page_size",t.pageSize),D&&p.append("search",D),m.account.length&&m.account.forEach(Q=>p.append("account",Q)),m.type.length&&m.type.forEach(Q=>p.append("type",Q)),m.dateFrom&&p.append("dateFrom",m.dateFrom.toISOString()),m.dateTo&&p.append("dateTo",m.dateTo.toISOString());const[N,se]=await Promise.all([G("GET",`/transactions/?${p.toString()}`),G("GET","/accounts/")]),ce=N.ok?await N.json():{results:[]},W=se.ok?await se.json():{results:[]};n(ce.count||0),r(ce.results||[]),d(W.results||[])}finally{u(!1)}},I=a.useMemo(()=>[{accessorKey:"created_at",header:te.date,size:120,Cell:({cell:p})=>{const N=new Date(p.getValue());return new Intl.DateTimeFormat("it-IT",{dateStyle:"medium",timeStyle:"short"}).format(N)}},{accessorKey:"type",header:te.type,size:100,Cell:({cell:p})=>{const N=p.getValue(),se=$a[N]||{label:"Sconosciuto",color:"default"};return e.jsx(ae,{label:se.label,color:se.color,variant:"outlined"})}},{accessorKey:"executor.name",header:te.executor,size:150},{accessorKey:"account.name",header:te.account,size:120,Cell:({cell:p})=>e.jsx(y,{component:"span",fontWeight:"bold",children:p.getValue()})},{accessorKey:"amount",header:te.amount,size:100,Cell:({cell:p})=>e.jsx(y,{children:p.getValue()!==null?e.jsx(ae,{label:`€${p.getValue()}`,color:"primary"}):e.jsx(ae,{label:"N/A",color:"warning"})})},{accessorKey:"description",header:te.description,size:200,Cell:({cell:p})=>e.jsx(y,{component:"span",fontStyle:"italic",children:p.getValue()})}],[]),b=ke({columns:I,data:s,enableStickyHeader:!0,enableStickyFooter:!0,enableColumnFilters:!1,enableColumnOrdering:!0,enableGrouping:!0,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableExpandAll:!1,initialState:{showColumnFilters:!1,showGlobalFilter:!0,columnPinning:{left:["mrt-row-expand","mrt-row-select"],right:["mrt-row-actions"]},sorting:[{id:"created_at",desc:!0}]},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",enableGlobalFilter:!1,muiPaginationProps:{color:"secondary",rowsPerPageOptions:[10,20,30],shape:"rounded",variant:"outlined"},manualPagination:!0,rowCount:w,onPaginationChange:z,state:{pagination:t},localization:De,muiTableBodyRowProps:({row:p})=>({onClick:()=>{C(p.original),f(!0)},sx:{cursor:"pointer"}})}),F=()=>{H(v),z(p=>({...p,pageIndex:0}))},S=()=>{L(""),H(""),z(p=>({...p,pageIndex:0})),Y.current&&Y.current.focus()},$=async p=>{p&&(g({message:"Transazione modificata con successo!",state:"success"}),await P()),C(null),f(!1)},A=(p,N)=>{j(se=>{let ce={...se,[p]:N};return p==="dateFrom"&&ce.dateTo&&N&&N>ce.dateTo&&(ce.dateTo=N),p==="dateTo"&&ce.dateFrom&&N&&N<ce.dateFrom&&(ce.dateFrom=N),ce})},c=p=>{const{name:N,value:se}=p.target;j(ce=>{let W={...ce,[N]:se};return(N==="account"||N==="type")&&(W[N]=typeof se=="string"?se.split(","):se),W})},E=()=>{j(p=>({...p,dateFrom:null,dateTo:null}))};return e.jsxs(y,{children:[e.jsx(Me,{}),h&&e.jsx(et,{open:h,onClose:$,transaction:T}),e.jsxs(y,{sx:{mx:"5%"},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[e.jsx(J,{onClick:()=>_(-1),sx:{mr:2},children:e.jsx(ra,{})}),e.jsx(M,{variant:"h4",children:"Lista Transazioni"})]}),e.jsxs(i,{container:!0,spacing:2,sx:{mb:2,mt:4},alignItems:"center",children:[e.jsx(i,{size:{xs:12,sm:2},children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(ne,{id:"account-label",children:"Cassa"}),e.jsx(re,{labelId:"account-label",name:"account",multiple:!0,value:m.account,onChange:c,input:e.jsx(Ce,{label:"Cassa"}),variant:"outlined",renderValue:p=>l.filter(N=>p.includes(N.id)).map(N=>N.name).join(", "),children:l.map(p=>e.jsx(q,{value:p.id,children:p.name},p.id))})]})}),e.jsx(i,{size:{xs:12,sm:2},children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(ne,{id:"type-label",children:"Tipo"}),e.jsx(re,{labelId:"type-label",name:"type",multiple:!0,value:m.type,onChange:c,input:e.jsx(Ce,{label:"Tipo"}),variant:"outlined",renderValue:p=>ga.filter(N=>p.includes(N.value)&&N.value).map(N=>N.label).join(", "),children:ga.filter(p=>p.value).map(p=>e.jsx(q,{value:p.value,children:p.label},p.value))})]})}),e.jsx(i,{size:{xs:12,sm:2},children:e.jsx(Z,{fullWidth:!0,children:e.jsx(pe,{dateAdapter:Ve,adapterLocale:He,children:e.jsx(ye,{label:"Da",value:m.dateFrom,maxDate:m.dateTo||void 0,onChange:p=>A("dateFrom",p),format:"d MMM yyyy"})})})}),e.jsx(i,{size:{xs:12,sm:2},children:e.jsx(Z,{fullWidth:!0,children:e.jsx(pe,{dateAdapter:Ve,adapterLocale:He,children:e.jsx(ye,{label:"A",value:m.dateTo,minDate:m.dateFrom||void 0,onChange:p=>A("dateTo",p),format:"d MMM yyyy"})})})}),(m.dateFrom||m.dateTo)&&e.jsx(i,{size:{xs:12,sm:2},sx:{display:"flex",alignItems:"center"},children:e.jsx(U,{variant:"outlined",color:"secondary",startIcon:e.jsx($e,{}),onClick:E,sx:{height:"100%",minWidth:0,px:1},children:"Azzera date"})}),e.jsx(i,{size:{xs:12,sm:2},sx:{ml:"auto"},children:e.jsx(Z,{fullWidth:!0,children:e.jsx(Ce,{inputRef:Y,size:"small",placeholder:"Cerca",value:v,onChange:p=>L(p.target.value),onKeyDown:p=>{p.key==="Enter"&&F()},endAdornment:v&&D===v?e.jsx(J,{"aria-label":"clear",onClick:S,edge:"end",children:e.jsx($e,{})}):e.jsx(J,{"aria-label":"search",onClick:F,edge:"end",children:e.jsx(ta,{})})})})})]}),x?e.jsx(ge,{}):e.jsx(Fe,{sx:{mt:2},table:b}),o&&e.jsx(ve,{message:o.message,state:o.state})]})]})}function st(){return e.jsx(Ts,{children:e.jsx(Is,{children:e.jsx(Cs,{children:e.jsxs(ws,{children:[e.jsx(he,{path:"/verify-email/:uid/:token",element:e.jsx(Qs,{})}),e.jsx(he,{path:"/reset-password/:uid/:token",element:e.jsx(Xs,{})}),e.jsx(he,{path:"/login",element:e.jsx(Ps,{})}),e.jsx(he,{path:"/",element:e.jsx(ze,{children:e.jsx($s,{})})}),e.jsx(he,{path:"/profiles/erasmus",element:e.jsx(ze,{children:e.jsx(Ns,{})})}),e.jsx(he,{path:"/profiles/esners",element:e.jsx(ze,{children:e.jsx(Os,{})})}),e.jsx(he,{path:"/erasmus_form",element:e.jsx(ks,{})}),e.jsx(he,{path:"/esner_form",element:e.jsx(Ds,{})}),e.jsx(he,{path:"/treasury",element:e.jsx(ze,{requiredPermission:"change_account",children:e.jsx(qs,{})})}),e.jsx(he,{path:"/treasury/accounts_list",element:e.jsx(ze,{requiredPermission:"change_account",children:e.jsx(Hs,{})})}),e.jsx(he,{path:"/treasury/transactions_list",element:e.jsx(ze,{requiredPermission:"change_account",children:e.jsx(at,{})})}),e.jsx(he,{path:"/events",element:e.jsx(ze,{children:e.jsx(Ys,{})})}),e.jsx(he,{path:"/event/:id",element:e.jsx(ze,{children:e.jsx(Zs,{})})})]})})})})}const tt=Pa({typography:{fontFamily:"Roboto, Arial, sans-serif",h1:{fontFamily:"Lato, Arial, sans-serif"},h2:{fontFamily:"Lato, Arial, sans-serif"},h3:{fontFamily:"Lato, Arial, sans-serif"},h4:{fontFamily:"Lato, Arial, sans-serif"},h5:{fontFamily:"Lato, Arial, sans-serif"}},palette:{primary:{main:"#1976d2"},secondary:{main:"#dc004e"},cyan:{main:"#00aeef",contrastText:"#ffffff"},magenta:{main:"#ec008c",contrastText:"#ffffff"},gray:{main:"#999999",contrastText:"#ffffff"}}}),nt=ba.createRoot(document.getElementById("root"));nt.render(e.jsxs(vs,{theme:Pa(tt,_s),children:[e.jsx(ja,{}),e.jsx(st,{})]}));
