{"version":3,"file":"index-B778zkZ0.js","sources":["../../src/api/api.js","../../src/utils/errorHandling.jsx","../../src/Context/AuthContext.jsx","../../src/Context/SidebarContext.jsx","../../src/assets/esnpolimi-logo.png","../../src/Components/StatusBanner.jsx","../../src/Pages/Login.jsx","../../src/Pages/ErasmusForm.jsx","../../src/utils/displayAttributes.jsx","../../src/Pages/ESNerForm.jsx","../../src/Components/Loader.jsx","../../src/Pages/profiles/ProfilesList.jsx","../../src/Components/LogoutButton.jsx","../../src/Components/Sidebar.jsx","../../src/Pages/profiles/ErasmusProfiles.jsx","../../src/Pages/profiles/ESNersProfiles.jsx","../../src/Components/ConfirmDialog.jsx","../../src/Components/Popup.jsx","../../src/utils/sharedStyles.jsx","../../src/Components/treasury/TransactionAdd.jsx","../../src/Pages/Home.jsx","../../src/Components/treasury/AccountsDash.jsx","../../src/Components/treasury/TransactionsDash.jsx","../../src/Pages/treasury/TreasuryDashboard.jsx","../../src/Components/treasury/AccountModal.jsx","../../src/Pages/treasury/AccountsList.jsx","../../src/Components/CustomEditor.jsx","../../src/Components/events/EventModal.jsx","../../src/Pages/events/EventsList.jsx","../../src/Components/ProfileSearch.jsx","../../src/Components/events/SubscriptionModal.jsx","../../src/Components/events/MoveToListModal.jsx","../../src/Pages/events/Event.jsx","../../src/Components/ProtectedRoute.jsx","../../src/Pages/EmailVerification.jsx","../../src/Pages/ResetPassword.jsx","../../src/Components/treasury/TransactionModal.jsx","../../src/Pages/treasury/TransactionsList.jsx","../../src/Components/EditButton.jsx","../../src/Components/CrudTable.jsx","../../src/Components/profiles/ESNcardEmissionModal.jsx","../../src/Pages/profiles/Profile.jsx","../../src/App.jsx","../../src/index.jsx"],"sourcesContent":["export const fetchCustom = async (method, path, body = null, options = {}, auth = true) => {\r\n    const accessToken = localStorage.getItem(\"accessToken\");\r\n    const API_HOST = import.meta.env.VITE_API_HOST;\r\n    const url = `${API_HOST}${path}`;\r\n    // console.log('Url', url.toString());\r\n\r\n    if (auth && !accessToken) {\r\n        throw new Error(\"No access token available\");\r\n    }\r\n\r\n    // Set default headers\r\n    const headers = {\r\n        \"Content-Type\": \"application/json\", // Default content type for JSON requests\r\n        ...(auth && {Authorization: `Bearer ${accessToken}`}), // Include Authorization header only when auth is true\r\n        ...options.headers, // Merge with additional headers if provided\r\n    };\r\n\r\n    // Configure fetch options\r\n    const fetchOptions = {\r\n        method,\r\n        headers,\r\n        credentials: \"include\", // Include cookies if required\r\n        ...options,\r\n    };\r\n\r\n    // Add body for POST, PUT, or PATCH methods\r\n    if (body) {\r\n        fetchOptions.body = typeof body === \"string\" ? body : JSON.stringify(body);\r\n    }\r\n\r\n    // Execute the request\r\n    const response = await fetch(url, fetchOptions);\r\n\r\n    if (response.status === 401) {\r\n        throw new Error(\"Unauthorized: Access token may have expired\");\r\n    }\r\n\r\n    return response;\r\n};","export const extractErrorMessage = (data, status) => {\r\n    if (!data) return `Server error (${status}) with empty response`;\r\n    if (typeof data === 'string') return data;\r\n    if (data.detail) return data.detail;\r\n    if (data.message) return data.message;\r\n    if (data.non_field_errors) return data.non_field_errors.join(', ');\r\n    if (data.lists?.non_field_errors) return `Error in lists format: ${data.lists.non_field_errors.join(', ')}`;\r\n    for (const [, errors] of Object.entries(data)) {\r\n        if (errors) return Array.isArray(errors) ? errors.join(', ') : errors.toString();\r\n    }\r\n    return JSON.stringify(data);\r\n};","import {createContext, useCallback, useContext, useEffect, useState, useRef} from \"react\";\r\nimport {fetchCustom} from \"../api/api\";\r\nimport {jwtDecode} from \"jwt-decode\";\r\nimport {extractErrorMessage} from \"../utils/errorHandling\";\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nconst AuthContext = createContext(null);\r\n\r\nexport const AuthProvider = ({children}) => {\r\n        const refreshTimer = useRef(null);\r\n        const [accessToken, setAccessToken] = useState(localStorage.getItem(\"accessToken\")); // localStorage needed for when refreshing pages\r\n        const [user, setUser] = useState(() => JSON.parse(localStorage.getItem(\"user\") || \"null\"));\r\n        const [loading, setLoading] = useState(true);\r\n\r\n\r\n        const parseUserFromToken = (token) => {\r\n            try {\r\n                const {user} = jwtDecode(token);\r\n                return user;\r\n            } catch (e) {\r\n                Sentry.captureException(e);\r\n                console.error(\"Invalid JWT token\", e);\r\n                return null;\r\n            }\r\n        };\r\n\r\n        const login = async (email, password) => {\r\n            try {\r\n                const response = await fetchCustom(\"POST\", \"/login/\",\r\n                    {email, password}, {}, false\r\n                );\r\n                const data = await response.json();\r\n                if (response.ok) {\r\n                    const user = parseUserFromToken(data.access);\r\n                    console.log(\"Login successful\");\r\n                    setAccessToken(data.access) // Fetch access token\r\n                    // Fetch user data\r\n                    console.log(\"Decoded access token:\", user);\r\n                    setUser(user);\r\n                    // Store data in localStorage\r\n                    localStorage.setItem(\"accessToken\", data.access);\r\n                    localStorage.setItem(\"user\", JSON.stringify(user));\r\n                    return true;\r\n                } else {\r\n                    return await extractErrorMessage(data, response.status);\r\n                }\r\n            } catch (error) {\r\n                Sentry.captureException(error);\r\n                return error;\r\n            }\r\n        };\r\n\r\n        const logout = useCallback(async ({skipApiCall = false} = {}) => {\r\n            console.log(\"Logout function called\");\r\n\r\n            if (refreshTimer.current) {\r\n                console.log(\"Aborting refresh timer...\");\r\n                clearTimeout(refreshTimer.current);\r\n                refreshTimer.current = null;\r\n            }\r\n\r\n            if (!skipApiCall)\r\n                await fetchCustom(\"POST\", \"/logout/\");\r\n\r\n            localStorage.removeItem(\"accessToken\");\r\n            localStorage.removeItem(\"user\");\r\n            setAccessToken(null);\r\n            setUser(null);\r\n            console.log(\"Logged out successfully\");\r\n        }, []);\r\n\r\n\r\n        const refreshAccessToken = useCallback(async () => {\r\n            if (accessToken) {\r\n                try {\r\n                    const email = user?.profile?.email;\r\n                    const response = await fetchCustom(\"POST\", \"/api/token/refresh/\",\r\n                        {email}, {}, false);\r\n                    if (response.ok) {\r\n                        const data = await response.json();\r\n                        const user = parseUserFromToken(data.access);\r\n                        setAccessToken(data.access);\r\n                        setUser(user);\r\n                        localStorage.setItem(\"accessToken\", data.access);\r\n                        localStorage.setItem(\"user\", JSON.stringify(user));\r\n                        return true;\r\n                    } else {\r\n                        console.warn(\"Token refresh failed. Logging out...\");\r\n                        await logout();\r\n                        return false;\r\n                    }\r\n                } catch (error) {\r\n                    Sentry.captureException(error);\r\n                    console.error(\"Refresh token error:\", error);\r\n                    await logout();\r\n                    return false;\r\n                }\r\n            } else {\r\n                console.log(\"Skipping token refresh, user is not logged in\");\r\n                return false;\r\n            }\r\n        }, [user, accessToken, logout]);\r\n\r\n\r\n        useEffect(() => {\r\n            const clearRefreshTimer = () => {\r\n                if (refreshTimer.current) {\r\n                    clearTimeout(refreshTimer.current);\r\n                    refreshTimer.current = null;\r\n                }\r\n            };\r\n\r\n            if (!accessToken) {\r\n                console.log(\"No access token found, skipping refresh scheduling\");\r\n                return;\r\n            }\r\n\r\n            const {exp} = jwtDecode(accessToken);\r\n            const now = Math.floor(Date.now() / 1000);\r\n            const refreshTime = (exp - now - 30) * 1000; // Refresh 30s before expiry\r\n\r\n            const expDate = new Date(exp * 1000);\r\n            const nowDate = new Date(now * 1000);\r\n            console.log(`Token expires at: ${expDate.getHours()}:${expDate.getMinutes()}, current time: ${nowDate.getHours()}:${nowDate.getMinutes()}, refresh time in s: ${refreshTime / 1000}`);\r\n\r\n            if (refreshTime <= 0) {\r\n                console.log(\"Refresh time is not valid, no timer set\");\r\n                setAccessToken(null);\r\n                return;\r\n            }\r\n\r\n            clearRefreshTimer();\r\n\r\n            refreshTimer.current = setTimeout(() => {\r\n                console.log(\"Refreshing access token...\");\r\n                refreshAccessToken().then();\r\n            }, refreshTime);\r\n\r\n            return () => {\r\n                console.log(\"Clearing refresh timer\");\r\n                clearRefreshTimer();\r\n            };\r\n        }, [accessToken, refreshAccessToken]);\r\n\r\n        useEffect(() => {\r\n            const initializeAuth = async () => {\r\n                const storedToken = localStorage.getItem(\"accessToken\");\r\n                const storedUser = localStorage.getItem(\"user\");\r\n\r\n                if (storedToken && storedUser) {\r\n                    try {\r\n                        const decodedToken = jwtDecode(storedToken);\r\n                        const now = Math.floor(Date.now() / 1000);\r\n\r\n                        if (decodedToken.exp > now) {\r\n                            setAccessToken(storedToken);\r\n                            setUser(JSON.parse(storedUser));\r\n                        } else {\r\n                            await logout({skipApiCall: true}); // token expired\r\n                        }\r\n                    } catch (e) {\r\n                        Sentry.captureException(e);\r\n                        console.error(\"Token decode error\", e);\r\n                        await logout({skipApiCall: true}); // invalid token\r\n                    }\r\n                }\r\n\r\n                setLoading(false);\r\n            };\r\n\r\n            initializeAuth().then();\r\n        }, [logout]);\r\n\r\n        return (\r\n            <AuthContext.Provider value={{user, accessToken, refreshAccessToken, logout, login, loading}}>\r\n                {children}\r\n            </AuthContext.Provider>\r\n        );\r\n    }\r\n;\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n","import {createContext, useContext, useState, useEffect} from 'react';\r\n\r\nconst SidebarContext = createContext(undefined);\r\n\r\nexport function SidebarProvider({children}) {\r\n    const [isDrawerOpen, setIsDrawerOpen] = useState(false);\r\n    const [expandedSection, setExpandedSection] = useState(null);\r\n\r\n    useEffect(() => {\r\n        const savedDrawerState = localStorage.getItem('sidebarDrawerState');\r\n        if (savedDrawerState) {\r\n            setIsDrawerOpen(JSON.parse(savedDrawerState));\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem('sidebarDrawerState', JSON.stringify(isDrawerOpen));\r\n    }, [isDrawerOpen]);\r\n\r\n    const toggleDrawer = (open) => (event) => {\r\n        if (event && event.type === 'keydown' && (event.key === 'Tab' || event.key === 'Shift')) {\r\n            return;\r\n        }\r\n        setIsDrawerOpen(open);\r\n    };\r\n\r\n    const handleExpand = (section) => {\r\n        setExpandedSection((prevSection) => prevSection === section ? null : section);\r\n    };\r\n\r\n    const closeDrawer = () => setIsDrawerOpen(false);\r\n\r\n    return (\r\n        <SidebarContext.Provider value={{\r\n            isDrawerOpen,\r\n            toggleDrawer,\r\n            closeDrawer,\r\n            expandedSection,\r\n            handleExpand\r\n        }}>\r\n            {children}\r\n        </SidebarContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useSidebar() {\r\n    return useContext(SidebarContext);\r\n}","export default \"__VITE_ASSET__AahJbyAp__\"","import {Typography, Box, Alert} from '@mui/material';\r\n\r\nconst StatusBanner = ({message, state, successText, errorText}) => {\r\n    return (\r\n        <Box\r\n            sx={{\r\n                mt: 2,\r\n                mb: 2,\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                alignItems: 'center',\r\n                textAlign: 'center',\r\n                p: 2,\r\n                borderRadius: 5,\r\n                boxShadow: 3,\r\n                bgcolor: 'background.paper'\r\n            }}>\r\n            {state === 'success' && (<>\r\n                <Alert severity=\"success\" sx={{width: '100%', mb: 1}}>\r\n                    {message || 'Success!'}\r\n                </Alert>\r\n                {successText && <Typography>{successText}</Typography>}\r\n            </>)}\r\n\r\n            {state === 'error' && (<>\r\n                <Alert severity=\"error\" sx={{width: '100%', mb: 1}}>\r\n                    {message || 'An error occurred'}\r\n                </Alert>\r\n                {errorText && <Typography>{errorText}</Typography>}\r\n            </>)}\r\n        </Box>\r\n    );\r\n};\r\n\r\nexport default StatusBanner;","import {Button, Box, Container, Link, TextField, CssBaseline, CircularProgress} from '@mui/material';\r\nimport {useState} from 'react';\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {useAuth} from \"../Context/AuthContext\";\r\nimport logo from '../assets/esnpolimi-logo.png';\r\nimport StatusBanner from \"../Components/StatusBanner\";\r\nimport {fetchCustom} from \"../api/api\";\r\nimport {extractErrorMessage} from \"../utils/errorHandling\";\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nexport default function Login() {\r\n    const [email, setEmail] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [isForgotPassword, setIsForgotPassword] = useState(false);\r\n    const {login} = useAuth();\r\n    const navigate = useNavigate();\r\n    const [statusMessage, setStatusMessage] = useState(null);\r\n    const [isResetSubmitted, setResetSubmitted] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    const handleForgotPassword = async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            console.log(\"Sending forgot password request for:\", email);\r\n            const response = await fetchCustom(\"POST\", '/api/forgot-password/', {email: email}, {}, false);\r\n            if (response.ok) {\r\n                setResetSubmitted(true);\r\n                setStatusMessage({message: 'Se il profilo è registrato, l\\'email è stata inviata con successo a \"' + email + '\". Controlla la tua casella di posta.', state: 'success'});\r\n            } else {\r\n                const json = await response.json();\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setStatusMessage({message: `Errore durante l'invio dell'email: ${errorMessage}`, state: 'error'});\r\n            }\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setStatusMessage({message: `Errore generale: ${error}`, state: 'error'});\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleLogin = async () => {\r\n        setIsLoading(true);\r\n        setStatusMessage(null);\r\n        const success = await login(email, password);\r\n        setIsLoading(false);\r\n        if (success === true) {\r\n            navigate(\"/\");\r\n        } else if (\r\n            typeof success === \"string\" &&\r\n            (success.trim().startsWith(\"<!DOCTYPE html\") || success.trim().startsWith(\"<html\"))\r\n        ) {\r\n            // Open the HTML error in a new tab\r\n            const newWindow = window.open();\r\n            if (newWindow) {\r\n                newWindow.document.open();\r\n                newWindow.document.write(success);\r\n                newWindow.document.close();\r\n            } else {\r\n                setStatusMessage({message: \"Impossibile aprire la pagina di errore in una nuova scheda.\", state: 'error'});\r\n            }\r\n        } else {\r\n            setStatusMessage({message: `Errore durante il login: ${success}`, state: 'error'});\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Container component=\"main\" maxWidth=\"xs\">\r\n            <CssBaseline/>\r\n            <Box\r\n                sx={{\r\n                    marginTop: 8,\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    alignItems: 'center',\r\n                }}>\r\n                <img alt='' src={logo || ''} style={{height: '25vh'}}/>\r\n                <Box>\r\n                    {!isResetSubmitted && (\r\n                        <TextField\r\n                            margin=\"normal\"\r\n                            required\r\n                            fullWidth\r\n                            id=\"email\"\r\n                            label=\"Email\"\r\n                            name=\"email\"\r\n                            autoComplete=\"email\"\r\n                            autoFocus\r\n                            onChange={(e) => setEmail(e.target.value)}\r\n                            onKeyDown={(e) => e.key === 'Enter' && (isForgotPassword ? handleForgotPassword() : handleLogin())}\r\n                        />\r\n                    )}\r\n                    {!isForgotPassword && (\r\n                        <TextField\r\n                            margin=\"normal\"\r\n                            required\r\n                            fullWidth\r\n                            name=\"password\"\r\n                            label=\"Password\"\r\n                            type=\"password\"\r\n                            id=\"password\"\r\n                            autoComplete=\"current-password\"\r\n                            onChange={(e) => setPassword(e.target.value)}\r\n                            onKeyDown={(e) => e.key === 'Enter' && handleLogin()}\r\n                        />\r\n                    )}\r\n                    {!isResetSubmitted && (\r\n                        <Button\r\n                            fullWidth\r\n                            variant=\"contained\"\r\n                            sx={{mt: 3, mb: 2, backgroundColor: 'black'}}\r\n                            onClick={isForgotPassword ? handleForgotPassword : handleLogin}\r\n                            disabled={isLoading}>\r\n                            {isLoading ? (\r\n                                <CircularProgress size={24} color=\"inherit\"/>\r\n                            ) : (\r\n                                isForgotPassword ? 'Invia Email di Reset' : 'Log In'\r\n                            )}\r\n                        </Button>\r\n                    )}\r\n                    <Box sx={{display: 'flex', justifyContent: 'center', width: '100%'}}>\r\n                        <Link\r\n                            component=\"button\"\r\n                            variant=\"body2\"\r\n                            onClick={() => {\r\n                                setIsForgotPassword(!isForgotPassword);\r\n                                setResetSubmitted(false);\r\n                                setStatusMessage(null);\r\n                            }}\r\n                            sx={{textAlign: 'center'}}>\r\n                            {isForgotPassword ? 'Torna al Login' : 'Password dimenticata?'}\r\n                        </Link>\r\n                        <Link\r\n                            component=\"button\"\r\n                            variant=\"body2\"\r\n                            onClick={() => navigate('/esner_form')}\r\n                            sx={{textAlign: 'center', marginLeft: 2}}>\r\n                            Non hai un account? Registrati\r\n                        </Link>\r\n                    </Box>\r\n                </Box>\r\n                {statusMessage && (<StatusBanner message={statusMessage.message} state={statusMessage.state}/>)}\r\n            </Box>\r\n        </Container>\r\n    );\r\n}","import React, {useState} from 'react';\r\nimport {Box, Button, FormControl, InputLabel, MenuItem, Select, TextField, Typography, Grid} from '@mui/material';\r\nimport {LocalizationProvider, DatePicker} from '@mui/x-date-pickers';\r\nimport {AdapterDayjs} from '@mui/x-date-pickers/AdapterDayjs';\r\nimport dayjs from 'dayjs';\r\nimport {Checkbox, FormControlLabel} from '@mui/material';\r\nimport 'dayjs/locale/en-gb';\r\nimport {green} from '@mui/material/colors';\r\nimport CheckCircleOutlineIcon from '@mui/icons-material/CheckCircleOutline';\r\nimport {fetchCustom} from \"../api/api\";\r\nimport countryCodes from \"../data/countryCodes.json\";\r\nimport StatusBanner from '../Components/StatusBanner';\r\nimport Link from '@mui/material/Link';\r\nimport CircularProgress from '@mui/material/CircularProgress';\r\nimport LoginIcon from '@mui/icons-material/Login';\r\nimport CheckIcon from \"@mui/icons-material/Check\";\r\nimport CloseIcon from \"@mui/icons-material/Close\";\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nexport default function ErasmusForm() {\r\n    const [isSubmitted, setSubmitted] = React.useState(false)\r\n    const [sameWAasPhone, setSameWAasPhone] = React.useState(true);\r\n    const [statusMessage, setStatusMessage] = useState(null);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    // Add checkbox state and error state\r\n    const [checkboxes, setCheckboxes] = useState({\r\n        acceptStatute: false,\r\n        acceptPurposes: false,\r\n        acceptRegulation: false,\r\n        acceptPrivacy: false,\r\n    });\r\n    const [checkboxErrors, setCheckboxErrors] = useState({\r\n        acceptStatute: false,\r\n        acceptPurposes: false,\r\n        acceptRegulation: false,\r\n        acceptPrivacy: false,\r\n    });\r\n\r\n    const links = {\r\n        statute: \"https://drive.google.com/file/d/1b0gpA3x9yRuAcdEWQyc9KvrnZzm0l-dB/view?usp=sharing\", // In English\r\n        regulation: \"https://drive.google.com/file/d/1_s0uBvqfOLRz5rQp1EEeNgtxRjs7Pgxy/view?usp=sharing\", // In English\r\n        privacy: \"https://drive.google.com/file/d/12LY0y49cCyjqdF0RotsO6srHrGkinNln/view?usp=sharing\" // In English\r\n    };\r\n\r\n    const [formData, setFormData] = React.useState({\r\n        name: '',\r\n        surname: '',\r\n        email: '',\r\n        email_confirm: '',\r\n        birthdate: dayjs(),\r\n        country: '',\r\n        phone_prefix: '+39',\r\n        phone_number: '',\r\n        whatsapp_prefix: '+39',\r\n        whatsapp_number: '',\r\n        person_code: '',\r\n        domicile: '',\r\n        course: '',\r\n        document_type: 'ID Card',\r\n        document_number: '',\r\n        document_expiration: dayjs(),\r\n        matricola_number: '',\r\n        matricola_expiration: dayjs(),\r\n        is_esner: false\r\n    });\r\n\r\n    /*const [formData, setFormData] = React.useState({\r\n        'name': 'Giampiero',\r\n        'surname': 'Bassini',\r\n        'email': 'teopompil@gmail.com',\r\n        'email_confirm': 'teopompil@gmail.com',\r\n        'birthdate': dayjs(),\r\n        'password': '1Unoduetrequattro',\r\n        'password_confirm': '1Unoduetrequattro',\r\n        'country': 'IT',\r\n        'phone_prefix': '+39',\r\n        'phone_number': '11111111',\r\n        'whatsapp_prefix': '+39',\r\n        'whatsapp_number': '',\r\n        'person_code': '65432101',\r\n        'domicile': 'via bassini 1, Milano',\r\n        'course': 'Design',\r\n        'document_type': 'ID Card',\r\n        'document_number': '324153gfd',\r\n        'document_expiration': dayjs(),\r\n        'matricola_number': '653423',\r\n        'matricola_expiration': dayjs(),\r\n        'is_esner': false\r\n    });*/\r\n\r\n    const initialFormErrors = {\r\n        email: [false, ''],\r\n        email_confirm: [false, ''],\r\n        name: [false, ''],\r\n        surname: [false, ''],\r\n        birthdate: [false, ''],\r\n        country: [false, ''],\r\n        phone_prefix: [false, ''],\r\n        phone_number: [false, ''],\r\n        whatsapp_prefix: [false, ''],\r\n        whatsapp_number: [false, ''],\r\n        person_code: [false, ''],\r\n        domicile: [false, ''],\r\n        course: [false, ''],\r\n        document_type: [false, ''],\r\n        document_number: [false, ''],\r\n        document_expiration: [false, ''],\r\n        matricola_number: [false, ''],\r\n        matricola_expiration: [false, ''],\r\n        is_esner: [false, '']\r\n    };\r\n\r\n    const [formErrors, setFormErrors] = React.useState(initialFormErrors);\r\n\r\n    const validateForm = () => {\r\n        let valid = true;\r\n        const newErrors = {...formErrors};\r\n        const newCheckboxErrors = {...checkboxErrors};\r\n\r\n        // Required fields\r\n        const requiredFields = [\r\n            'email', 'email_confirm', 'name', 'surname', 'birthdate', 'country', 'phone_prefix',\r\n            'phone_number', 'person_code', 'domicile', 'course', 'document_type',\r\n            'document_number', 'document_expiration', 'matricola_number', 'matricola_expiration'\r\n        ];\r\n        requiredFields.forEach(field => {\r\n            if (!formData[field] || (typeof formData[field] === 'string' && formData[field].trim() === '')) {\r\n                newErrors[field] = [true, 'This field is required'];\r\n                valid = false;\r\n            } else {\r\n                newErrors[field] = [false, ''];\r\n            }\r\n        });\r\n\r\n        // Validate matricola (exactly 6 digits)\r\n        const matricolaRegex = /^\\d{6}$/;\r\n        if (!matricolaRegex.test(formData.matricola_number)) {\r\n            newErrors.matricola_number = [true, 'Matricola must be exactly 6 digits'];\r\n            valid = false;\r\n        } else newErrors.matricola_number = [false, ''];\r\n\r\n        // Validate person code (exactly 8 digits)\r\n        const personCodeRegex = /^\\d{8}$/;\r\n        if (!personCodeRegex.test(formData.person_code)) {\r\n            newErrors.person_code = [true, 'Person Code must be exactly 8 digits'];\r\n            valid = false;\r\n        } else newErrors.person_code = [false, ''];\r\n\r\n        // Email format regex (simple version)\r\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n        if (formData.email && !emailRegex.test(formData.email)) {\r\n            newErrors.email = [true, 'Invalid email format'];\r\n            valid = false;\r\n        }\r\n\r\n        // Validate emails equality\r\n        if (formData.email !== formData.email_confirm) {\r\n            newErrors.email_confirm = [true, 'Emails do not match'];\r\n            valid = false;\r\n        } else newErrors.email_confirm = [false, ''];\r\n\r\n        // Checkbox validation\r\n        Object.entries(checkboxes).forEach(([key, value]) => {\r\n            if (!value) {\r\n                newCheckboxErrors[key] = true;\r\n                valid = false;\r\n            } else {\r\n                newCheckboxErrors[key] = false;\r\n            }\r\n        });\r\n\r\n        setFormErrors(newErrors);\r\n        setCheckboxErrors(newCheckboxErrors);\r\n        if (!valid) setStatusMessage({message: \"Error in form submission, check the errors below\", state: 'error'});\r\n        return valid;\r\n    };\r\n\r\n    const scrollUp = () => {\r\n        window.scrollTo({\r\n            top: 0,\r\n            behavior: 'smooth'\r\n        });\r\n    }\r\n\r\n    const formatDateString = (date) => {\r\n        return dayjs(date).format('YYYY-MM-DD');\r\n    };\r\n\r\n    const handleChange = (e) => {\r\n        setFormData({\r\n            ...formData,\r\n            [e.target.name]: e.target.value,\r\n        });\r\n        // Reset error for this field\r\n        if (formErrors[e.target.name]) {\r\n            setFormErrors({\r\n                ...formErrors,\r\n                [e.target.name]: [false, '']\r\n            });\r\n        }\r\n    };\r\n\r\n    const handleDateChange = (name, date) => {\r\n        setFormData({\r\n            ...formData,\r\n            [name]: date,\r\n        });\r\n    };\r\n\r\n    const handleCheckboxChange = (e) => {\r\n        const {name, checked} = e.target;\r\n        setCheckboxes({\r\n            ...checkboxes,\r\n            [name]: checked\r\n        });\r\n        // Reset checkbox error when checked\r\n        if (checked) {\r\n            setCheckboxErrors({\r\n                ...checkboxErrors,\r\n                [name]: false\r\n            });\r\n        }\r\n    };\r\n\r\n    const handleSubmit = (e) => {\r\n        e.preventDefault();\r\n\r\n        if (!validateForm()) {\r\n            scrollUp();\r\n            return;\r\n        }\r\n\r\n        setStatusMessage(null);\r\n        setIsLoading(true);\r\n\r\n        let body = {\r\n            ...formData,\r\n            whatsapp_prefix: sameWAasPhone ? formData.phone_prefix : formData.whatsapp_prefix,\r\n            whatsapp_number: sameWAasPhone ? formData.phone_number : formData.whatsapp_number,\r\n            birthdate: formatDateString(formData.birthdate),\r\n            document_expiration: formatDateString(formData.document_expiration),\r\n            matricola_expiration: formatDateString(formData.matricola_expiration),\r\n        }\r\n\r\n        const submit = async () => {\r\n            try {\r\n                const response = await fetchCustom(\"POST\", '/profile/initiate-creation/', body, {}, false);\r\n                const data = await response.json();\r\n                setFormErrors(initialFormErrors);\r\n                if (!response.ok) {\r\n                    setStatusMessage({message: 'Failed to submit application: see errors below', state: 'error'});\r\n                    const newErrors = {...formErrors};\r\n                    Object.entries(data).forEach(([field, message]) => {\r\n                        if (newErrors[field]) newErrors[field] = [true, message];\r\n                    });\r\n                    setFormErrors(newErrors);\r\n                } else {\r\n                    setSubmitted(true);\r\n                }\r\n            } catch (error) {\r\n                Sentry.captureException(error);\r\n                setStatusMessage({message: 'Internal error (please contact us): ' + error.message, state: 'error'});\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n        submit().then();\r\n    }\r\n\r\n    const handleSameNumberChange = (e) => {\r\n        setSameWAasPhone(e.target.checked);\r\n        if (e.target.checked) {\r\n            setFormData({\r\n                ...formData,\r\n                whatsapp_prefix: formData.phone_prefix,\r\n                whatsapp_number: formData.phone_number\r\n            });\r\n        }\r\n    };\r\n\r\n    if (isSubmitted) {\r\n        return (\r\n            <Box display=\"flex\"\r\n                 flexDirection=\"column\"\r\n                 alignItems=\"center\"\r\n                 justifyContent=\"center\"\r\n                 height=\"100vh\"\r\n                 bgcolor=\"#fff\">\r\n                <CheckCircleOutlineIcon style={{fontSize: 100, color: green[500]}}/>\r\n                <Typography variant=\"h4\" align=\"center\" gutterBottom>\r\n                    Your response has been sent.\r\n                </Typography>\r\n                <Typography variant=\"subtitle1\" align=\"center\">\r\n                    Check your inbox to verify your e-mail.\r\n                </Typography>\r\n                <Typography variant=\"body2\" align=\"center\" sx={{mt: 2}}>\r\n                    In case you do not receive an email, please check your spam folder or contact us at <Link href=\"mailto: informatica@esnpolimi.it\">informatica@esnpolimi.it</Link>\r\n                </Typography>\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Box component=\"form\" noValidate sx={{maxWidth: 800, margin: 'auto', mt: 5, mb: 5, px: 4}} onSubmit={handleSubmit}>\r\n            <Typography variant=\"h4\" align=\"center\" gutterBottom mb={5}>ESN Polimi Registration - International Student</Typography>\r\n\r\n            {statusMessage && (<StatusBanner message={statusMessage.message} state={statusMessage.state}/>)}\r\n\r\n            <Typography variant=\"h5\" align=\"center\" gutterBottom sx={{my: 4}}>Personal Information</Typography>\r\n            <Grid container spacing={3}>\r\n                <Grid size={{xs: 12, sm: 4}}>\r\n                    <TextField\r\n                        label=\"Name\"\r\n                        variant=\"outlined\"\r\n                        name=\"name\"\r\n                        value={formData.name}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.name[0]}\r\n                        helperText={formErrors.name[1]}/>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 4}}>\r\n                    <TextField\r\n                        label=\"Surname\"\r\n                        variant=\"outlined\"\r\n                        name=\"surname\"\r\n                        value={formData.surname}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.surname[0]}\r\n                        helperText={formErrors.surname[1]}/>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 4}}>\r\n                    <LocalizationProvider dateAdapter={AdapterDayjs} adapterLocale='en-gb'>\r\n                        <DatePicker\r\n                            label=\"Birthdate\"\r\n                            value={formData.birthdate}\r\n                            onChange={(date) => handleDateChange('birthdate', date)}\r\n                            maxDate={dayjs()}\r\n                            slotProps={{textField: {variant: 'outlined'}}}/>\r\n                    </LocalizationProvider>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <TextField\r\n                        label=\"Email\"\r\n                        variant=\"outlined\"\r\n                        name=\"email\"\r\n                        type=\"email\"\r\n                        value={formData.email}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.email[0]}\r\n                        helperText={formErrors.email[1]}/>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <TextField\r\n                        label=\"Confirm Email\"\r\n                        variant=\"outlined\"\r\n                        name=\"email_confirm\"\r\n                        type=\"email\"\r\n                        value={formData.email_confirm}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.email_confirm[0]}\r\n                        helperText={formErrors.email_confirm[1]}/>\r\n                    <Box sx={{mt: 1}}>\r\n                        {formData.email_confirm && (\r\n                            <Typography variant=\"caption\" sx={{display: 'flex', alignItems: 'center', color: formData.email === formData.email_confirm ? 'green' : 'grey'}}>\r\n                                {formData.email === formData.email_confirm\r\n                                    ? <CheckIcon fontSize=\"small\" sx={{mr: 0.5}}/>\r\n                                    : <CloseIcon fontSize=\"small\" sx={{mr: 0.5}}/>\r\n                                }\r\n                                {formData.email === formData.email_confirm\r\n                                    ? \"The emails match\"\r\n                                    : \"The emails do not match\"}\r\n                            </Typography>\r\n                        )}\r\n                    </Box>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <FormControl fullWidth required>\r\n                        <InputLabel id=\"country-label\">Home University Country</InputLabel>\r\n                        <Select\r\n                            variant=\"outlined\"\r\n                            labelId=\"country-label\"\r\n                            name=\"country\"\r\n                            value={formData.country}\r\n                            onChange={handleChange}\r\n                            label=\"Home University Country\"\r\n                            error={formErrors.country[0]}>\r\n                            {countryCodes.map((country) => (\r\n                                <MenuItem key={country.code} value={country.code}>\r\n                                    {country.name}\r\n                                </MenuItem>\r\n                            ))}\r\n                        </Select>\r\n                    </FormControl>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <TextField\r\n                        label=\"Home Domicile\"\r\n                        variant=\"outlined\"\r\n                        name=\"domicile\"\r\n                        value={formData.domicile}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.domicile[0]}\r\n                        helperText={formErrors.domicile[1]}/>\r\n                </Grid>\r\n                <Grid size={{xs: 4, sm: 2}}>\r\n                    <FormControl fullWidth>\r\n                        <InputLabel id=\"phone-prefix-label\">Prefix</InputLabel>\r\n                        <Select\r\n                            variant=\"outlined\"\r\n                            labelId=\"phone-prefix-label\"\r\n                            id=\"phone-prefix\"\r\n                            name=\"phone_prefix\"\r\n                            value={formData.phone_prefix}\r\n                            onChange={handleChange}\r\n                            label=\"Prefix\"\r\n                            renderValue={(value) => value}\r\n                            error={formErrors.phone_prefix[0]}>\r\n                            {countryCodes.map((country) => (\r\n                                <MenuItem key={country.code} value={country.dial}>\r\n                                    {country.dial} ({country.name})\r\n                                </MenuItem>\r\n                            ))}\r\n                        </Select>\r\n                    </FormControl>\r\n                </Grid>\r\n                <Grid size={{xs: 8, sm: 4}}>\r\n                    <TextField\r\n                        label=\"Phone Number\"\r\n                        variant=\"outlined\"\r\n                        name=\"phone_number\"\r\n                        type=\"number\"\r\n                        value={formData.phone_number}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.phone_number[0]}\r\n                        helperText={formErrors.phone_number[1]}/>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <FormControlLabel\r\n                        control={\r\n                            <Checkbox\r\n                                checked={sameWAasPhone}\r\n                                onChange={handleSameNumberChange}\r\n                                name=\"sameAsPhone\"\r\n                                color=\"primary\"/>\r\n                        }\r\n                        label=\"Same number for WhatsApp\"\r\n                    />\r\n                </Grid>\r\n                {!sameWAasPhone && (<>\r\n                    <Grid size={{xs: 4, sm: 2}}>\r\n                        <FormControl fullWidth>\r\n                            <InputLabel id=\"whatsapp-prefix-label\">Prefix</InputLabel>\r\n                            <Select\r\n                                variant=\"outlined\"\r\n                                labelId=\"whatsapp-prefix-label\"\r\n                                id=\"whatsapp-prefix\"\r\n                                name=\"whatsapp_prefix\"\r\n                                value={formData.whatsapp_prefix}\r\n                                onChange={handleChange}\r\n                                label=\"Prefix\"\r\n                                renderValue={(value) => value}\r\n                                error={formErrors.whatsapp_prefix[0]}>\r\n                                {countryCodes.map((country) => (\r\n                                    <MenuItem key={country.code} value={country.dial}>\r\n                                        {country.dial} ({country.name})\r\n                                    </MenuItem>\r\n                                ))}\r\n                            </Select>\r\n                        </FormControl>\r\n                    </Grid>\r\n                    <Grid size={{xs: 8, sm: 4}}>\r\n                        <TextField\r\n                            label=\"Whatsapp Number\"\r\n                            variant=\"outlined\"\r\n                            name=\"whatsapp_number\"\r\n                            type=\"number\"\r\n                            value={formData.whatsapp_number}\r\n                            onChange={handleChange}\r\n                            fullWidth\r\n                            required\r\n                            error={formErrors.whatsapp_number[0]}\r\n                            helperText={formErrors.whatsapp_number[1]}/>\r\n                    </Grid>\r\n                </>)}\r\n            </Grid>\r\n\r\n            <Typography variant=\"h5\" align=\"center\" gutterBottom my={4}>Document Information</Typography>\r\n            <Grid container spacing={3}>\r\n                <Grid size={{xs: 12, sm: 4}}>\r\n                    <FormControl fullWidth required>\r\n                        <InputLabel id=\"idType-label\">Type</InputLabel>\r\n                        <Select\r\n                            variant=\"outlined\"\r\n                            labelId=\"document-type-label\"\r\n                            name=\"document_type\"\r\n                            value={formData.document_type}\r\n                            onChange={handleChange}\r\n                            label=\"Type\"\r\n                            required\r\n                            error={formErrors.document_type[0]}>\r\n                            <MenuItem value=\"Passport\">Passport</MenuItem>\r\n                            <MenuItem value=\"ID Card\">ID Card</MenuItem>\r\n                            <MenuItem value=\"Driving License\">Driving License</MenuItem>\r\n                            <MenuItem value=\"Residency Permit\">Residency Permit</MenuItem>\r\n                            <MenuItem value=\"Other\">Other</MenuItem>\r\n                        </Select>\r\n                    </FormControl>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 4}}>\r\n                    <TextField\r\n                        label=\"Number\"\r\n                        variant=\"outlined\"\r\n                        name=\"document_number\"\r\n                        value={formData.document_number}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.document_number[0]}\r\n                        helperText={formErrors.document_number[1]}/>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 4}}>\r\n                    <LocalizationProvider dateAdapter={AdapterDayjs} adapterLocale='en-gb'>\r\n                        <DatePicker\r\n                            label=\"Expiration Date\"\r\n                            value={formData.document_expiration}\r\n                            onChange={(date) => handleDateChange('document_expiration', date)}\r\n                            slotProps={{textField: {variant: 'outlined'}}}/>\r\n                    </LocalizationProvider>\r\n                </Grid>\r\n            </Grid>\r\n\r\n            <Typography variant=\"h5\" align=\"center\" gutterBottom my={4}>Exchange Information</Typography>\r\n            <Grid container spacing={3}>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <FormControl fullWidth required>\r\n                        <InputLabel id=\"course-label\">Field of Study</InputLabel>\r\n                        <Select\r\n                            variant=\"outlined\"\r\n                            labelId=\"course-label\"\r\n                            name=\"course\"\r\n                            value={formData.course}\r\n                            onChange={handleChange}\r\n                            label=\"Field of Study\"\r\n                            error={formErrors.course[0]}>\r\n                            <MenuItem value=\"Engineering\">Engineering</MenuItem>\r\n                            <MenuItem value=\"Design\">Design</MenuItem>\r\n                            <MenuItem value=\"Architecture\">Architecture</MenuItem>\r\n                        </Select>\r\n                    </FormControl>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <LocalizationProvider dateAdapter={AdapterDayjs} adapterLocale='en-gb'>\r\n                        <DatePicker\r\n                            label=\"Exchange End Date\"\r\n                            value={formData.matricola_expiration}\r\n                            onChange={(date) => handleDateChange('matricola_expiration', date)}\r\n                            slotProps={{textField: {variant: 'outlined'}}}/>\r\n                    </LocalizationProvider>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <TextField\r\n                        label=\"Person Code (8 digits)\"\r\n                        variant=\"outlined\"\r\n                        name=\"person_code\"\r\n                        type=\"number\"\r\n                        value={formData.person_code}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.person_code[0]}\r\n                        helperText={formErrors.person_code[1]}/>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <TextField\r\n                        label=\"Matricola (6 digits)\"\r\n                        variant=\"outlined\"\r\n                        name=\"matricola_number\"\r\n                        type=\"number\"\r\n                        value={formData.matricola_number}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.matricola_number[0]}\r\n                        helperText={formErrors.matricola_number[1]}/>\r\n                </Grid>\r\n                <Grid size={{xs: 12}}>\r\n                    <Typography variant=\"body2\" color=\"text.secondary\" sx={{mb: 2}}>\r\n                        You can find your Person Code and Matricola in the Polimi App under your profile section, or from the Online Services.\r\n                        <br/> In case the university has not provided you a Matricola yet, you can fill the field with 6 0s.\r\n                    </Typography>\r\n                </Grid>\r\n            </Grid>\r\n\r\n            <Grid container spacing={3} mt={3}>\r\n                <Grid size={{xs: 12}}>\r\n                    <FormControlLabel\r\n                        control={\r\n                            <Checkbox\r\n                                name=\"acceptStatute\"\r\n                                checked={checkboxes.acceptStatute}\r\n                                onChange={handleCheckboxChange}\r\n                                required\r\n                                sx={{\r\n                                    color: checkboxErrors.acceptStatute ? 'red' : undefined,\r\n                                    '&.Mui-checked': {color: checkboxErrors.acceptStatute ? 'red' : undefined}\r\n                                }}/>\r\n                        }\r\n                        label={\r\n                            <span>\r\n                                I declare that I have read and accepted the{' '}\r\n                                <Link href={links.statute} target=\"_blank\" rel=\"noopener noreferrer\" underline=\"always\">\r\n                                    ESN Politecnico Milano Charter\r\n                                </Link>\r\n                            </span>\r\n                        }/>\r\n                </Grid>\r\n                <Grid size={{xs: 12}}>\r\n                    <FormControlLabel\r\n                        control={\r\n                            <Checkbox\r\n                                name=\"acceptPurposes\"\r\n                                checked={checkboxes.acceptPurposes}\r\n                                onChange={handleCheckboxChange}\r\n                                required\r\n                                sx={{\r\n                                    color: checkboxErrors.acceptPurposes ? 'red' : undefined,\r\n                                    '&.Mui-checked': {color: checkboxErrors.acceptPurposes ? 'red' : undefined}\r\n                                }}/>\r\n                        }\r\n                        label=\"I declare that I fully share the aims of the Association (ref. Article 2 of the Charter)\"\r\n                    />\r\n                </Grid>\r\n                <Grid size={{xs: 12}}>\r\n                    <FormControlLabel\r\n                        control={\r\n                            <Checkbox\r\n                                name=\"acceptRegulation\"\r\n                                checked={checkboxes.acceptRegulation}\r\n                                onChange={handleCheckboxChange}\r\n                                required\r\n                                sx={{\r\n                                    color: checkboxErrors.acceptRegulation ? 'red' : undefined,\r\n                                    '&.Mui-checked': {color: checkboxErrors.acceptRegulation ? 'red' : undefined}\r\n                                }}/>\r\n                        }\r\n                        label={\r\n                            <span>\r\n                                I declare that I accept all the terms stated in the{' '}\r\n                                <Link href={links.regulation} target=\"_blank\" rel=\"noopener noreferrer\" underline=\"always\">\r\n                                    Internal Rules\r\n                                </Link>\r\n                                {' '}and all subsequent changes and additions\r\n                            </span>\r\n                        }/>\r\n                </Grid>\r\n                <Grid size={{xs: 12}}>\r\n                    <FormControlLabel\r\n                        control={\r\n                            <Checkbox\r\n                                name=\"acceptPrivacy\"\r\n                                checked={checkboxes.acceptPrivacy}\r\n                                onChange={handleCheckboxChange}\r\n                                required\r\n                                sx={{\r\n                                    color: checkboxErrors.acceptPrivacy ? 'red' : undefined,\r\n                                    '&.Mui-checked': {color: checkboxErrors.acceptPrivacy ? 'red' : undefined}\r\n                                }}/>\r\n                        }\r\n                        label={\r\n                            <span>\r\n                                I declare that I have read the attached{' '}\r\n                                <Link href={links.privacy} target=\"_blank\" rel=\"noopener noreferrer\" underline=\"always\">\r\n                                    Privacy Disclaimer\r\n                                </Link>\r\n                                {' '}and that I agree to the usage of my personal data according to the Regulation EU 2016/679 (GDPR) and to be aware of my guaranteed rights by the afore-mentioned law\r\n                            </span>\r\n                        }/>\r\n                </Grid>\r\n            </Grid>\r\n\r\n            <Button type=\"submit\"\r\n                    variant=\"contained\"\r\n                    color=\"primary\"\r\n                    fullWidth\r\n                    sx={{mt: 4}}\r\n                    startIcon={!isLoading && <LoginIcon/>}\r\n                    disabled={isLoading}>\r\n                {isLoading ? <CircularProgress size={24} color=\"inherit\"/> : \"Submit\"}\r\n            </Button>\r\n        </Box>\r\n    );\r\n}\r\n","export const profileDisplayNames = {\r\n    id: 'Id',\r\n    name: 'Nome',\r\n    surname: 'Cognome',\r\n    group: 'Gruppo',\r\n    email: 'Email',\r\n    phone_prefix: 'Prefisso Tel',\r\n    phone_number: 'Numero Telefono',\r\n    whatsapp_prefix: 'Prefisso WA',\r\n    whatsapp_number: 'Numero WhatsApp',\r\n    country: 'Paese',\r\n    birthdate: 'Data di Nascita',\r\n    latest_esncard: 'ESNcard',\r\n    latest_document: 'Documento',\r\n    matricola_number: 'Matricola',\r\n    matricola_expiration: 'Scadenza Matricola',\r\n    course: 'Corso di Studi',\r\n    person_code: 'Codice Persona',\r\n    domicile: 'Domicilio',\r\n};\r\n\r\nexport const eventDisplayNames = {\r\n    id: 'Id',\r\n    name: 'Nome Evento',\r\n    date: 'Data Evento',\r\n    description: 'Descrizione',\r\n    cost: 'Costo (€)',\r\n    subscription_start_date: 'Data Apertura Iscrizioni',\r\n    subscription_end_date: 'Data Chiusura Iscrizioni',\r\n    subscription_date_status: 'Stato Iscrizioni',\r\n    list_name: 'Nome Lista',\r\n    list_capacity: 'Capacità Lista'\r\n};\r\n\r\nexport const accountDisplayNames = {\r\n    id: 'Id',\r\n    name: 'Nome',\r\n    status: 'Stato',\r\n    balance: 'Saldo',\r\n    changed_by: 'Ultima Modifica',\r\n    visible_to_groups: 'Gruppi di Visibilità',\r\n};\r\n\r\nexport const transactionDisplayNames = {\r\n    id: 'Id',\r\n    date: 'Data',\r\n    type: 'Tipo',\r\n    description: 'Descrizione',\r\n    amount: 'Importo',\r\n    executor: 'Eseguito da',\r\n    account: 'Cassa',\r\n    tran_type: {\r\n        event: 'Evento',\r\n        esncard: 'ESNcard',\r\n        deposit: 'Deposito',\r\n        withdrawal: 'Prelievo',\r\n        subscription: 'Iscrizione'\r\n    },\r\n}","import React, {useState} from 'react';\r\nimport {Box, Button, FormControl, InputLabel, MenuItem, Select, TextField, Typography, Grid} from '@mui/material';\r\nimport {LocalizationProvider, DatePicker} from '@mui/x-date-pickers';\r\nimport {AdapterDayjs} from '@mui/x-date-pickers/AdapterDayjs';\r\nimport dayjs from 'dayjs';\r\nimport {Checkbox, FormControlLabel} from '@mui/material';\r\nimport 'dayjs/locale/en-gb';\r\nimport {green} from '@mui/material/colors';\r\nimport CheckCircleOutlineIcon from '@mui/icons-material/CheckCircleOutline';\r\nimport {fetchCustom} from \"../api/api\";\r\nimport countryCodes from \"../data/countryCodes.json\";\r\nimport {profileDisplayNames} from \"../utils/displayAttributes\";\r\nimport StatusBanner from \"../Components/StatusBanner\";\r\nimport CheckIcon from '@mui/icons-material/Check';\r\nimport CloseIcon from '@mui/icons-material/Close';\r\nimport LoginIcon from '@mui/icons-material/Login';\r\nimport CircularProgress from '@mui/material/CircularProgress';\r\nimport Link from '@mui/material/Link';\r\nimport WarningAmberIcon from '@mui/icons-material/WarningAmber';\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nexport default function ESNerForm() {\r\n    const [isSubmitted, setSubmitted] = React.useState(false)\r\n    const [statusMessage, setStatusMessage] = useState(null);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [capsLockActive, setCapsLockActive] = useState({password: false, password_confirm: false});\r\n    const names = profileDisplayNames;\r\n\r\n    const [formData, setFormData] = React.useState({\r\n        'email': '',\r\n        'email_confirm': '',\r\n        'password': '',\r\n        'password_confirm': '',\r\n        'name': '',\r\n        'surname': '',\r\n        'birthdate': dayjs(),\r\n        'country': 'IT',\r\n        'phone_prefix': '+39',\r\n        'phone_number': '',\r\n        'person_code': '',\r\n        'domicile': '',\r\n        'document_type': 'ID Card',\r\n        'document_number': '',\r\n        'document_expiration': dayjs(),\r\n        'matricola_number': '',\r\n        'is_esner': true\r\n    });\r\n\r\n    /*const [formData, setFormData] = React.useState({\r\n        email: 'teopompil@gmail.com',\r\n        email_confirm: 'teopompil@gmail.com',\r\n        password: '1Unoduetrequattro',\r\n        password_confirm: '1Unoduetrequattro',\r\n        name: 'Giampiero',\r\n        surname: 'Bassini',\r\n        birthdate: dayjs(),\r\n        country: 'IT',\r\n        phone_prefix: '+39',\r\n        phone_number: '11111111',\r\n        person_code: '11223344',\r\n        domicile: 'via bassini 1, Milano',\r\n        document_type: 'ID Card',\r\n        document_number: '343536gffgdg',\r\n        document_expiration: dayjs(),\r\n        matricola_number: '263544',\r\n        is_esner: true\r\n    });*/\r\n\r\n    const initialFormErrors = {\r\n        email: [false, ''],\r\n        email_confirm: [false, ''],\r\n        password: [false, ''],\r\n        password_confirm: [false, ''],\r\n        name: [false, ''],\r\n        surname: [false, ''],\r\n        birthdate: [false, ''],\r\n        country: [false, ''],\r\n        phone_prefix: [false, ''],\r\n        phone_number: [false, ''],\r\n        person_code: [false, ''],\r\n        domicile: [false, ''],\r\n        document_type: [false, ''],\r\n        document_number: [false, ''],\r\n        document_expiration: [false, ''],\r\n        matricola_number: [false, ''],\r\n        is_esner: [false, '']\r\n    };\r\n\r\n    const [formErrors, setFormErrors] = React.useState(initialFormErrors);\r\n\r\n    // Add state for checkboxes\r\n    const [checkboxes, setCheckboxes] = useState({\r\n        acceptStatute: false,\r\n        acceptPurposes: false,\r\n        acceptRegulation: false,\r\n        acceptPrivacy: false,\r\n    });\r\n\r\n    // Track checkbox errors\r\n    const [checkboxErrors, setCheckboxErrors] = useState({\r\n        acceptStatute: false,\r\n        acceptPurposes: false,\r\n        acceptRegulation: false,\r\n        acceptPrivacy: false,\r\n    });\r\n\r\n    // Example links (replace with your actual URLs)\r\n    const links = {\r\n        statute: \"https://drive.google.com/file/d/1rYtF01hrvQDIYHPebn1nNTDUOazS0kK2/view?usp=sharing\", // In Italian\r\n        regulation: \"https://drive.google.com/file/d/1ZuPfEshihDJ3lvoKyiQ_1L1BpsxBuZdq/view?usp=sharing\", // In Italian\r\n        privacy: \"https://drive.google.com/file/d/12LY0y49cCyjqdF0RotsO6srHrGkinNln/view?usp=sharing\" // In English\r\n    };\r\n\r\n    const passwordRequirements = [\r\n        {\r\n            label: \"Almeno 10 caratteri\",\r\n            test: (pw) => pw.length >= 10\r\n        },\r\n        {\r\n            label: \"Almeno 1 numero\",\r\n            test: (pw) => /\\d/.test(pw)\r\n        },\r\n        {\r\n            label: \"Almeno 1 lettera maiuscola\",\r\n            test: (pw) => /[A-Z]/.test(pw)\r\n        }\r\n    ];\r\n\r\n    const validateForm = () => {\r\n        let valid = true;\r\n        const newErrors = {...formErrors};\r\n        const newCheckboxErrors = {...checkboxErrors};\r\n\r\n        const requiredFields = [\r\n            'email', 'email_confirm', 'password', 'password_confirm',\r\n            'name', 'surname', 'birthdate', 'country', 'phone_prefix',\r\n            'phone_number', 'person_code', 'domicile', 'document_type',\r\n            'document_number', 'document_expiration', 'matricola_number'\r\n        ];\r\n\r\n        requiredFields.forEach(field => {\r\n            if (!formData[field] || (typeof formData[field] === 'string' && formData[field].trim() === '')) {\r\n                newErrors[field] = [true, 'Questo campo è obbligatorio'];\r\n                valid = false;\r\n            } else {\r\n                newErrors[field] = [false, ''];\r\n            }\r\n        });\r\n\r\n        // Validate matricola (exactly 6 digits)\r\n        const matricolaRegex = /^\\d{6}$/;\r\n        if (!matricolaRegex.test(formData.matricola_number)) {\r\n            newErrors.matricola_number = [true, 'La Matricola deve essere di 6 cifre'];\r\n            valid = false;\r\n        } else newErrors.matricola_number = [false, ''];\r\n\r\n        // Validate person code (exactly 8 digits)\r\n        const personCodeRegex = /^\\d{8}$/;\r\n        if (!personCodeRegex.test(formData.person_code)) {\r\n            newErrors.person_code = [true, 'Il Codice Persona deve essere di 8 cifre'];\r\n            valid = false;\r\n        } else newErrors.person_code = [false, ''];\r\n\r\n        // Email format regex (simple version)\r\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n        if (formData.email && !emailRegex.test(formData.email)) {\r\n            newErrors.email = [true, 'Formato email non valido'];\r\n            valid = false;\r\n        }\r\n\r\n        // Validate emails equality\r\n        if (formData.email !== formData.email_confirm) {\r\n            newErrors.email_confirm = [true, 'Le email non corrispondono'];\r\n            valid = false;\r\n        } else newErrors.email_confirm = [false, ''];\r\n\r\n        // Validate passwords equality\r\n        if (formData.password !== formData.password_confirm) {\r\n            newErrors.password_confirm = [true, 'Le password non corrispondono'];\r\n            valid = false;\r\n        } else newErrors.password_confirm = [false, ''];\r\n\r\n        // Checkbox validation\r\n        Object.entries(checkboxes).forEach(([key, value]) => {\r\n            if (!value) {\r\n                newCheckboxErrors[key] = true;\r\n                valid = false;\r\n            } else {\r\n                newCheckboxErrors[key] = false;\r\n            }\r\n        });\r\n\r\n        setFormErrors(newErrors);\r\n        setCheckboxErrors(newCheckboxErrors);\r\n        if (!valid) setStatusMessage({message: \"Errore nella compilazione del form, controlla i campi evidenziati.\", state: \"error\"});\r\n        return valid;\r\n    };\r\n\r\n    const scrollUp = () => {\r\n        window.scrollTo({\r\n            top: 0,\r\n            behavior: 'smooth'\r\n        });\r\n    }\r\n\r\n    const formatDateString = (date) => {\r\n        return dayjs(date).format('YYYY-MM-DD');\r\n    };\r\n\r\n    const handleChange = (e) => {\r\n        setFormData({\r\n            ...formData,\r\n            [e.target.name]: e.target.value,\r\n        });\r\n        // Reset error for this field\r\n        if (formErrors[e.target.name]) {\r\n            setFormErrors({\r\n                ...formErrors,\r\n                [e.target.name]: [false, '']\r\n            });\r\n        }\r\n    };\r\n\r\n    const handleDateChange = (name, date) => {\r\n        setFormData({\r\n            ...formData,\r\n            [name]: date,\r\n        });\r\n    };\r\n\r\n    const handleCheckboxChange = (e) => {\r\n        const {name, checked} = e.target;\r\n        setCheckboxes({\r\n            ...checkboxes,\r\n            [name]: checked\r\n        });\r\n\r\n        // Reset checkbox error when checked\r\n        if (checked) {\r\n            setCheckboxErrors({\r\n                ...checkboxErrors,\r\n                [name]: false\r\n            });\r\n        }\r\n    }\r\n\r\n    const handlePasswordKeyDown = (field) => (e) => {\r\n        setCapsLockActive((prev) => ({\r\n            ...prev,\r\n            [field]: e.getModifierState && e.getModifierState('CapsLock')\r\n        }));\r\n    };\r\n\r\n    const handlePasswordKeyUp = (field) => (e) => {\r\n        setCapsLockActive((prev) => ({\r\n            ...prev,\r\n            [field]: e.getModifierState && e.getModifierState('CapsLock')\r\n        }));\r\n    };\r\n\r\n    const handleSubmit = (e) => {\r\n        e.preventDefault();\r\n\r\n        if (!validateForm()) {\r\n            // Banner is already set in validateForm\r\n            scrollUp();\r\n            return;\r\n        }\r\n\r\n        setStatusMessage(null);\r\n        setIsLoading(true);\r\n\r\n        let body = {\r\n            ...formData,\r\n            birthdate: formatDateString(formData.birthdate),\r\n            document_expiration: formatDateString(formData.document_expiration),\r\n            matricola_expiration: formatDateString(formData.matricola_expiration),\r\n        }\r\n\r\n        const submit = async () => {\r\n            try {\r\n                const response = await fetchCustom(\"POST\", '/profile/initiate-creation/', body, {}, false);\r\n                const data = await response.json();\r\n                setFormErrors(initialFormErrors);\r\n                if (!response.ok) {\r\n                    setStatusMessage({message: 'Errore nell\\'invio dati, guarda gli errori sotto', state: 'error'});\r\n                    const newErrors = {...formErrors};\r\n                    Object.entries(data).forEach(([field, message]) => {\r\n                        if (newErrors[field]) newErrors[field] = [true, message];\r\n                    });\r\n                    setFormErrors(newErrors);\r\n                } else {\r\n                    setSubmitted(true);\r\n                }\r\n            } catch (error) {\r\n                Sentry.captureException(error);\r\n                setStatusMessage({message: 'Internal error (please contact us): ' + error.message, state: 'error'});\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n        submit().then();\r\n    };\r\n\r\n    if (isSubmitted) {\r\n        return (\r\n            <Box display=\"flex\"\r\n                 flexDirection=\"column\"\r\n                 alignItems=\"center\"\r\n                 justifyContent=\"center\"\r\n                 height=\"100vh\"\r\n                 bgcolor=\"#fff\">\r\n                <CheckCircleOutlineIcon style={{fontSize: 100, color: green[500]}}/>\r\n                <Typography variant=\"h4\" align=\"center\" gutterBottom>\r\n                    La tua richiesta di registrazione è stata inviata con successo!\r\n                </Typography>\r\n                <Typography variant=\"subtitle1\" align=\"center\">\r\n                    Controlla la tua email per ulteriori istruzioni.\r\n                </Typography>\r\n                <Typography variant=\"body2\" align=\"center\" sx={{mt: 2}}>\r\n                    In caso non avessi ricevuto nulla, controlla la cartella spam o contattaci all&apos;indirizzo <Link href=\"mailto: informatica@esnpolimi.it\">informatica@esnpolimi.it</Link>\r\n                </Typography>\r\n                <Link href=\"/login\" underline=\"always\" sx={{mt: 3}}>\r\n                    Torna al Login\r\n                </Link>\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Box component=\"form\" noValidate sx={{maxWidth: 800, margin: 'auto', mt: 5, mb: 5, px: 4}} onSubmit={handleSubmit}>\r\n            <Typography variant=\"h4\" align=\"center\" gutterBottom mb={5}>ESN Polimi - Registrazione ESNer</Typography>\r\n\r\n            {statusMessage && (<StatusBanner message={statusMessage.message} state={statusMessage.state}/>)}\r\n\r\n            <Typography variant=\"h5\" align=\"center\" gutterBottom sx={{my: 4}}>Informazioni Personali</Typography>\r\n\r\n            <Grid container spacing={2}>\r\n                <Grid size={{xs: 12, sm: 4}}>\r\n                    <TextField\r\n                        label={names.name}\r\n                        variant=\"outlined\"\r\n                        name=\"name\"\r\n                        value={formData.name}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.name[0]}\r\n                        helperText={formErrors.name[1]}/>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 4}}>\r\n                    <TextField\r\n                        label={names.surname}\r\n                        variant=\"outlined\"\r\n                        name=\"surname\"\r\n                        value={formData.surname}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.surname[0]}\r\n                        helperText={formErrors.surname[1]}/>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 4}}>\r\n                    <LocalizationProvider dateAdapter={AdapterDayjs} adapterLocale='en-gb'>\r\n                        <DatePicker\r\n                            label={names.birthdate}\r\n                            value={formData.birthdate}\r\n                            onChange={(date) => handleDateChange('birthdate', date)}\r\n                            maxDate={dayjs()}\r\n                            required\r\n                            slotProps={{textField: {variant: 'outlined'}}}/>\r\n                    </LocalizationProvider>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <TextField\r\n                        label={names.email}\r\n                        variant=\"outlined\"\r\n                        name=\"email\"\r\n                        type=\"email\"\r\n                        value={formData.email}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.email[0]}\r\n                        helperText={formErrors.email[1]}/>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <TextField\r\n                        label=\"Conferma Email\"\r\n                        variant=\"outlined\"\r\n                        name=\"email_confirm\"\r\n                        type=\"email\"\r\n                        value={formData.email_confirm}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.email_confirm[0]}\r\n                        helperText={formErrors.email_confirm[1]}/>\r\n                    <Box sx={{mt: 1}}>\r\n                        {formData.email_confirm && (\r\n                            <Typography variant=\"caption\" sx={{display: 'flex', alignItems: 'center', color: formData.email === formData.email_confirm ? 'green' : 'grey'}}>\r\n                                {formData.email === formData.email_confirm\r\n                                    ? <CheckIcon fontSize=\"small\" sx={{mr: 0.5}}/>\r\n                                    : <CloseIcon fontSize=\"small\" sx={{mr: 0.5}}/>\r\n                                }\r\n                                {formData.email === formData.email_confirm\r\n                                    ? \"Le due email coincidono\"\r\n                                    : \"Le email non corrispondono\"}\r\n                            </Typography>\r\n                        )}\r\n                    </Box>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <TextField\r\n                        type=\"password\"\r\n                        label=\"Password\"\r\n                        variant=\"outlined\"\r\n                        name=\"password\"\r\n                        value={formData.password}\r\n                        onChange={handleChange}\r\n                        onKeyDown={handlePasswordKeyDown('password')}\r\n                        onKeyUp={handlePasswordKeyUp('password')}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.password[0]}\r\n                        helperText={formErrors.password[1]}/>\r\n                    {/* Caps Lock warning */}\r\n                    {capsLockActive.password && (\r\n                        <Box sx={{display: 'flex', alignItems: 'center', color: 'orange', mt: 0.5}}>\r\n                            <WarningAmberIcon fontSize=\"small\" sx={{mr: 0.5}}/>\r\n                            <Typography variant=\"caption\">Attenzione: il tasto Bloc Maiusc è attivo</Typography>\r\n                        </Box>\r\n                    )}\r\n                    <Box sx={{mt: 1, mb: 2}}>\r\n                        <Typography variant=\"caption\" color=\"text.secondary\">\r\n                            La password deve contenere:\r\n                        </Typography>\r\n                        <ul style={{margin: 0, paddingLeft: 20}}>\r\n                            {passwordRequirements.map((req, idx) => {\r\n                                const passed = req.test(formData.password);\r\n                                return (\r\n                                    <li key={idx} style={{color: passed ? 'green' : 'grey', display: 'flex', alignItems: 'center', marginBottom: 2}}>\r\n                                        {passed ? <CheckIcon fontSize=\"small\" sx={{mr: 0.5}}/> : <CloseIcon fontSize=\"small\" sx={{mr: 0.5}}/>}\r\n                                        <span>{req.label}</span>\r\n                                    </li>\r\n                                );\r\n                            })}\r\n                        </ul>\r\n                    </Box>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <TextField\r\n                        type=\"password\"\r\n                        label=\"Conferma Password\"\r\n                        variant=\"outlined\"\r\n                        name=\"password_confirm\"\r\n                        value={formData.password_confirm}\r\n                        onChange={handleChange}\r\n                        onKeyDown={handlePasswordKeyDown('password_confirm')}\r\n                        onKeyUp={handlePasswordKeyUp('password_confirm')}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.password_confirm[0]}\r\n                        helperText={formErrors.password_confirm[1]}/>\r\n                    {capsLockActive.password_confirm && (\r\n                        <Box sx={{display: 'flex', alignItems: 'center', color: 'orange', mt: 0.5}}>\r\n                            <WarningAmberIcon fontSize=\"small\" sx={{mr: 0.5}}/>\r\n                            <Typography variant=\"caption\">Attenzione: il tasto Bloc Maiusc è attivo</Typography>\r\n                        </Box>\r\n                    )}\r\n                    <Box sx={{mt: 1}}>\r\n                        {formData.password_confirm && (\r\n                            <Typography variant=\"caption\" sx={{display: 'flex', alignItems: 'center', color: formData.password === formData.password_confirm ? 'green' : 'grey'}}>\r\n                                {formData.password === formData.password_confirm\r\n                                    ? <CheckIcon fontSize=\"small\" sx={{mr: 0.5}}/>\r\n                                    : <CloseIcon fontSize=\"small\" sx={{mr: 0.5}}/>\r\n                                }\r\n                                {formData.password === formData.password_confirm\r\n                                    ? \"Le password corrispondono\"\r\n                                    : \"Le password non corrispondono\"}\r\n                            </Typography>\r\n                        )}\r\n                    </Box>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <FormControl fullWidth required>\r\n                        <InputLabel id=\"country-label\">{names.country}</InputLabel>\r\n                        <Select variant=\"outlined\"\r\n                                labelId=\"country-label\"\r\n                                name=\"country\"\r\n                                value={formData.country}\r\n                                onChange={handleChange}\r\n                                label={names.country}\r\n                                error={formErrors.country[0]}>\r\n                            {countryCodes.map((country) => (\r\n                                <MenuItem key={country.code} value={country.code}>\r\n                                    {country.name}\r\n                                </MenuItem>\r\n                            ))}\r\n                        </Select>\r\n                    </FormControl>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <TextField\r\n                        label={names.domicile}\r\n                        variant=\"outlined\"\r\n                        name=\"domicile\"\r\n                        value={formData.domicile}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.domicile[0]}\r\n                        helperText={formErrors.domicile[1]}/>\r\n                </Grid>\r\n                <Grid size={{xs: 4, sm: 2}}>\r\n                    <FormControl fullWidth>\r\n                        <InputLabel id=\"phone-prefix-label\">{names.phone_prefix}</InputLabel>\r\n                        <Select\r\n                            variant=\"outlined\"\r\n                            labelId=\"phone-prefix-label\"\r\n                            id=\"phone-prefix\"\r\n                            name=\"phone_prefix\"\r\n                            value={formData.phone_prefix}\r\n                            onChange={handleChange}\r\n                            label={names.phone_prefix}\r\n                            renderValue={(value) => value}\r\n                            error={formErrors.phone_prefix[0]}>\r\n                            {countryCodes.map((country) => (\r\n                                <MenuItem key={country.code} value={country.dial}>\r\n                                    {country.dial} ({country.name})\r\n                                </MenuItem>\r\n                            ))}\r\n                        </Select>\r\n                    </FormControl>\r\n                </Grid>\r\n                <Grid size={{xs: 8, sm: 4}}>\r\n                    <TextField\r\n                        label={names.phone_number}\r\n                        variant=\"outlined\"\r\n                        name=\"phone_number\"\r\n                        type=\"number\"\r\n                        value={formData.phone_number}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.phone_number[0]}\r\n                        helperText={formErrors.phone_number[1]}/>\r\n                </Grid>\r\n            </Grid>\r\n\r\n            <Typography variant=\"h5\" align=\"center\" gutterBottom my={4}>Informazioni Documento</Typography>\r\n            <Grid container spacing={3}>\r\n                <Grid size={{xs: 12, sm: 4}}>\r\n                    <FormControl fullWidth required>\r\n                        <InputLabel id=\"idType-label\">Tipo</InputLabel>\r\n                        <Select\r\n                            variant=\"outlined\"\r\n                            labelId=\"document-type-label\"\r\n                            name=\"document_type\"\r\n                            value={formData.document_type}\r\n                            onChange={handleChange}\r\n                            label=\"Tipo\"\r\n                            required\r\n                            error={formErrors.document_type[0]}>\r\n                            <MenuItem value=\"Passport\">Passport</MenuItem>\r\n                            <MenuItem value=\"ID Card\">ID Card</MenuItem>\r\n                            <MenuItem value=\"Driving License\">Driving License</MenuItem>\r\n                            <MenuItem value=\"Residency Permit\">Residency Permit</MenuItem>\r\n                            <MenuItem value=\"Other\">Other</MenuItem>\r\n                        </Select>\r\n                    </FormControl>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 4}}>\r\n                    <TextField\r\n                        label=\"Numero\"\r\n                        variant=\"outlined\"\r\n                        name=\"document_number\"\r\n                        value={formData.document_number}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.document_number[0]}\r\n                        helperText={formErrors.document_number[1]}/>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 4}}>\r\n                    <LocalizationProvider dateAdapter={AdapterDayjs} adapterLocale='en-gb'>\r\n                        <DatePicker\r\n                            label=\"Data di Scadenza\"\r\n                            value={formData.document_expiration}\r\n                            onChange={(date) => handleDateChange('document_expiration', date)}\r\n                            slotProps={{textField: {variant: 'outlined'}}}/>\r\n                    </LocalizationProvider>\r\n                </Grid>\r\n            </Grid>\r\n\r\n            <Typography variant=\"h5\" align=\"center\" gutterBottom my={4}>Informazioni Studente</Typography>\r\n            <Grid container spacing={3}>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <TextField\r\n                        label={names.person_code}\r\n                        variant=\"outlined\"\r\n                        name=\"person_code\"\r\n                        type=\"number\"\r\n                        value={formData.person_code}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.person_code[0]}\r\n                        helperText={formErrors.person_code[1]}/>\r\n                </Grid>\r\n                <Grid size={{xs: 12, sm: 6}}>\r\n                    <TextField\r\n                        label={names.matricola_number}\r\n                        variant=\"outlined\"\r\n                        name=\"matricola_number\"\r\n                        type=\"number\"\r\n                        value={formData.matricola_number}\r\n                        onChange={handleChange}\r\n                        fullWidth\r\n                        required\r\n                        error={formErrors.matricola_number[0]}\r\n                        helperText={formErrors.matricola_number[1]}/>\r\n                </Grid>\r\n            </Grid>\r\n\r\n            <Grid container spacing={2} mt={3}>\r\n                <Grid size={{xs: 12}}>\r\n                    <FormControlLabel\r\n                        control={\r\n                            <Checkbox\r\n                                name=\"acceptStatute\"\r\n                                checked={checkboxes.acceptStatute}\r\n                                onChange={handleCheckboxChange}\r\n                                required\r\n                                sx={{\r\n                                    color: checkboxErrors.acceptStatute ? 'red' : undefined,\r\n                                    '&.Mui-checked': {color: checkboxErrors.acceptStatute ? 'red' : undefined}\r\n                                }}/>\r\n                        }\r\n                        label={\r\n                            <span>\r\n                                Dichiaro di aver letto e accettato lo{' '}\r\n                                <Link href={links.statute} target=\"_blank\" rel=\"noopener noreferrer\" underline=\"always\">\r\n                                    Statuto di ESN Politecnico Milano\r\n                                </Link>\r\n                            </span>\r\n                        }/>\r\n                </Grid>\r\n                <Grid size={{xs: 12}}>\r\n                    <FormControlLabel\r\n                        control={\r\n                            <Checkbox\r\n                                name=\"acceptPurposes\"\r\n                                checked={checkboxes.acceptPurposes}\r\n                                onChange={handleCheckboxChange}\r\n                                required\r\n                                sx={{\r\n                                    color: checkboxErrors.acceptPurposes ? 'red' : undefined,\r\n                                    '&.Mui-checked': {color: checkboxErrors.acceptPurposes ? 'red' : undefined}\r\n                                }}/>\r\n                        }\r\n                        label=\"Dichiaro di condividere pienamente gli scopi dell'Associazione (rif. Articolo 2 dello Statuto)\"\r\n                    />\r\n                </Grid>\r\n                <Grid size={{xs: 12}}>\r\n                    <FormControlLabel\r\n                        control={\r\n                            <Checkbox\r\n                                name=\"acceptRegulation\"\r\n                                checked={checkboxes.acceptRegulation}\r\n                                onChange={handleCheckboxChange}\r\n                                required\r\n                                sx={{\r\n                                    color: checkboxErrors.acceptRegulation ? 'red' : undefined,\r\n                                    '&.Mui-checked': {color: checkboxErrors.acceptRegulation ? 'red' : undefined}\r\n                                }}/>\r\n                        }\r\n                        label={\r\n                            <span>\r\n                                Dichiaro di accettare tutti i termini indicati nello{' '}\r\n                                <Link href={links.regulation} target=\"_blank\" rel=\"noopener noreferrer\" underline=\"always\">\r\n                                    Regolamento Interno\r\n                                </Link>\r\n                                {' '}e tutte le successive modifiche e integrazioni\r\n                            </span>\r\n                        }/>\r\n                </Grid>\r\n                <Grid size={{xs: 12}}>\r\n                    <FormControlLabel\r\n                        control={\r\n                            <Checkbox\r\n                                name=\"acceptPrivacy\"\r\n                                checked={checkboxes.acceptPrivacy}\r\n                                onChange={handleCheckboxChange}\r\n                                required\r\n                                sx={{\r\n                                    color: checkboxErrors.acceptPrivacy ? 'red' : undefined,\r\n                                    '&.Mui-checked': {color: checkboxErrors.acceptPrivacy ? 'red' : undefined}\r\n                                }}/>\r\n                        }\r\n                        label={\r\n                            <span>\r\n                                Dichiaro di aver letto l&apos;\r\n                                <Link href={links.privacy} target=\"_blank\" rel=\"noopener noreferrer\" underline=\"always\">\r\n                                    Informativa sulla Privacy\r\n                                </Link>\r\n                                {' '}e di acconsentire al trattamento dei miei dati personali secondo il Regolamento UE 2016/679 (GDPR) e di essere consapevole dei miei diritti garantiti dalla suddetta legge\r\n                            </span>\r\n                        }/>\r\n                </Grid>\r\n            </Grid>\r\n\r\n            <Button\r\n                type=\"submit\"\r\n                variant=\"contained\"\r\n                color=\"primary\"\r\n                fullWidth\r\n                sx={{mt: 4}}\r\n                startIcon={!isLoading && <LoginIcon/>}\r\n                disabled={isLoading}>\r\n                {isLoading ? <CircularProgress size={24} color=\"inherit\"/> : \"Conferma Dati\"}\r\n            </Button>\r\n        </Box>\r\n    );\r\n}","import {CircularProgress, Box} from '@mui/material';\r\n\r\nexport default function Loader({size = 40, fullScreen = false}) {\r\n    return (\r\n        <Box\r\n            sx={{\r\n                display: 'flex',\r\n                justifyContent: 'center',\r\n                alignItems: 'center',\r\n                height: fullScreen ? '100vh' : '100%',\r\n                width: '100%',\r\n                position: fullScreen ? 'fixed' : 'relative',\r\n                top: 0,\r\n                left: 0,\r\n                zIndex: fullScreen ? 1300 : 1,\r\n                backgroundColor: fullScreen ? 'rgba(255, 255, 255, 0.7)' : 'transparent'\r\n            }}>\r\n            <CircularProgress size={size}/>\r\n        </Box>\r\n    );\r\n}","import {useEffect, useState, useRef} from 'react';\r\nimport {Box, Grid, FormControl, InputLabel, Select, MenuItem, OutlinedInput, IconButton} from '@mui/material';\r\nimport {MaterialReactTable, useMaterialReactTable} from 'material-react-table';\r\nimport {fetchCustom} from '../../api/api';\r\nimport {MRT_Localization_IT} from \"material-react-table/locales/it\";\r\nimport Loader from \"../../Components/Loader\";\r\nimport ClearIcon from \"@mui/icons-material/Clear\";\r\nimport SearchIcon from \"@mui/icons-material/Search\";\r\nimport ManageAccountsIcon from '@mui/icons-material/ManageAccounts';\r\nimport {useNavigate} from 'react-router-dom';\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nconst ESNCARD_VALIDITY_OPTIONS = [\r\n    {value: 'valid', label: 'Valida'},\r\n    {value: 'expired', label: 'Scaduta'},\r\n    {value: 'absent', label: 'Assente'}\r\n];\r\n\r\nexport default function ProfilesList({apiEndpoint, columns, columnVisibility, profileType}) {\r\n    const [data, setData] = useState([]);\r\n    const [pagination, setPagination] = useState({pageIndex: 0, pageSize: 10});\r\n    const [rowCount, setRowCount] = useState(0);\r\n    const [groups, setGroups] = useState([]);\r\n    const [filters, setFilters] = useState({esncardValidity: [], group: []});\r\n    const [search, setSearch] = useState('');\r\n    const [appliedSearch, setAppliedSearch] = useState('');\r\n    const [internalLoading, setInternalLoading] = useState(true);\r\n    const searchInputRef = useRef(null);\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        // Only fetch data when appliedSearch changes (icon click), or filters/pagination change\r\n        setInternalLoading(true);\r\n        const fetchData = async () => {\r\n            try {\r\n                const params = new URLSearchParams();\r\n                params.append('page', pagination.pageIndex + 1);\r\n                params.append('page_size', pagination.pageSize);\r\n                if (appliedSearch) params.append('search', appliedSearch);\r\n                if (filters.esncardValidity.length)\r\n                    params.append('esncardValidity', filters.esncardValidity.join(','));\r\n                if (filters.group.length)\r\n                    params.append('group', filters.group.join(','));\r\n                const response = await fetchCustom('GET', `${apiEndpoint}?${params.toString()}`);\r\n                const json = await response.json();\r\n                setRowCount(json.count || 0);\r\n                setData(json.results);\r\n            } catch (error) {\r\n                Sentry.captureException(error);\r\n            } finally {\r\n                setInternalLoading(false);\r\n            }\r\n        };\r\n        fetchData().then();\r\n\r\n        if (profileType === 'ESNer') {\r\n            fetchCustom(\"GET\", \"/groups/\").then(response => {\r\n                if (response.ok) {\r\n                    response.json().then(json => setGroups(json));\r\n                }\r\n            });\r\n        }\r\n    }, [apiEndpoint, pagination.pageIndex, pagination.pageSize, profileType, filters, appliedSearch]);\r\n\r\n    const handleSearchApply = () => {\r\n        setAppliedSearch(search);\r\n        setPagination(prev => ({...prev, pageIndex: 0}));\r\n    };\r\n\r\n    const handleSearchClear = () => {\r\n        setSearch('');\r\n        setAppliedSearch('');\r\n        setPagination(prev => ({...prev, pageIndex: 0}));\r\n        if (searchInputRef.current) searchInputRef.current.focus();\r\n    };\r\n\r\n    const table = useMaterialReactTable({\r\n        columns,\r\n        data,\r\n        enableStickyHeader: true,\r\n        enableStickyFooter: true,\r\n        enableColumnFilters: false, // Disabled cause it only allows to search in the current page\r\n        enableColumnOrdering: true,\r\n        enableGrouping: true,\r\n        enableColumnPinning: true,\r\n        enableFacetedValues: true,\r\n        enableRowActions: true,\r\n        enableRowSelection: false,\r\n        enableRowPinning: false,\r\n        enableExpandAll: false,\r\n        initialState: {\r\n            showColumnFilters: false,\r\n            showGlobalFilter: true,\r\n            columnPinning: {\r\n                left: ['mrt-row-expand', 'mrt-row-select'],\r\n                right: ['mrt-row-actions'],\r\n            },\r\n            columnVisibility\r\n        },\r\n        paginationDisplayMode: 'pages',\r\n        positionToolbarAlertBanner: 'bottom',\r\n        enableGlobalFilter: false,\r\n        muiPaginationProps: {\r\n            color: 'secondary',\r\n            rowsPerPageOptions: [10, 20, 50],\r\n            shape: 'rounded',\r\n            variant: 'outlined',\r\n        },\r\n        manualPagination: true,\r\n        rowCount,\r\n        onPaginationChange: setPagination,\r\n        state: {pagination},\r\n        localization: MRT_Localization_IT,\r\n        muiTableBodyRowProps: () => ({}), // No row click navigation\r\n        renderRowActions: ({row}) => (\r\n            <IconButton\r\n                aria-label=\"Modifica profilo\"\r\n                onClick={e => {\r\n                    e.stopPropagation();\r\n                    navigate(`/profile/${row.original.id.toString()}`);\r\n                }}>\r\n                <ManageAccountsIcon/>\r\n            </IconButton>\r\n        ),\r\n    });\r\n\r\n    const handleFilterChange = (e) => {\r\n        const {name, value} = e.target;\r\n        setFilters(prev => ({\r\n            ...prev,\r\n            [name]: typeof value === 'string' ? value.split(',') : value\r\n        }));\r\n    };\r\n\r\n    return (\r\n        <Box sx={{mx: '5%'}}>\r\n            <Grid container spacing={2} sx={{mb: 2, mt: 2}} alignItems=\"center\" justifyContent=\"flex-end\">\r\n                <Grid size={{xs: 12, sm: 2}}>\r\n                    <FormControl fullWidth>\r\n                        <InputLabel id=\"esncard-validity-label\">Validità ESNcard</InputLabel>\r\n                        <Select\r\n                            labelId=\"esncard-validity-label\"\r\n                            name=\"esncardValidity\"\r\n                            variant=\"outlined\"\r\n                            multiple\r\n                            value={filters.esncardValidity}\r\n                            onChange={handleFilterChange}\r\n                            input={<OutlinedInput label=\"Validità ESNcard\"/>}\r\n                            renderValue={(selected) =>\r\n                                ESNCARD_VALIDITY_OPTIONS.filter(opt => selected.includes(opt.value)).map(opt => opt.label).join(', ')\r\n                            }>\r\n                            {ESNCARD_VALIDITY_OPTIONS.map(opt => (\r\n                                <MenuItem key={opt.value} value={opt.value}>{opt.label}</MenuItem>\r\n                            ))}\r\n                        </Select>\r\n                    </FormControl>\r\n                </Grid>\r\n                {profileType === 'ESNer' && groups.length > 0 && (\r\n                    <Grid size={{xs: 12, sm: 2}}>\r\n                        <FormControl fullWidth>\r\n                            <InputLabel id=\"group-label\">Gruppo</InputLabel>\r\n                            <Select\r\n                                labelId=\"group-label\"\r\n                                name=\"group\"\r\n                                variant=\"outlined\"\r\n                                multiple\r\n                                value={filters.group}\r\n                                onChange={handleFilterChange}\r\n                                input={<OutlinedInput label=\"Gruppo\"/>}\r\n                                renderValue={(selected) =>\r\n                                    groups.filter(opt => selected.includes(opt.name)).map(opt => opt.name).join(', ')\r\n                                }>\r\n                                {groups.map(opt => (\r\n                                    <MenuItem key={opt.name} value={opt.name}>{opt.name}</MenuItem>\r\n                                ))}\r\n                            </Select>\r\n                        </FormControl>\r\n                    </Grid>\r\n                )}\r\n                <Grid size={{xs: 12, sm: \"auto\"}}>\r\n                    <OutlinedInput\r\n                        inputRef={searchInputRef}\r\n                        size=\"small\"\r\n                        placeholder=\"Cerca\"\r\n                        value={search}\r\n                        onChange={e => setSearch(e.target.value)}\r\n                        onKeyDown={e => {\r\n                            if (e.key === 'Enter') handleSearchApply();\r\n                        }}\r\n                        endAdornment={\r\n                            search && appliedSearch === search ? (\r\n                                <IconButton\r\n                                    aria-label=\"clear\"\r\n                                    onClick={handleSearchClear}\r\n                                    edge=\"end\">\r\n                                    <ClearIcon/>\r\n                                </IconButton>\r\n                            ) : (\r\n                                <IconButton\r\n                                    aria-label=\"search\"\r\n                                    onClick={handleSearchApply}\r\n                                    edge=\"end\">\r\n                                    <SearchIcon/>\r\n                                </IconButton>\r\n                            )\r\n                        }\r\n                    />\r\n                </Grid>\r\n            </Grid>\r\n            {internalLoading ? <Loader/> :\r\n                <MaterialReactTable table={table}/>\r\n            }\r\n        </Box>\r\n    );\r\n}","import {IconButton} from \"@mui/material\";\r\nimport {useAuth} from \"../Context/AuthContext\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport LogoutIcon from '@mui/icons-material/Logout';\r\n\r\nconst LogoutButton = () => {\r\n    const {logout} = useAuth();\r\n    const navigate = useNavigate();\r\n\r\n    const handleLogout = () => {\r\n        logout();\r\n        navigate(\"/login\");\r\n    };\r\n\r\n    return (\r\n        <IconButton\r\n            variant=\"contained\"\r\n            sx={{backgroundColor: \"black\", color: \"white\"}}\r\n            onClick={handleLogout}>\r\n            <LogoutIcon/>\r\n        </IconButton>\r\n    );\r\n};\r\n\r\nexport default LogoutButton;\r\n","import React, {useCallback} from 'react';\r\nimport {Link, useNavigate} from 'react-router-dom';\r\nimport {Box, Drawer, List, ListItem, ListItemIcon, ListItemText, ListItemButton, IconButton, Collapse, Typography} from '@mui/material';\r\nimport {\r\n    Menu as MenuIcon,\r\n    Home as HomeIcon,\r\n    AccountBalance as AccountBalanceIcon,\r\n    Event as EventIcon,\r\n    Person as PersonIcon,\r\n    Snowboarding as SnowboardingIcon,\r\n    BabyChangingStation as BabyChangingStationIcon,\r\n    ExpandLess,\r\n    ExpandMore,\r\n} from \"@mui/icons-material\";\r\nimport LogoutButton from './LogoutButton';\r\nimport {useAuth} from \"../Context/AuthContext\";\r\nimport {useSidebar} from \"../Context/SidebarContext\";\r\n\r\n\r\nexport default function Sidebar() {\r\n    const {isDrawerOpen, toggleDrawer, closeDrawer, expandedSection, handleExpand} = useSidebar();\r\n    const {user} = useAuth();\r\n    const navigate = useNavigate();\r\n\r\n    const hasPermission = (permission) => {\r\n        return user?.permissions?.includes(permission) || false;\r\n    };\r\n\r\n    const menuItems = [\r\n        {text: \"Home\", icon: <HomeIcon/>, path: \"/\"},\r\n        {text: \"Tesoreria\", icon: <AccountBalanceIcon/>, path: \"/treasury\", requiredPermission: \"change_account\"},\r\n        {text: \"Eventi\", icon: <EventIcon/>, path: \"/events\"},\r\n        {\r\n            text: \"Profili\",\r\n            icon: <PersonIcon/>,\r\n            children: [\r\n                {text: 'Erasmus', icon: <SnowboardingIcon/>, path: '/profiles/erasmus'},\r\n                {text: 'ESNers', icon: <BabyChangingStationIcon/>, path: '/profiles/esners'},\r\n            ],\r\n        },\r\n    ].filter(item => !item.requiredPermission || hasPermission(item.requiredPermission));\r\n\r\n    // Inline ProfileSidebarBox logic here\r\n    const handleProfileOpen = useCallback(() => {\r\n        navigate(`/profile/${user.profile.id.toString()}`);\r\n    }, [navigate, user?.profile?.id]);\r\n\r\n    const handleNavClick = (e) => {\r\n        if (e.button === 0 || e.button === 1) closeDrawer();\r\n    };\r\n\r\n    const drawer = (\r\n        <Box sx={{\r\n            width: 250,\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            height: '100%'\r\n        }}\r\n             role=\"presentation\"\r\n             onClick={toggleDrawer(false)}\r\n             onKeyDown={toggleDrawer(false)}>\r\n            <Box sx={{flexGrow: 1}}>\r\n                {menuItems.map((item) => (\r\n                    <React.Fragment key={item.text}>\r\n                        {!item.children ? (\r\n                            <ListItem component={Link}\r\n                                      to={item.path}\r\n                                      key={item.text}\r\n                                      onClick={handleNavClick}\r\n                                      onAuxClick={handleNavClick}>\r\n                                <ListItemIcon>{item.icon}</ListItemIcon>\r\n                                <ListItemText primary={item.text} slotProps={{primary: {style: {color: \"black\"},}}}/>\r\n                            </ListItem>\r\n                        ) : (\r\n                            <React.Fragment key={item.text}>\r\n                                <ListItemButton onClick={(e) => {\r\n                                    e.stopPropagation(); // Prevent drawer from closing\r\n                                    handleExpand(item.text);\r\n                                }}>\r\n                                    <ListItemIcon>{item.icon}</ListItemIcon>\r\n                                    <ListItemText primary={item.text} slotProps={{primary: {style: {color: \"black\"},}}}/>\r\n                                    {expandedSection === item.text ? <ExpandLess/> : <ExpandMore/>}\r\n                                </ListItemButton>\r\n                                <Collapse in={expandedSection === item.text} timeout=\"auto\" unmountOnExit>\r\n                                    <List component=\"div\" disablePadding>\r\n                                        {item.children?.map((child) => (\r\n                                            <ListItem component={Link}\r\n                                                      to={child.path}\r\n                                                      key={child.text}\r\n                                                      onClick={handleNavClick}\r\n                                                      onAuxClick={handleNavClick}\r\n                                                      sx={{pl: 4}}>\r\n                                                <ListItemIcon>{child.icon}</ListItemIcon>\r\n                                                <ListItemText primary={child.text} slotProps={{primary: {style: {color: \"black\"}}}}/>\r\n                                            </ListItem>\r\n                                        )) || []}\r\n                                    </List>\r\n                                </Collapse>\r\n                            </React.Fragment>\r\n                        )}\r\n                    </React.Fragment>\r\n                ))}\r\n            </Box>\r\n            {user && (\r\n                <Box\r\n                    sx={{\r\n                        mt: 'auto',\r\n                        mb: 2,\r\n                        ml: 0.5,\r\n                        mr: 0.5,\r\n                        px: 2,\r\n                        py: 1.5,\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        borderRadius: 2,\r\n                        background: '#f5f5f5',\r\n                        boxShadow: 1,\r\n                        gap: 1,\r\n                    }}>\r\n                    <IconButton\r\n                        onClick={handleProfileOpen}\r\n                        aria-label=\"Profile\"\r\n                        sx={{\r\n                            background: '#e0e0e0',\r\n                            mr: 0.5,\r\n                            width: 44,\r\n                            height: 44,\r\n                            '&:hover': {background: '#d1c4e9'},\r\n                        }}>\r\n                        <PersonIcon sx={{fontSize: 28}}/>\r\n                    </IconButton>\r\n                    <Box sx={{flexGrow: 1, minWidth: 0}}>\r\n                        <Typography\r\n                            variant=\"title\"\r\n                            sx={{\r\n                                fontWeight: 600,\r\n                                whiteSpace: 'nowrap',\r\n                                overflow: 'hidden',\r\n                                textOverflow: 'ellipsis'\r\n                            }}>\r\n                            {\r\n                                user.profile.name.length > 10\r\n                                    ? user.profile.name.slice(0, 10) + '...'\r\n                                    : user.profile.name\r\n                            }\r\n                        </Typography>\r\n                    </Box>\r\n                    <LogoutButton/>\r\n                </Box>\r\n            )}\r\n        </Box>\r\n    );\r\n\r\n    return (\r\n        <Box sx={{display: \"flex\"}}>\r\n            <IconButton\r\n                edge=\"start\"\r\n                color=\"inherit\"\r\n                aria-label=\"menu\"\r\n                onClick={toggleDrawer(true)}\r\n                sx={{margin: \"10px\"}}>\r\n                <MenuIcon/>\r\n            </IconButton>\r\n            <Drawer anchor=\"left\" open={isDrawerOpen} onClose={toggleDrawer(false)}>\r\n                {drawer}\r\n            </Drawer>\r\n        </Box>\r\n    );\r\n}\r\n","import {useMemo} from 'react';\r\nimport ProfilesList from './ProfilesList.jsx';\r\nimport {Box, Chip, Typography} from \"@mui/material\";\r\nimport SnowboardingIcon from '@mui/icons-material/Snowboarding';\r\nimport Sidebar from \"../../Components/Sidebar\";\r\nimport {profileDisplayNames as names} from \"../../utils/displayAttributes\";\r\nimport countryCodes from \"../../data/countryCodes.json\";\r\n\r\nexport default function ErasmusProfiles() {\r\n\r\n    const columns = useMemo(() => [\r\n        {\r\n            accessorKey: 'id',\r\n            header: names.id,\r\n            size: 50,\r\n        },\r\n        {\r\n            accessorKey: 'name',\r\n            header: names.name,\r\n            size: 150,\r\n        },\r\n        {\r\n            accessorKey: 'surname',\r\n            header: names.surname,\r\n            size: 150,\r\n        },\r\n        {\r\n            accessorKey: 'email',\r\n            header: names.email,\r\n            size: 150,\r\n        },\r\n        {\r\n            accessorKey: 'latest_esncard',\r\n            header: names.latest_esncard,\r\n            size: 50,\r\n            Cell: ({cell}) => (\r\n                <Box sx={{}}>\r\n                    {cell.getValue() !== null ? (\r\n                        <Chip label={cell.getValue().number} color={cell.getValue().is_valid ? \"success\" : \"warning\"}/>\r\n                    ) : (\r\n                        <Chip label=\"Nessuna ESNcard\" color=\"error\"/>\r\n                    )}\r\n                </Box>\r\n            ),\r\n        },\r\n        {\r\n            accessorKey: 'country',\r\n            header: names.country,\r\n            size: 150,\r\n            Cell: ({row}) => {\r\n                const countryCode = row.original.country;\r\n                const country = countryCodes.find(c => c.code === countryCode);\r\n                return country ? country.name : countryCode || '(vuoto)';\r\n            },\r\n        },\r\n        {\r\n            accessorKey: 'birthdate',\r\n            header: names.birthdate,\r\n            size: 100,\r\n        },\r\n        {\r\n            accessorKey: 'course',\r\n            header: names.course,\r\n            size: 100,\r\n        },\r\n        {\r\n            accessorKey: 'phone_prefix',\r\n            header: 'Prefisso Telefono',\r\n            size: 60,\r\n        },\r\n        {\r\n            accessorKey: 'phone_number',\r\n            header: 'Numero Telefono (no prefisso)',\r\n            size: 120,\r\n        },\r\n        {\r\n            id: 'fullPhoneNumber',\r\n            header: names.phone_number,\r\n            size: 150,\r\n            accessorFn: row => `(${row.phone_prefix || 'vuoto'}) ${row.phone_number || '(vuoto)'}`,\r\n            Cell: ({row}) => (\r\n                <span>({row.original.phone_prefix || 'vuoto'}) {row.original.phone_number || '(vuoto)'}</span>\r\n            ),\r\n        },\r\n        {\r\n            accessorKey: 'whatsapp_prefix',\r\n            header: 'Prefisso WhatsApp',\r\n            size: 60,\r\n        },\r\n        {\r\n            accessorKey: 'whatsapp_number',\r\n            header: 'Numero WhatsApp (no prefisso)',\r\n            size: 120,\r\n        },\r\n        {\r\n            id: 'fullWANumber',\r\n            header: names.whatsapp_number,\r\n            size: 150,\r\n            accessorFn: row => `(${row.whatsapp_prefix || 'vuoto'}) ${row.whatsapp_number || '(vuoto)'}`,\r\n            Cell: ({row}) => (\r\n                <span>({row.original.whatsapp_prefix || 'vuoto'}) {row.original.whatsapp_number || '(vuoto)'}</span>\r\n            ),\r\n        },\r\n        {\r\n            accessorKey: 'domicile',\r\n            header: names.domicile,\r\n            size: 200,\r\n        },\r\n        {\r\n            accessorKey: 'matricola_number',\r\n            header: names.matricola_number,\r\n            size: 50,\r\n        },\r\n        {\r\n            accessorKey: 'matricola_expiration',\r\n            header: names.matricola_expiration,\r\n            size: 50,\r\n        },\r\n        {\r\n            accessorKey: 'latest_document.number',\r\n            header: names.latest_document,\r\n            size: 50,\r\n        },\r\n\r\n    ], []);\r\n\r\n    const columnVisibility = {\r\n        id: true,\r\n        name: true,\r\n        surname: true,\r\n        email: true,\r\n        country: false,\r\n        birthdate: false,\r\n        course: false,\r\n        fullPhoneNumber: true,\r\n        fullWANumber: true,\r\n        person_code: false,\r\n        domicile: false,\r\n        matricola_number: false,\r\n        matricola_expiration: false,\r\n        'latest_document.number': false,\r\n        phone_prefix: false,\r\n        phone_number: false,\r\n        whatsapp_prefix: false,\r\n        whatsapp_number: false\r\n    }\r\n\r\n    return (\r\n        <Box>\r\n            <Sidebar/>\r\n            <Box sx={{mx: '5%'}}>\r\n                <Box sx={{display: 'flex', alignItems: 'center', marginBottom: '20px'}}>\r\n                    <SnowboardingIcon sx={{marginRight: '10px'}}/>\r\n                    <Typography variant=\"h4\">Profili Erasmus</Typography>\r\n                </Box>\r\n            </Box>\r\n            <ProfilesList\r\n                apiEndpoint=\"/erasmus_profiles/\"\r\n                columns={columns}\r\n                columnVisibility={columnVisibility}\r\n                profileType=\"Erasmus\"\r\n            />\r\n        </Box>\r\n    );\r\n}","import {useMemo} from 'react';\r\nimport ProfilesList from './ProfilesList.jsx';\r\nimport {Box, Chip, Typography} from \"@mui/material\";\r\nimport BabyChangingStationIcon from '@mui/icons-material/BabyChangingStation';\r\nimport Sidebar from \"../../Components/Sidebar\";\r\nimport {profileDisplayNames as names} from '../../utils/displayAttributes';\r\nimport countryCodes from \"../../data/countryCodes.json\";\r\n\r\nexport default function ESNersProfiles() {\r\n\r\n    const columns = useMemo(() => [\r\n        {\r\n            accessorKey: 'id',\r\n            header: names.id,\r\n            size: 50,\r\n        },\r\n        {\r\n            accessorKey: 'name',\r\n            header: names.name,\r\n            size: 150,\r\n        },\r\n        {\r\n            accessorKey: 'surname',\r\n            header: names.surname,\r\n            size: 150,\r\n        },\r\n        {\r\n            accessorKey: 'group',\r\n            header: names.group,\r\n            size: 150,\r\n            Cell: ({cell}) => {\r\n                const value = cell.getValue();\r\n                let chipColor = \"default\";\r\n                if(value === \"Aspiranti\") chipColor = \"info\";\r\n                else if(value === \"Attivi\") chipColor = \"success\";\r\n                else if(value === \"Board\") chipColor = \"warning\";\r\n                return <Chip label={value} color={chipColor} />;\r\n            },\r\n        },\r\n        {\r\n            accessorKey: 'email',\r\n            header: names.email,\r\n            size: 150,\r\n        },\r\n        {\r\n            accessorKey: 'latest_esncard',\r\n            header: names.latest_esncard,\r\n            size: 50,\r\n            Cell: ({cell}) => (\r\n                <Box sx={{}}>\r\n                    {cell.getValue() !== null ? (\r\n                        <Chip label={cell.getValue().number} color={cell.getValue().is_valid ? \"success\" : \"warning\"}/>\r\n                    ) : (\r\n                        <Chip label=\"Nessuna ESNcard\" color=\"error\"/>\r\n                    )}\r\n                </Box>\r\n            ),\r\n        },\r\n        {\r\n            accessorKey: 'country',\r\n            header: names.country,\r\n            size: 150,\r\n            Cell: ({row}) => {\r\n                const countryCode = row.original.country;\r\n                const country = countryCodes.find(c => c.code === countryCode);\r\n                return country ? country.name : countryCode || '(vuoto)';\r\n            },\r\n        },\r\n        {\r\n            accessorKey: 'birthdate',\r\n            header: names.birthdate,\r\n            size: 100,\r\n        },\r\n        {\r\n            accessorKey: 'phone_prefix',\r\n            header: 'Prefisso Telefono',\r\n            size: 60,\r\n        },\r\n        {\r\n            accessorKey: 'phone_number',\r\n            header: 'Numero Telefono (no prefisso)',\r\n            size: 120,\r\n        },\r\n        {\r\n            id: 'fullPhoneNumber',\r\n            header: names.phone_number,\r\n            size: 150,\r\n            accessorFn: row => `(${row.phone_prefix || 'vuoto'}) ${row.phone_number || '(vuoto)'}`,\r\n            Cell: ({row}) => (\r\n                <span>({row.original.phone_prefix || 'vuoto'}) {row.original.phone_number || '(vuoto)'}</span>\r\n            ),\r\n        },\r\n        {\r\n            accessorKey: 'person_code',\r\n            header: names.person_code,\r\n            size: 150,\r\n        },\r\n        {\r\n            accessorKey: 'domicile',\r\n            header: names.domicile,\r\n            size: 200,\r\n        },\r\n        {\r\n            accessorKey: 'matricola_number',\r\n            header: names.matricola_number,\r\n            size: 50,\r\n        },\r\n        {\r\n            accessorKey: 'latest_document.number',\r\n            header: names.latest_document,\r\n            size: 50,\r\n        },\r\n    ], []);\r\n\r\n    const columnVisibility = {\r\n        id: true,\r\n        name: true,\r\n        surname: true,\r\n        groups: true,\r\n        email: true,\r\n        country: true,\r\n        birthdate: false,\r\n        fullPhoneNumber: true,\r\n        person_code: false,\r\n        domicile: false,\r\n        matricola_number: false,\r\n        'latest_document.number': false,\r\n        phone_prefix: false,\r\n        phone_number: false\r\n    };\r\n\r\n    return (\r\n        <Box>\r\n            <Sidebar/>\r\n            <Box sx={{mx: '5%'}}>\r\n                <Box sx={{display: 'flex', alignItems: 'center', marginBottom: '20px'}}>\r\n                    <BabyChangingStationIcon sx={{marginRight: '10px'}}/>\r\n                    <Typography variant=\"h4\">Profili ESNers</Typography>\r\n                </Box>\r\n            </Box>\r\n            <ProfilesList\r\n                apiEndpoint=\"/esner_profiles/\"\r\n                columns={columns}\r\n                columnVisibility={columnVisibility}\r\n                profileType=\"ESNer\"\r\n            />\r\n        </Box>\r\n    );\r\n}\r\n","import Dialog from '@mui/material/Dialog';\r\nimport DialogTitle from '@mui/material/DialogTitle';\r\nimport DialogContent from '@mui/material/DialogContent';\r\nimport DialogActions from '@mui/material/DialogActions';\r\nimport Button from '@mui/material/Button';\r\nimport Typography from '@mui/material/Typography';\r\n\r\nexport default function ConfirmDialog({open, message, onConfirm, onClose}) {\r\n    return (\r\n        <Dialog open={open} onClose={onClose}>\r\n            <DialogTitle>Conferma Azione</DialogTitle>\r\n            <DialogContent>\r\n                <Typography>{message}</Typography>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={onClose} color=\"secondary\">Annulla</Button>\r\n                <Button onClick={onConfirm} color=\"primary\" autoFocus>Conferma</Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n}","import {useEffect} from 'react';\r\nimport ReactDOM from 'react-dom/client';\r\nimport ContentCopyIcon from '@mui/icons-material/ContentCopy';\r\n\r\nconst Popup = ({message, state, duration = 2000}) => {\r\n\r\n    useEffect(() => {\r\n        const popup = document.createElement('div');\r\n        const copyButton = document.createElement('button');\r\n\r\n        // Render the icon inside the button if we're in \"error\" state\r\n        if (state === 'error') {\r\n            copyButton.style.marginRight = '10px';\r\n            copyButton.style.cursor = 'pointer';\r\n            copyButton.style.border = 'none';\r\n            copyButton.style.color = 'white';\r\n            copyButton.style.backgroundColor = 'transparent';\r\n            const root = ReactDOM.createRoot(copyButton);\r\n            root.render(<ContentCopyIcon/>);\r\n            const textSpan = document.createElement('span');\r\n            textSpan.innerText = message;\r\n            popup.appendChild(copyButton);\r\n            popup.appendChild(textSpan);\r\n        }\r\n        else popup.innerText = message;\r\n\r\n\r\n        popup.style.display = 'flex';\r\n        popup.style.alignItems = 'center';\r\n        popup.style.position = 'fixed';\r\n        popup.style.top = '-100px'; // Start off-screen\r\n        popup.style.left = '50%';\r\n        popup.style.transform = 'translateX(-50%)';\r\n        popup.style.backgroundColor = state === 'success' ? 'green' : 'red';\r\n        popup.style.color = 'white';\r\n        popup.style.padding = '10px';\r\n        popup.style.borderRadius = '5px';\r\n        popup.style.cursor = 'pointer';\r\n        popup.style.zIndex = '9999'; // Ensure the popup is in front of any layer/modal\r\n        popup.style.transition = 'opacity 0.5s ease-in-out, top 0.5s ease-in-out';\r\n        document.body.appendChild(popup);\r\n\r\n        const copyToClipboard = () => {\r\n            navigator.clipboard.writeText(message).then();\r\n        };\r\n\r\n        if (state === 'error') {\r\n            copyButton.addEventListener('click', copyToClipboard);\r\n        }\r\n\r\n        let timer;\r\n        requestAnimationFrame(() => {\r\n            popup.style.top = '20px';\r\n        });\r\n\r\n        const animateOut = () => {\r\n            popup.style.top = '-100px';\r\n            setTimeout(() => {\r\n                popup.removeEventListener('mouseenter', handleMouseEnter);\r\n                popup.removeEventListener('mouseleave', handleMouseLeave);\r\n                copyButton.removeEventListener('click', copyToClipboard);\r\n                if (document.body.contains(popup)) document.body.removeChild(popup);\r\n            }, duration / 4);\r\n        };\r\n\r\n        const handleMouseEnter = () => {\r\n            clearTimeout(timer);\r\n        };\r\n\r\n        const handleMouseLeave = () => {\r\n            timer = setTimeout(animateOut, duration);\r\n        };\r\n\r\n        popup.addEventListener('mouseenter', handleMouseEnter);\r\n        popup.addEventListener('mouseleave', handleMouseLeave);\r\n\r\n        handleMouseLeave();\r\n    }, [message, state, duration]);\r\n    return null;\r\n};\r\n\r\nexport default Popup;","// Shared styles\r\nexport const style = {\r\n    position: 'absolute',\r\n    top: '50%',\r\n    left: '50%',\r\n    transform: 'translate(-50%, -50%)',\r\n    width: '80%',\r\n    maxWidth: 1200,\r\n    maxHeight: '90vh',\r\n    bgcolor: 'background.paper',\r\n    border: '2px solid #000',\r\n    boxShadow: 24,\r\n    p: 4,\r\n    overflow: 'auto',\r\n};\r\n\r\nexport const styleESNcardModal = {\r\n    position: 'absolute',\r\n    top: '50%',\r\n    left: '50%',\r\n    transform: 'translate(-50%, -50%)',\r\n    width: 400,\r\n    bgcolor: 'background.paper',\r\n    boxShadow: 24,\r\n    p: 4,\r\n    outline: 'none',\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n};\r\n\r\n// Shared color options\r\nexport const colorOptions = [\r\n    {label: 'Rosso', value: '#FF0000'},\r\n    {label: 'Verde', value: '#00FF00'},\r\n    {label: 'Blu', value: '#0000FF'},\r\n    {label: 'Giallo', value: '#FFFF00'},\r\n    {label: 'Ciano', value: '#00FFFF'},\r\n    {label: 'Magenta', value: '#FF00FF'},\r\n    {label: 'Nero', value: '#000000'},\r\n    {label: 'Bianco', value: '#FFFFFF'},\r\n    {label: 'Arancione', value: '#FFA500'},\r\n    {label: 'Viola', value: '#800080'},\r\n    {label: 'Rosa', value: '#FFC0CB'},\r\n    {label: 'Marrone', value: '#A52A2A'},\r\n    {label: 'Grigio', value: '#808080'},\r\n    {label: 'Lime', value: '#00FF00'},\r\n    {label: 'Marrone Scuro', value: '#800000'},\r\n    {label: 'Blu Marino', value: '#000080'}\r\n];","import {useState} from 'react';\r\nimport {Button, TextField, FormControl, InputLabel, Select, MenuItem, Typography, IconButton, Box, Modal, Grid} from '@mui/material';\r\nimport {fetchCustom} from '../../api/api';\r\nimport CloseIcon from \"@mui/icons-material/Close\";\r\nimport {styleESNcardModal as style} from \"../../utils/sharedStyles\";\r\nimport {useAuth} from \"../../Context/AuthContext\";\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nexport default function TransactionAdd({open, onClose, account, onSuccess}) {\r\n    const {user} = useAuth();\r\n    const [formData, setFormData] = useState({\r\n        amount: '',\r\n        type: 'deposit',\r\n        description: ''\r\n    });\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        try {\r\n            const response = await fetchCustom('POST', '/transaction/', {\r\n                account: account.id,\r\n                amount: formData.type === 'deposit' ? Math.abs(formData.amount) : -Math.abs(formData.amount),\r\n                description: formData.description,\r\n                type: formData.type,\r\n                executor: user.profile.email\r\n            });\r\n            if (response.ok) {\r\n                onSuccess('Transazione registrata con successo');\r\n                onClose();\r\n            } else {\r\n                const error = await response.json();\r\n                onSuccess('Errore durante la registrazione: ' + JSON.stringify(error), 'error');\r\n            }\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            onSuccess('Errore durante la registrazione: ' + error.message, 'error');\r\n        }\r\n    };\r\n\r\n    const handleClose = () => onClose(false);\r\n\r\n    return (\r\n        <Modal open={open} onClose={handleClose}>\r\n            <Box sx={style} component=\"form\" onSubmit={handleSubmit} noValidate>\r\n                <Box sx={{display: 'flex', justifyContent: 'flex-end', mb: -2}}>\r\n                    <IconButton onClick={handleClose} sx={{minWidth: 0}}> <CloseIcon/> </IconButton>\r\n                </Box>\r\n                <Typography variant=\"h5\" gutterBottom align=\"center\" sx={{mt: 2}}>\r\n                    Transazione Manuale - Cassa {account?.name}\r\n                </Typography>\r\n                <Grid container spacing={2} sx={{mt: 2}}>\r\n                    <FormControl fullWidth>\r\n                        <InputLabel>Tipo</InputLabel>\r\n                        <Select\r\n                            variant=\"outlined\"\r\n                            value={formData.type}\r\n                            label=\"Tipo\"\r\n                            onChange={(e) => setFormData({...formData, type: e.target.value})}>\r\n                            <MenuItem value=\"deposit\">Deposito</MenuItem>\r\n                            <MenuItem value=\"withdrawal\">Prelievo</MenuItem>\r\n                        </Select>\r\n                    </FormControl>\r\n                    <TextField\r\n                        margin=\"dense\"\r\n                        label=\"Importo\"\r\n                        type=\"number\"\r\n                        fullWidth\r\n                        value={formData.amount}\r\n                        slotProps={{htmlInput: {min: \"0.01\", step: \"0.01\"}}}\r\n                        onChange={(e) => setFormData({...formData, amount: e.target.value})}/>\r\n                    <TextField\r\n                        margin=\"dense\"\r\n                        label=\"Descrizione\"\r\n                        type=\"text\"\r\n                        fullWidth\r\n                        multiline\r\n                        rows={2}\r\n                        value={formData.description}\r\n                        onChange={(e) => setFormData({...formData, description: e.target.value})}/>\r\n                </Grid>\r\n                <Box mt={2}>\r\n                    <Button fullWidth onClick={onClose}>Annulla</Button>\r\n                    <Button\r\n                        fullWidth\r\n                        variant=\"contained\"\r\n                        color=\"primary\"\r\n                        type=\"submit\"\r\n                        disabled={!formData.amount || formData.amount <= 0}>\r\n                        Conferma\r\n                    </Button>\r\n                </Box>\r\n            </Box>\r\n        </Modal>\r\n    );\r\n}\r\n","import {useEffect, useState} from \"react\";\r\nimport Sidebar from \"../Components/Sidebar\";\r\nimport {Box, Typography, Card, CardContent, CardActions, Button, Collapse, IconButton, Paper} from \"@mui/material\";\r\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\r\nimport ExpandLessIcon from '@mui/icons-material/ExpandLess';\r\nimport ConfirmDialog from \"../Components/ConfirmDialog\";\r\nimport {fetchCustom} from \"../api/api\";\r\nimport {useAuth} from \"../Context/AuthContext\";\r\nimport logo from '../assets/esnpolimi-logo.png';\r\nimport Popup from \"../Components/Popup\";\r\nimport {accountDisplayNames as names} from \"../utils/displayAttributes\";\r\nimport {extractErrorMessage} from \"../utils/errorHandling\";\r\nimport TransactionAdd from \"../Components/treasury/TransactionAdd\";\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nconst style = {\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"top\",\r\n    mt: 4,\r\n    minHeight: \"100vh\",\r\n};\r\n\r\nexport default function Home() {\r\n    const {user} = useAuth(); // Access logged-in user info\r\n    const [accounts, setAccounts] = useState([]);\r\n    const [selectedAccount, setSelectedAccount] = useState(null);\r\n    const [confirmDialogOpen, setConfirmDialogOpen] = useState(false);\r\n    const [actionType, setActionType] = useState(\"\"); // \"open\" or \"close\"\r\n    const [casseOpen, setCasseOpen] = useState(false);\r\n    const [showSuccessPopup, setShowSuccessPopup] = useState(null);\r\n    const [transactionModalOpen, setTransactionModalOpen] = useState(false);\r\n    const accountsDetails = user?.permissions.includes(\"change_account\");\r\n\r\n    useEffect(() => {\r\n        fetchAccounts().then();\r\n    }, [user]);\r\n\r\n    const fetchAccounts = async () => {\r\n        try {\r\n            const response = await fetchCustom(\"GET\", \"/accounts/\");\r\n            const json = await response.json();\r\n            if (response.ok) setAccounts(json.results);\r\n            else {\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setShowSuccessPopup({message: `Errore durante il recupero delle casse: ${errorMessage}`, state: \"error\"});\r\n            }\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setShowSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n        }\r\n    };\r\n\r\n    const handleAction = (account, type) => {\r\n        setSelectedAccount(account);\r\n        setActionType(type);\r\n        setConfirmDialogOpen(true);\r\n    };\r\n\r\n    const confirmAction = async () => {\r\n        try {\r\n            const response = await fetchCustom(\"PATCH\", `/account/${selectedAccount.id}/`, {\r\n                status: actionType === \"open\" ? \"open\" : \"closed\",\r\n            });\r\n            if (response.ok) {\r\n                console.log(`Account ${actionType}ed successfully.`);\r\n                fetchAccounts().then();\r\n                setShowSuccessPopup({message: `Cassa ${actionType === \"open\" ? \"aperta\" : \"chiusa\"} con successo!`, state: \"success\"});\r\n            } else {\r\n                console.error(`Failed to ${actionType} account.`);\r\n                setShowSuccessPopup({message: `Errore account: ${response.statusText}`, state: \"error\"});\r\n            }\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setShowSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n        } finally {\r\n            setConfirmDialogOpen(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Box>\r\n            <Sidebar/>\r\n            <Box sx={{width: \"100%\", maxWidth: \"90%\", mx: \"auto\", mt: 0}}>\r\n                <Paper elevation={3} sx={{p: 2, mb: 0, borderRadius: 5}}>\r\n                    <Box sx={{display: \"flex\", alignItems: \"center\", cursor: \"pointer\"}} onClick={() => setCasseOpen(o => !o)}>\r\n                        <Typography variant=\"h5\" sx={{flexGrow: 1, fontWeight: 600}}>Casse</Typography>\r\n                        <IconButton>\r\n                            {casseOpen ? <ExpandLessIcon/> : <ExpandMoreIcon/>}\r\n                        </IconButton>\r\n                    </Box>\r\n                    <Collapse in={casseOpen} timeout=\"auto\" unmountOnExit>\r\n                        <Box\r\n                            sx={{\r\n                                display: \"flex\",\r\n                                flexWrap: \"wrap\",\r\n                                gap: 2,\r\n                                mt: 2,\r\n                                justifyContent: \"center\",\r\n                            }}>\r\n                            {accounts.map((account) => (\r\n                                <Card\r\n                                    key={account.id}\r\n                                    sx={{\r\n                                        flex: \"1 1 320px\",\r\n                                        minWidth: 320,\r\n                                        maxWidth: 400,\r\n                                        display: \"flex\",\r\n                                        alignItems: \"center\",\r\n                                        boxShadow: 4,\r\n                                        borderRadius: 2,\r\n                                        m: 1,\r\n                                    }}>\r\n                                    <CardContent sx={{flex: 1}}>\r\n                                        <Typography variant=\"h6\" sx={{fontWeight: 700, color: \"#2d3a4b\"}}>\r\n                                            {account.name}\r\n                                        </Typography>\r\n\r\n                                        {accountsDetails && (<>\r\n                                            <Typography variant=\"body1\" sx={{color: \"#3e5060\"}}>\r\n                                                {names.balance}: <b>€{account.balance}</b>\r\n                                            </Typography>\r\n                                            <Typography variant=\"body2\" sx={{color: \"#607d8b\"}}>\r\n                                                {names.changed_by}: {account.changed_by.name || \"N/A\"}\r\n                                            </Typography>\r\n                                        </>)}\r\n                                    </CardContent>\r\n\r\n                                    {accountsDetails ? (\r\n                                        <CardActions sx={{pr: 2, flexDirection: 'column', alignItems: 'flex-end'}}>\r\n                                            {account.status === \"closed\" && (\r\n                                                <Button\r\n                                                    variant=\"contained\"\r\n                                                    color=\"success\"\r\n                                                    onClick={() => handleAction(account, \"open\")}\r\n                                                    sx={{minWidth: 120, fontWeight: 600}}>\r\n                                                    Apri Cassa\r\n                                                </Button>\r\n                                            )}\r\n                                            {account.status === \"open\" && (<>\r\n                                                    <Button\r\n                                                        variant=\"contained\"\r\n                                                        color=\"error\"\r\n                                                        onClick={() => handleAction(account, \"close\")}\r\n                                                        sx={{minWidth: 120, fontWeight: 600, mb: 1}}>\r\n                                                        Chiudi Cassa\r\n                                                    </Button>\r\n                                                    <Button\r\n                                                        variant=\"contained\"\r\n                                                        color=\"primary\"\r\n                                                        onClick={() => {\r\n                                                            setSelectedAccount(account);\r\n                                                            setTransactionModalOpen(true);\r\n                                                        }}\r\n                                                        sx={{minWidth: 120, fontWeight: 600}}>\r\n                                                        Deposita/Preleva\r\n                                                    </Button>\r\n                                                </>\r\n                                            )}\r\n                                        </CardActions>\r\n                                    ) : (\r\n                                        <Typography\r\n                                            variant=\"h7\"\r\n                                            style={{\r\n                                                color: account.status === \"closed\" ? 'red' : 'green',\r\n                                                fontWeight: 'bold',\r\n                                                padding: '20px'\r\n                                            }}>\r\n                                            {account.status === \"closed\" ? \"Cassa Chiusa\" : \"Cassa Aperta\"}\r\n                                        </Typography>)}\r\n                                </Card>\r\n                            ))}\r\n                        </Box>\r\n                    </Collapse>\r\n                </Paper>\r\n            </Box>\r\n            <Box sx={style}>\r\n                <Typography variant=\"h3\" gutterBottom>\r\n                    Sistema di Gestione\r\n                </Typography>\r\n                <img src={logo || ''} alt=\"ESN Polimi Logo\" style={{height: \"25vh\", marginTop: \"2px\"}}/>\r\n                <h1>Benvenuto, {user ? user.profile.name : \"Sir\"}!</h1>\r\n            </Box>\r\n            <ConfirmDialog\r\n                open={confirmDialogOpen}\r\n                message={`Confermi la presenza di €${selectedAccount?.balance} nella cassa \"${selectedAccount?.name}\" prima di ${actionType === \"open\" ? \"aprirla\" : \"chiuderla\"}?`}\r\n                onConfirm={confirmAction}\r\n                onClose={() => setConfirmDialogOpen(false)}\r\n            />\r\n            <TransactionAdd\r\n                open={transactionModalOpen}\r\n                onClose={() => setTransactionModalOpen(false)}\r\n                account={selectedAccount}\r\n                onSuccess={(message, state) => setShowSuccessPopup({message, state: state || 'success'})}\r\n            />\r\n            {showSuccessPopup && <Popup message={showSuccessPopup.message} state={showSuccessPopup.state}/>}\r\n        </Box>\r\n    );\r\n}","import {useEffect, useState, useMemo} from 'react';\r\nimport {MRT_Table, useMaterialReactTable} from 'material-react-table';\r\nimport {accountDisplayNames as names} from '../../utils/displayAttributes';\r\nimport {fetchCustom} from '../../api/api';\r\nimport {MRT_Localization_IT} from 'material-react-table/locales/it';\r\nimport Loader from '../Loader';\r\nimport {Box, Chip} from \"@mui/material\";\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nexport default function AccountsDash({limit = 5}) {\r\n    const [data, setData] = useState([]);\r\n    const [isLoading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            setLoading(true);\r\n            try {\r\n                const response = await fetchCustom(\"GET\", '/accounts/');\r\n                if (response.ok) {\r\n                    const json = await response.json();\r\n                    setData(json.results);\r\n                }\r\n            } catch (e) {\r\n                Sentry.captureException(e);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        fetchData().then();\r\n    }, []);\r\n\r\n    const columns = useMemo(() => [\r\n        {accessorKey: 'name', header: names.name, size: 100},\r\n        {\r\n            accessorKey: 'balance', header: names.balance, size: 100,\r\n            Cell: ({cell}) => (\r\n                <Box>\r\n                    {cell.getValue() !== null ? (\r\n                        <Chip label={`€${cell.getValue()}`} color=\"primary\"/>) : (\r\n                        <Chip label=\"N/A\" color=\"warning\"/>)}\r\n                </Box>\r\n            ),\r\n        },\r\n        {\r\n            accessorKey: 'status', header: names.status, size: 100,\r\n            Cell: ({cell}) => (\r\n                <Box>\r\n                    {cell.getValue() !== null ? (\r\n                        <Chip\r\n                            label={cell.getValue() === 'open' ? \"Aperta\" : \"Chiusa\"}\r\n                            color={cell.getValue() === 'open' ? \"success\" : \"error\"}/>\r\n                    ) : (\r\n                        <Chip label=\"Stato ignoto\" color=\"warning\"/>\r\n                    )}\r\n                </Box>\r\n            ),\r\n        },\r\n    ], []);\r\n\r\n    const table = useMaterialReactTable({\r\n        columns,\r\n        data: data.slice(0, limit),\r\n        enableKeyboardShortcuts: false,\r\n        enableColumnActions: false,\r\n        enableColumnFilters: false,\r\n        enablePagination: false,\r\n        enableSorting: false,\r\n        initialState: {showColumnFilters: false, showGlobalFilter: false},\r\n        paginationDisplayMode: 'default',\r\n        muiTableBodyRowProps: {hover: false},\r\n        localization: MRT_Localization_IT,\r\n    });\r\n\r\n    return isLoading ? <Loader/> : <MRT_Table table={table}/>;\r\n}","import {useEffect, useState, useMemo} from 'react';\r\nimport {MRT_Table, useMaterialReactTable} from 'material-react-table';\r\nimport {transactionDisplayNames as names} from '../../utils/displayAttributes';\r\nimport {fetchCustom} from '../../api/api';\r\nimport {MRT_Localization_IT} from 'material-react-table/locales/it';\r\nimport Loader from '../Loader';\r\nimport {Box, Chip} from \"@mui/material\";\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nconst TRANSACTION_CONFIGS = {\r\n    subscription: {label: names.tran_type[\"subscription\"], color: 'primary'},\r\n    esncard: {label: names.tran_type[\"esncard\"], color: 'secondary'},\r\n    deposit: {label: names.tran_type[\"deposit\"], color: 'success'},\r\n    withdrawal: {label: names.tran_type[\"withdrawal\"], color: 'error'}\r\n};\r\n\r\nexport default function TransactionsDash({limit = 5}) {\r\n    const [data, setData] = useState([]);\r\n    const [isLoading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            setLoading(true);\r\n            try {\r\n                const response = await fetchCustom(\"GET\", '/transactions/');\r\n                if (response.ok) {\r\n                    const json = await response.json();\r\n                    setData(json.results);\r\n                    console.log(\"Transactions data:\", json.results);\r\n                }\r\n            } catch (e) {\r\n                Sentry.captureException(e);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        fetchData().then();\r\n    }, []);\r\n\r\n    const columns = useMemo(() => [\r\n        {\r\n            accessorKey: 'created_at', header: names.date, size: 100,\r\n            Cell: ({cell}) => {\r\n                const date = new Date(cell.getValue());\r\n                return (\r\n                    <Box>\r\n                        {new Intl.DateTimeFormat('it-IT', {\r\n                            dateStyle: 'medium',\r\n                            timeStyle: 'short',\r\n                        }).format(date)}\r\n                    </Box>\r\n                );\r\n            },\r\n        },\r\n        {\r\n            accessorKey: 'type', header: names.type, size: 100,\r\n            Cell: ({cell}) => {\r\n                const type = cell.getValue();\r\n                const config = TRANSACTION_CONFIGS[type] || {label: 'Sconosciuto', color: 'default'};\r\n                return (\r\n                    <Chip\r\n                        label={config.label}\r\n                        color={config.color}\r\n                        variant=\"outlined\"\r\n                    />\r\n                );\r\n            }\r\n        },\r\n        {accessorKey: 'executor.name', header: names.executor, size: 150},\r\n        {\r\n            accessorKey: 'account.name',\r\n            header: names.account,\r\n            size: 100,\r\n            Cell: ({cell}) => (\r\n                <Box component=\"span\" fontWeight=\"bold\">\r\n                    {cell.getValue()}\r\n                </Box>\r\n            ),\r\n        },\r\n        {\r\n            accessorKey: 'amount', header: names.amount, size: 100,\r\n            Cell: ({cell}) => (\r\n                <Box>\r\n                    {cell.getValue() !== null ? (\r\n                        <Chip label={`€${cell.getValue()}`} color=\"primary\"/>) : (\r\n                        <Chip label=\"N/A\" color=\"warning\"/>)}\r\n                </Box>\r\n            ),\r\n        },\r\n    ], []);\r\n\r\n    const table = useMaterialReactTable({\r\n        columns,\r\n        data: data.slice(0, limit),\r\n        enableKeyboardShortcuts: false,\r\n        enableColumnActions: false,\r\n        enableColumnFilters: false,\r\n        enablePagination: false,\r\n        enableSorting: true,\r\n        initialState: {\r\n            showColumnFilters: false,\r\n            showGlobalFilter: false,\r\n            sorting: [{id: 'created_at', desc: true}],\r\n        },\r\n        paginationDisplayMode: 'default',\r\n        muiTableBodyRowProps: {hover: false},\r\n        localization: MRT_Localization_IT,\r\n    });\r\n\r\n    return isLoading ? <Loader/> : <MRT_Table table={table}/>;\r\n}\r\n","import {Box, Typography, Paper, Button, Grid} from '@mui/material';\r\nimport Sidebar from '../../Components/Sidebar';\r\nimport AccountsDash from '../../Components/treasury/AccountsDash';\r\nimport ReceiptsDash from '../../Components/treasury/TransactionsDash';\r\nimport {useNavigate} from 'react-router-dom';\r\n\r\nexport default function TreasuryDashboard() {\r\n    const navigate = useNavigate();\r\n\r\n    return (\r\n        <Box>\r\n            <Sidebar/>\r\n            <Box sx={{mx: '5%', mt: 0}}>\r\n                <Typography variant=\"h4\" sx={{mb: 3}}>Dashboard Tesoreria</Typography>\r\n                <Grid container spacing={3}>\r\n                    <Grid size={{xs: 12, md: 4}}>\r\n                        <Paper elevation={3} sx={{p: 2}}>\r\n                            <Typography variant=\"h6\" sx={{mb: 2}}>Casse</Typography>\r\n                            <AccountsDash limit={5}/>\r\n                            <Box sx={{display: 'flex', justifyContent: 'flex-end', mt: 2}}>\r\n                                <Button\r\n                                    variant=\"outlined\"\r\n                                    size=\"small\"\r\n                                    onClick={() => navigate('/treasury/accounts_list/')}>\r\n                                    Gestisci Casse\r\n                                </Button>\r\n                            </Box>\r\n                        </Paper>\r\n                    </Grid>\r\n                    <Grid size={{xs: 12, md: 8}}>\r\n                        <Paper elevation={3} sx={{p: 2}}>\r\n                            <Typography variant=\"h6\" sx={{mb: 2}}>Ultime Transazioni</Typography>\r\n                            <ReceiptsDash limit={3}/>\r\n                            <Box sx={{display: 'flex', justifyContent: 'flex-end', mt: 2}}>\r\n                                <Button\r\n                                    variant=\"outlined\"\r\n                                    size=\"small\"\r\n                                    onClick={() => navigate('/treasury/transactions_list/')}>\r\n                                    Gestisci Movimenti\r\n                                </Button>\r\n                            </Box>\r\n                        </Paper>\r\n                    </Grid>\r\n                </Grid>\r\n            </Box>\r\n        </Box>\r\n    );\r\n}","import {useState, useEffect} from 'react';\r\nimport {Modal, Box, TextField, Button, Typography, Grid, IconButton, Select, MenuItem, InputLabel, FormControl, Chip, OutlinedInput, FormHelperText} from '@mui/material';\r\nimport {styleESNcardModal as style} from '../../utils/sharedStyles';\r\nimport Loader from '../Loader';\r\nimport {fetchCustom} from '../../api/api';\r\nimport {extractErrorMessage} from '../../utils/errorHandling';\r\nimport CloseIcon from '@mui/icons-material/Close';\r\nimport Popup from \"../Popup\";\r\nimport {accountDisplayNames as names} from \"../../utils/displayAttributes\";\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nexport default function AccountModal({open, onClose, account = null}) {\r\n    const isEdit = account !== null;\r\n    const [isLoading, setLoading] = useState(true);\r\n    const [successPopup, setSuccessPopup] = useState(null);\r\n    const [data, setData] = useState({name: '', visible_to_groups: []});\r\n    const [errors, setErrors] = useState({name: [false, ''], visible_to_groups: [false, '']});\r\n    const [groups, setGroups] = useState([]);\r\n\r\n    useEffect(() => {\r\n        const fetchGroups = async () => {\r\n            try {\r\n                const response = await fetchCustom('GET', '/groups/');\r\n                const json = await response.json();\r\n                if (response.ok) {\r\n                    setGroups(json);\r\n                } else {\r\n                    const errorMessage = await extractErrorMessage(json, response.status);\r\n                    setSuccessPopup({message: `Errore nel recupero dei gruppi: ${errorMessage}`, state: 'error'});\r\n                }\r\n            } catch (e) {\r\n                Sentry.captureException(e);\r\n                setSuccessPopup({message: `Errore nel recupero dei gruppi: ${e}`, state: 'error'});\r\n            }\r\n        };\r\n        fetchGroups().then();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (isEdit && account)\r\n            setData({name: account.name || '', visible_to_groups: account.visible_to_groups?.map(g => g.id) || []});\r\n        else\r\n            setData({name: '', visible_to_groups: []});\r\n        setLoading(false);\r\n    }, [isEdit, account]);\r\n\r\n    const handleInputChange = (event) => {\r\n        const {name, value} = event.target;\r\n        setData({...data, [name]: value});\r\n    };\r\n\r\n    const handleGroupsChange = (event) => {\r\n        setData({...data, visible_to_groups: event.target.value});\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n\r\n        const newErrors = {...errors};\r\n\r\n        if (!data.name.trim()) newErrors.name = [true, 'Il nome è obbligatorio'];\r\n        else newErrors.name = [false, ''];\r\n\r\n        if (data.visible_to_groups.length === 0) newErrors.visible_to_groups = [true, 'Seleziona almeno un gruppo'];\r\n        else newErrors.visible_to_groups = [false, ''];\r\n\r\n        setErrors(newErrors);\r\n        if (newErrors.name[0] || newErrors.visible_to_groups[0]) return;\r\n\r\n\r\n        setLoading(true);\r\n        try {\r\n            const payload = {name: data.name, visible_to_groups: data.visible_to_groups};\r\n            let response;\r\n            if (isEdit && account) response = await fetchCustom('PATCH', `/account/${account.id}/`, payload);\r\n            else response = await fetchCustom('POST', '/account/', payload);\r\n            if (!response.ok) {\r\n                const json = await response.json();\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setSuccessPopup({message: `Errore ${isEdit ? 'modifica' : 'creazione'} cassa: ${errorMessage}`, state: 'error'});\r\n            } else {\r\n                onClose(true);\r\n            }\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setSuccessPopup({message: `Errore generale: ${error}`, state: 'error'});\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleClose = () => {\r\n        onClose(false);\r\n    };\r\n\r\n    return (\r\n        <Modal open={open} onClose={handleClose}>\r\n            <Box sx={style} component=\"form\" onSubmit={handleSubmit} noValidate>\r\n                {isLoading ? <Loader/> : (<>\r\n                    <Box sx={{display: 'flex', justifyContent: 'flex-end', mb: -2}}>\r\n                        <IconButton onClick={handleClose} sx={{minWidth: 0}}><CloseIcon/></IconButton>\r\n                    </Box>\r\n                    <Typography variant=\"h5\" gutterBottom align=\"center\" sx={{mb: 2}}>\r\n                        {isEdit ? `Modifica Cassa - ${account?.name}` : 'Crea Cassa'}\r\n                    </Typography>\r\n                    {successPopup && <Popup message={successPopup.message} state={successPopup.state}/>}\r\n\r\n                    <Grid container spacing={2}>\r\n                        <Grid size={{xs: 12}}>\r\n                            <TextField\r\n                                fullWidth\r\n                                label={names.name}\r\n                                name=\"name\"\r\n                                value={data.name}\r\n                                onChange={handleInputChange}\r\n                                required\r\n                                error={errors.name[0]}\r\n                                helperText={errors.name[0] ? errors.name[1] : ''}/>\r\n                        </Grid>\r\n                        <Grid size={{xs: 12}}>\r\n                            <FormControl fullWidth error={errors.visible_to_groups[0]}>\r\n                                <InputLabel id=\"groups-label\">{names.visible_to_groups}</InputLabel>\r\n                                <Select\r\n                                    variant=\"outlined\"\r\n                                    labelId=\"groups-label\"\r\n                                    multiple\r\n                                    value={data.visible_to_groups}\r\n                                    onChange={handleGroupsChange}\r\n                                    input={<OutlinedInput label={names.visible_to_groups}/>}\r\n                                    renderValue={(selected) => (\r\n                                        <Box sx={{display: 'flex', flexWrap: 'wrap', gap: 0.5}}>\r\n                                            {selected.map((id) => {\r\n                                                const group = groups.find(g => g.id === id);\r\n                                                return <Chip key={id} label={group ? group.name : id}/>;\r\n                                            })}\r\n                                        </Box>\r\n                                    )}>\r\n                                    {groups.map((group) => (\r\n                                        <MenuItem key={group.id} value={group.id}>\r\n                                            {group.name}\r\n                                        </MenuItem>\r\n                                    ))}\r\n                                </Select>\r\n                                {errors.visible_to_groups[0] && (\r\n                                    <FormHelperText>{errors.visible_to_groups[1]}</FormHelperText>\r\n                                )}\r\n                            </FormControl>\r\n                        </Grid>\r\n                    </Grid>\r\n                    <Box mt={2}>\r\n                        <Button fullWidth variant=\"contained\" color=\"primary\" type=\"submit\">\r\n                            {isEdit ? 'Salva Modifiche' : 'Crea'}\r\n                        </Button>\r\n                    </Box>\r\n                </>)}\r\n            </Box>\r\n        </Modal>\r\n    );\r\n}","import {useEffect, useState, useMemo} from 'react';\r\nimport {Box, Typography, Button, IconButton, Chip} from '@mui/material';\r\nimport {MaterialReactTable, useMaterialReactTable} from 'material-react-table';\r\nimport Sidebar from '../../Components/Sidebar.jsx'\r\nimport StoreIcon from '@mui/icons-material/Store';\r\nimport AccountModal from '../../Components/treasury/AccountModal.jsx';\r\nimport {fetchCustom} from \"../../api/api\";\r\nimport {MRT_Localization_IT} from \"material-react-table/locales/it\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {accountDisplayNames as names} from \"../../utils/displayAttributes\";\r\nimport Loader from \"../../Components/Loader\";\r\nimport Popup from \"../../Components/Popup\";\r\nimport {extractErrorMessage} from \"../../utils/errorHandling\";\r\nimport ArrowBackIcon from \"@mui/icons-material/ArrowBack\";\r\nimport TransactionAdd from \"../../Components/treasury/TransactionAdd\";\r\nimport EditIcon from '@mui/icons-material/Edit';\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nexport default function AccountsList() {\r\n    const [data, setData] = useState([]);\r\n    const [isLoading, setLoading] = useState(true);\r\n    const [accountModalOpen, setAccountModalOpen] = useState(false);\r\n    const navigate = useNavigate();\r\n    const [showSuccessPopup, setShowSuccessPopup] = useState(null);\r\n    const [selectedAccount, setSelectedAccount] = useState(null);\r\n    const [transactionModalOpen, setTransactionModalOpen] = useState(false);\r\n\r\n    useEffect(() => {\r\n        refreshAccountsData().then();\r\n    }, []);\r\n\r\n    const refreshAccountsData = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const response = await fetchCustom(\"GET\", '/accounts/');\r\n            const json = await response.json();\r\n            if (!response.ok) {\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setShowSuccessPopup({message: `Errore: ${errorMessage}`, state: 'error'});\r\n            } else {\r\n                setData(json.results);\r\n                console.log(\"Account List Data: \", json.results);\r\n            }\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setShowSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const columns = useMemo(() => [\r\n        {accessorKey: 'id', header: names.id, size: 50},\r\n        {accessorKey: 'name', header: names.name, size: 150},\r\n        {accessorKey: 'changed_by.name', header: names.changed_by, size: 150},\r\n        {\r\n            accessorKey: 'balance', header: names.balance, size: 100,\r\n            Cell: ({cell}) => (\r\n                <Box>\r\n                    {cell.getValue() !== null ? (\r\n                        <Chip label={`€${cell.getValue()}`} color=\"primary\"/>) : (\r\n                        <Chip label=\"N/A\" color=\"warning\"/>)}\r\n                </Box>\r\n            ),\r\n        },\r\n        {\r\n            accessorKey: 'status', header: names.status, size: 150,\r\n            Cell: ({cell}) => (\r\n                <Box sx={{}}>\r\n                    {cell.getValue() !== null ? (\r\n                        <Chip\r\n                            label={cell.getValue() === 'open' ? \"Aperta\" : \"Chiusa\"}\r\n                            color={cell.getValue() === 'open' ? \"success\" : \"error\"}/>\r\n                    ) : (\r\n                        <Chip label=\"N/A\" color=\"warning\"/>\r\n                    )}\r\n                </Box>\r\n            ),\r\n        },\r\n        {\r\n            accessorKey: 'visible_to_groups', header: names.visible_to_groups, size: 150,\r\n            Cell: ({cell}) => (\r\n                <Box sx={{}}>\r\n                    {cell.getValue() !== null ? (\r\n                        cell.getValue().map((group) => (\r\n                            <Chip key={group.id} label={group.name} color=\"grey\" sx={{mr: 1}}/>\r\n                        ))\r\n                    ) : (\r\n                        <Chip label=\"N/A\" color=\"warning\"/>\r\n                    )}\r\n                </Box>\r\n            ),\r\n        },\r\n        {\r\n            header: 'Azioni',\r\n            size: 150,\r\n            Cell: ({row}) => (\r\n                <Box sx={{display: 'flex', gap: 1}}>\r\n                    <IconButton\r\n                        color=\"primary\"\r\n                        onClick={() => {\r\n                            setSelectedAccount(row.original);\r\n                            setAccountModalOpen(true);\r\n                        }}>\r\n                        <EditIcon/>\r\n                    </IconButton>\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        color=\"primary\"\r\n                        onClick={() => {\r\n                            setSelectedAccount(row.original);\r\n                            setTransactionModalOpen(true);\r\n                        }}>\r\n                        Deposita/Preleva\r\n                    </Button>\r\n                </Box>\r\n            ),\r\n        },\r\n    ], []);\r\n\r\n    const table = useMaterialReactTable({\r\n        columns,\r\n        data,\r\n        enablePagination: false,\r\n        enableStickyHeader: true,\r\n        enableStickyFooter: true,\r\n        enableColumnFilters: false,\r\n        enableColumnOrdering: true,\r\n        enableGrouping: true,\r\n        enableColumnPinning: false,\r\n        enableFacetedValues: true,\r\n        enableRowActions: false,\r\n        enableRowSelection: false,\r\n        enableRowPinning: false,\r\n        enableExpandAll: false,\r\n        initialState: {\r\n            showGlobalFilter: true,\r\n            columnPinning: {\r\n                left: ['mrt-row-expand', 'mrt-row-select'],\r\n                right: ['mrt-row-actions'],\r\n            },\r\n            columnVisibility: {\r\n                id: false,\r\n                name: true,\r\n                changed_by: true,\r\n                status: true,\r\n                balance: true\r\n            },\r\n        },\r\n        positionToolbarAlertBanner: 'bottom',\r\n        localization: MRT_Localization_IT,\r\n        muiTableBodyRowProps: () => ({\r\n            sx: {cursor: 'default'},\r\n        }),\r\n        renderTopToolbarCustomActions: () => {\r\n            return (\r\n                <Box sx={{display: 'flex', flexDirection: 'row'}}>\r\n                    <Button variant='contained' onClick={() => setAccountModalOpen(true)} sx={{width: '150px'}}>\r\n                        Nuova Cassa\r\n                    </Button>\r\n                </Box>\r\n            );\r\n        },\r\n    });\r\n\r\n    const handleCloseAccountModal = async (success) => {\r\n        if (success) {\r\n            setShowSuccessPopup({message: \"Cassa creata con successo!\", state: \"success\"});\r\n            await refreshAccountsData();\r\n        }\r\n        setSelectedAccount(null);\r\n        setAccountModalOpen(false);\r\n    };\r\n\r\n    return (\r\n        <Box>\r\n            <Sidebar/>\r\n            {accountModalOpen && <AccountModal\r\n                open={accountModalOpen}\r\n                onClose={handleCloseAccountModal}\r\n                account={selectedAccount}\r\n            />}\r\n            <TransactionAdd\r\n                open={transactionModalOpen}\r\n                onClose={() => setTransactionModalOpen(false)}\r\n                account={selectedAccount}\r\n                onSuccess={(message, state) => setShowSuccessPopup({message, state: state || 'success'})}\r\n            />\r\n            <Box sx={{mx: '5%'}}>\r\n                {isLoading ? <Loader/> : (<>\r\n                        <Box sx={{display: 'flex', alignItems: 'center', marginBottom: '20px'}}>\r\n                            <IconButton onClick={() => {\r\n                                navigate(-1);\r\n                            }} sx={{mr: 2}}><ArrowBackIcon/></IconButton>\r\n                            <StoreIcon sx={{marginRight: '10px'}}/>\r\n                            <Typography variant=\"h4\">Lista Casse</Typography>\r\n                        </Box>\r\n                        <MaterialReactTable table={table}/>\r\n                    </>\r\n                )}\r\n            </Box>\r\n            {showSuccessPopup && <Popup message={showSuccessPopup.message} state={showSuccessPopup.state}/>}\r\n        </Box>\r\n    );\r\n}\r\n","import {useEffect, useRef} from 'react';\r\nimport Quill from 'quill';\r\nimport 'quill/dist/quill.snow.css';\r\n\r\nexport default function QuillEditor({value, onChange, readOnly = false}) {\r\n    const editorRef = useRef(null);\r\n    const quillInstance = useRef(null);\r\n\r\n    useEffect(() => {\r\n        if (editorRef.current && !quillInstance.current) {\r\n            // Define toolbar only when not in readOnly mode\r\n            const modules = readOnly\r\n                ? { toolbar: false }\r\n                : {\r\n                    toolbar: [\r\n                        ['bold', 'italic', 'underline', 'strike'],\r\n                        ['blockquote', 'code-block'],\r\n                        [{'header': 1}, {'header': 2}],\r\n                        [{'list': 'ordered'}, {'list': 'bullet'}],\r\n                        [{'script': 'sub'}, {'script': 'super'}],\r\n                        [{'indent': '-1'}, {'indent': '+1'}],\r\n                        [{'direction': 'rtl'}],\r\n                        [{'size': ['small', false, 'large', 'huge']}],\r\n                        [{'header': [1, 2, 3, 4, 5, 6, false]}],\r\n                        [{'color': []}, {'background': []}],\r\n                        [{'font': []}],\r\n                        [{'align': []}],\r\n                        ['link'],\r\n                        ['clean']\r\n                    ]\r\n                };\r\n\r\n            quillInstance.current = new Quill(editorRef.current, {\r\n                theme: 'snow',\r\n                readOnly: readOnly,\r\n                modules: modules\r\n            });\r\n\r\n            quillInstance.current.on('text-change', () => {\r\n                onChange && onChange(quillInstance.current.root.innerHTML);\r\n            });\r\n\r\n            if (value) {\r\n                quillInstance.current.root.innerHTML = value;\r\n            }\r\n        }\r\n    }, [value, onChange, readOnly]);\r\n\r\n    return <div ref={editorRef}/>;\r\n}","import React, {useEffect, useState} from 'react';\r\nimport {Modal, Box, TextField, Button, IconButton, Typography, Tooltip, Grid} from '@mui/material';\r\nimport {LocalizationProvider, DatePicker, DateTimePicker} from '@mui/x-date-pickers';\r\nimport {AdapterDayjs} from '@mui/x-date-pickers/AdapterDayjs';\r\nimport dayjs from 'dayjs';\r\nimport {Add as AddIcon, Delete as DeleteIcon, Info as InfoIcon} from '@mui/icons-material';\r\nimport {fetchCustom} from \"../../api/api\";\r\nimport {style} from '../../utils/sharedStyles'\r\nimport {eventDisplayNames as eventNames} from '../../utils/displayAttributes';\r\nimport CustomEditor from '../CustomEditor';\r\nimport Loader from \"../Loader\";\r\nimport StatusBanner from \"../StatusBanner\";\r\nimport {extractErrorMessage} from \"../../utils/errorHandling\";\r\nimport CloseIcon from '@mui/icons-material/Close';\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nexport default function EventModal({open, event, isEdit, onClose}) {\r\n    const [isLoading, setLoading] = useState(true);\r\n    const title = isEdit ? 'Modifica Evento - ' + event.name : 'Crea Evento';\r\n    const [statusMessage, setStatusMessage] = useState(null);\r\n    const [hasSubscriptions, setHasSubscriptions] = useState(false);\r\n\r\n    const [data, setData] = useState({\r\n        id: '',\r\n        name: '',\r\n        date: dayjs(),\r\n        description: '<h3>Descrizione</h3>' +\r\n            '    <p>Ecco un <a href=\"https://www.italia.it\" target=\"_blank\">link all\\'Italia</a>.</p>' +\r\n            '    <blockquote>Citazione elegante.</blockquote>' +\r\n            '    <p style=\"text-align: center;\">Adios.</p>',\r\n        cost: '',\r\n        subscription_start_date: dayjs().hour(12).minute(0),\r\n        subscription_end_date: dayjs().hour(24).minute(0),\r\n        lists: [{id: '', name: 'Main List', capacity: ''}]\r\n    });\r\n\r\n    const [errors, setErrors] = React.useState({\r\n        name: [false, ''],\r\n        date: [false, ''],\r\n        description: [false, ''],\r\n        cost: [false, ''],\r\n        subscription_start_date: [false, ''],\r\n        subscription_end_date: [false, ''],\r\n        lists: [false, ''],\r\n        listItems: []\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (isEdit) {\r\n            console.log(\"Setting form data: \", event);\r\n            setData(event);\r\n            console.log(\"#Subsciptions: \", event.subscriptions.length);\r\n            setHasSubscriptions(event.subscriptions.length > 0)\r\n        }\r\n        setLoading(false);\r\n    }, []);\r\n\r\n    const formatDateString = (date) => {\r\n        return dayjs(date).format('YYYY-MM-DD');\r\n    };\r\n\r\n    const formatDateTimeString = (date) => {\r\n        return dayjs(date).toISOString();\r\n    };\r\n\r\n    const handleEventDateChange = (date) => {\r\n        // Only allow dates from today onward\r\n        if (date && dayjs(date).isBefore(dayjs(), 'day')) return;\r\n        setData({...data, date: date});\r\n    };\r\n\r\n    const handleSubscriptionStartChange = (date) => {\r\n        // If end date exists and is now before start date, update it\r\n        if (data.subscription_end_date && dayjs(date).isAfter(dayjs(data.subscription_end_date))) {\r\n            setData({\r\n                ...data,\r\n                subscription_start_date: date,\r\n                subscription_end_date: dayjs(date).add(1, 'day'),\r\n            });\r\n        } else {\r\n            setData({...data, subscription_start_date: date});\r\n        }\r\n    };\r\n\r\n    const handleSubscriptionEndChange = (date) => {\r\n        // Only allow dates and times after start date and time and current time\r\n        if (date) {\r\n            const startDateTime = dayjs(data.subscription_start_date);\r\n            const endDateTime = dayjs(date);\r\n            const now = dayjs();\r\n\r\n            // End date should not be before start date or current time\r\n            if (endDateTime.isBefore(startDateTime)) {\r\n                date = startDateTime;\r\n            } else if (endDateTime.isBefore(now)) {\r\n                date = now;\r\n            }\r\n        }\r\n        setData({...data, subscription_end_date: date});\r\n    };\r\n\r\n    const convert = (data) => {\r\n        return ({\r\n            name: data.name,\r\n            date: formatDateString(data.date),\r\n            description: data.description,\r\n            subscription_start_date: formatDateTimeString(data.subscription_start_date),\r\n            subscription_end_date: formatDateTimeString(data.subscription_end_date),\r\n            cost: Number(data.cost).toFixed(2),\r\n            lists: data.lists.map(t => ({\r\n                id: t.id,\r\n                name: t.name,\r\n                capacity: Math.floor(Number(t.capacity))\r\n            }))\r\n            /*enable_form: data.enableForm,\r\n            profile_fields: data.profileFields,\r\n            additional_fields: Object.fromEntries(data.additionalFields.map((f) => {\r\n                switch (f.type) {\r\n                    case 'text':\r\n                        return ['t_' + f.name, {\r\n                            office_edit: f.edilistByOffice,\r\n                            office_view: f.visibleByOffice,\r\n                            length: f.length // Add length here\r\n                        }]\r\n                    case 'integer':\r\n                        return ['i_' + f.name, {\r\n                            office_edit: f.edilistByOffice,\r\n                            office_view: f.visibleByOffice\r\n                        }]\r\n                    case 'float':\r\n                        return ['f_' + f.name, {\r\n                            office_edit: f.edilistByOffice,\r\n                            office_view: f.visibleByOffice\r\n                        }]\r\n                    case 'single choice':\r\n                        return ['c_' + f.name, {\r\n                            office_edit: f.edilistByOffice,\r\n                            office_view: f.visibleByOffice,\r\n                            choices: Object.fromEntries(f.choices.map((c) => {\r\n                                return [c.value, c.color]\r\n                            }))\r\n                        }]\r\n                    case 'multiple choice':\r\n                        return ['m_' + f.name, {\r\n                            office_edit: f.edilistByOffice,\r\n                            office_view: f.visibleByOffice,\r\n                            choices: Object.fromEntries(f.choices.map((c) => {\r\n                                return [c.value, c.color]\r\n                            }))\r\n                        }]\r\n                }\r\n            }))*/\r\n        })\r\n    }\r\n\r\n    const scrollUp = () => {\r\n        window.scrollTo({\r\n            top: 0,\r\n            behavior: 'smooth'\r\n        });\r\n    }\r\n\r\n    const handleInputChange = (event) => {\r\n        const {name, value, type, checked} = event.target;\r\n        setData({\r\n            ...data,\r\n            [name]: type === 'checkbox' ? checked : value,\r\n        });\r\n    };\r\n\r\n    const handleAddList = () => {\r\n        setData({\r\n            ...data,\r\n            lists: [...data.lists, {id: '', name: '', capacity: ''}],\r\n        });\r\n    };\r\n\r\n    const handleListChange = (index, event) => {\r\n        const {name, value} = event.target;\r\n        const updatedLists = data.lists.map((list, i) =>\r\n            i === index ? {...list, [name]: value} : list\r\n        );\r\n        setData({...data, lists: updatedLists});\r\n    };\r\n\r\n    const handleDeleteList = (index) => {\r\n        setData({\r\n            ...data,\r\n            lists: data.lists.filter((_, i) => i !== index),\r\n        });\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n\r\n        // Validate lists - check if any list has empty name or capacity\r\n        const listErrors = data.lists.map(list => ({\r\n            name: !list.name.trim(),\r\n            capacity: list.capacity === ''\r\n        }));\r\n        const hasListErrors = listErrors.some(error => error.name || error.capacity);\r\n        setErrors({...errors, listItems: listErrors, lists: [hasListErrors]});\r\n        if (hasListErrors) {\r\n            setStatusMessage({message: 'Errore campi Liste', state: 'error'});\r\n            scrollUp();\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = isEdit\r\n                ? await fetchCustom(\"PATCH\", `/event/${data.id}/`, convert(data))\r\n                : await fetchCustom(\"POST\", '/event/', convert(data));\r\n            if (!response.ok) {\r\n                const json = await response.json();\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setStatusMessage({message: `Errore ${isEdit ? 'modifica' : 'creazione'} evento: ${errorMessage}`, state: 'error'});\r\n                scrollUp();\r\n            } else onClose(true);\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setStatusMessage({message: `Errore generale: ${error}`, state: \"error\"});\r\n            scrollUp();\r\n        }\r\n    }\r\n\r\n    const handleClose = () => {\r\n        onClose(false);\r\n    }\r\n\r\n    /*\r\n    const profileFieldOptions = ['name', 'surname', 'email', 'phone', 'whatsapp', 'birthdate', 'latest_esncard', 'latest_document', 'matricola_number', 'matricola_expiration', 'person_code', 'domicile'];\r\n\r\n    const handleProfileFieldChange = (event) => {\r\n        const {value} = event.target;\r\n        setData({\r\n            ...data,\r\n            profileFields: value,\r\n        });\r\n    };\r\n\r\n    const handleAddField = (fieldType) => {\r\n        setData({\r\n            ...data,\r\n            [fieldType]: [...data[fieldType], {name: '', edilistByOffice: false, visibleByOffice: false, type: '', choices: [], length: ''}],\r\n        });\r\n    };\r\n\r\n    const handleFieldChange = (fieldType, index, event) => {\r\n        const {name, value, type, checked} = event.target;\r\n        const updatedFields = data[fieldType].map((field, i) =>\r\n            i === index ? {...field, [name]: type === 'checkbox' ? checked : value} : field\r\n        );\r\n        setData({...data, [fieldType]: updatedFields});\r\n    };\r\n\r\n    const handleDeleteField = (fieldType, index) => {\r\n        setData({\r\n            ...data,\r\n            [fieldType]: data[fieldType].filter((_, i) => i !== index),\r\n        });\r\n    };\r\n\r\n    const handleAddChoice = (fieldType, index) => {\r\n        const updatedFields = data[fieldType].map((field, i) =>\r\n            i === index ? {...field, choices: [...field.choices, {value: '', color: '#FFFFFF'}]} : field\r\n        );\r\n        setData({...data, [fieldType]: updatedFields});\r\n    };\r\n\r\n    const handleChoiceChange = (fieldType, fieldIndex, choiceIndex, event) => {\r\n        const {name, value} = event.target;\r\n        const updatedFields = data[fieldType].map((field, i) => {\r\n            if (i === fieldIndex) {\r\n                const updatedChoices = field.choices.map((choice, j) =>\r\n                    j === choiceIndex ? {...choice, [name]: value} : choice\r\n                );\r\n                return {...field, choices: updatedChoices};\r\n            }\r\n            return field;\r\n        });\r\n        setData({...data, [fieldType]: updatedFields});\r\n    };\r\n\r\n    const handleColorChange = (fieldType, fieldIndex, choiceIndex, event) => {\r\n        const {value} = event.target;\r\n        const updatedFields = data[fieldType].map((field, i) => {\r\n            if (i === fieldIndex) {\r\n                const updatedChoices = field.choices.map((choice, j) =>\r\n                    j === choiceIndex ? {...choice, color: value} : choice\r\n                );\r\n                return {...field, choices: updatedChoices};\r\n            }\r\n            return field;\r\n        });\r\n        setData({...data, [fieldType]: updatedFields});\r\n    };\r\n    */\r\n\r\n    return (\r\n        <Modal open={open} onClose={handleClose}>\r\n            <Box sx={style} component=\"form\" onSubmit={handleSubmit} noValidate={false}>\r\n                {isLoading ? <Loader/> : (<>\r\n                    <Box sx={{display: 'flex', justifyContent: 'flex-end', mb: -2}}>\r\n                        <IconButton onClick={() => onClose(false)} sx={{minWidth: 0}}><CloseIcon/></IconButton>\r\n                    </Box>\r\n                    <Typography variant=\"h5\" gutterBottom sx={{mb: 2}} align=\"center\">{title}</Typography>\r\n                    {statusMessage && (<StatusBanner message={statusMessage.message} state={statusMessage.state}/>)}\r\n\r\n                    {isEdit && hasSubscriptions && (\r\n                        <Box sx={{mb: 2, p: 1, bgcolor: '#fff3e0', borderRadius: 1}}>\r\n                            <Typography variant=\"body2\" color=\"warning.main\">\r\n                                <InfoIcon fontSize=\"small\" sx={{verticalAlign: 'middle', mr: 1}}/>\r\n                                Alcuni campi non sono modificabili perché ci sono già iscrizioni. Rimuovi tutte le iscrizioni per abilitare la modifica.\r\n                            </Typography>\r\n                        </Box>\r\n                    )}\r\n\r\n                    <Grid container spacing={2}>\r\n                        <Grid size={{xs: 12, md: 6}}>\r\n                            <TextField\r\n                                fullWidth\r\n                                label={eventNames.name}\r\n                                name=\"name\"\r\n                                value={data.name}\r\n                                onChange={handleInputChange}\r\n                                required\r\n                                error={errors.name[0]}\r\n                            />\r\n                        </Grid>\r\n                        <Grid size={{xs: 12, md: 6}}>\r\n                            <LocalizationProvider dateAdapter={AdapterDayjs} adapterLocale='en-gb'>\r\n                                <DatePicker\r\n                                    label={eventNames.date}\r\n                                    value={data.date}\r\n                                    onChange={handleEventDateChange}\r\n                                    minDate={isEdit ? null : dayjs()}\r\n                                    slotProps={{textField: {variant: 'outlined'}}}\r\n                                    required\r\n                                    error={errors.date[0]}/>\r\n                            </LocalizationProvider>\r\n                        </Grid>\r\n                        <Grid size={{xs: 12, md: 3}}>\r\n                            <Tooltip title={isEdit && hasSubscriptions ? \"Non modificabile con iscrizioni esistenti\" : \"\"}>\r\n                                <div> {/* Wrapper div needed for Tooltip to work with disabled elements */}\r\n                                    <LocalizationProvider dateAdapter={AdapterDayjs} adapterLocale='en-gb'>\r\n                                        <DateTimePicker\r\n                                            label={eventNames.subscription_start_date}\r\n                                            value={data.subscription_start_date || null}\r\n                                            onChange={handleSubscriptionStartChange}\r\n                                            minDate={isEdit ? null : dayjs()}\r\n                                            slotProps={{\r\n                                                textField: {\r\n                                                    fullWidth: true,\r\n                                                    required: true,\r\n                                                }\r\n                                            }}\r\n                                            disabled={isEdit && hasSubscriptions}\r\n                                            required\r\n                                            error={errors.subscription_start_date[0]}\r\n                                        />\r\n                                    </LocalizationProvider>\r\n                                </div>\r\n                            </Tooltip>\r\n                        </Grid>\r\n                        <Grid size={{xs: 12, md: 3}}>\r\n                            <LocalizationProvider dateAdapter={AdapterDayjs} adapterLocale='en-gb'>\r\n                                <DateTimePicker\r\n                                    label={eventNames.subscription_end_date}\r\n                                    value={data.subscription_end_date || null}\r\n                                    onChange={handleSubscriptionEndChange}\r\n                                    minDate={dayjs().isAfter(data.subscription_start_date) ? dayjs() : data.subscription_start_date || dayjs()}\r\n                                    slotProps={{textField: {fullWidth: true, required: true}}}\r\n                                    required\r\n                                    error={errors.subscription_start_date[0]}\r\n                                />\r\n                            </LocalizationProvider>\r\n                        </Grid>\r\n                        <Grid size={{xs: 12, md: 3}}>\r\n                            <Tooltip title={isEdit && hasSubscriptions ? \"Non modificabile con iscrizioni esistenti\" : \"\"}>\r\n                                <div> {/* Wrapper div needed for Tooltip to work with disabled elements */}\r\n                                    <TextField\r\n                                        fullWidth\r\n                                        label={eventNames.cost}\r\n                                        name=\"cost\"\r\n                                        type=\"number\"\r\n                                        slotProps={{htmlInput: {min: \"0\", step: \"0.01\"}}}\r\n                                        value={data.cost}\r\n                                        onChange={handleInputChange}\r\n                                        placeholder=\"Inserisci 0 se gratuito\"\r\n                                        required\r\n                                        error={errors.cost[0]}\r\n                                        disabled={isEdit && hasSubscriptions}\r\n                                    />\r\n                                </div>\r\n                            </Tooltip>\r\n                        </Grid>\r\n                    </Grid>\r\n                    <Grid size={{xs: 12}} data-color-mode=\"light\">\r\n                        <Typography variant=\"h6\" component=\"div\">{eventNames.description}</Typography>\r\n                        <CustomEditor\r\n                            value={data.description}\r\n                            onChange={(value) => {\r\n                                setData({...data, description: value});\r\n                            }}\r\n                        />\r\n                    </Grid>\r\n\r\n                    <Box my={2}>\r\n                        <Grid container spacing={2} alignItems=\"center\">\r\n                            <Grid><Typography variant=\"h6\" gutterBottom>Liste</Typography></Grid>\r\n                            <Grid><IconButton onClick={handleAddList}><AddIcon/></IconButton></Grid>\r\n                        </Grid>\r\n                        {data.lists.map((list, index) => (\r\n                            <Grid container spacing={2} alignItems=\"center\" mb={2} key={index}>\r\n                                <Grid>\r\n                                    <TextField\r\n                                        label={eventNames.list_name}\r\n                                        name=\"name\"\r\n                                        value={list.name}\r\n                                        onChange={(e) => handleListChange(index, e)}\r\n                                        required\r\n                                        error={errors.listItems[index]?.name}\r\n                                        helperText={errors.listItems[index]?.name ? \"Il nome è obbligatorio\" : \"\"}\r\n                                    />\r\n                                </Grid>\r\n                                <Grid>\r\n                                    <TextField\r\n                                        label={eventNames.list_capacity}\r\n                                        name=\"capacity\"\r\n                                        type=\"number\"\r\n                                        value={list.capacity}\r\n                                        slotProps={{htmlInput: {min: \"0\", step: \"1\"}}}\r\n                                        onChange={(e) => handleListChange(index, e)}\r\n                                        placeholder=\"Inserisci 0 se illimitata\"\r\n                                        required\r\n                                        error={errors.listItems[index]?.capacity}\r\n                                        helperText={errors.listItems[index]?.capacity ? \"La capacità è obbligatoria\" : \"\"}\r\n                                    />\r\n                                </Grid>\r\n                                <Grid size={{xs: 2}}><IconButton onClick={() => handleDeleteList(index)}><DeleteIcon/></IconButton></Grid>\r\n                            </Grid>\r\n                        ))}\r\n                    </Box>\r\n\r\n                    {/* Insert *1 */}\r\n                    {/* Insert *2 */}\r\n                    {/* Insert *3 */}\r\n\r\n                    <Box mt={2}>\r\n                        <Button variant=\"contained\" color=\"primary\" type=\"submit\">{isEdit ? 'Salva Modifiche' : 'Crea'}</Button>\r\n                    </Box>\r\n                </>)}\r\n            </Box>\r\n        </Modal>\r\n\r\n    );\r\n}\r\n// *1\r\n/*<FormControlLabel\r\n    control={<Switch\r\n        checked={data.enableForm}\r\n        onChange={handleInputChange}\r\n        name=\"enableForm\"\r\n        color=\"primary\"\r\n    />}\r\n    label=\"Attiva Form\"\r\n/>*/\r\n\r\n// *2\r\n/*<Box my={2}>\r\n    <Grid container spacing={2}>\r\n        <Grid size={{xs: 12, md: 6}}>\r\n            <Typography variant=\"h6\" gutterBottom>Campi Profilo</Typography>\r\n            <FormControl sx={{minWidth: '100%'}}>\r\n                <Select\r\n                    variant=\"outlined\"\r\n                    multiple\r\n                    value={data.profileFields}\r\n                    onChange={handleProfileFieldChange}\r\n                    renderValue={(selected) => selected.join(', ')}\r\n                >\r\n                    {profileFieldOptions.map((option) => (\r\n                        <MenuItem key={option} value={option}>\r\n                            <Checkbox checked={data.profileFields.indexOf(option) > -1}/>\r\n                            {names[option]}\r\n                        </MenuItem>\r\n                    ))}\r\n                </Select>\r\n            </FormControl>\r\n        </Grid>\r\n    </Grid>\r\n</Box>*/\r\n\r\n// *3\r\n/*{\r\n    ['additionalFields', 'formFields'].map((fieldType) => (\r\n        <Box my={2} key={fieldType}>\r\n            <Grid container spacing={2} alignItems=\"center\">\r\n                <Grid size={{xs: 6}}>\r\n                    <Typography variant=\"h6\" gutterBottom>\r\n                        {fieldType === 'additionalFields' ? 'Campi Aggiuntivi' : 'Campi Form'}\r\n                    </Typography>\r\n                </Grid>\r\n                <Grid size={{xs: 6}} textAlign=\"right\">\r\n                    <IconButton onClick={() => handleAddField(fieldType)}><AddIcon/></IconButton>\r\n                </Grid>\r\n            </Grid>\r\n            {data[fieldType].map((field, index) => (\r\n                <Paper key={index} sx={{p: 2, mb: 1}}>\r\n                    <Grid container spacing={2} alignItems=\"center\">\r\n                        <Grid size={{xs: 4}}>\r\n                            <TextField\r\n                                fullWidth\r\n                                label=\"Nome campo\"\r\n                                name=\"name\"\r\n                                value={field.name}\r\n                                onChange={(e) => handleFieldChange(fieldType, index, e)}\r\n                            />\r\n                        </Grid>\r\n                        <Grid size={{xs: 2}}>\r\n                            <FormControlLabel\r\n                                control={\r\n                                    <Checkbox\r\n                                        checked={field.edilistByOffice}\r\n                                        onChange={(e) => handleFieldChange(fieldType, index, e)}\r\n                                        name=\"edilistByOffice\"\r\n                                    />\r\n                                }\r\n                                label=\"Editabile\"\r\n                            />\r\n                        </Grid>\r\n                        <Grid size={{xs: 2}}>\r\n                            <FormControlLabel\r\n                                control={\r\n                                    <Checkbox\r\n                                        checked={field.visibleByOffice}\r\n                                        onChange={(e) => handleFieldChange(fieldType, index, e)}\r\n                                        name=\"visibleByOffice\"\r\n                                    />\r\n                                }\r\n                                label=\"Visibile\"\r\n                            />\r\n                        </Grid>\r\n                        <Grid size={{xs: 3}}>\r\n                            <FormControl fullWidth>\r\n                                <InputLabel>Formato</InputLabel>\r\n                                <Select\r\n                                    variant=\"outlined\"\r\n                                    name=\"type\"\r\n                                    label=\"Formato\"\r\n                                    value={field.type}\r\n                                    onChange={(e) => handleFieldChange(fieldType, index, e)}\r\n                                >\r\n                                    <MenuItem value=\"text\">Testo</MenuItem>\r\n                                    <MenuItem value=\"integer\">Numerico Intero</MenuItem>\r\n                                    <MenuItem value=\"float\">Numerico Decimale</MenuItem>\r\n                                    <MenuItem value=\"single choice\">Scelta Singola</MenuItem>\r\n                                    <MenuItem value=\"multiple choice\">Scelta Multipla</MenuItem>\r\n                                </Select>\r\n                            </FormControl>\r\n                        </Grid>\r\n                        <Grid size={{xs: 1}}>\r\n                            <IconButton onClick={() => handleDeleteField(fieldType, index)}>\r\n                                <DeleteIcon/>\r\n                            </IconButton>\r\n                        </Grid>\r\n                    </Grid>\r\n                    {field.type === 'text' && (\r\n                        <Grid container spacing={2} alignItems=\"center\">\r\n                            <Grid size={{xs: 4}}>\r\n                                <TextField\r\n                                    fullWidth\r\n                                    label=\"Lunghezza\"\r\n                                    name=\"length\"\r\n                                    value={field.length}\r\n                                    onChange={(e) => handleFieldChange(fieldType, index, e)}\r\n                                    type=\"number\"\r\n                                />\r\n                            </Grid>\r\n                        </Grid>\r\n                    )}\r\n                    {(field.type === 'single choice' || field.type === 'multiple choice') && (\r\n                        <Box mt={2} ml={2}>\r\n                            <Grid container spacing={2}>\r\n                                <Grid size={{xs: 12}}>\r\n                                    <Button onClick={() => handleAddChoice(fieldType, index)}>Aggiungi Scelta</Button>\r\n                                </Grid>\r\n                                {field.choices.map((choice, choiceIndex) => (\r\n                                    <Grid container spacing={2} key={choiceIndex} alignItems=\"center\">\r\n                                        <Grid size={{xs: 5}}>\r\n                                            <TextField\r\n                                                fullWidth\r\n                                                label=\"Valore\"\r\n                                                name=\"value\"\r\n                                                value={choice.value}\r\n                                                onChange={(e) => handleChoiceChange(fieldType, index, choiceIndex, e)}\r\n                                            />\r\n                                        </Grid>\r\n                                        <Grid size={{xs: 5}}>\r\n                                            <FormControl fullWidth>\r\n                                                <InputLabel>Colore</InputLabel>\r\n                                                <Select\r\n                                                    variant=\"outlined\"\r\n                                                    name=\"color\"\r\n                                                    label=\"Colore\"\r\n                                                    value={choice.color}\r\n                                                    onChange={(e) => handleColorChange(fieldType, index, choiceIndex, e)}\r\n                                                >\r\n                                                    {colorOptions.map((option) => (\r\n                                                        <MenuItem key={option.value} value={option.value}>\r\n                                                            <div style={{backgroundColor: option.value, width: 20, height: 20, display: 'inline-block', marginRight: 8}}></div>\r\n                                                            {option.label}\r\n                                                        </MenuItem>\r\n                                                    ))}\r\n                                                </Select>\r\n                                            </FormControl>\r\n                                        </Grid>\r\n                                    </Grid>\r\n                                ))}\r\n                            </Grid>\r\n                        </Box>\r\n                    )}\r\n                </Paper>\r\n            ))}\r\n        </Box>\r\n    ))\r\n}*/\r\n\r\n","import {useEffect, useState, useMemo, useRef} from 'react';\r\nimport {Box, Typography, Chip, Button, Grid, OutlinedInput, IconButton, FormControl, InputLabel, Select, MenuItem} from '@mui/material';\r\nimport {MaterialReactTable, useMaterialReactTable} from 'material-react-table';\r\nimport Sidebar from '../../Components/Sidebar.jsx'\r\nimport EventIcon from '@mui/icons-material/Event';\r\nimport EventModal from '../../Components/events/EventModal.jsx';\r\nimport {fetchCustom} from \"../../api/api\";\r\nimport {MRT_Localization_IT} from \"material-react-table/locales/it\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {eventDisplayNames as names} from \"../../utils/displayAttributes\";\r\nimport Loader from \"../../Components/Loader\";\r\nimport dayjs from \"dayjs\";\r\nimport Popup from \"../../Components/Popup\";\r\nimport {extractErrorMessage} from \"../../utils/errorHandling\";\r\nimport SearchIcon from '@mui/icons-material/Search';\r\nimport ClearIcon from '@mui/icons-material/Clear';\r\nimport {DatePicker, LocalizationProvider} from '@mui/x-date-pickers';\r\nimport {AdapterDateFns} from '@mui/x-date-pickers/AdapterDateFns';\r\nimport itLocale from 'date-fns/locale/it';\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nconst SUBSCRIPTION_STATUS_OPTIONS = [\r\n    {value: 'open', label: 'Iscrizioni aperte'},\r\n    {value: 'not_yet', label: 'Non ancora aperte'},\r\n    {value: 'closed', label: 'Iscrizioni chiuse'}\r\n];\r\n\r\nexport default function EventsList() {\r\n    const [data, setData] = useState([]);\r\n    const [eventModalOpen, setEventModalOpen] = useState(false);\r\n    const navigate = useNavigate();\r\n    const [showSuccessPopup, setShowSuccessPopup] = useState(null);\r\n    const [pagination, setPagination] = useState({pageIndex: 0, pageSize: 10});\r\n    const [rowCount, setRowCount] = useState(0);\r\n    const [search, setSearch] = useState('');\r\n    const [appliedSearch, setAppliedSearch] = useState('');\r\n    const [filters, setFilters] = useState({\r\n        subscriptionStatus: [],\r\n        dateFrom: null,\r\n        dateTo: null,\r\n    });\r\n\r\n    const [localLoading, setLocalLoading] = useState(false);\r\n    const searchInputRef = useRef(null);\r\n\r\n    const formatDateString = (date) => {\r\n        return dayjs(date).format('YYYY-MM-DD');\r\n    };\r\n\r\n    useEffect(() => {\r\n        let ignore = false;\r\n        const fetchData = async () => {\r\n            setLocalLoading(true);\r\n            try {\r\n                const params = new URLSearchParams();\r\n                params.append('page', pagination.pageIndex + 1);\r\n                params.append('page_size', pagination.pageSize);\r\n                if (appliedSearch) params.append('search', appliedSearch);\r\n                if (filters.subscriptionStatus.length)\r\n                    params.append('subscription_status', filters.subscriptionStatus.join(','));\r\n                if (filters.dateFrom)\r\n                    params.append('dateFrom', formatDateString(filters.dateFrom));\r\n                if (filters.dateTo)\r\n                    params.append('dateTo', formatDateString(filters.dateTo));\r\n                const response = await fetchCustom(\"GET\", `/events/?${params.toString()}`);\r\n                const json = await response.json();\r\n                if (!response.ok) {\r\n                    const errorMessage = await extractErrorMessage(json, response.status);\r\n                    setShowSuccessPopup({message: `Errore: ${errorMessage}`, state: 'error'});\r\n                } else {\r\n                    if (!ignore) {\r\n                        setRowCount(json.count || 0);\r\n                        setData(json.results);\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                Sentry.captureException(error);\r\n                setShowSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n            } finally {\r\n                setLocalLoading(false);\r\n            }\r\n        };\r\n        fetchData().then();\r\n        return () => {\r\n            ignore = true;\r\n        };\r\n    }, [pagination.pageIndex, pagination.pageSize, filters, appliedSearch]);\r\n\r\n    const columns = useMemo(() => [\r\n        {\r\n            accessorKey: 'id',\r\n            header: names.id,\r\n            size: 50,\r\n        },\r\n        {\r\n            accessorKey: 'name',\r\n            header: names.name,\r\n            size: 150,\r\n        },\r\n        {\r\n            accessorKey: 'date',\r\n            header: names.date,\r\n            size: 150,\r\n        },\r\n        {\r\n            accessorKey: 'cost',\r\n            header: names.cost,\r\n            size: 150,\r\n        },\r\n        {\r\n            accessorKey: 'subscription_start_date',\r\n            header: names.subscription_date_status,\r\n            size: 150,\r\n            Cell: ({row}) => {\r\n                const now = dayjs();\r\n                const startDateTime = row.original.subscription_start_date ? dayjs(row.original.subscription_start_date) : null;\r\n                const endDateTime = row.original.subscription_end_date ? dayjs(row.original.subscription_end_date) : null;\r\n\r\n                let status = \"Non disponibile\";\r\n                let color = \"error\";\r\n\r\n                if (startDateTime && endDateTime) {\r\n                    if (now.isAfter(startDateTime) && now.isBefore(endDateTime)) {\r\n                        status = \"Iscrizioni aperte\";\r\n                        color = \"success\";\r\n                    } else if (now.isBefore(startDateTime)) {\r\n                        status = \"Iscrizioni non ancora aperte\";\r\n                        color = \"warning\";\r\n                    } else if (now.isAfter(endDateTime)) {\r\n                        status = \"Iscrizioni chiuse\";\r\n                        color = \"error\";\r\n                    }\r\n                }\r\n\r\n                return <Chip label={status} color={color}/>;\r\n            },\r\n        },\r\n    ], []);\r\n\r\n    const table = useMaterialReactTable({\r\n        columns,\r\n        data,\r\n        enableStickyHeader: true,\r\n        enableStickyFooter: true,\r\n        enableColumnFilters: false, // Disabled cause it only allows to search in the current page\r\n        enableColumnOrdering: true,\r\n        enableGrouping: true,\r\n        enableColumnPinning: true,\r\n        enableFacetedValues: true,\r\n        enableRowActions: false,\r\n        enableRowSelection: false,\r\n        enableRowPinning: true,\r\n        enableExpandAll: false,\r\n        initialState: {\r\n            showColumnFilters: false,\r\n            showGlobalFilter: true,\r\n            columnPinning: {\r\n                left: ['mrt-row-expand', 'mrt-row-select'],\r\n                right: ['mrt-row-actions'],\r\n            },\r\n            columnVisibility: {\r\n                id: true,\r\n                name: true,\r\n                date: true,\r\n                cost: true\r\n            },\r\n        },\r\n        paginationDisplayMode: 'pages',\r\n        positionToolbarAlertBanner: 'bottom',\r\n        enableGlobalFilter: false,\r\n        muiPaginationProps: {\r\n            color: 'secondary',\r\n            rowsPerPageOptions: [10, 20, 30],\r\n            shape: 'rounded',\r\n            variant: 'outlined',\r\n        },\r\n        manualPagination: true,\r\n        rowCount,\r\n        onPaginationChange: setPagination,\r\n        state: {pagination},\r\n        localization: MRT_Localization_IT,\r\n        muiTableBodyRowProps: ({row}) => ({\r\n            onClick: () => {\r\n                navigate('/event/' + row.original.id, {state: {event: row.original}});\r\n            },\r\n        }),\r\n        renderTopToolbarCustomActions: () => {\r\n            return (\r\n                <Box sx={{display: 'flex', flexDirection: 'row'}}>\r\n                    <Button variant='contained' onClick={() => setEventModalOpen(true)} sx={{width: '150px'}}>\r\n                        Crea\r\n                    </Button>\r\n                </Box>\r\n            );\r\n        },\r\n    });\r\n\r\n    // Manual search handlers\r\n    const handleSearchApply = () => {\r\n        setAppliedSearch(search);\r\n        setPagination(prev => ({...prev, pageIndex: 0}));\r\n    };\r\n    const handleSearchClear = () => {\r\n        setSearch('');\r\n        setAppliedSearch('');\r\n        setPagination(prev => ({...prev, pageIndex: 0}));\r\n        if (searchInputRef.current) searchInputRef.current.focus();\r\n    };\r\n\r\n    const handleFilterChange = (e) => {\r\n        const {name, value} = e.target;\r\n        setFilters(prev => ({\r\n            ...prev,\r\n            [name]: typeof value === 'string' ? value.split(',') : value\r\n        }));\r\n    };\r\n\r\n    const handleDateChange = (name, value) => {\r\n        setFilters(prev => {\r\n            let newFilters = {...prev, [name]: value};\r\n            // Prevent invalid date ranges\r\n            if (name === 'dateFrom' && newFilters.dateTo && value && value > newFilters.dateTo)\r\n                newFilters.dateTo = value;\r\n            if (name === 'dateTo' && newFilters.dateFrom && value && value < newFilters.dateFrom)\r\n                newFilters.dateFrom = value;\r\n            return newFilters;\r\n        });\r\n    };\r\n\r\n    const handleClearDates = () => {\r\n        setFilters(prev => ({\r\n            ...prev,\r\n            dateFrom: null,\r\n            dateTo: null,\r\n        }));\r\n    };\r\n\r\n    const handleCloseEventModal = async (success) => {\r\n        if (success) {\r\n            setShowSuccessPopup({message: \"Evento creato con successo!\", state: \"success\"});\r\n        }\r\n        setEventModalOpen(false);\r\n    };\r\n\r\n    return (\r\n        <Box>\r\n            <Sidebar/>\r\n            {eventModalOpen && <EventModal\r\n                open={eventModalOpen}\r\n                onClose={handleCloseEventModal}\r\n                isEdit={false}\r\n            />}\r\n            <Box sx={{mx: '5%'}}>\r\n                <Box sx={{display: 'flex', alignItems: 'center', marginBottom: '20px'}}>\r\n                    <EventIcon sx={{marginRight: '10px'}}/>\r\n                    <Typography variant=\"h4\">Lista Eventi</Typography>\r\n                </Box>\r\n                <Grid container spacing={2} sx={{mb: 2}} alignItems=\"center\" justifyContent=\"flex-end\">\r\n                    <Grid size={{xs: 12, sm: 2}}>\r\n                        <FormControl fullWidth>\r\n                            <InputLabel id=\"subscription-status-label\">Stato iscrizione</InputLabel>\r\n                            <Select\r\n                                labelId=\"subscription-status-label\"\r\n                                name=\"subscriptionStatus\"\r\n                                multiple\r\n                                value={filters.subscriptionStatus}\r\n                                onChange={handleFilterChange}\r\n                                input={<OutlinedInput label=\"Stato iscrizione\"/>}\r\n                                variant=\"outlined\"\r\n                                renderValue={(selected) =>\r\n                                    SUBSCRIPTION_STATUS_OPTIONS.filter(opt => selected.includes(opt.value)).map(opt => opt.label).join(', ')\r\n                                }>\r\n                                {SUBSCRIPTION_STATUS_OPTIONS.map(opt => (\r\n                                    <MenuItem key={opt.value} value={opt.value}>{opt.label}</MenuItem>\r\n                                ))}\r\n                            </Select>\r\n                        </FormControl>\r\n                    </Grid>\r\n                    <Grid size={{xs: 12, sm: 2}}>\r\n                        <FormControl fullWidth>\r\n                            <LocalizationProvider dateAdapter={AdapterDateFns} adapterLocale={itLocale}>\r\n                                <DatePicker\r\n                                    label=\"Inizio Data Evento\"\r\n                                    value={filters.dateFrom}\r\n                                    maxDate={filters.dateTo || undefined}\r\n                                    onChange={date => handleDateChange('dateFrom', date)}\r\n                                    format=\"d MMM yyyy\"/>\r\n                            </LocalizationProvider>\r\n                        </FormControl>\r\n                    </Grid>\r\n                    <Grid size={{xs: 12, sm: 2}}>\r\n                        <FormControl fullWidth>\r\n                            <LocalizationProvider dateAdapter={AdapterDateFns} adapterLocale={itLocale}>\r\n                                <DatePicker\r\n                                    label=\"Fine Data Evento\"\r\n                                    value={filters.dateTo}\r\n                                    minDate={filters.dateFrom || undefined}\r\n                                    onChange={date => handleDateChange('dateTo', date)}\r\n                                    format=\"d MMM yyyy\"/>\r\n                            </LocalizationProvider>\r\n                        </FormControl>\r\n                    </Grid>\r\n                    {(filters.dateFrom || filters.dateTo) && (\r\n                        <Grid size={{xs: 12, sm: 2}} sx={{display: 'flex', alignItems: 'center'}}>\r\n                            <Button\r\n                                variant=\"outlined\"\r\n                                color=\"secondary\"\r\n                                startIcon={<ClearIcon/>}\r\n                                onClick={handleClearDates}\r\n                                sx={{height: '100%', minWidth: 0, px: 1, mr: 1}}>\r\n                                Azzera date\r\n                            </Button>\r\n                        </Grid>\r\n                    )}\r\n                    <Grid size={{xs: 12, sm: 2}} sx={{ml: 'auto'}}>\r\n                        <OutlinedInput\r\n                            inputRef={searchInputRef}\r\n                            size=\"small\"\r\n                            placeholder=\"Cerca\"\r\n                            value={search}\r\n                            onChange={e => setSearch(e.target.value)}\r\n                            onKeyDown={e => {\r\n                                if (e.key === 'Enter') handleSearchApply();\r\n                            }}\r\n                            endAdornment={\r\n                                search && appliedSearch === search ? (\r\n                                    <IconButton\r\n                                        aria-label=\"clear\"\r\n                                        onClick={handleSearchClear}\r\n                                        edge=\"end\">\r\n                                        <ClearIcon/>\r\n                                    </IconButton>\r\n                                ) : (\r\n                                    <IconButton\r\n                                        aria-label=\"search\"\r\n                                        onClick={handleSearchApply}\r\n                                        edge=\"end\">\r\n                                        <SearchIcon/>\r\n                                    </IconButton>\r\n                                )\r\n                            }\r\n                        />\r\n                    </Grid>\r\n                </Grid>\r\n                {localLoading\r\n                    ? <Loader/>\r\n                    : <MaterialReactTable table={table}/>}\r\n                {showSuccessPopup && <Popup message={showSuccessPopup.message} state={showSuccessPopup.state}/>}\r\n            </Box>\r\n        </Box>\r\n    );\r\n}\r\n\r\n","import {useState, useEffect} from 'react';\r\nimport {Grid, Typography, Autocomplete, TextField} from '@mui/material';\r\nimport {fetchCustom} from '../api/api';\r\n\r\nexport default function ProfileSearch({\r\n                                          value,\r\n                                          onChange,\r\n                                          error,\r\n                                          helperText,\r\n                                          label = \"Cerca profilo\",\r\n                                          required = false,\r\n                                          disabled = false,\r\n                                          valid_only = true,\r\n                                          esner_only = false\r\n                                      }) {\r\n    const [profiles, setProfiles] = useState([]);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [searchLoading, setSearchLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (searchQuery.length < 3) {\r\n            setProfiles([]);\r\n            return;\r\n        }\r\n        setSearchLoading(true);\r\n        const timer = setTimeout(async () => {\r\n            try {\r\n                const resp = await fetchCustom('GET', `/profiles/search/?q=${encodeURIComponent(searchQuery)}&valid_only=${valid_only}&esner_only=${esner_only}`);\r\n                if (resp.ok) {\r\n                    const json = await resp.json();\r\n                    setProfiles(json.results || []);\r\n                }\r\n            } finally {\r\n                setSearchLoading(false);\r\n            }\r\n        }, 300);\r\n        return () => clearTimeout(timer);\r\n    }, [searchQuery]);\r\n\r\n    const renderOption = (props, option) => {\r\n        const {key, ...otherProps} = props;\r\n        const hasEsncard = option.latest_esncard && option.latest_esncard.number;\r\n        const esnCardExpired = hasEsncard && !option.latest_esncard.is_valid;\r\n\r\n        return (\r\n            <li key={key} {...otherProps}>\r\n                <Grid container spacing={1} sx={{width: '100%'}}>\r\n                    <Grid size={{xs: 4}}>\r\n                        <Typography>{option.name} {option.surname}</Typography>\r\n                    </Grid>\r\n                    <Grid size={{xs: 4}}>\r\n                        <Typography\r\n                            component=\"span\"\r\n                            sx={{color: hasEsncard ? (esnCardExpired ? 'error.main' : 'text.primary') : 'error.main'}}>\r\n                            {hasEsncard\r\n                                ? (esnCardExpired ? `${option.latest_esncard.number} (Scaduta)` : option.latest_esncard.number)\r\n                                : 'No ESNcard'}\r\n                        </Typography>\r\n                    </Grid>\r\n                    <Grid size={{xs: 4}}>\r\n                        <Typography\r\n                            component=\"span\"\r\n                            sx={{\r\n                                color: option.is_esner ? 'primary.main' : 'success.main',\r\n                                fontWeight: 'bold',\r\n                                textAlign: 'right',\r\n                                display: 'block'\r\n                            }}>\r\n                            {option.is_esner ? 'ESNer' : 'Erasmus'}\r\n                        </Typography>\r\n                    </Grid>\r\n                </Grid>\r\n            </li>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <Autocomplete\r\n            options={profiles}\r\n            loading={searchLoading}\r\n            getOptionLabel={option => `${option.name}${option.surname ? ` ${option.surname}` : ''}${option.latest_esncard ? ` (${option.latest_esncard.number})` : ''}`}\r\n            renderOption={renderOption}\r\n            value={value}\r\n            onChange={onChange}\r\n            onInputChange={(event, newInputValue) => setSearchQuery(newInputValue)}\r\n            renderInput={(params) => (\r\n                <TextField\r\n                    {...params}\r\n                    label={label}\r\n                    required={required}\r\n                    error={error}\r\n                    helperText={helperText}\r\n                />\r\n            )}\r\n            noOptionsText=\"Nessun profilo trovato\"\r\n            loadingText=\"Caricamento...\"\r\n            disabled={disabled}\r\n        />\r\n    );\r\n}","import {useEffect, useMemo, useState} from \"react\";\r\nimport {Button, Box, Divider, FormControl, InputLabel, MenuItem, Modal, Select, Typography, TextField, FormHelperText} from \"@mui/material\";\r\nimport {Switch, FormControlLabel, Paper, IconButton, Grid} from '@mui/material';\r\nimport CloseIcon from '@mui/icons-material/Close';\r\nimport {fetchCustom} from \"../../api/api\";\r\nimport {styleESNcardModal as style} from \"../../utils/sharedStyles\";\r\nimport Popup from \"../Popup\";\r\nimport {extractErrorMessage} from \"../../utils/errorHandling\";\r\nimport Loader from \"../Loader\";\r\nimport ConfirmDialog from \"../ConfirmDialog\";\r\nimport ProfileSearch from \"../ProfileSearch\";\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nexport default function SubscriptionModal({open, onClose, event, listId, subscription, isEdit}) {\r\n    const [isLoading, setLoading] = useState(true);\r\n    const [successPopup, setSuccessPopup] = useState(null);\r\n    const [accounts, setAccounts] = useState([]);\r\n    const [confirmDialog, setConfirmDialog] = useState({open: false, action: null, message: ''});\r\n    const title = isEdit ? 'Modifica Iscrizione' : 'Iscrizione Evento';\r\n    const originalAccountId = isEdit ? subscription.account_id || null : null; // 'paid' to 'pending' status needs the original account_id\r\n\r\n    const [data, setData] = useState({\r\n        id: '',\r\n        account_id: '',\r\n        account_name: '',\r\n        profile_id: '',\r\n        profile_name: '',\r\n        status: 'pending',\r\n        list_id: listId || '',\r\n        list_name: event.lists.find(list => list.id === listId)?.name || 'Lista non trovata',\r\n        notes: '',\r\n    });\r\n\r\n    const [errors, setErrors] = useState({\r\n        account_id: [false, ''],\r\n        account_name: [false, ''],\r\n        profile_id: [false, ''],\r\n        profile_name: [false, ''],\r\n        status: [false, ''],\r\n        list_id: [false, ''],\r\n        list_name: [false, ''],\r\n        notes: [false, ''],\r\n    });\r\n\r\n    const fieldsToValidate = useMemo(() => [\r\n        {field: 'profile_id', value: data?.profile_id, message: \"Selezionare un Profilo\"},\r\n        ...(data?.status === 'paid' ? [{field: 'account_id', value: data?.account_id, message: \"Selezionare una Cassa\"}] : [])\r\n    ], [data]);\r\n\r\n    const [originalStatus, setOriginalStatus] = useState(isEdit ? subscription.status : 'pending');\r\n\r\n    useEffect(() => {\r\n        if (isEdit) {\r\n            console.log('Setting Subscription:', subscription);\r\n            setData(subscription)\r\n            setOriginalStatus(subscription.status);\r\n        }\r\n        setLoading(false);\r\n        fetchAccounts().then();\r\n    }, [isEdit])\r\n\r\n    const fetchAccounts = async () => {\r\n        try {\r\n            const response = await fetchCustom(\"GET\", \"/accounts/\");\r\n            const json = await response.json();\r\n            if (response.ok) setAccounts(json.results);\r\n            else {\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setSuccessPopup({message: `Errore durante il recupero delle casse: ${errorMessage}`, state: \"error\"});\r\n            }\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n        }\r\n    }\r\n\r\n    const resetErrors = () => {\r\n        const resetObj = {};\r\n        Object.keys(errors).forEach(key => {\r\n            resetObj[key] = [false, ''];\r\n        });\r\n        setErrors(resetObj);\r\n        return resetObj;\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        let hasErrors = false;\r\n        const newErrors = resetErrors();\r\n        fieldsToValidate.forEach(item => {\r\n            if (!item.value) {\r\n                newErrors[item.field] = [true, item.message];\r\n                hasErrors = true;\r\n            }\r\n        });\r\n\r\n        if (hasErrors) {\r\n            setErrors(newErrors);\r\n            return;\r\n        }\r\n\r\n        // Confirmation if payment is involved (new paid or status changed to paid)\r\n        if ((data.status === 'paid' && (!isEdit || originalStatus !== 'paid'))\r\n            || (isEdit && originalStatus === 'paid' && data.status !== 'paid')) {\r\n            let msg = '';\r\n            if (data.status === 'paid' && (!isEdit || originalStatus !== 'paid')) {\r\n                msg = 'Confermi di registrare un pagamento di €' + event.cost + ' per questa iscrizione?';\r\n            } else if (isEdit && originalStatus === 'paid' && data.status !== 'paid') {\r\n                msg = 'Confermi di annullare un pagamento di €' + event.cost + ' per questa iscrizione?';\r\n            }\r\n            setConfirmDialog({open: true, action: () => doSubmit(), message: msg});\r\n            return;\r\n        }\r\n\r\n        if (data.status === 'paid' && isEdit && originalStatus === 'paid' && data.account_id !== originalAccountId) {\r\n            setConfirmDialog({\r\n                open: true,\r\n                action: () => doSubmit(),\r\n                message: 'Confermi di voler cambiare la cassa associata a questo pagamento? Verranno spostati €' + event.cost + ' da ' + data.account_name + ' a ' + accounts.find(account => account.id === data.account_id)?.name + '.'\r\n            })\r\n            return;\r\n        }\r\n\r\n        await doSubmit();\r\n    };\r\n\r\n    const doSubmit = async () => {\r\n        setConfirmDialog({open: false, action: null, message: ''});\r\n        try {\r\n            const response = await fetchCustom(isEdit ? \"PATCH\" : \"POST\", `/subscription/${isEdit ? data.id + '/' : ''}`, {\r\n                profile: data.profile_id,\r\n                event: event.id,\r\n                list: data.list_id,\r\n                account_id: data.account_id || originalAccountId,\r\n                notes: data.notes,\r\n                status: data.status\r\n            });\r\n            if (!response.ok) {\r\n                const json = await response.json();\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setSuccessPopup({message: `Errore: ${errorMessage}`, state: 'error'});\r\n            } else onClose(true, (isEdit ? 'Modifica Iscrizione' : 'Iscrizione') + ' completata con successo!');\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n        }\r\n    };\r\n\r\n    const handleDelete = async () => {\r\n        // Only confirm if paid\r\n        if (data.status === 'paid') {\r\n            setConfirmDialog({\r\n                open: true,\r\n                action: () => doDelete(),\r\n                message: 'Confermi di voler eliminare un pagamento di €' + event.cost + ' per questa iscrizione?'\r\n            });\r\n            return;\r\n        }\r\n        await doDelete();\r\n    };\r\n\r\n    const doDelete = async () => {\r\n        setConfirmDialog({open: false, action: null, message: ''});\r\n        if (!isEdit || !data.id) return;\r\n        try {\r\n            const response = await fetchCustom(\"DELETE\", `/subscription/${data.id}/`);\r\n            if (!response.ok) {\r\n                const json = await response.json();\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setSuccessPopup({message: `Errore eliminazione: ${errorMessage}`, state: 'error'});\r\n            } else onClose(true, \"Eliminazione avvenuta con successo\");\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n        }\r\n    };\r\n\r\n    const handleChange = (e) => {\r\n        setData({\r\n            ...data,\r\n            [e.target.name]: e.target.value,\r\n        });\r\n    };\r\n\r\n    const handleStatusToggle = () => {\r\n        setData({\r\n            ...data,\r\n            status: data.status === 'paid' ? 'pending' : 'paid',\r\n            // Reset account_id if switching to pending\r\n            ...(data.status === 'paid' ? {account_id: ''} : {})\r\n        });\r\n    };\r\n\r\n    return (\r\n        <Modal\r\n            open={open}\r\n            onClose={() => {\r\n                onClose(false);\r\n            }}\r\n            aria-labelledby=\"modal-modal-title\"\r\n            aria-describedby=\"modal-modal-description\"\r\n        >\r\n            <Box sx={style}>\r\n                {isLoading ? <Loader/> : (<>\r\n                    <Box sx={{display: 'flex', justifyContent: 'flex-end', mb: -2}}>\r\n                        <IconButton onClick={() => onClose(false)} sx={{minWidth: 0}}><CloseIcon/></IconButton>\r\n                    </Box>\r\n                    <Typography variant=\"h4\" component=\"h2\" gutterBottom>{title}</Typography>\r\n                    <Divider sx={{mb: 2}}/>\r\n                    <Typography variant=\"subtitle1\" gutterBottom>\r\n                        <b>Nome Evento:</b> {event.name}\r\n                    </Typography>\r\n                    <Typography variant=\"subtitle1\" gutterBottom>\r\n                        <b>Lista:</b> {data.list_name}\r\n                    </Typography>\r\n                    <Typography variant=\"subtitle1\" gutterBottom>\r\n                        <b>Importo:</b> {event.cost}€\r\n                    </Typography>\r\n\r\n                    <Grid container spacing={2} direction=\"column\">\r\n                        <Grid size={{xs: 12}} sx={{mt: 2}}>\r\n                            <ProfileSearch\r\n                                value={data.profile_id ? {\r\n                                    id: data.profile_id,\r\n                                    name: data.profile_name\r\n                                } : null}\r\n                                onChange={(event, newValue) => {\r\n                                    setData({\r\n                                        ...data,\r\n                                        profile_id: newValue?.id,\r\n                                        profile_name: newValue ? `${newValue.name} ${newValue.surname}` : ''\r\n                                    });\r\n                                }}\r\n                                error={errors.profile_id && errors.profile_id[0]}\r\n                                helperText={errors.profile_id && errors.profile_id[1] || 'Cerca per nome o numero ESNcard'}\r\n                                label={isEdit ? data.profile_name : \"Cerca profilo\"}\r\n                                required\r\n                                disabled={isEdit}\r\n                            />\r\n                        </Grid>\r\n                        <Grid size={{xs: 12}}>\r\n                            <Paper\r\n                                elevation={1}\r\n                                sx={{\r\n                                    p: 2,\r\n                                    display: 'flex',\r\n                                    alignItems: 'center',\r\n                                    justifyContent: 'space-between',\r\n                                    bgcolor: data.status === 'paid' ? '#e3f2fd' : 'inherit',\r\n                                    transition: 'background-color 0.3s'\r\n                                }}\r\n                            >\r\n                                <Typography variant=\"subtitle1\">Stato Pagamento</Typography>\r\n                                <FormControlLabel\r\n                                    control={\r\n                                        <Switch\r\n                                            checked={data.status === 'paid'}\r\n                                            onChange={handleStatusToggle}\r\n                                            color=\"primary\"\r\n                                        />\r\n                                    }\r\n                                    label={data.status === 'paid' ? \"Pagato\" : \"In attesa\"}\r\n                                    labelPlacement=\"start\"\r\n                                />\r\n                            </Paper>\r\n                        </Grid>\r\n                        {data.status === 'paid' && (\r\n                            <Grid size={{xs: 12}}>\r\n                                <FormControl fullWidth required error={errors.account_id && errors.account_id[0]}>\r\n                                    <InputLabel htmlFor=\"account-selector\" sx={{mb: 2}}>Seleziona Cassa</InputLabel>\r\n                                    <Select\r\n                                        variant=\"outlined\"\r\n                                        label=\"Seleziona Cassa\"\r\n                                        labelId=\"account-selector-label\"\r\n                                        id=\"account-selector\"\r\n                                        name=\"account_id\"\r\n                                        value={data.account_id || ''}\r\n                                        error={errors.account_id && errors.account_id[0]}\r\n                                        onChange={handleChange}>\r\n                                        {accounts.map((account) => (\r\n                                            <MenuItem\r\n                                                key={account.id}\r\n                                                value={account.id}\r\n                                                disabled={account.status === 'closed'}\r\n                                                style={{color: account.status === 'closed' ? 'grey' : 'inherit'}}>\r\n                                                {account.name} {account.status === 'closed' ? '(Chiusa)' : ''}\r\n                                            </MenuItem>\r\n                                        ))}\r\n                                    </Select>\r\n                                    {errors.account_id && errors.account_id[0] && <FormHelperText>{errors.account_id[1]}</FormHelperText>}\r\n                                </FormControl>\r\n                            </Grid>\r\n                        )}\r\n\r\n                        <Grid size={{xs: 12}}>\r\n                            <TextField\r\n                                label=\"Note\"\r\n                                name=\"notes\"\r\n                                value={data.notes}\r\n                                onChange={handleChange}\r\n                                multiline\r\n                                rows={2}\r\n                                fullWidth\r\n                            />\r\n                        </Grid>\r\n                    </Grid>\r\n\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        fullWidth\r\n                        sx={{\r\n                            mt: 2,\r\n                            bgcolor: data.profile_id ? '#1976d2' : '#9e9e9e',\r\n                            '&:hover': {bgcolor: data.profile_id ? '#1565c0' : '#757575'}\r\n                        }}\r\n                        onClick={handleSubmit}>\r\n                        {isEdit ? 'Salva Modifiche' : 'Conferma'}\r\n                    </Button>\r\n                    {isEdit && (\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            fullWidth\r\n                            sx={{\r\n                                mt: 1,\r\n                                bgcolor: '#d32f2f',\r\n                                '&:hover': {bgcolor: '#b71c1c'}\r\n                            }}\r\n                            onClick={handleDelete}\r\n                        >\r\n                            Elimina Iscrizione\r\n                        </Button>\r\n                    )}\r\n                    {successPopup && <Popup message={successPopup.message} state={successPopup.state}/>}\r\n                </>)}\r\n                <ConfirmDialog\r\n                    open={confirmDialog.open}\r\n                    message={confirmDialog.message}\r\n                    onConfirm={confirmDialog.action}\r\n                    onClose={() => setConfirmDialog({open: false, action: null, message: ''})}\r\n                />\r\n            </Box>\r\n        </Modal>\r\n    );\r\n}\r\n","import {useEffect, useState} from 'react';\r\nimport {Modal, Box, Button, Typography, FormControl, InputLabel, Select, MenuItem, IconButton} from '@mui/material';\r\nimport {styleESNcardModal as style} from \"../../utils/sharedStyles\";\r\nimport {fetchCustom} from \"../../api/api\";\r\nimport {extractErrorMessage} from \"../../utils/errorHandling\";\r\nimport Popup from \"../Popup\";\r\nimport CloseIcon from \"@mui/icons-material/Close\";\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nexport default function MoveToListModal({open, onClose, selectedRows, event, listId}) {\r\n    const [showSuccessPopup, setShowSuccessPopup] = useState(null);\r\n    const [lists, setLists] = useState([]);\r\n    const [selectedListId, setSelectedListId] = useState('');\r\n    const listName = event.lists.find(list => list.id === listId)?.name || 'Lista non trovata';\r\n\r\n    useEffect(() => {\r\n        if (event?.lists) {\r\n            // Filter out the current list to avoid moving to the same list\r\n            const availableLists = event.lists.filter(list => list.id !== listId);\r\n            setLists(availableLists);\r\n        }\r\n    }, [event, listId]);\r\n\r\n    const handleSubmit = async () => {\r\n        if (!selectedListId) return;\r\n        try {\r\n            const response = await fetchCustom(\"POST\", '/move-subscriptions/', {\r\n                subscriptionIds: selectedRows.map(row => row.original.id),\r\n                targetListId: selectedListId,\r\n            });\r\n            if (!response.ok) {\r\n                const json = await response.json();\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setShowSuccessPopup({message: `Errore: ${errorMessage}`, state: 'error'});\r\n            } else onClose(true);\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setShowSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Modal\r\n            open={open}\r\n            onClose={() => onClose(false)}\r\n            aria-labelledby=\"modal-modal-title\"\r\n            aria-describedby=\"modal-modal-description\"\r\n        >\r\n            <Box sx={style}>\r\n                <Box sx={{display: 'flex', justifyContent: 'flex-end'}}>\r\n                    <IconButton onClick={() => onClose(false)} sx={{minWidth: 0}}>\r\n                        <CloseIcon/>\r\n                    </IconButton>\r\n                </Box>\r\n                <Typography variant=\"h4\" component=\"h3\" gutterBottom>\r\n                    Sposta {selectedRows.length} {selectedRows.length === 1 ? \"iscrizione\" : \"iscrizioni\"}\r\n                </Typography>\r\n                <Typography variant=\"body1\" id=\"modal-modal-description\" gutterBottom>\r\n                    Lista di origine: {listName}\r\n                </Typography>\r\n                <FormControl fullWidth sx={{mt: 1}}>\r\n                    <InputLabel id=\"list-select-label\">Lista di destinazione</InputLabel>\r\n                    <Select\r\n                        labelId=\"list-select-label\"\r\n                        label=\"Lista di destinazione\"\r\n                        value={selectedListId}\r\n                        onChange={(e) => setSelectedListId(e.target.value)}\r\n                        variant=\"outlined\">\r\n                        {lists.map(list => (\r\n                            <MenuItem key={list.id} value={list.id}>\r\n                                {list.name}\r\n                            </MenuItem>\r\n                        ))}\r\n                    </Select>\r\n                </FormControl>\r\n                <Button\r\n                    variant=\"contained\"\r\n                    fullWidth\r\n                    sx={{\r\n                        mt: 2,\r\n                        bgcolor: selectedListId ? '#1976d2' : '#9e9e9e',\r\n                        '&:hover': {\r\n                            bgcolor: selectedListId ? '#1565c0' : '#757575',\r\n                        },\r\n                    }}\r\n                    onClick={handleSubmit}\r\n                    disabled={!selectedListId}\r\n                >\r\n                    Conferma\r\n                </Button>\r\n                {showSuccessPopup && <Popup message={showSuccessPopup.message} state={showSuccessPopup.state}/>}\r\n            </Box>\r\n        </Modal>\r\n    );\r\n}","import React, {useEffect, useState} from 'react';\r\nimport {useLocation, useNavigate, useParams} from 'react-router-dom';\r\nimport Sidebar from \"../../Components/Sidebar\";\r\nimport {Accordion, AccordionDetails, AccordionSummary, Box, Button, Card, CardContent, Chip, Divider, IconButton, LinearProgress, Typography, Grid} from \"@mui/material\";\r\nimport EventIcon from \"@mui/icons-material/Event\";\r\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\r\nimport CalendarTodayIcon from '@mui/icons-material/CalendarToday';\r\nimport DescriptionIcon from '@mui/icons-material/Description';\r\nimport EuroIcon from '@mui/icons-material/Euro';\r\nimport AdjustIcon from '@mui/icons-material/Adjust';\r\nimport BallotIcon from '@mui/icons-material/Ballot';\r\nimport PersonAddIcon from '@mui/icons-material/PersonAdd';\r\nimport Loader from \"../../Components/Loader\";\r\nimport {fetchCustom} from \"../../api/api\";\r\nimport dayjs from \"dayjs\";\r\nimport EditIcon from \"@mui/icons-material/Edit\";\r\nimport EventModal from \"../../Components/events/EventModal\";\r\nimport CustomEditor from '../../Components/CustomEditor';\r\nimport Popup from \"../../Components/Popup\";\r\nimport {MaterialReactTable, useMaterialReactTable} from 'material-react-table';\r\nimport {MRT_Localization_IT} from \"material-react-table/locales/it\";\r\nimport SubscriptionModal from \"../../Components/events/SubscriptionModal\";\r\nimport MoveToListModal from \"../../Components/events/MoveToListModal\";\r\nimport {extractErrorMessage} from \"../../utils/errorHandling\";\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nexport default function Event() {\r\n    const {id} = useParams(); // Get the ID from URL\r\n    const location = useLocation();\r\n    const navigate = useNavigate();\r\n    const [eventModalOpen, setEventModalOpen] = useState(false);\r\n    const [subscriptionModalOpen, setSubscriptionModalOpen] = useState(false);\r\n    const [moveToListModalOpen, setMoveToListModalOpen] = useState(false);\r\n    const [selectedRows, setSelectedRows] = useState([]);\r\n    const [isLoading, setLoading] = useState(true);\r\n    const [showSuccessPopup, setShowSuccessPopup] = useState(null);\r\n    const [data, setData] = useState(null);\r\n    // Try to get event from location state, if not available we'll fetch it using ID\r\n    const eventFromState = location.state?.event;\r\n    // States for subscription management\r\n    const [selectedList, setSelectedList] = useState(null);\r\n    const [subscription, setSubscription] = useState(null);\r\n    const [subscriptionIsEdit, setSubscriptionIsEdit] = useState(null);\r\n\r\n    useEffect(() => {\r\n        setLoading(true);\r\n        const fetchData = async () => {\r\n            try {\r\n                // Use ID from URL params if available, otherwise from state\r\n                const eventId = id || eventFromState?.id;\r\n                const response = await fetchCustom(\"GET\", `/event/${eventId}/`);\r\n                const json = await response.json();\r\n                if (!response.ok) {\r\n                    const errorMessage = await extractErrorMessage(json, response.status);\r\n                    setShowSuccessPopup({message: `Errore: ${errorMessage}`, state: 'error'});\r\n                } else {\r\n                    setData(json);\r\n                    console.log(\"Event Data: \", json);\r\n                }\r\n            } catch (error) {\r\n                Sentry.captureException(error);\r\n                setShowSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        fetchData().then();\r\n    }, [id, eventFromState]);\r\n\r\n    const refreshEventData = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const response = await fetchCustom(\"GET\", `/event/${data.id}/`);\r\n            const json = await response.json();\r\n            if (!response.ok) {\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setShowSuccessPopup({message: `Errore: ${errorMessage}`, state: 'error'});\r\n            } else {\r\n                setData(json);\r\n                setLoading(false);\r\n            }\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setShowSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleOpenEventModal = () => {\r\n        setEventModalOpen(true);\r\n    };\r\n\r\n    const handleCloseEventModal = async (success) => {\r\n        if (success) {\r\n            setShowSuccessPopup({message: \"Evento modificato con successo!\", state: \"success\"});\r\n            await refreshEventData();\r\n        }\r\n        setEventModalOpen(false);\r\n    };\r\n\r\n    const handleOpenSubscriptionModal = (listId) => {\r\n        setSelectedList(listId);\r\n        setSubscriptionIsEdit(false);\r\n        setSubscriptionModalOpen(true);\r\n    };\r\n\r\n    const handleCloseSubscriptionModal = async (success, message) => {\r\n        if (success) {\r\n            setShowSuccessPopup({message: message, state: \"success\"});\r\n            await refreshEventData();\r\n        }\r\n        setSubscriptionModalOpen(false);\r\n        setSelectedList(null);\r\n    };\r\n\r\n    const handleSubscriptionStatus = () => {\r\n        if (!data) return {chip: <Chip label=\"Loading...\" variant=\"outlined\" size=\"medium\"/>, isActive: false};\r\n\r\n        const now = dayjs();\r\n        const startDateTime = data.subscription_start_date ? dayjs(data.subscription_start_date) : null;\r\n        const endDateTime = data.subscription_end_date ? dayjs(data.subscription_end_date) : null;\r\n\r\n        let color = \"error\";\r\n        let isActive = false;\r\n\r\n        if (startDateTime && endDateTime) {\r\n            if (now.isAfter(startDateTime) && now.isBefore(endDateTime)) {\r\n                color = \"success\";\r\n                isActive = true;\r\n            } else if (now.isBefore(startDateTime)) {\r\n                color = \"warning\";\r\n            }\r\n        }\r\n\r\n        let startText = data.subscription_start_date ? dayjs(data.subscription_start_date).format('DD/MM/YYYY HH:mm') : 'Inizio non specificato';\r\n        let endText = data.subscription_end_date ? dayjs(data.subscription_end_date).format('DD/MM/YYYY HH:mm') : 'Fine non specificata';\r\n\r\n        return {\r\n            chip: (\r\n                <Chip\r\n                    label={startText + ' - ' + endText}\r\n                    color={color}\r\n                    variant=\"outlined\"\r\n                    size=\"medium\"\r\n                />\r\n            ),\r\n            isActive\r\n        };\r\n    };\r\n\r\n    const handleEditSubscription = (subscriptionId) => {\r\n        // Implementation for editing a subscription\r\n        console.log(\"Editing subscription:\", subscriptionId);\r\n        setSelectedList(null);\r\n        setSubscription(data.subscriptions.find(sub => sub.id === subscriptionId) || null);\r\n        setSubscriptionIsEdit(true);\r\n        setSubscriptionModalOpen(true);\r\n    };\r\n\r\n    // Columns and data for lists\r\n    const listConfigs = React.useMemo(() => {\r\n        if (!data?.lists) return [];\r\n        return data.lists.map(list => {\r\n            const listSubscriptions = data.subscriptions?.filter(sub => sub.list_id === list.id) || [];\r\n            const listSubscriptionsColumns = [\r\n                {\r\n                    accessorKey: 'id',\r\n                    header: 'ID',\r\n                    size: 50,\r\n                },\r\n                {\r\n                    accessorKey: 'profile_name',\r\n                    header: 'Profilo',\r\n                    size: 150,\r\n                },\r\n                {\r\n                    accessorKey: 'status',\r\n                    header: 'Stato',\r\n                    size: 100,\r\n                    Cell: ({cell}) => {\r\n                        const status = cell.getValue();\r\n                        let color;\r\n                        let label;\r\n                        switch (status) {\r\n                            case 'paid':\r\n                                color = 'success';\r\n                                label = 'PAGATO';\r\n                                break;\r\n                            case 'pending':\r\n                                color = 'warning';\r\n                                label = 'IN ATTESA';\r\n                                break;\r\n                            case 'cancelled':\r\n                                color = 'error';\r\n                                label = 'CANCELLATO';\r\n                                break;\r\n                            default:\r\n                                color = 'default';\r\n                                label = status;\r\n                        }\r\n                        return <Chip label={label} color={color} size=\"small\"/>;\r\n                    }\r\n                },\r\n                {\r\n                    accessorKey: 'notes',\r\n                    header: 'Note',\r\n                    size: 200,\r\n                }\r\n            ];\r\n            return {\r\n                listId: list.id,\r\n                listName: list.name,\r\n                capacity: list.capacity,\r\n                subscriptions: listSubscriptions,\r\n                columns: listSubscriptionsColumns\r\n            };\r\n        });\r\n    }, [data]);\r\n\r\n    const lists = React.useMemo(() => {\r\n        return listConfigs.map(config => ({\r\n            ...config,\r\n            tableOptions: {\r\n                columns: config.columns,\r\n                data: config.subscriptions,\r\n                enableStickyHeader: true,\r\n                enablePagination: true,\r\n                enableRowSelection: true,\r\n                display: false,\r\n                initialState: {\r\n                    pagination: {\r\n                        pageSize: 10,\r\n                        pageIndex: 0,\r\n                    },\r\n                },\r\n                paginationDisplayMode: 'pages',\r\n                localization: MRT_Localization_IT,\r\n                renderEmptyRowsFallback: () => (\r\n                    <Box sx={{textAlign: 'center', p: 2}}>\r\n                        <Typography variant=\"body1\">Nessuna iscrizione presente</Typography>\r\n                    </Box>\r\n                ),\r\n                muiTablePaginationProps: {\r\n                    labelRowsPerPage: 'Righe per pagina:'\r\n                },\r\n                renderTopToolbarCustomActions: ({table}) => {\r\n                    const selectedRows = table.getSelectedRowModel().rows;\r\n                    const selectedCount = selectedRows.length;\r\n                    return (\r\n                        <Box sx={{display: 'flex', gap: 1}}>\r\n                            {selectedCount >= 1 && (<>\r\n                                    <Button\r\n                                        variant=\"outlined\"\r\n                                        color=\"primary\"\r\n                                        onClick={() => handleMoveToList(selectedRows, config.listId)}>\r\n                                        Sposta in Altra Lista\r\n                                    </Button>\r\n                                    <Button\r\n                                        variant=\"outlined\"\r\n                                        color=\"secondary\"\r\n                                        onClick={() => handleExportSelected(selectedRows)}>\r\n                                        Esporta\r\n                                    </Button>\r\n                                </>\r\n                            )}\r\n                            {selectedCount === 1 && (<>\r\n                                    <Button\r\n                                        variant=\"contained\"\r\n                                        color=\"primary\"\r\n                                        onClick={() => handleEditSubscription(selectedRows[0].original.id)}>\r\n                                        Modifica Iscrizione\r\n                                    </Button>\r\n                                </>\r\n                            )}\r\n                        </Box>\r\n                    );\r\n                },\r\n            }\r\n        }));\r\n    }, [listConfigs]);\r\n    \r\n    const ListAccordions = React.memo(() => {\r\n        if (!lists || lists.length === 0) {\r\n            return <Typography>Nessuna lista disponibile (aggiungine una per poter iscrivere)</Typography>;\r\n        }\r\n\r\n        const {isActive} = handleSubscriptionStatus();\r\n\r\n        return lists.map(listConfig => {\r\n            const {listId, listName, capacity, subscriptions, tableOptions} = listConfig;\r\n            const occupancyPercentage = Math.round((subscriptions.length / capacity) * 100) || 0;\r\n            const occupancyColor = occupancyPercentage >= 90 ? 'error' : occupancyPercentage >= 60 ? 'warning' : 'success';\r\n            const fixedTableOptions = {...tableOptions, paginationDisplayMode: 'pages'};\r\n            const list = useMaterialReactTable(fixedTableOptions);\r\n\r\n            return (\r\n                <Accordion key={listId} sx={{mt: 2}}>\r\n                    <AccordionSummary>\r\n                        <Box sx={{display: 'flex', alignItems: 'center', width: '100%'}}>\r\n                            <BallotIcon sx={{color: 'primary.main', mr: 1}}/>\r\n                            <Typography variant=\"h6\" component=\"div\" sx={{flexGrow: 1}}>{listName}</Typography>\r\n                            <Box\r\n                                sx={{\r\n                                    display: 'flex',\r\n                                    alignItems: 'center',\r\n                                    cursor: subscriptions.length < capacity && isActive ? 'pointer' : 'not-allowed',\r\n                                    opacity: subscriptions.length < capacity && isActive ? 1 : 0.5,\r\n                                    px: 2,\r\n                                    py: 1,\r\n                                    borderRadius: 1,\r\n                                    bgcolor: 'primary.main',\r\n                                    color: 'white',\r\n                                    ml: 2,\r\n                                }}\r\n                                onClick={subscriptions.length < capacity && isActive ? () => handleOpenSubscriptionModal(listId) : undefined}>\r\n                                <PersonAddIcon sx={{mr: 1}}/> ISCRIVI\r\n                            </Box>\r\n                            <Box sx={{width: '200px', ml: 2}}>\r\n                                <Box sx={{display: 'flex', justifyContent: 'space-between'}}>\r\n                                    <Typography variant=\"body2\">{subscriptions.length}/{capacity}</Typography>\r\n                                </Box>\r\n                                <LinearProgress\r\n                                    variant=\"determinate\"\r\n                                    value={occupancyPercentage}\r\n                                    color={occupancyColor}\r\n                                    sx={{height: 8, borderRadius: 5}}\r\n                                />\r\n                            </Box>\r\n                        </Box>\r\n                    </AccordionSummary>\r\n                    <AccordionDetails>\r\n                        <MaterialReactTable table={list}/>\r\n                    </AccordionDetails>\r\n                </Accordion>\r\n            );\r\n        });\r\n    });\r\n    ListAccordions.displayName = \"ListAccordions\";\r\n    \r\n    // Handlers for actions\r\n    const handleMoveToList = (selectedRows, listId) => {\r\n        console.log(\"Moving selected rows to another list:\", selectedRows);\r\n        setSelectedRows(selectedRows);\r\n        setSelectedList(listId);\r\n        setMoveToListModalOpen(true);\r\n    };\r\n\r\n    const handleCloseMoveToListModal = (success) => {\r\n        if (success) {\r\n            setShowSuccessPopup({message: \"Spostamento effettuato con successo!\", state: \"success\"});\r\n            refreshEventData().then();\r\n        }\r\n        setMoveToListModalOpen(false);\r\n    }\r\n\r\n    const handleExportSelected = (selectedRows) => {\r\n        console.log(\"Exporting selected rows:\", selectedRows);\r\n        // Implement export logic here\r\n    };\r\n\r\n    return (\r\n        <Box>\r\n            <Sidebar/>\r\n            {eventModalOpen && <EventModal\r\n                open={eventModalOpen}\r\n                onClose={handleCloseEventModal}\r\n                event={{\r\n                    ...data,\r\n                    date: data.date ? dayjs(data.date) : null,\r\n                    subscription_start_date: data.subscription_start_date ? dayjs(data.subscription_start_date) : null,\r\n                    subscription_end_date: data.subscription_end_date ? dayjs(data.subscription_end_date) : null\r\n                }}\r\n                isEdit={true}\r\n            />}\r\n            {subscriptionModalOpen && <SubscriptionModal\r\n                open={subscriptionModalOpen}\r\n                onClose={handleCloseSubscriptionModal}\r\n                event={data}\r\n                listId={selectedList}\r\n                subscription={subscription}\r\n                isEdit={subscriptionIsEdit}\r\n            />}\r\n            {moveToListModalOpen && <MoveToListModal\r\n                open={moveToListModalOpen}\r\n                onClose={handleCloseMoveToListModal}\r\n                selectedRows={selectedRows}\r\n                event={data}\r\n                listId={selectedList}\r\n            />}\r\n            <Box sx={{mx: '5%'}}>\r\n                {isLoading ? <Loader/> : (<>\r\n                        <Box sx={{display: 'flex', alignItems: 'center', marginBottom: '20px'}}>\r\n                            <IconButton onClick={() => {\r\n                                navigate(-1);\r\n                            }} sx={{mr: 2}}><ArrowBackIcon/></IconButton>\r\n                            <EventIcon sx={{marginRight: '10px'}}/>\r\n                            <Typography variant=\"h4\">Evento - {data.name}</Typography>\r\n                        </Box>\r\n                        <Card elevation={3} sx={{mt: 5, mb: 4, borderRadius: 2, overflow: 'hidden'}}>\r\n                            <CardContent>\r\n                                <Grid container spacing={3}>\r\n                                    <Grid size={{xs: 12, md: 4}}>\r\n                                        <Box sx={{display: 'flex', alignItems: 'center'}}>\r\n                                            <CalendarTodayIcon sx={{color: 'primary.main', mr: 1}}/>\r\n                                            <Typography variant=\"h6\" component=\"div\">Data</Typography>\r\n                                        </Box>\r\n                                        <Typography variant=\"body1\" color=\"text.secondary\" sx={{mt: 2}}>\r\n                                            {data.date ? dayjs(data.date).format('DD/MM/YYYY') : 'Data non specificata'}\r\n                                        </Typography>\r\n                                    </Grid>\r\n                                    <Grid size={{xs: 12, md: 4}}>\r\n                                        <Box sx={{display: 'flex', alignItems: 'center'}}>\r\n                                            <EuroIcon sx={{color: 'primary.main', mr: 1}}/>\r\n                                            <Typography variant=\"h6\" component=\"div\">Costo</Typography>\r\n                                        </Box>\r\n                                        <Typography variant=\"body1\" color=\"text.secondary\" sx={{mt: 2}}>\r\n                                            {data.cost !== 0 ? `€ ${data.cost}` : 'Gratuito'}\r\n                                        </Typography>\r\n                                    </Grid>\r\n                                    <Grid size={{xs: 12, md: 4}}>\r\n                                        <Box sx={{display: 'flex', alignItems: 'center'}}>\r\n                                            <AdjustIcon sx={{color: 'primary.main', mr: 1}}/>\r\n                                            <Typography variant=\"h6\" component=\"div\">Periodo Iscrizioni</Typography>\r\n                                        </Box>\r\n                                        <Box sx={{display: 'flex', alignItems: 'center', mt: 2}}>\r\n                                            {handleSubscriptionStatus().chip}\r\n                                        </Box>\r\n                                    </Grid>\r\n                                    <Grid size={{xs: 12}}>\r\n                                        <Divider sx={{my: 1}}/>\r\n                                        <Box sx={{display: 'flex', alignItems: 'center', mt: 2}}>\r\n                                            <DescriptionIcon sx={{color: 'primary.main', mr: 1}}/>\r\n                                            <Typography variant=\"h6\" component=\"div\">Descrizione</Typography>\r\n                                        </Box>\r\n                                        <div data-color-mode=\"light\" style={{marginTop: 10}}>\r\n                                            <CustomEditor\r\n                                                value={data.description || 'Nessuna descrizione disponibile'}\r\n                                                readOnly={true}\r\n                                            />\r\n                                        </div>\r\n                                    </Grid>\r\n                                    <Grid size={{xs: 12}}>\r\n                                        <Divider sx={{my: 1}}/>\r\n                                        <Box sx={{display: 'flex', alignItems: 'center', mt: 2}}>\r\n                                            <EditIcon sx={{color: 'primary.main', mr: 1}}/>\r\n                                            <Typography variant=\"h6\" component=\"div\">Azioni</Typography>\r\n                                        </Box>\r\n                                        <Button sx={{mt: 2}} variant=\"contained\" color=\"primary\" onClick={handleOpenEventModal}>\r\n                                            Modifica Evento\r\n                                        </Button>\r\n                                    </Grid>\r\n                                    <Grid size={{xs: 12}}>\r\n                                        <Divider sx={{my: 1}}/>\r\n                                        <Box sx={{mt: 2}}>\r\n                                            <Typography variant=\"h6\" component=\"div\" sx={{mb: 2}}>Liste</Typography>\r\n                                            <ListAccordions/>\r\n                                        </Box>\r\n                                    </Grid>\r\n                                </Grid>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </>\r\n                )}\r\n                {showSuccessPopup && <Popup message={showSuccessPopup.message} state={showSuccessPopup.state}/>}\r\n            </Box>\r\n        </Box>\r\n    );\r\n}","import {useAuth} from \"../Context/AuthContext\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {useEffect} from \"react\";\r\n\r\nexport default function ProtectedRoute({children, requiredPermission}) {\r\n    const {accessToken, user, loading} = useAuth(); // assuming `loading` tracks auth check\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        if (!loading && (!accessToken || (requiredPermission && !user?.permissions.includes(requiredPermission)))) {\r\n            console.log(\"Redirecting to login...\");\r\n            navigate(\"/login\", {replace: true});\r\n        }\r\n    }, [loading, accessToken, user, requiredPermission, navigate]);\r\n\r\n    if (loading) {\r\n        return <div>Loading...</div>; // Prevent early rendering\r\n    }\r\n\r\n    if (!accessToken || (requiredPermission && !user?.permissions.includes(requiredPermission))) {\r\n        return null; // Prevent rendering children during navigation\r\n    }\r\n\r\n    return children;\r\n};","import {useState, useEffect} from 'react';\r\nimport {useParams} from 'react-router-dom';\r\nimport {Container, Typography, Box} from '@mui/material';\r\nimport {fetchCustom} from \"../api/api\";\r\nimport StatusBanner from '../components/StatusBanner';\r\nimport {extractErrorMessage} from \"../utils/errorHandling\";\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nexport default function EmailVerification() {\r\n    const {uid, token} = useParams();\r\n    const [statusMessage, setStatusMessage] = useState({\r\n        message: '',\r\n        state: 'loading'\r\n    });\r\n\r\n    useEffect(() => {\r\n        const verifyEmail = async () => {\r\n            try {\r\n                const response = await fetchCustom('GET', `/api/profile/verify-email/${uid}/${token}/`, null, {}, false);\r\n                const json = await response.json();\r\n                if (!response.ok) {\r\n                    const errorMessage = extractErrorMessage(json, response.status);\r\n                    setStatusMessage({message: errorMessage, state: 'error'});\r\n                } else {\r\n                    setStatusMessage({message: json.message, state: 'success'});\r\n                }\r\n            } catch (error) {\r\n                Sentry.captureException(error);\r\n                setStatusMessage({message: `General error: ${error}`, state: 'error'});\r\n            }\r\n        };\r\n\r\n        if (uid && token) verifyEmail().then();\r\n        else setStatusMessage({message: 'Invalid verification link', state: 'error'});\r\n    }, [uid, token]);\r\n\r\n    return (\r\n        <Container maxWidth=\"sm\">\r\n            <Box\r\n                sx={{\r\n                    mt: 8,\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    alignItems: 'center',\r\n                    textAlign: 'center',\r\n                    p: 3,\r\n                    borderRadius: 2,\r\n                    boxShadow: 3,\r\n                    bgcolor: 'background.paper'\r\n                }}\r\n            >\r\n                <Typography variant=\"h4\" component=\"h1\" gutterBottom>\r\n                    Email Verification\r\n                </Typography>\r\n\r\n                <StatusBanner\r\n                    message={statusMessage.message}\r\n                    state={statusMessage.state}\r\n                    loadingText=\"Verifying your email address...\"\r\n                />\r\n            </Box>\r\n        </Container>\r\n    );\r\n}","import {useState} from 'react';\r\nimport {useParams, useNavigate} from 'react-router-dom';\r\nimport {Container, TextField, Button, Box, Typography, Link} from '@mui/material';\r\nimport StatusBanner from '../Components/StatusBanner';\r\nimport logo from '../assets/esnpolimi-logo.png';\r\nimport {extractErrorMessage} from \"../utils/errorHandling\";\r\nimport {fetchCustom} from \"../api/api\";\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nexport default function ResetPassword() {\r\n    const {uid, token} = useParams();\r\n    const navigate = useNavigate();\r\n    const [password, setPassword] = useState('');\r\n    const [confirmPassword, setConfirmPassword] = useState('');\r\n    const [statusMessage, setStatusMessage] = useState(null);\r\n    const [isSubmitted, setSubmitted] = useState(false);\r\n\r\n    const handleResetPassword = async () => {\r\n        if (password !== confirmPassword) {\r\n            setStatusMessage({message: 'Le password non coincidono.', state: 'error'});\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await fetchCustom(\"POST\", `/api/reset-password/${uid}/${token}/`, {\r\n                password: password,\r\n                confirm_password: confirmPassword\r\n            }, {}, false);\r\n            if (response.ok) {\r\n                setSubmitted(true);\r\n                setStatusMessage({message: 'Password reimpostata con successo!', state: 'success'});\r\n            } else {\r\n                const json = await response.json();\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setStatusMessage({message: `Errore durante il reset della password: ${errorMessage}`, state: 'error'});\r\n            }\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setStatusMessage({message: `Errore generale: ${error}`, state: 'error'});\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Container maxWidth=\"xs\">\r\n            <Box\r\n                sx={{\r\n                    marginTop: 8,\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    alignItems: 'center',\r\n                }}>\r\n                <img alt='' src={logo || ''} style={{height: '25vh'}}/>\r\n                <Typography style={{marginTop: 10}} variant=\"h5\">Reimposta Password</Typography>\r\n                {statusMessage && <StatusBanner message={statusMessage.message} state={statusMessage.state}/>}\r\n                {!isSubmitted && (<>\r\n                    <TextField\r\n                        margin=\"normal\"\r\n                        required\r\n                        fullWidth\r\n                        label=\"Nuova Password\"\r\n                        type=\"password\"\r\n                        onChange={(e) => setPassword(e.target.value)}/>\r\n                    <TextField\r\n                        margin=\"normal\"\r\n                        required\r\n                        fullWidth\r\n                        label=\"Conferma Password\"\r\n                        type=\"password\"\r\n                        onChange={(e) => setConfirmPassword(e.target.value)}/>\r\n                    <Button\r\n                        fullWidth\r\n                        variant=\"contained\"\r\n                        sx={{mt: 3, mb: 2}}\r\n                        onClick={handleResetPassword}>\r\n                        Reimposta Password\r\n                    </Button>\r\n                </>)}\r\n                {isSubmitted && (\r\n                    <Link\r\n                        component=\"button\"\r\n                        variant=\"body2\"\r\n                        sx={{textAlign: 'center'}}\r\n                        onClick={() => navigate('/login')}>\r\n                        Vai al Login\r\n                    </Link>\r\n                )}\r\n            </Box>\r\n        </Container>\r\n    );\r\n}\r\n","import {useState, useEffect} from 'react';\r\nimport {\r\n    Modal, Box, Typography, Grid, IconButton, TextField, Button,\r\n    FormControl, InputLabel, Select, MenuItem, OutlinedInput, FormHelperText\r\n} from '@mui/material';\r\nimport CloseIcon from '@mui/icons-material/Close';\r\nimport {styleESNcardModal as style} from '../../utils/sharedStyles';\r\nimport Loader from '../Loader';\r\nimport Popup from '../Popup';\r\nimport {fetchCustom} from '../../api/api';\r\nimport {extractErrorMessage} from '../../utils/errorHandling';\r\nimport {transactionDisplayNames as names} from '../../utils/displayAttributes';\r\nimport ProfileSearch from '../ProfileSearch';\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nexport default function TransactionModal({open, onClose, transaction}) {\r\n    const [isLoading, setLoading] = useState(true);\r\n    const [accounts, setAccounts] = useState([]);\r\n    const [successPopup, setSuccessPopup] = useState(null);\r\n\r\n    const [data, setData] = useState({\r\n        executor: null,\r\n        account: '',\r\n        amount: '',\r\n        description: '',\r\n        type: '',\r\n    });\r\n\r\n    const [errors, setErrors] = useState({\r\n        executor: [false, ''],\r\n        account: [false, ''],\r\n        amount: [false, ''],\r\n        description: [false, ''],\r\n    });\r\n\r\n    useEffect(() => {\r\n        console.log('TransactionModal useEffect', transaction);\r\n        setLoading(true);\r\n        Promise.all([fetchCustom('GET', '/accounts/')])\r\n            .then(async ([accRes]) => {\r\n                const accJson = accRes.ok ? await accRes.json() : {results: []};\r\n                setAccounts(accJson.results || []);\r\n                if (transaction) {\r\n                    setData({\r\n                        executor: transaction.executor || null,\r\n                        account: transaction.account?.id || '',\r\n                        amount: transaction.amount || '',\r\n                        description: transaction.description || '',\r\n                        type: transaction.type || '',\r\n                    });\r\n                }\r\n            }).finally(() => setLoading(false));\r\n    }, [open, transaction]);\r\n\r\n    const handleInputChange = (e) => {\r\n        const {name, value} = e.target;\r\n        setData(prev => ({...prev, [name]: value}));\r\n    };\r\n\r\n    const validate = () => {\r\n        let hasError = false;\r\n        const newErrors = {...errors};\r\n        if (!data.executor) {\r\n            newErrors.executor = [true, 'Seleziona un Esecutore'];\r\n            hasError = true;\r\n        } else newErrors.executor = [false, ''];\r\n        if (!data.account) {\r\n            newErrors.account = [true, 'Seleziona una Cassa'];\r\n            hasError = true;\r\n        } else newErrors.account = [false, ''];\r\n        if (!data.amount || isNaN(Number(data.amount))) {\r\n            newErrors.amount = [true, 'Inserisci un importo valido'];\r\n            hasError = true;\r\n        } else newErrors.amount = [false, ''];\r\n        setErrors(newErrors);\r\n        return !hasError;\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (!validate()) return;\r\n        setLoading(true);\r\n        try {\r\n            const payload = {\r\n                executor: data.executor.id || data.executor.email,\r\n                account: data.account,\r\n                amount: parseFloat(data.amount),\r\n                description: data.description,\r\n            };\r\n            const response = await fetchCustom('PATCH', `/transaction/${transaction.id}/`, payload);\r\n            if (!response.ok) {\r\n                const json = await response.json();\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setSuccessPopup({message: `Errore: ${errorMessage}`, state: 'error'});\r\n            } else onClose(true);\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setSuccessPopup({message: `Errore generale: ${error}`, state: 'error'});\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleClose = () => onClose(false);\r\n\r\n    return (\r\n        <Modal open={open} onClose={handleClose}>\r\n            <Box sx={style} component=\"form\" onSubmit={handleSubmit} noValidate>\r\n                {isLoading ? <Loader/> : (<>\r\n                    <Box sx={{display: 'flex', justifyContent: 'flex-end', mb: -2}}>\r\n                        <IconButton onClick={handleClose} sx={{minWidth: 0}}><CloseIcon/></IconButton>\r\n                    </Box>\r\n                    <Typography variant=\"h5\" gutterBottom align=\"center\" sx={{mb: 2}}>\r\n                        Modifica Transazione\r\n                    </Typography>\r\n                    {successPopup && <Popup message={successPopup.message} state={successPopup.state}/>}\r\n                    <Grid container spacing={2} sx={{mt: 2}}>\r\n                        <Typography variant=\"subtitle1\" gutterBottom>\r\n                            <b>Tipo:</b> {names.tran_type[data.type] || 'Non specificato'}\r\n                        </Typography>\r\n                        <Grid size={{xs: 12}}>\r\n                            <ProfileSearch\r\n                                value={data.executor}\r\n                                onChange={(event, newValue) => {\r\n                                    setData({...data, executor: newValue});\r\n                                }}\r\n                                error={errors.executor[0]}\r\n                                helperText={errors.executor[0] ? errors.executor[1] : 'Cerca per nome o numero ESNcard'}\r\n                                label={names.executor}\r\n                                esner_only={true}\r\n                                required\r\n                            />\r\n                        </Grid>\r\n                        <Grid size={{xs: 12}}>\r\n                            <FormControl fullWidth required error={errors.account[0]}>\r\n                                <InputLabel id=\"account-label\">{names.account}</InputLabel>\r\n                                <Select\r\n                                    labelId=\"account-label\"\r\n                                    name=\"account\"\r\n                                    variant=\"outlined\"\r\n                                    value={data.account}\r\n                                    onChange={handleInputChange}\r\n                                    input={<OutlinedInput label={names.account}/>}>\r\n                                    {accounts.map(acc => (\r\n                                        <MenuItem key={acc.id} value={acc.id}>{acc.name}</MenuItem>\r\n                                    ))}\r\n                                </Select>\r\n                                {errors.account[0] && <FormHelperText>{errors.account[1]}</FormHelperText>}\r\n                            </FormControl>\r\n                        </Grid>\r\n                        <Grid size={{xs: 12}}>\r\n                            <TextField\r\n                                label={names.amount}\r\n                                name=\"amount\"\r\n                                value={data.amount}\r\n                                onChange={handleInputChange}\r\n                                required\r\n                                fullWidth\r\n                                error={errors.amount[0]}\r\n                                type=\"number\"\r\n                                slotProps={{htmlInput: {min: \"0.01\", step: \"0.01\"}}}\r\n                            />\r\n                        </Grid>\r\n                        <Grid size={{xs: 12}}>\r\n                            <TextField\r\n                                label=\"Descrizione\"\r\n                                name=\"description\"\r\n                                value={data.description}\r\n                                onChange={handleInputChange}\r\n                                fullWidth\r\n                                multiline\r\n                                rows={3}\r\n                            />\r\n                        </Grid>\r\n                    </Grid>\r\n                    <Box mt={2}>\r\n                        <Button fullWidth variant=\"contained\" color=\"primary\" type=\"submit\">\r\n                            Salva Modifiche\r\n                        </Button>\r\n                    </Box>\r\n                </>)}\r\n            </Box>\r\n        </Modal>\r\n    );\r\n}","import {useState, useEffect, useMemo, useRef} from 'react';\r\nimport {Box, Typography, FormControl, InputLabel, Select, MenuItem, OutlinedInput, Grid, IconButton, Chip, Button} from '@mui/material';\r\nimport Sidebar from '../../Components/Sidebar.jsx';\r\nimport Loader from '../../Components/Loader';\r\nimport {fetchCustom} from '../../api/api';\r\nimport {MaterialReactTable, useMaterialReactTable} from 'material-react-table';\r\nimport {MRT_Localization_IT} from 'material-react-table/locales/it';\r\nimport {transactionDisplayNames as names} from '../../utils/displayAttributes';\r\nimport ArrowBackIcon from \"@mui/icons-material/ArrowBack\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {DatePicker, LocalizationProvider} from '@mui/x-date-pickers';\r\nimport {AdapterDateFns} from '@mui/x-date-pickers/AdapterDateFns';\r\nimport itLocale from 'date-fns/locale/it';\r\nimport SearchIcon from '@mui/icons-material/Search';\r\nimport ClearIcon from '@mui/icons-material/Clear';\r\nimport TransactionModal from \"../../Components/treasury/TransactionModal.jsx\";\r\nimport Popup from \"../../Components/Popup\";\r\n\r\n\r\nconst TRANSACTION_CONFIGS = {\r\n    subscription: {label: names.tran_type[\"subscription\"], color: 'primary'},\r\n    esncard: {label: names.tran_type[\"esncard\"], color: 'secondary'},\r\n    deposit: {label: names.tran_type[\"deposit\"], color: 'success'},\r\n    withdrawal: {label: names.tran_type[\"withdrawal\"], color: 'error'}\r\n};\r\n\r\n// For the filter dropdown\r\nconst transactionTypes = [\r\n    {value: '', label: 'Tutti'},\r\n    ...Object.entries(TRANSACTION_CONFIGS).map(([value, config]) => ({\r\n        value,\r\n        label: config.label,\r\n        color: config.color\r\n    }))\r\n];\r\n\r\nexport default function TransactionsList() {\r\n    const [isLoading, setLoading] = useState(true);\r\n    const [transactions, setTransactions] = useState([]);\r\n    const [accounts, setAccounts] = useState([]);\r\n    const navigate = useNavigate();\r\n    const [showSuccessPopup, setShowSuccessPopup] = useState(null);\r\n    const [transactionModalOpen, setTransactionModalOpen] = useState(false);\r\n    const [selectedTransaction, setSelectedTransaction] = useState(null);\r\n    const [pagination, setPagination] = useState({pageIndex: 0, pageSize: 10});\r\n    const [rowCount, setRowCount] = useState(0);\r\n\r\n    const [filters, setFilters] = useState({\r\n        account: [],\r\n        type: [],\r\n        dateFrom: null,\r\n        dateTo: null,\r\n    });\r\n    const [search, setSearch] = useState('');\r\n    const [appliedSearch, setAppliedSearch] = useState('');\r\n    const searchInputRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        refreshTransactionsData().then();\r\n    }, [pagination.pageIndex, pagination.pageSize, filters, appliedSearch]);\r\n\r\n    const refreshTransactionsData = async () => {\r\n        setLoading(true);\r\n        try {\r\n            // Build query params for pagination, search, and filters\r\n            const params = new URLSearchParams();\r\n            params.append('page', pagination.pageIndex + 1);\r\n            params.append('page_size', pagination.pageSize);\r\n            if (appliedSearch) params.append('search', appliedSearch);\r\n            if (filters.account.length)\r\n                filters.account.forEach(acc => params.append('account', acc));\r\n            if (filters.type.length)\r\n                filters.type.forEach(t => params.append('type', t));\r\n            if (filters.dateFrom)\r\n                params.append('dateFrom', filters.dateFrom.toISOString());\r\n            if (filters.dateTo)\r\n                params.append('dateTo', filters.dateTo.toISOString());\r\n            const [txRes, accRes] = await Promise.all([\r\n                fetchCustom('GET', `/transactions/?${params.toString()}`),\r\n                fetchCustom('GET', '/accounts/')\r\n            ]);\r\n            const txJson = txRes.ok ? await txRes.json() : {results: []};\r\n            const accJson = accRes.ok ? await accRes.json() : {results: []};\r\n            setRowCount(txJson.count || 0);\r\n            setTransactions(txJson.results || []);\r\n            setAccounts(accJson.results || []);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const columns = useMemo(() => [\r\n        {\r\n            accessorKey: 'created_at', header: names.date, size: 120,\r\n            Cell: ({cell}) => {\r\n                const date = new Date(cell.getValue());\r\n                return new Intl.DateTimeFormat('it-IT', {\r\n                    dateStyle: 'medium',\r\n                    timeStyle: 'short',\r\n                }).format(date);\r\n            }\r\n        },\r\n        {\r\n            accessorKey: 'type', header: names.type, size: 100,\r\n            Cell: ({cell}) => {\r\n                const type = cell.getValue();\r\n                const config = TRANSACTION_CONFIGS[type] || {label: 'Sconosciuto', color: 'default'};\r\n                return (\r\n                    <Chip\r\n                        label={config.label}\r\n                        color={config.color}\r\n                        variant=\"outlined\"\r\n                    />\r\n                );\r\n            }\r\n        },\r\n        {accessorKey: 'executor.name', header: names.executor, size: 150},\r\n        {\r\n            accessorKey: 'account.name',\r\n            header: names.account,\r\n            size: 120,\r\n            Cell: ({cell}) => (\r\n                <Box component=\"span\" fontWeight=\"bold\">\r\n                    {cell.getValue()}\r\n                </Box>\r\n            ),\r\n        },\r\n        {\r\n            accessorKey: 'amount', header: names.amount, size: 100,\r\n            Cell: ({cell}) => (\r\n                <Box>\r\n                    {cell.getValue() !== null ? (\r\n                        <Chip label={`€${cell.getValue()}`} color=\"primary\"/>) : (\r\n                        <Chip label=\"N/A\" color=\"warning\"/>)}\r\n                </Box>\r\n            ),\r\n        },\r\n        {\r\n            accessorKey: 'description',\r\n            header: names.description,\r\n            size: 200,\r\n            Cell: ({cell}) => (\r\n                <Box component=\"span\" fontStyle=\"italic\">\r\n                    {cell.getValue()}\r\n                </Box>\r\n            ),\r\n        },\r\n    ], []);\r\n\r\n    const table = useMaterialReactTable({\r\n        columns,\r\n        data: transactions,\r\n        enableStickyHeader: true,\r\n        enableStickyFooter: true,\r\n        enableColumnFilters: false, // Disable MUI filters, because they only search in the current page\r\n        enableColumnOrdering: true,\r\n        enableGrouping: true,\r\n        enableFacetedValues: true,\r\n        enableRowActions: false,\r\n        enableRowSelection: false,\r\n        enableExpandAll: false,\r\n        initialState: {\r\n            showColumnFilters: false,\r\n            showGlobalFilter: true,\r\n            columnPinning: {\r\n                left: ['mrt-row-expand', 'mrt-row-select'],\r\n                right: ['mrt-row-actions'],\r\n            },\r\n            sorting: [{id: 'created_at', desc: true}],\r\n        },\r\n        paginationDisplayMode: 'pages',\r\n        positionToolbarAlertBanner: 'bottom',\r\n        enableGlobalFilter: false,\r\n        muiPaginationProps: {\r\n            color: 'secondary',\r\n            rowsPerPageOptions: [10, 20, 30],\r\n            shape: 'rounded',\r\n            variant: 'outlined',\r\n        },\r\n        manualPagination: true,\r\n        rowCount,\r\n        onPaginationChange: setPagination,\r\n        state: {pagination},\r\n        localization: MRT_Localization_IT,\r\n        muiTableBodyRowProps: ({row}) => ({\r\n            onClick: () => {\r\n                setSelectedTransaction(row.original);\r\n                setTransactionModalOpen(true);\r\n            },\r\n            sx: {cursor: 'pointer'},\r\n        })\r\n    });\r\n\r\n    const handleSearchApply = () => {\r\n        setAppliedSearch(search);\r\n        setPagination(prev => ({...prev, pageIndex: 0}));\r\n    };\r\n\r\n    const handleSearchClear = () => {\r\n        setSearch('');\r\n        setAppliedSearch('');\r\n        setPagination(prev => ({...prev, pageIndex: 0}));\r\n        if (searchInputRef.current) searchInputRef.current.focus();\r\n    };\r\n\r\n    const handleCloseTransactionModal = async (success) => {\r\n        if (success) {\r\n            setShowSuccessPopup({message: \"Transazione modificata con successo!\", state: \"success\"});\r\n            await refreshTransactionsData();\r\n        }\r\n        setSelectedTransaction(null);\r\n        setTransactionModalOpen(false);\r\n    };\r\n\r\n    const handleDateChange = (name, value) => {\r\n        setFilters(prev => {\r\n            let newFilters = {...prev, [name]: value};\r\n            // Prevent invalid date ranges\r\n            if (name === 'dateFrom' && newFilters.dateTo && value && value > newFilters.dateTo)\r\n                newFilters.dateTo = value;\r\n            if (name === 'dateTo' && newFilters.dateFrom && value && value < newFilters.dateFrom)\r\n                newFilters.dateFrom = value;\r\n            return newFilters;\r\n        });\r\n    };\r\n\r\n    const handleFilterChange = (e) => {\r\n        const {name, value} = e.target;\r\n        setFilters(prev => {\r\n            let newFilters = {...prev, [name]: value};\r\n            // For multi-selects\r\n            if (name === 'account' || name === 'type') {\r\n                newFilters[name] = typeof value === 'string' ? value.split(',') : value;\r\n            }\r\n            return newFilters;\r\n        });\r\n    };\r\n\r\n    const handleClearDates = () => {\r\n        setFilters(prev => ({\r\n            ...prev,\r\n            dateFrom: null,\r\n            dateTo: null,\r\n        }));\r\n    };\r\n\r\n    return (\r\n        <Box>\r\n            <Sidebar/>\r\n            {transactionModalOpen && <TransactionModal\r\n                open={transactionModalOpen}\r\n                onClose={handleCloseTransactionModal}\r\n                transaction={selectedTransaction}\r\n            />}\r\n            <Box sx={{mx: '5%'}}>\r\n                <Box sx={{display: 'flex', alignItems: 'center', marginBottom: '20px'}}>\r\n                    <IconButton onClick={() => navigate(-1)} sx={{mr: 2}}><ArrowBackIcon/></IconButton>\r\n                    <Typography variant=\"h4\">Lista Transazioni</Typography>\r\n                </Box>\r\n                <Grid container spacing={2} sx={{mb: 2, mt: 4}} alignItems=\"center\">\r\n                    <Grid size={{xs: 12, sm: 2}}>\r\n                        <FormControl fullWidth>\r\n                            <InputLabel id=\"account-label\">Cassa</InputLabel>\r\n                            <Select\r\n                                labelId=\"account-label\"\r\n                                name=\"account\"\r\n                                multiple\r\n                                value={filters.account}\r\n                                onChange={handleFilterChange}\r\n                                input={<OutlinedInput label=\"Cassa\"/>}\r\n                                variant=\"outlined\"\r\n                                renderValue={(selected) =>\r\n                                    accounts.filter(acc => selected.includes(acc.id)).map(acc => acc.name).join(', ')\r\n                                }>\r\n                                {accounts.map(acc => (\r\n                                    <MenuItem key={acc.id} value={acc.id}>{acc.name}</MenuItem>\r\n                                ))}\r\n                            </Select>\r\n                        </FormControl>\r\n                    </Grid>\r\n                    <Grid size={{xs: 12, sm: 2}}>\r\n                        <FormControl fullWidth>\r\n                            <InputLabel id=\"type-label\">Tipo</InputLabel>\r\n                            <Select\r\n                                labelId=\"type-label\"\r\n                                name=\"type\"\r\n                                multiple\r\n                                value={filters.type}\r\n                                onChange={handleFilterChange}\r\n                                input={<OutlinedInput label=\"Tipo\"/>}\r\n                                variant=\"outlined\"\r\n                                renderValue={(selected) =>\r\n                                    transactionTypes.filter(t => selected.includes(t.value) && t.value).map(t => t.label).join(', ')\r\n                                }>\r\n                                {transactionTypes.filter(t => t.value).map(t => (\r\n                                    <MenuItem key={t.value} value={t.value}>{t.label}</MenuItem>\r\n                                ))}\r\n                            </Select>\r\n                        </FormControl>\r\n                    </Grid>\r\n                    <Grid size={{xs: 12, sm: 2}}>\r\n                        <FormControl fullWidth>\r\n                            <LocalizationProvider dateAdapter={AdapterDateFns} adapterLocale={itLocale}>\r\n                                <DatePicker\r\n                                    label=\"Da\"\r\n                                    value={filters.dateFrom}\r\n                                    maxDate={filters.dateTo || undefined}\r\n                                    onChange={date => handleDateChange('dateFrom', date)}\r\n                                    format=\"d MMM yyyy\"/>\r\n                            </LocalizationProvider>\r\n                        </FormControl>\r\n                    </Grid>\r\n                    <Grid size={{xs: 12, sm: 2}}>\r\n                        <FormControl fullWidth>\r\n                            <LocalizationProvider dateAdapter={AdapterDateFns} adapterLocale={itLocale}>\r\n                                <DatePicker\r\n                                    label=\"A\"\r\n                                    value={filters.dateTo}\r\n                                    minDate={filters.dateFrom || undefined}\r\n                                    onChange={date => handleDateChange('dateTo', date)}\r\n                                    format=\"d MMM yyyy\"/>\r\n                            </LocalizationProvider>\r\n                        </FormControl>\r\n                    </Grid>\r\n                    {(filters.dateFrom || filters.dateTo) && (\r\n                        <Grid size={{xs: 12, sm: 2}} sx={{display: 'flex', alignItems: 'center'}}>\r\n                            <Button\r\n                                variant=\"outlined\"\r\n                                color=\"secondary\"\r\n                                startIcon={<ClearIcon/>}\r\n                                onClick={handleClearDates}\r\n                                sx={{height: '100%', minWidth: 0, px: 1}}>\r\n                                Azzera date\r\n                            </Button>\r\n                        </Grid>\r\n                    )}\r\n                    <Grid size={{xs: 12, sm: 2}} sx={{ml: 'auto'}}>\r\n                        <FormControl fullWidth>\r\n                            <OutlinedInput\r\n                                inputRef={searchInputRef}\r\n                                size=\"small\"\r\n                                placeholder=\"Cerca\"\r\n                                value={search}\r\n                                onChange={e => setSearch(e.target.value)}\r\n                                onKeyDown={e => {\r\n                                    if (e.key === 'Enter') handleSearchApply();\r\n                                }}\r\n                                endAdornment={\r\n                                    search && appliedSearch === search ? (\r\n                                        <IconButton\r\n                                            aria-label=\"clear\"\r\n                                            onClick={handleSearchClear}\r\n                                            edge=\"end\">\r\n                                            <ClearIcon/>\r\n                                        </IconButton>\r\n                                    ) : (\r\n                                        <IconButton\r\n                                            aria-label=\"search\"\r\n                                            onClick={handleSearchApply}\r\n                                            edge=\"end\">\r\n                                            <SearchIcon/>\r\n                                        </IconButton>\r\n                                    )\r\n                                }\r\n                            />\r\n                        </FormControl>\r\n                    </Grid>\r\n                </Grid>\r\n                {isLoading ? <Loader/> : <MaterialReactTable sx={{mt: 2}} table={table}/>}\r\n                {showSuccessPopup && <Popup message={showSuccessPopup.message} state={showSuccessPopup.state}/>}\r\n            </Box>\r\n        </Box>\r\n    );\r\n}\r\n\r\n","import {useState} from 'react';\r\nimport {CircularProgress, IconButton, Box} from '@mui/material';\r\nimport EditIcon from '@mui/icons-material/Edit';\r\nimport SaveIcon from '@mui/icons-material/Save';\r\nimport CancelIcon from '@mui/icons-material/Cancel';\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nconst EditButton = ({onEdit, onCancel, onSave, saving}) => {\r\n    const [loading, setLoading] = useState(false);\r\n    const [isEditing, setIsEditing] = useState(false);\r\n\r\n    const handleEditClick = () => {\r\n        setIsEditing(true);\r\n        if (onEdit) onEdit();\r\n    };\r\n\r\n    const handleCancelClick = () => {\r\n        if (!saving) {\r\n            setIsEditing(false);\r\n            if (onCancel) onCancel();\r\n        }\r\n    };\r\n\r\n    const handleSaveClick = async () => {\r\n        setLoading(true);\r\n        try {\r\n            if (onSave) {\r\n                const result = await onSave();\r\n                if (result !== false) setIsEditing(false);\r\n            } else setIsEditing(false);\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            {isEditing ? (\r\n                <Box sx={{display: 'inline-flex'}}>\r\n                    <IconButton onClick={handleCancelClick} aria-label=\"Cancel\" disabled={saving || loading}>\r\n                        <CancelIcon/>\r\n                    </IconButton>\r\n                    {saving || loading ? (\r\n                        <IconButton disabled>\r\n                            <CircularProgress size='1rem'/>\r\n                        </IconButton>\r\n                    ) : (\r\n                        <IconButton onClick={handleSaveClick} aria-label=\"Save\" sx={{color: '#0288d1'}}>\r\n                            <SaveIcon/>\r\n                        </IconButton>\r\n                    )}\r\n                </Box>\r\n            ) : (\r\n                <IconButton onClick={handleEditClick} aria-label=\"Edit\">\r\n                    <EditIcon/>\r\n                </IconButton>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default EditButton;\r\n","import {useState, useMemo, useEffect} from 'react';\r\nimport {useMaterialReactTable, MaterialReactTable} from 'material-react-table';\r\nimport {Box, Button, IconButton, Tooltip} from '@mui/material';\r\nimport EditIcon from '@mui/icons-material/Edit';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport AddCircleOutlineIcon from '@mui/icons-material/AddCircleOutline';\r\nimport {MRT_Localization_IT} from 'material-react-table/locales/it';\r\n\r\n/*  The save function must receive as parameter the row object. \r\n    It must return true if creating was successful, false otherwise.\r\n    Same goes for the create function.\r\n*/\r\n\r\nexport default function CrudTable({cols, initialData, title, onSave, onDelete, onCreate, createText, canCreate, canDelete, canEdit, sortColumn}) {\r\n    const columns = useMemo(() => cols, [cols]);\r\n    const [data, setData] = useState([])\r\n    const canEditText = <span style={{color: 'green'}}>(Hai i permessi per eseguire modifiche)</span>;\r\n    const cannotEditText = <span style={{color: 'red'}}>(Non hai i permessi per eseguire modifiche)</span>;\r\n    const editText = canEdit ? canEditText : cannotEditText;\r\n\r\n    useEffect(() => {\r\n        setData(initialData);\r\n    }, [initialData]);\r\n\r\n    const table = useMaterialReactTable({\r\n        columns,\r\n        data: data,\r\n        enableEditing: canEdit,\r\n        editDisplayMode: 'row',\r\n        createDisplayMode: 'row',\r\n        enableColumnFilters: false,\r\n        enableGlobalFilter: false,\r\n        enableSorting: sortColumn != null,\r\n        enableFullScreenToggle: false,\r\n        enableColumnOrdering: false,\r\n        enableColumnActions: false,\r\n        enableDensityToggle: false,\r\n        enableHiding: false,\r\n        enablePagination: false,\r\n        localization: MRT_Localization_IT,\r\n        initialState: {\r\n            sorting: [{id: sortColumn, desc: true}],\r\n        },\r\n        onCreatingRowSave:\r\n            async ({values, table}) => {\r\n                let new_doc = await onCreate(values);\r\n                if (new_doc) {\r\n                    setData([...data, new_doc]);\r\n                    table.setCreatingRow(false);\r\n                }\r\n            },\r\n        onEditingRowSave:\r\n            async ({row, values}) => {\r\n                if (await onSave(row.original, values)) {\r\n                    const updatedData = data.map((item, index) =>\r\n                        index === row.index ? {...row.original, ...values} : item\r\n                    );\r\n                    setData(updatedData);\r\n                    console.log(updatedData);\r\n                    table.setEditingRow(null);\r\n                }\r\n            },\r\n        getRowId: (row) => row.id,\r\n        renderRowActions:\r\n            ({row, table}) => {\r\n                return (\r\n                    <Box sx={{display: 'flex'}}>\r\n                        <Tooltip title=\"Modifica\">\r\n                            <IconButton onClick={() => table.setEditingRow(row)}>\r\n                                <EditIcon/>\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                        {canDelete && (\r\n                            <Tooltip title=\"Elimina\">\r\n                                <IconButton onClick={async () => {\r\n                                    await onDelete(row.original);\r\n                                    setData(data.filter(item => item.id !== row.id));\r\n                                }}> <DeleteIcon/>\r\n                                </IconButton>\r\n                            </Tooltip>\r\n                        )}\r\n                    </Box>\r\n                );\r\n            },\r\n\r\n        renderTopToolbarCustomActions:\r\n            ({table}) => {\r\n                return (\r\n                    <Box sx={{display: 'flex', alignItems: 'center', width: '100%'}}>\r\n                        <Box sx={{ml: 3}}>\r\n                            <h3>{title}</h3>\r\n                            <h5>{editText}</h5>\r\n                        </Box>\r\n                        {createText != null ? (\r\n                            <Button variant=\"contained\" color=\"primary\" onClick={onCreate}\r\n                                    sx={{ml: 'auto', mr: 2, visibility: canCreate ? 'visible' : 'hidden'}}>\r\n                                {createText}\r\n                            </Button>\r\n                        ) : (\r\n                            <IconButton\r\n                                sx={{ml: 'auto', mr: 2, visibility: canCreate ? 'visible' : 'hidden'}}\r\n                                onClick={() => {\r\n                                    table.setCreatingRow(true);\r\n                                }}>\r\n                                <AddCircleOutlineIcon/>\r\n                            </IconButton>\r\n                        )}\r\n                    </Box>\r\n                );\r\n            },\r\n    })\r\n\r\n    return (<MaterialReactTable table={table}/>);\r\n};","import {useEffect, useState} from \"react\";\r\nimport {Button, Box, Divider, FormControl, InputLabel, MenuItem, Modal, Select, Typography, TextField, FormHelperText, IconButton, Grid} from '@mui/material';\r\nimport CloseIcon from '@mui/icons-material/Close';\r\nimport {fetchCustom} from \"../../api/api\";\r\nimport {styleESNcardModal as style} from \"../../utils/sharedStyles\";\r\nimport Popup from \"../Popup\";\r\nimport ConfirmDialog from \"../ConfirmDialog\";\r\nimport {extractErrorMessage} from \"../../utils/errorHandling\";\r\nimport Loader from \"../Loader\";\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nexport default function ESNcardEmissionModal({open, profile, onClose}) {\r\n    const [amount, setAmount] = useState(0);\r\n    const [successPopup, setSuccessPopup] = useState(null);\r\n    const [confirmDialog, setConfirmDialog] = useState({open: false, action: null, message: ''});\r\n    const [isLoading, setLoading] = useState(true);\r\n    const [accounts, setAccounts] = useState([]);\r\n\r\n    const [data, setData] = useState({  /* profile fields */\r\n        esncard_number: '',\r\n        account_id: ''\r\n    });\r\n\r\n    const [errors, setErrors] = useState({  /* validation errors */\r\n        esncard_number: [false, ''],\r\n        account_id: [false, '']\r\n    });\r\n\r\n    const fieldsToValidate = [\r\n        {field: 'esncard_number', value: data.esncard_number, message: \"Inserire il numero di ESNcard\"},\r\n        {field: 'account_id', value: data.account_id, message: \"Selezionare una Cassa\"}\r\n    ];\r\n\r\n    useEffect(() => {\r\n        setLoading(true);\r\n        fetchAccounts().then();\r\n        retrieveFees().then();\r\n    }, []);\r\n\r\n    const retrieveFees = async () => {\r\n        try {\r\n            const response = await fetchCustom(\"GET\", '/esncard_fees/');\r\n            const json = await response.json();\r\n            if (!response.ok) {\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setSuccessPopup({message: `Errore fees ESNcard: ${errorMessage}`, state: 'error'});\r\n            } else {\r\n                console.log(\"ESNcard fees:\", json);\r\n                if (profile.latest_esncard && profile.latest_esncard?.is_valid)\r\n                    setAmount(parseFloat(json.esncard_lost_fee.replace('€', '')));\r\n                else\r\n                    setAmount(parseFloat(json.esncard_release_fee.replace('€', '')));\r\n            }\r\n        } catch (error) {\r\n    Sentry.captureException(error);\r\n            setSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const fetchAccounts = async () => {\r\n        try {\r\n            const response = await fetchCustom(\"GET\", \"/accounts/\");\r\n            const json = await response.json();\r\n            if (response.ok) setAccounts(json.results);\r\n            else {\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setSuccessPopup({message: `Errore durante il recupero delle casse: ${errorMessage}`, state: \"error\"});\r\n            }\r\n        } catch (error) {\r\n    Sentry.captureException(error);\r\n            setSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n        }\r\n    }\r\n\r\n    const resetErrors = () => {\r\n        const resetObj = {};\r\n        Object.keys(errors).forEach(key => {\r\n            resetObj[key] = [false, ''];\r\n        });\r\n        setErrors(resetObj);\r\n        return resetObj;\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        let hasErrors = false;\r\n        const newErrors = resetErrors();\r\n        fieldsToValidate.forEach(item => {\r\n            if (!item.value) {\r\n                newErrors[item.field] = [true, item.message];\r\n                hasErrors = true;\r\n            }\r\n        });\r\n\r\n        if (hasErrors) {\r\n            setErrors(newErrors);\r\n            return;\r\n        }\r\n\r\n        let msg = 'Confermi un pagamento di ' + amount + '€ per l\\'emissione della ESNcard?';\r\n        setConfirmDialog({open: true, action: () => doSubmit(), message: msg});\r\n    }\r\n\r\n    const doSubmit = async () => {\r\n        setConfirmDialog({open: false, action: null, message: ''});\r\n        try {\r\n            const response = await fetchCustom(\"POST\", '/esncard_emission/', {\r\n                profile_id: profile.id,\r\n                account_id: data.account_id,\r\n                esncard_number: data.esncard_number,\r\n                amount: amount\r\n            });\r\n            if (!response.ok) {\r\n                const json = await response.json();\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setSuccessPopup({message: `Errore durante l'emissione della ESNcard: ${errorMessage}`, state: 'error'});\r\n            } else onClose(true);\r\n        } catch (error) {\r\n    Sentry.captureException(error);\r\n            setSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n        }\r\n    }\r\n\r\n    const handleChange = (e) => {\r\n        setData({\r\n            ...data,\r\n            [e.target.name]: e.target.value,\r\n        });\r\n    };\r\n\r\n    return (\r\n        <Modal\r\n            open={open}\r\n            onClose={() => {\r\n                onClose(false);\r\n            }}\r\n            aria-labelledby=\"modal-modal-title\"\r\n            aria-describedby=\"modal-modal-description\">\r\n            <Box sx={style}>\r\n                {isLoading ? <Loader/> : (<>\r\n                        <Box sx={{display: 'flex', justifyContent: 'flex-end', mb: -2}}>\r\n                            <IconButton onClick={() => onClose(false)} sx={{minWidth: 0}}><CloseIcon/></IconButton>\r\n                        </Box>\r\n                        <Typography variant=\"h4\" component=\"h2\" gutterBottom>Emissione ESNcard</Typography>\r\n                        <Divider sx={{mb: 2}}/>\r\n                        <Typography variant=\"subtitle1\" gutterBottom><b>A:</b> {profile.name} {profile.surname}</Typography>\r\n                        <Typography variant=\"subtitle1\" gutterBottom><b>Importo:</b> {amount}€</Typography>\r\n\r\n                        <Grid container spacing={2} direction=\"column\">\r\n                            <Grid size={{xs: 12}} sx={{mt: 2}}>\r\n                                <TextField\r\n                                    required\r\n                                    label='Numero ESNcard'\r\n                                    name='esncard_number'\r\n                                    value={data.esncard_number}\r\n                                    error={errors.esncard_number[0]}\r\n                                    helperText={errors.esncard_number[1]}\r\n                                    onChange={handleChange}\r\n                                    fullWidth/>\r\n                            </Grid>\r\n                            <Grid size={{xs: 12}} sx={{mt: 0}}>\r\n                                <FormControl fullWidth required error={errors.account_id[0]}>\r\n                                    <InputLabel htmlFor=\"account-selector\" sx={{mb: 2}}>Seleziona Cassa</InputLabel>\r\n                                    <Select\r\n                                        variant=\"outlined\"\r\n                                        label=\"Seleziona Cassa\"\r\n                                        labelId=\"account-selector-label\"\r\n                                        id=\"account-selector\"\r\n                                        name=\"account_id\"\r\n                                        value={data.account_id}\r\n                                        error={errors.account_id[0]}\r\n                                        onChange={handleChange}>\r\n                                        {accounts.map((account) => (\r\n                                            <MenuItem\r\n                                                key={account.id}\r\n                                                value={account.id}\r\n                                                disabled={account.status === 'closed'}\r\n                                                style={{color: account.status === 'closed' ? 'grey' : 'inherit'}}>\r\n                                                {account.name} {account.status === 'closed' ? '(Chiusa)' : ''}\r\n                                            </MenuItem>\r\n                                        ))}\r\n                                    </Select>\r\n                                    {errors.account_id[0] && <FormHelperText>{errors.account_id[1]}</FormHelperText>}\r\n                                </FormControl>\r\n                            </Grid>\r\n                        </Grid>\r\n\r\n                        <Button variant=\"contained\" fullWidth sx={{mt: 2}} onClick={handleSubmit}>Conferma</Button>\r\n                        {successPopup && <Popup message={successPopup.message} state={successPopup.state}/>}\r\n                        <ConfirmDialog\r\n                            open={confirmDialog.open}\r\n                            message={confirmDialog.message}\r\n                            onConfirm={confirmDialog.action}\r\n                            onClose={() => setConfirmDialog({open: false, action: null, message: ''})}\r\n                        />\r\n                    </>\r\n                )}\r\n            </Box>\r\n        </Modal>\r\n    );\r\n}\r\n","import {Box, Button, Card, FormControl, InputLabel, MenuItem, Select, TextField, Toolbar, Typography, Grid, IconButton} from \"@mui/material\";\r\nimport {useEffect, useMemo, useState} from 'react';\r\nimport {DatePicker, LocalizationProvider} from '@mui/x-date-pickers';\r\nimport {AdapterDayjs} from '@mui/x-date-pickers/AdapterDayjs';\r\nimport dayjs from 'dayjs';\r\nimport EditButton from \"../../Components/EditButton\";\r\nimport CrudTable from \"../../Components/CrudTable\";\r\nimport {fetchCustom} from \"../../api/api\";\r\nimport {useAuth} from \"../../Context/AuthContext\";\r\nimport Popup from '../../Components/Popup'\r\nimport {profileDisplayNames as names} from '../../utils/displayAttributes';\r\nimport ESNcardEmissionModal from \"../../Components/profiles/ESNcardEmissionModal\";\r\nimport Loader from \"../../Components/Loader\";\r\nimport countryCodes from \"../../data/countryCodes.json\";\r\nimport {extractErrorMessage} from \"../../utils/errorHandling\";\r\nimport {Person, School, Group} from '@mui/icons-material';\r\nimport {useNavigate, useParams} from \"react-router-dom\";\r\nimport Sidebar from \"../../Components/Sidebar\";\r\nimport ArrowBackIcon from \"@mui/icons-material/ArrowBack\";\r\nimport * as Sentry from \"@sentry/react\";\r\n\r\nconst profileFieldRules = {\r\n    ESNer: {hideFields: ['course', 'matricola_expiration', 'whatsapp_prefix', 'whatsapp_number']},\r\n    Erasmus: {hideFields: ['group']}\r\n};\r\n\r\nexport default function Profile() {\r\n    const {user} = useAuth();\r\n    const {id} = useParams();\r\n    const [saving, setSaving] = useState(false); /* true when making api call to save data */\r\n    const [loading, setLoading] = useState(true);\r\n    const [profile, setProfile] = useState(null);\r\n    const [showSuccessPopup, setShowSuccessPopup] = useState(null);\r\n    const [ESNcardModalOpen, setESNcardModalOpen] = useState(false);\r\n    const [esncardErrors, setESNcardErrors] = useState({})\r\n    const [documentErrors, setDocumentErrors] = useState({})\r\n    const [groups, setGroups] = useState([]);\r\n    const [profileType, setProfileType] = useState(null);\r\n    const navigate = useNavigate();\r\n    //console.log(\"ProfileModal profile:\", profile);\r\n    // Qua puoi disattivare manualmente i permessi degli utenti\r\n    // user.permissions = user.permissions.filter((permission) => !['delete_document', 'change_document', 'add_document'].includes(permission));\r\n\r\n    const [data, setData] = useState({  /* profile fields */\r\n        email: '',\r\n        name: '',\r\n        surname: '',\r\n        birthdate: '',\r\n        country: '',\r\n        phone_prefix: '',\r\n        phone_number: '',\r\n        whatsapp_prefix: '',\r\n        whatsapp_number: '',\r\n        person_code: '',\r\n        domicile: '',\r\n        course: '',\r\n        matricola_number: '',\r\n        matricola_expiration: '',\r\n        documents: [],\r\n        esncards: [],\r\n        group: ''\r\n    });\r\n    const [updatedData, setUpdatedData] = useState({    /* profile fields when edited */\r\n        email: '',\r\n        name: '',\r\n        surname: '',\r\n        birthdate: '',\r\n        country: '',\r\n        phone_prefix: '',\r\n        phone_number: '',\r\n        whatsapp_prefix: '',\r\n        whatsapp_number: '',\r\n        person_code: '',\r\n        domicile: '',\r\n        course: '',\r\n        matricola_number: '',\r\n        matricola_expiration: '',\r\n        group: ''\r\n    });\r\n    const [errors, setErrors] = useState({  /* validation errors */\r\n        email: [false, ''],\r\n        name: [false, ''],\r\n        surname: [false, ''],\r\n        birthdate: [false, ''],\r\n        country: [false, ''],\r\n        phone_prefix: [false, ''],\r\n        phone_number: [false, ''],\r\n        whatsapp_prefix: [false, ''],\r\n        whatsapp_number: [false, ''],\r\n        person_code: [false, ''],\r\n        domicile: [false, ''],\r\n        course: [false, ''],\r\n        matricola_number: [false, ''],\r\n        matricola_expiration: [false, ''],\r\n        group: [false, '']\r\n    });\r\n    const [readOnly, setReadOnly] = useState({  /* readonly states for profile fields */\r\n        email: true,\r\n        name: true,\r\n        surname: true,\r\n        birthdate: true,\r\n        country: true,\r\n        phone_prefix: true,\r\n        phone_number: true,\r\n        whatsapp_prefix: true,\r\n        whatsapp_number: true,\r\n        person_code: true,\r\n        domicile: true,\r\n        course: true,\r\n        matricola_number: true,\r\n        matricola_expiration: true,\r\n        group: true\r\n    });\r\n\r\n    useEffect(() => {\r\n        setLoading(true);\r\n        const fetchData = async () => {\r\n            try {\r\n                const response = await fetchCustom(\"GET\", `/profile/${id}/`);\r\n                const json = await response.json();\r\n                if (!response.ok) {\r\n                    const errorMessage = await extractErrorMessage(json, response.status);\r\n                    setShowSuccessPopup({message: `Errore: ${errorMessage}`, state: 'error'});\r\n                } else {\r\n                    const update = {};\r\n                    Object.keys(data).map((key) => {\r\n                        update[key] = json[key];\r\n                    });\r\n                    setData(update)\r\n                    setUpdatedData(update)\r\n                    setProfile(json);\r\n                    setProfileType(json.is_esner ? \"ESNer\" : \"Erasmus\");\r\n                }\r\n            } catch (error) {\r\n                Sentry.captureException(error);\r\n                setShowSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        fetchData().then();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const fetchGroups = async () => {\r\n            try {\r\n                const response = await fetchCustom(\"GET\", \"/groups/\");\r\n                const json = await response.json();\r\n                if (response.ok) setGroups(json);\r\n                else setShowSuccessPopup({message: `Errore nel recupero dei gruppi: ${await extractErrorMessage(json, response.status)}`, state: \"error\"});\r\n            } catch (error) {\r\n                Sentry.captureException(error);\r\n                setShowSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n            }\r\n        };\r\n        fetchGroups().then();\r\n    }, []);\r\n\r\n\r\n    const rules = profileFieldRules[profileType] || {hideFields: []};\r\n    const shouldHideField = (fieldName) => {\r\n        return rules.hideFields.includes(fieldName);\r\n    };\r\n\r\n    const refreshProfileData = async () => {\r\n        try {\r\n            const response = await fetchCustom(\"GET\", `/profile/${profile.id.toString()}/`);\r\n            const json = await response.json();\r\n            if (!response.ok) {\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setShowSuccessPopup({message: `Errore: ${errorMessage}`, state: 'error'});\r\n            } else {\r\n                setData(json);\r\n                setUpdatedData(json);\r\n                setProfile(json);\r\n            }\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setShowSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n        }\r\n    };\r\n\r\n    const handleOpenESNcardModal = () => {\r\n        setESNcardModalOpen(true);\r\n    };\r\n\r\n    const handleCloseESNcardModal = async (success) => {\r\n        if (success) {\r\n            setShowSuccessPopup({message: \"ESNcard emessa con successo!\", state: \"success\"});\r\n            await refreshProfileData();\r\n        }\r\n        setESNcardModalOpen(false);\r\n    };\r\n\r\n    /* columns for esncard table */\r\n    const esncard_columns = useMemo(() => [\r\n        {\r\n            accessorKey: 'number',\r\n            header: 'Numero',\r\n            size: 100,\r\n            muiEditTextFieldProps: {\r\n                required: true,\r\n                helperText: esncardErrors?.number,\r\n                error: !!esncardErrors?.number\r\n            },\r\n        },\r\n        {\r\n            accessorKey: 'created_at',\r\n            enableEditing: false,\r\n            header: 'Rilascio',\r\n            size: 100,\r\n            Cell: ({cell}) => {\r\n                const date = new Date(cell.getValue());\r\n                return date == null ? 'Null' : date.toISOString().split('T')[0];\r\n            }\r\n        },\r\n        {\r\n            accessorKey: 'expiration',\r\n            enableEditing: false,\r\n            header: 'Scadenza',\r\n            size: 100,\r\n            Cell: ({cell}) => {\r\n                const expirationDate = new Date(cell.getValue());\r\n                const today = new Date();\r\n                const isExpired = expirationDate < today;\r\n                return (\r\n                    <span style={{color: isExpired ? 'orange' : 'green'}}>\r\n                        {cell.getValue()}\r\n                    </span>\r\n                );\r\n            }\r\n        },\r\n    ], []);\r\n\r\n    const saveESNcard = async (row, values) => {\r\n        try {\r\n            const response = await fetchCustom(\"PATCH\", `/esncard/${row.id}/`, values);\r\n            if (!response.ok) {\r\n                const json = await response.json();\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setShowSuccessPopup({message: `Errore: ${errorMessage}`, state: 'error'});\r\n                return false;\r\n            } else {\r\n                setESNcardErrors({});\r\n                setShowSuccessPopup({message: \"ESNcard aggiornata con successo!\", state: \"success\"});\r\n                await refreshProfileData();\r\n                return true;\r\n            }\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setShowSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n        }\r\n    }\r\n\r\n    /* columns for documents table */\r\n    const document_columns = useMemo(() => [\r\n        {\r\n            accessorKey: 'type',\r\n            header: 'Tipo',\r\n            size: 100,\r\n            editVariant: 'select',\r\n            editSelectOptions: ['Passport', 'ID Card', 'Driving License', 'Residency Permit', 'Other'],\r\n            muiEditTextFieldProps: {\r\n                select: true,\r\n                helperText: documentErrors?.type,\r\n                error: !!documentErrors?.type,\r\n            }\r\n        },\r\n        {\r\n            accessorKey: 'number',\r\n            header: 'Numero',\r\n            size: 60,\r\n            muiEditTextFieldProps: {\r\n                required: true,\r\n                helperText: documentErrors?.number,\r\n                error: !!documentErrors?.number\r\n            },\r\n        },\r\n        {\r\n            accessorKey: 'expiration',\r\n            header: 'Scadenza',\r\n            size: 60,\r\n            muiEditTextFieldProps: {\r\n                required: true,\r\n                helperText: documentErrors?.expiration,\r\n                error: !!documentErrors?.expiration,\r\n                type: 'date'\r\n            },\r\n            Cell: ({cell}) => {\r\n                const expirationDate = new Date(cell.getValue());\r\n                const today = new Date();\r\n                const isExpired = expirationDate < today;\r\n                return (\r\n                    <span style={{color: isExpired ? 'orange' : 'green'}}>\r\n                        {cell.getValue()}\r\n                    </span>\r\n                );\r\n            }\r\n        },\r\n\r\n\r\n    ], []);\r\n\r\n    const deleteDocument = async (row) => {\r\n        try {\r\n            const response = await fetchCustom(\"DELETE\", `/document/${row.id}/`);\r\n            if (!response.ok) {\r\n                response.json().then((errors) => setDocumentErrors(errors))\r\n                const json = await response.json();\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setShowSuccessPopup({message: `Errore: ${errorMessage}`, state: 'error'});\r\n            } else {\r\n                setDocumentErrors({});\r\n                setShowSuccessPopup({message: \"Documento eliminato con successo!\", state: \"success\"});\r\n                await refreshProfileData();\r\n                return true;\r\n            }\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setShowSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n        }\r\n    };\r\n\r\n    /* document creation */\r\n    const createDocument = async (values) => {\r\n        let val = {...values, profile: profile.id};\r\n        try {\r\n            const response = await fetchCustom(\"POST\", '/document/', val);\r\n            if (!response.ok) {\r\n                response.json().then((errors) => setDocumentErrors(errors))\r\n                const json = await response.json();\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setShowSuccessPopup({message: `Errore: ${errorMessage}`, state: 'error'});\r\n                return false;\r\n            } else {\r\n                setDocumentErrors({});\r\n                setShowSuccessPopup({message: \"Documento aggiunto con successo!\", state: \"success\"});\r\n                await refreshProfileData();\r\n                return true;\r\n            }\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setShowSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n            return false;\r\n        }\r\n    };\r\n\r\n    /* save edited document */\r\n    const saveDocument = async (row, values) => {\r\n        try {\r\n            const response = await fetchCustom(\"PATCH\", `/document/${row.id}/`, values);\r\n            if (!response.ok) {\r\n                response.json().then((errors) => setDocumentErrors(errors))\r\n                const json = await response.json();\r\n                const errorMessage = await extractErrorMessage(json, response.status);\r\n                setShowSuccessPopup({message: `Errore: ${errorMessage}`, state: 'error'});\r\n                return false;\r\n            } else {\r\n                setDocumentErrors({});\r\n                setShowSuccessPopup({message: \"Documento aggiornato con successo!\", state: \"success\"});\r\n                await refreshProfileData();\r\n                return true;\r\n            }\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setShowSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n            return false;\r\n        }\r\n    }\r\n\r\n    const formatDateString = (date) => {\r\n        if (!date) return null;\r\n        return dayjs(date).format('YYYY-MM-DD');\r\n    };\r\n\r\n    const handleChange = (e) => {\r\n        setUpdatedData({\r\n            ...updatedData,\r\n            [e.target.name]: e.target.value,\r\n        });\r\n    };\r\n\r\n    const handleDateChange = (name, date) => {\r\n        setUpdatedData({\r\n            ...updatedData,\r\n            [name]: date,\r\n        });\r\n    };\r\n\r\n    const resetErrors = () => {\r\n        const resetObj = {};\r\n        Object.keys(errors).forEach(key => {\r\n            resetObj[key] = [false, ''];\r\n        });\r\n        setErrors(resetObj);\r\n    };\r\n\r\n    const toggleEdit = (edit) => {\r\n        setReadOnly(Object.fromEntries(Object.keys(readOnly).map((k) =>\r\n            [k, !edit]\r\n        )));\r\n        resetErrors();\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        setSaving(true);\r\n\r\n        // Check if matricola_number is provided and verify it's exactly 6 digits\r\n        if (updatedData.matricola_number && !/^\\d{6}$/.test(updatedData.matricola_number)) {\r\n            setErrors((prevErrors) => ({\r\n                ...prevErrors,\r\n                matricola_number: [true, 'La Matricola deve essere composta da 6 cifre'],\r\n            }));\r\n            setSaving(false);\r\n            return false;\r\n        }\r\n        try {\r\n            const body = {\r\n                ...updatedData,\r\n                birthdate: formatDateString(updatedData.birthdate),\r\n                matricola_expiration: formatDateString(updatedData.matricola_expiration)\r\n            }\r\n            const response = await fetchCustom(\"PATCH\", `/profile/${profile.id.toString()}/`, body);\r\n            if (!response.ok) {\r\n                const json = await response.json();\r\n                const updatedErrors = Object.fromEntries(Object.keys(errors).map(\r\n                    (e) => {\r\n                        if (e in json) return [e, [true, json[e]]];\r\n                        else return [e, [false, '']];\r\n                    }\r\n                ));\r\n                setErrors(updatedErrors);\r\n            } else {\r\n                await refreshProfileData();\r\n                if (data) {\r\n                    resetErrors();\r\n                    setShowSuccessPopup({message: \"Profilo aggiornato con successo!\", state: \"success\"});\r\n                    toggleEdit(false);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            Sentry.captureException(error);\r\n            setUpdatedData(data);\r\n            setShowSuccessPopup({message: `Errore generale: ${error}`, state: \"error\"});\r\n            toggleEdit(false);\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Box>\r\n            <Sidebar/>\r\n            {loading ? <Loader/> : (<>\r\n                    <Box sx={{mx: '5%'}}>\r\n                        <Box sx={{display: 'flex', alignItems: 'center', marginBottom: '20px'}}>\r\n                            <IconButton onClick={() => navigate(-1)} sx={{mr: 2}}><ArrowBackIcon/></IconButton>\r\n                            <Typography variant=\"h4\">Profilo {profileType}</Typography>\r\n                        </Box>\r\n                        <Card sx={{p: '20px'}}>\r\n                            <Grid container spacing={2}>\r\n                                {/* --- Personal Information Section --- */}\r\n                                <Grid container size={{xs: 12}} alignItems=\"center\">\r\n                                    <Person/>\r\n                                    <Typography variant=\"h6\" sx={{m: 0}}>Informazioni Personali</Typography>\r\n                                    <Grid sx={{marginLeft: 'auto'}}>\r\n                                        <EditButton\r\n                                            onEdit={() => toggleEdit(true)}\r\n                                            onCancel={() => {\r\n                                                toggleEdit(false);\r\n                                                setUpdatedData(data);\r\n                                            }}\r\n                                            saving={saving}\r\n                                            onSave={handleSave}/>\r\n\r\n                                    </Grid>\r\n                                </Grid>\r\n                                {!shouldHideField('name') && (\r\n                                    <Grid size={{xs: 12, md: 3}}>\r\n                                        <TextField\r\n                                            label={names.name}\r\n                                            name='name'\r\n                                            value={updatedData.name}\r\n                                            error={errors.name[0]}\r\n                                            helperText={errors.name[1]}\r\n                                            slotProps={{input: {readOnly: readOnly.name}}}\r\n                                            onChange={handleChange}\r\n                                            sx={{backgroundColor: readOnly.name ? 'grey.200' : 'white'}}\r\n                                            fullWidth/>\r\n                                    </Grid>\r\n                                )}\r\n                                {!shouldHideField('surname') && (\r\n                                    <Grid size={{xs: 12, md: 3}}>\r\n                                        <TextField\r\n                                            label={names.surname}\r\n                                            name='surname'\r\n                                            value={updatedData.surname}\r\n                                            error={errors.surname[0]}\r\n                                            helperText={errors.surname[1]}\r\n                                            onChange={handleChange}\r\n                                            slotProps={{input: {readOnly: readOnly.surname}}}\r\n                                            sx={{backgroundColor: readOnly.surname ? 'grey.200' : 'white'}}\r\n                                            fullWidth/>\r\n                                    </Grid>\r\n                                )}\r\n                                {!shouldHideField('email') && (\r\n                                    <Grid size={{xs: 12, md: 3}}>\r\n                                        <TextField\r\n                                            label={names.email}\r\n                                            name='email'\r\n                                            type='email'\r\n                                            value={updatedData.email}\r\n                                            error={errors.email[0]}\r\n                                            helperText={errors.email[1]}\r\n                                            slotProps={{input: {readOnly: true}}}\r\n                                            sx={{backgroundColor: 'grey.200'}}\r\n                                            onChange={handleChange} fullWidth/>\r\n                                    </Grid>\r\n                                )}\r\n                                {!shouldHideField('birthdate') && (\r\n                                    <Grid size={{xs: 12, md: 3}}>\r\n                                        <LocalizationProvider dateAdapter={AdapterDayjs} adapterLocale='en-gb'>\r\n                                            <DatePicker\r\n                                                label={names.birthdate}\r\n                                                value={updatedData.birthdate ? dayjs(updatedData.birthdate, 'YYYY-MM-DD') : null}\r\n                                                readOnly={readOnly.birthdate}\r\n                                                onChange={(date) => handleDateChange('birthdate', date)}\r\n                                                sx={{backgroundColor: readOnly.birthdate ? 'grey.200' : 'white'}}\r\n                                                slotProps={{textField: {variant: 'outlined'}}}/>\r\n                                        </LocalizationProvider>\r\n                                    </Grid>\r\n                                )}\r\n                                {!shouldHideField('country') && (\r\n                                    <Grid size={{xs: 12, md: 2}}>\r\n                                        <FormControl fullWidth required>\r\n                                            <InputLabel id=\"country-label\">{names.country}</InputLabel>\r\n                                            <Select\r\n                                                variant=\"outlined\"\r\n                                                labelId=\"country-label\"\r\n                                                name=\"country\"\r\n                                                label={names.country}\r\n                                                value={updatedData.country}\r\n                                                error={errors.country[0]}\r\n                                                onChange={handleChange}\r\n                                                slotProps={{input: {readOnly: readOnly.country}}}\r\n                                                sx={{backgroundColor: readOnly.country ? 'grey.200' : 'white'}}>\r\n\r\n                                                <MenuItem value=\"\"><em>None</em></MenuItem>\r\n                                                {countryCodes.map((country) => (\r\n                                                    <MenuItem key={country.code} value={country.code}>\r\n                                                        {country.name}\r\n                                                    </MenuItem>\r\n                                                ))}\r\n                                            </Select>\r\n                                        </FormControl>\r\n                                    </Grid>\r\n                                )}\r\n                                {!shouldHideField('domicile') && (\r\n                                    <Grid size={{xs: 12, md: 4}}>\r\n                                        <TextField\r\n                                            label={names.domicile}\r\n                                            name='domicile'\r\n                                            value={updatedData.domicile}\r\n                                            error={errors.domicile[0]}\r\n                                            helperText={errors.domicile[1]}\r\n                                            onChange={handleChange}\r\n                                            slotProps={{input: {readOnly: readOnly.domicile}}}\r\n                                            sx={{backgroundColor: readOnly.domicile ? 'grey.200' : 'white'}}\r\n                                            fullWidth/>\r\n                                    </Grid>\r\n                                )}\r\n                                {/* --- Phone numbers --- */}\r\n                                {!shouldHideField('phone_prefix') && !shouldHideField('phone_number') && (\r\n                                    <Grid size={{xs: 12}} container spacing={2}>\r\n                                        <Grid size={{xs: 12, md: 1}}>\r\n                                            <FormControl fullWidth required>\r\n                                                <InputLabel id=\"phone-prefix-label\">{names.phone_prefix}</InputLabel>\r\n                                                <Select\r\n                                                    variant=\"outlined\"\r\n                                                    labelId=\"phone-prefix-label\"\r\n                                                    id=\"phone-prefix\"\r\n                                                    name=\"phone_prefix\"\r\n                                                    value={updatedData.phone_prefix || ''}\r\n                                                    onChange={handleChange}\r\n                                                    slotProps={{input: {readOnly: readOnly.phone_number}}}\r\n                                                    sx={{backgroundColor: readOnly.phone_number ? 'grey.200' : 'white'}}\r\n                                                    label={names.phone_prefix}\r\n                                                    renderValue={(value) => value}>\r\n                                                    {countryCodes.map((country) => (\r\n                                                        <MenuItem key={country.code} value={country.dial}>\r\n                                                            {country.dial} ({country.name})\r\n                                                        </MenuItem>\r\n                                                    ))}\r\n                                                </Select>\r\n                                            </FormControl>\r\n                                        </Grid>\r\n                                        <Grid size={{xs: 12, md: 2}}>\r\n                                            <TextField\r\n                                                label={names.phone_number}\r\n                                                name='phone_number'\r\n                                                value={updatedData.phone_number || ''}\r\n                                                error={errors.phone_number[0]}\r\n                                                helperText={errors.phone_number[1]}\r\n                                                onChange={handleChange}\r\n                                                slotProps={{input: {readOnly: readOnly.phone_number}}}\r\n                                                sx={{backgroundColor: readOnly.phone_number ? 'grey.200' : 'white'}}\r\n                                                fullWidth/>\r\n                                        </Grid>\r\n                                    </Grid>\r\n                                )}\r\n                                {!shouldHideField('whatsapp_prefix') && !shouldHideField('whatsapp_number') && (\r\n                                    <Grid size={{xs: 12}} container spacing={2}>\r\n                                        <Grid size={{xs: 12, md: 1}}>\r\n                                            <FormControl fullWidth required>\r\n                                                <InputLabel id=\"whatsapp-prefix-label\">{names.whatsapp_prefix}</InputLabel>\r\n                                                <Select\r\n                                                    variant=\"outlined\"\r\n                                                    labelId=\"whatsapp-prefix-label\"\r\n                                                    id=\"whatsapp-prefix\"\r\n                                                    name=\"whatsapp_prefix\"\r\n                                                    value={updatedData.whatsapp_prefix || ''}\r\n                                                    onChange={handleChange}\r\n                                                    slotProps={{input: {readOnly: readOnly.whatsapp_prefix}}}\r\n                                                    sx={{backgroundColor: readOnly.whatsapp_prefix ? 'grey.200' : 'white'}}\r\n                                                    label={names.whatsapp_prefix}\r\n                                                    renderValue={(value) => value}>\r\n                                                    {countryCodes.map((country) => (\r\n                                                        <MenuItem key={country.code} value={country.dial}>\r\n                                                            {country.dial} ({country.name})\r\n                                                        </MenuItem>\r\n                                                    ))}\r\n                                                </Select>\r\n                                            </FormControl>\r\n                                        </Grid>\r\n                                        <Grid size={{xs: 12, md: 2}}>\r\n                                            <TextField\r\n                                                label={names.whatsapp_number}\r\n                                                name='whatsapp_number'\r\n                                                value={updatedData.whatsapp_number || ''}\r\n                                                error={errors.whatsapp_number[0]}\r\n                                                helperText={errors.whatsapp_number[1]}\r\n                                                onChange={handleChange}\r\n                                                slotProps={{input: {readOnly: readOnly.whatsapp_number}}}\r\n                                                sx={{backgroundColor: readOnly.whatsapp_number ? 'grey.200' : 'white'}}\r\n                                                fullWidth/>\r\n                                        </Grid>\r\n                                    </Grid>\r\n                                )}\r\n                                {/* --- Polimi fields --- */}\r\n                                <Grid container size={{xs: 12}} sx={{mt: 2}} alignItems=\"center\">\r\n                                    <School/>\r\n                                    <Typography variant=\"h6\" sx={{m: 0}}>Dati Studente</Typography>\r\n                                </Grid>\r\n                                {!shouldHideField('person_code') && (\r\n                                    <Grid size={{xs: 12, md: 3}}>\r\n                                        <TextField\r\n                                            label={names.person_code}\r\n                                            name='person_code'\r\n                                            value={updatedData.person_code || ''}\r\n                                            error={errors.person_code[0]}\r\n                                            helperText={errors.person_code[1]}\r\n                                            onChange={handleChange}\r\n                                            slotProps={{input: {readOnly: readOnly.person_code}}}\r\n                                            sx={{backgroundColor: readOnly.person_code ? 'grey.200' : 'white'}}\r\n                                            fullWidth/>\r\n                                    </Grid>\r\n                                )}\r\n                                {!shouldHideField('course') && (\r\n                                    <Grid size={{xs: 12, md: 3}}>\r\n                                        <FormControl fullWidth required>\r\n                                            <InputLabel id=\"course-label\">{names.course}</InputLabel>\r\n                                            <Select\r\n                                                variant=\"outlined\"\r\n                                                labelId=\"course-label\"\r\n                                                name=\"course\"\r\n                                                label={names.course}\r\n                                                value={updatedData.course || ''}\r\n                                                onChange={handleChange}\r\n                                                slotProps={{input: {readOnly: readOnly.course}}}\r\n                                                sx={{backgroundColor: readOnly.course ? 'grey.200' : 'white'}}>\r\n                                                <MenuItem value=\"Engineering\">Ingegneria</MenuItem>\r\n                                                <MenuItem value=\"Design\">Design</MenuItem>\r\n                                                <MenuItem value=\"Architecture\">Architettura</MenuItem>\r\n                                            </Select>\r\n                                        </FormControl>\r\n                                    </Grid>\r\n                                )}\r\n                                {!shouldHideField('matricola_number') && (\r\n                                    <Grid size={{xs: 12, md: 3}}>\r\n                                        <TextField\r\n                                            label={names.matricola_number}\r\n                                            name='matricola_number'\r\n                                            value={updatedData.matricola_number || ''}\r\n                                            error={errors.matricola_number[0]}\r\n                                            helperText={errors.matricola_number[1]}\r\n                                            onChange={handleChange}\r\n                                            sx={{backgroundColor: readOnly.matricola_number ? 'grey.200' : 'white'}}\r\n                                            type=\"number\"\r\n                                            slotProps={{input: {readOnly: readOnly.matricola_number}}}\r\n                                            fullWidth/>\r\n                                    </Grid>\r\n                                )}\r\n                                {!shouldHideField('matricola_expiration') && (\r\n                                    <Grid size={{xs: 12, md: 3}}>\r\n                                        <LocalizationProvider dateAdapter={AdapterDayjs} adapterLocale='en-gb'>\r\n                                            <DatePicker\r\n                                                label={names.matricola_expiration}\r\n                                                value={updatedData.matricola_expiration ? dayjs(updatedData.matricola_expiration, 'YYYY-MM-DD') : null}\r\n                                                readOnly={readOnly.matricola_expiration}\r\n                                                onChange={(date) => handleDateChange('matricola_expiration', date)}\r\n                                                sx={{backgroundColor: readOnly.matricola_expiration ? 'grey.200' : 'white'}}\r\n                                                slotProps={{textField: {variant: 'outlined'}}}/>\r\n                                        </LocalizationProvider>\r\n                                    </Grid>\r\n                                )}\r\n                                {!shouldHideField('group') && (\r\n                                    <Grid container alignItems=\"center\" spacing={1} sx={{width: '100%', mt: 2}}>\r\n                                        <Group/>\r\n                                        <Grid size={{xs: 12, md: 2}}>\r\n                                            <FormControl fullWidth required>\r\n                                                <InputLabel id=\"group-label\">{names.group}</InputLabel>\r\n                                                <Select\r\n                                                    variant=\"outlined\"\r\n                                                    labelId=\"group-label\"\r\n                                                    label={names.group}\r\n                                                    name=\"group\"\r\n                                                    value={updatedData.group || ''}\r\n                                                    onChange={handleChange}\r\n                                                    slotProps={{input: {readOnly: readOnly.group}}}\r\n                                                    sx={{backgroundColor: readOnly.group ? 'grey.200' : 'white'}}>\r\n                                                    {groups.map((group) => (<MenuItem key={group.name} value={group.name}>{group.name}</MenuItem>))}\r\n                                                </Select>\r\n                                            </FormControl>\r\n                                        </Grid>\r\n                                    </Grid>\r\n                                )}\r\n                            </Grid>\r\n                        </Card>\r\n                        <Card sx={{p: 1, mt: 2, mb: 2, minHeight: '80px', display: 'flex', alignItems: 'center'}}>\r\n                            <Toolbar sx={{justifyContent: 'space-between', width: '100%', p: 0}}>\r\n                                <Typography variant=\"h6\">Azioni</Typography>\r\n                                <Button variant=\"contained\" color=\"primary\">\r\n                                    Esporta Profilo\r\n                                </Button>\r\n                            </Toolbar>\r\n                            {ESNcardModalOpen &&\r\n                                <ESNcardEmissionModal\r\n                                    open={ESNcardModalOpen}\r\n                                    profile={profile}\r\n                                    onClose={handleCloseESNcardModal}/>\r\n                            }\r\n                        </Card>\r\n                        <Grid container sx={{width: '100%', mb: 5}} spacing={2}>\r\n                            <Grid size={{xs: 12, md: 6}}>\r\n                                <CrudTable\r\n                                    cols={document_columns}\r\n                                    canCreate={user.permissions.includes('add_document')}\r\n                                    canEdit={user.permissions.includes('change_document')}\r\n                                    canDelete={user.permissions.includes('delete_document')}\r\n                                    onCreate={createDocument}\r\n                                    onSave={saveDocument}\r\n                                    onDelete={deleteDocument}\r\n                                    initialData={data.documents}\r\n                                    title={'Documenti'}\r\n                                    sortColumn={'expiration'}/>\r\n                            </Grid>\r\n                            <Grid size={{xs: 12, md: 6}}>\r\n                                <CrudTable\r\n                                    cols={esncard_columns}\r\n                                    canCreate={user.permissions.includes('add_esncard')}\r\n                                    onCreate={handleOpenESNcardModal}\r\n                                    createText={!profile.latest_esncard ? \"Rilascia\" : (profile.latest_esncard.is_valid ? \"Card Smarrita\" : \"Rinnova\")}\r\n                                    canEdit={user.permissions.includes('change_esncard')}\r\n                                    onSave={saveESNcard}\r\n                                    initialData={data.esncards}\r\n                                    title={'ESNcards'}\r\n                                    sortColumn={'expiration'}/>\r\n                            </Grid>\r\n                        </Grid>\r\n                        {showSuccessPopup && <Popup message={showSuccessPopup.message} state={showSuccessPopup.state}/>}\r\n                    </Box>\r\n                </>\r\n            )}\r\n        </Box>\r\n    );\r\n}\r\n\r\n","import {BrowserRouter as Router, Routes, Route} from 'react-router-dom';\r\nimport './App.css';\r\nimport {AuthProvider} from \"./Context/AuthContext.jsx\";\r\nimport {SidebarProvider} from './Context/SidebarContext.jsx';\r\nimport Login from './Pages/Login.jsx'\r\nimport ErasmusForm from './Pages/ErasmusForm.jsx';\r\nimport ESNerForm from './Pages/ESNerForm.jsx';\r\nimport ErasmusProfiles from './Pages/profiles/ErasmusProfiles.jsx';\r\nimport ESNersProfiles from './Pages/profiles/ESNersProfiles.jsx';\r\nimport Home from './Pages/Home.jsx'\r\nimport TreasuryDashboard from './Pages/treasury/TreasuryDashboard.jsx';\r\nimport AccountsList from './Pages/treasury/AccountsList.jsx';\r\nimport EventsList from './Pages/events/EventsList.jsx';\r\nimport Event from './Pages/events/Event.jsx';\r\nimport ProtectedRoute from \"./Components/ProtectedRoute.jsx\";\r\nimport EmailVerification from './Pages/EmailVerification.jsx';\r\nimport ResetPassword from \"./Pages/ResetPassword.jsx\";\r\nimport TransactionsList from \"./Pages/treasury/TransactionsList.jsx\";\r\nimport Profile from \"./Pages/profiles/Profile.jsx\";\r\n\r\nfunction App() {\r\n    return (\r\n        <AuthProvider>\r\n            <SidebarProvider>\r\n                <Router>\r\n                    <Routes>\r\n                        <Route path=\"/verify-email/:uid/:token\" element={<EmailVerification/>}/>\r\n                        <Route path=\"/reset-password/:uid/:token\" element={<ResetPassword/>}/>\r\n                        <Route path='/login' element={<Login/>}/>\r\n                        <Route path='/' element={<ProtectedRoute><Home/></ProtectedRoute>}/>\r\n                        <Route path='/profiles/erasmus' element={<ProtectedRoute><ErasmusProfiles/></ProtectedRoute>}/>\r\n                        <Route path='/profiles/esners' element={<ProtectedRoute><ESNersProfiles/></ProtectedRoute>}/>\r\n                        <Route path='/profile/:id' element={<ProtectedRoute><Profile/></ProtectedRoute>}/>\r\n                        <Route path='/erasmus_form' element={<ErasmusForm/>}/>\r\n                        <Route path='/esner_form' element={<ESNerForm/>}/>\r\n                        <Route path='/treasury' element={<ProtectedRoute requiredPermission=\"change_account\"><TreasuryDashboard/></ProtectedRoute>}/>\r\n                        <Route path='/treasury/accounts_list' element={<ProtectedRoute requiredPermission=\"change_account\"><AccountsList/></ProtectedRoute>}/>\r\n                        <Route path='/treasury/transactions_list' element={<ProtectedRoute requiredPermission=\"change_account\"><TransactionsList/></ProtectedRoute>}/>\r\n                        <Route path='/events' element={<ProtectedRoute><EventsList/></ProtectedRoute>}/>\r\n                        <Route path='/event/:id' element={<ProtectedRoute><Event/></ProtectedRoute>}/>\r\n                    </Routes>\r\n                </Router>\r\n            </SidebarProvider>\r\n        </AuthProvider>\r\n    )\r\n}\r\n\r\nexport default App;\r\n","// Import Sentry and tracing\r\nimport * as Sentry from \"@sentry/react\";\r\n// import {BrowserTracing} from \"@sentry/tracing\";\r\n// import {browserTracingIntegration} from \"@sentry/react\";\r\n\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom/client';\r\nimport './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport {createTheme, ThemeProvider} from '@mui/material/styles';\r\nimport CssBaseline from '@mui/material/CssBaseline';\r\nimport {itIT} from '@mui/material/locale';\r\n\r\nSentry.init({\r\n    dsn: \"https://f7ee9b97bae2c35e767d8e156eb7b116@o4509581352828928.ingest.de.sentry.io/4509581461487696\",\r\n    sendDefaultPii: true,\r\n    environment: import.meta.env.MODE,\r\n    //integrations: [Sentry.browserTracingIntegration()],\r\n    //tracesSampleRate: 1.0,  // Adjust in production to reduce volume\r\n    //tracePropagationTargets: [\"localhost\", /^https:\\/\\/mgmt.esnpolimi.it\\.io\\/api/],\r\n});\r\n\r\nconst theme = createTheme({\r\n    typography: {\r\n        fontFamily: 'Roboto, Arial, sans-serif',\r\n        h1: {fontFamily: 'Lato, Arial, sans-serif'},\r\n        h2: {fontFamily: 'Lato, Arial, sans-serif'},\r\n        h3: {fontFamily: 'Lato, Arial, sans-serif'},\r\n        h4: {fontFamily: 'Lato, Arial, sans-serif'},\r\n        h5: {fontFamily: 'Lato, Arial, sans-serif'},\r\n    },\r\n    palette: {\r\n        primary: {main: '#1976d2'},\r\n        secondary: {main: '#dc004e'},\r\n        cyan: {main: '#00aeef', contrastText: '#ffffff'},\r\n        magenta: {main: '#ec008c', contrastText: '#ffffff'},\r\n        gray: {main: '#999999', contrastText: '#ffffff'},\r\n    },\r\n});\r\n\r\nconst root = ReactDOM.createRoot(document.getElementById('root'));\r\n\r\nroot.render(\r\n    <React.StrictMode>\r\n        <Sentry.ErrorBoundary fallback={<p>An unexpected error occurred.</p>}>\r\n            <ThemeProvider theme={createTheme(theme, itIT)}>\r\n                <CssBaseline/>\r\n                <App/>\r\n            </ThemeProvider>\r\n        </Sentry.ErrorBoundary>\r\n    </React.StrictMode>\r\n);\r\n\r\nreportWebVitals();\r\n"],"names":["fetchCustom","method","path","body","options","auth","accessToken","url","headers","fetchOptions","response","extractErrorMessage","data","status","errors","AuthContext","createContext","AuthProvider","children","refreshTimer","useRef","setAccessToken","useState","user","setUser","loading","setLoading","parseUserFromToken","token","jwtDecode","e","Sentry.captureException","login","email","password","error","logout","useCallback","skipApiCall","refreshAccessToken","useEffect","clearRefreshTimer","exp","now","refreshTime","expDate","nowDate","storedToken","storedUser","decodedToken","jsx","useAuth","useContext","SidebarContext","SidebarProvider","isDrawerOpen","setIsDrawerOpen","expandedSection","setExpandedSection","savedDrawerState","toggleDrawer","open","event","handleExpand","section","prevSection","closeDrawer","useSidebar","logo","StatusBanner","message","state","successText","errorText","jsxs","Box","Fragment","Alert","Typography","Login","setEmail","setPassword","isForgotPassword","setIsForgotPassword","navigate","useNavigate","statusMessage","setStatusMessage","isResetSubmitted","setResetSubmitted","isLoading","setIsLoading","handleForgotPassword","json","errorMessage","handleLogin","success","newWindow","Container","CssBaseline","TextField","Button","CircularProgress","Link","ErasmusForm","isSubmitted","setSubmitted","React","sameWAasPhone","setSameWAasPhone","checkboxes","setCheckboxes","checkboxErrors","setCheckboxErrors","links","formData","setFormData","dayjs","initialFormErrors","formErrors","setFormErrors","validateForm","valid","newErrors","newCheckboxErrors","field","emailRegex","key","value","scrollUp","formatDateString","date","handleChange","handleDateChange","name","handleCheckboxChange","checked","handleSubmit","handleSameNumberChange","CheckCircleOutlineIcon","green","Grid","LocalizationProvider","AdapterDayjs","DatePicker","CheckIcon","CloseIcon","FormControl","InputLabel","Select","countryCodes","country","MenuItem","FormControlLabel","Checkbox","LoginIcon","profileDisplayNames","eventDisplayNames","accountDisplayNames","transactionDisplayNames","ESNerForm","capsLockActive","setCapsLockActive","names","passwordRequirements","pw","handlePasswordKeyDown","prev","handlePasswordKeyUp","WarningAmberIcon","req","idx","passed","Loader","size","fullScreen","ESNCARD_VALIDITY_OPTIONS","ProfilesList","apiEndpoint","columns","columnVisibility","profileType","setData","pagination","setPagination","rowCount","setRowCount","groups","setGroups","filters","setFilters","search","setSearch","appliedSearch","setAppliedSearch","internalLoading","setInternalLoading","searchInputRef","params","handleSearchApply","handleSearchClear","table","useMaterialReactTable","MRT_Localization_IT","row","IconButton","ManageAccountsIcon","handleFilterChange","OutlinedInput","selected","opt","ClearIcon","SearchIcon","MaterialReactTable","LogoutButton","handleLogout","LogoutIcon","Sidebar","hasPermission","permission","menuItems","HomeIcon","AccountBalanceIcon","EventIcon","PersonIcon","SnowboardingIcon","BabyChangingStationIcon","item","handleProfileOpen","handleNavClick","drawer","ListItemButton","ListItemIcon","ListItemText","ExpandLess","ExpandMore","Collapse","List","child","ListItem","MenuIcon","Drawer","ErasmusProfiles","useMemo","cell","Chip","countryCode","c","ESNersProfiles","chipColor","ConfirmDialog","onConfirm","onClose","Dialog","DialogTitle","DialogContent","DialogActions","Popup","duration","popup","copyButton","ReactDOM","ContentCopyIcon","textSpan","copyToClipboard","timer","animateOut","handleMouseEnter","handleMouseLeave","style","styleESNcardModal","TransactionAdd","account","onSuccess","handleClose","Modal","Home","accounts","setAccounts","selectedAccount","setSelectedAccount","confirmDialogOpen","setConfirmDialogOpen","actionType","setActionType","casseOpen","setCasseOpen","showSuccessPopup","setShowSuccessPopup","transactionModalOpen","setTransactionModalOpen","accountsDetails","fetchAccounts","handleAction","type","confirmAction","Paper","o","ExpandLessIcon","ExpandMoreIcon","Card","CardContent","CardActions","AccountsDash","limit","MRT_Table","TRANSACTION_CONFIGS","TransactionsDash","config","TreasuryDashboard","ReceiptsDash","AccountModal","isEdit","successPopup","setSuccessPopup","setErrors","g","handleInputChange","handleGroupsChange","payload","id","group","FormHelperText","AccountsList","accountModalOpen","setAccountModalOpen","refreshAccountsData","EditIcon","handleCloseAccountModal","ArrowBackIcon","StoreIcon","QuillEditor","onChange","readOnly","editorRef","quillInstance","modules","Quill","EventModal","title","hasSubscriptions","setHasSubscriptions","formatDateTimeString","handleEventDateChange","handleSubscriptionStartChange","handleSubscriptionEndChange","startDateTime","endDateTime","convert","t","handleAddList","handleListChange","index","updatedLists","list","i","handleDeleteList","_","listErrors","hasListErrors","InfoIcon","eventNames","Tooltip","DateTimePicker","CustomEditor","AddIcon","DeleteIcon","SUBSCRIPTION_STATUS_OPTIONS","EventsList","eventModalOpen","setEventModalOpen","localLoading","setLocalLoading","ignore","color","newFilters","handleClearDates","handleCloseEventModal","AdapterDateFns","itLocale","ProfileSearch","helperText","label","required","disabled","valid_only","esner_only","profiles","setProfiles","searchQuery","setSearchQuery","searchLoading","setSearchLoading","resp","renderOption","props","option","otherProps","hasEsncard","esnCardExpired","Autocomplete","newInputValue","SubscriptionModal","listId","subscription","confirmDialog","setConfirmDialog","originalAccountId","fieldsToValidate","originalStatus","setOriginalStatus","resetErrors","resetObj","hasErrors","msg","doSubmit","handleDelete","doDelete","handleStatusToggle","Divider","newValue","Switch","MoveToListModal","selectedRows","lists","setLists","selectedListId","setSelectedListId","listName","availableLists","Event","useParams","location","useLocation","subscriptionModalOpen","setSubscriptionModalOpen","moveToListModalOpen","setMoveToListModalOpen","setSelectedRows","eventFromState","selectedList","setSelectedList","setSubscription","subscriptionIsEdit","setSubscriptionIsEdit","eventId","refreshEventData","handleOpenEventModal","handleOpenSubscriptionModal","handleCloseSubscriptionModal","handleSubscriptionStatus","isActive","startText","endText","handleEditSubscription","subscriptionId","sub","listConfigs","listSubscriptions","listSubscriptionsColumns","selectedCount","handleMoveToList","handleExportSelected","ListAccordions","listConfig","capacity","subscriptions","tableOptions","occupancyPercentage","occupancyColor","fixedTableOptions","Accordion","AccordionSummary","BallotIcon","PersonAddIcon","LinearProgress","AccordionDetails","handleCloseMoveToListModal","CalendarTodayIcon","EuroIcon","AdjustIcon","DescriptionIcon","ProtectedRoute","requiredPermission","EmailVerification","uid","ResetPassword","confirmPassword","setConfirmPassword","handleResetPassword","TransactionModal","transaction","accRes","accJson","validate","hasError","acc","transactionTypes","TransactionsList","transactions","setTransactions","selectedTransaction","setSelectedTransaction","refreshTransactionsData","txRes","txJson","handleCloseTransactionModal","EditButton","onEdit","onCancel","onSave","saving","isEditing","setIsEditing","handleEditClick","handleCancelClick","handleSaveClick","CancelIcon","SaveIcon","CrudTable","cols","initialData","onDelete","onCreate","createText","canCreate","canDelete","canEdit","sortColumn","editText","values","new_doc","updatedData","AddCircleOutlineIcon","ESNcardEmissionModal","profile","amount","setAmount","retrieveFees","profileFieldRules","Profile","setSaving","setProfile","ESNcardModalOpen","setESNcardModalOpen","esncardErrors","setESNcardErrors","documentErrors","setDocumentErrors","setProfileType","setUpdatedData","setReadOnly","update","rules","shouldHideField","fieldName","refreshProfileData","handleOpenESNcardModal","handleCloseESNcardModal","esncard_columns","isExpired","saveESNcard","document_columns","deleteDocument","createDocument","val","saveDocument","toggleEdit","edit","k","handleSave","prevErrors","updatedErrors","Person","School","Group","Toolbar","App","Router","Routes","Route","Sentry.init","theme","createTheme","root","Sentry.ErrorBoundary","ThemeProvider","itIT"],"mappings":"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"}